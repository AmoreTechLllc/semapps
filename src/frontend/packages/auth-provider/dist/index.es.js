import e,{useState as t,useEffect as r,useCallback as n,forwardRef as o}from"react";import{useTranslate as a,useGetList as i,useDataProvider as c,Loading as l,Error as s,usePermissionsOptimized as u,useAuthProvider as m,Button as d,ListButton as f,ShowButton as p,useRecordContext as h,DeleteButton as g,Toolbar as v,SaveButton as y,useNotify as b,useRedirect as w,Edit as E,EditButton as k,Show as C,useLogin as P,Notification as x,useLogout as O,Resource as I,MenuItemLink as j,useGetIdentity as A,UserMenu as S}from"react-admin";import{TopToolbar as _,List as R,ListActions as U}from"@semapps/archipelago-layout";import T from"@material-ui/icons/Share";import{makeStyles as N,TextField as L,List as W,ListItem as G,ListItemAvatar as V,Avatar as $,ListItemText as D,ListItemSecondaryAction as M,IconButton as B,Menu as F,MenuItem as q,ListItemIcon as z,Dialog as H,DialogTitle as J,DialogContent as K,DialogActions as Q,Card as X,CardActions as Y,Button as Z}from"@material-ui/core";import ee from"@material-ui/lab/Autocomplete";import te from"@material-ui/icons/Person";import re from"@material-ui/icons/Edit";import ne from"@material-ui/icons/Check";import oe from"@material-ui/icons/Public";import ae from"@material-ui/icons/VpnLock";import ie from"@material-ui/icons/Group";import{ThemeProvider as ce}from"@material-ui/styles";import{makeStyles as le,createMuiTheme as se}from"@material-ui/core/styles";import ue from"@material-ui/icons/Lock";import me from"@material-ui/core/MenuItem";import de from"@material-ui/icons/PowerSettingsNew";import fe from"@material-ui/icons/AccountCircle";function pe(e,t,r,n,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,o)}function he(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){pe(a,n,o,i,c,"next",e)}function c(e){pe(a,n,o,i,c,"throw",e)}i(void 0)}))}}function ge(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ve(){return(ve=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(r),!0).forEach((function(t){ge(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ye(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function we(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function Ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}(e,t)||Ce(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ke(e){return function(e){if(Array.isArray(e))return Pe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Ce(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ce(e,t){if(e){if("string"==typeof e)return Pe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Pe(e,t):void 0}}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function xe(e){this.message=e}xe.prototype=new Error,xe.prototype.name="InvalidCharacterError";var Oe="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new xe("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,o=0,a=0,i="";n=t.charAt(a++);~n&&(r=o%4?64*r+n:n,o++%4)?i+=String.fromCharCode(255&r>>(-2*o&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return i};function Ie(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(Oe(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return Oe(t)}}function je(e){this.message=e}function Ae(e,t){if("string"!=typeof e)throw new je("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(Ie(e.split(".")[r]))}catch(e){throw new je("Invalid token specified: "+e.message)}}je.prototype=new Error,je.prototype.name="InvalidTokenError";var Se="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var _e,Re,Ue=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t,r;t=Se,r=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var r=e.shift();e[0]=r+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(n>0&&(o=o.replace(/^[\/]+/,"")),o=n<e.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),t.push(o))}var a=t.join("/"),i=(a=a.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return a=i.shift()+(i.length>0?"?":"")+i.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=r():t.urljoin=r()})),Te=function(e){return e?Array.isArray(e)?e:[e]:void 0},Ne=function(e,t){return Ue(e,t.replace(e,"_acl/"))},Le=function(e){return{"@base":e,acl:"http://www.w3.org/ns/auth/acl#",foaf:"http://xmlns.com/foaf/0.1/","acl:agent":{"@type":"@id"},"acl:agentGroup":{"@type":"@id"},"acl:agentClass":{"@type":"@id"},"acl:mode":{"@type":"@id"},"acl:accessTo":{"@type":"@id"}}},We=function(e){var t,r,n,o,a,i,c=e.middlewareUri,l=e.allowAnonymous,s=void 0===l||l,u=e.checkUser,m=e.httpClient,d=e.checkPermissions,f=e.resources;return{login:(i=he(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new URL(window.location.href),window.location.href="".concat(c,"auth?redirectUrl=")+encodeURIComponent(r.origin+"/login?login=true");case 2:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)}),logout:(a=he(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new URL(window.location.href),s){e.next=6;break}localStorage.removeItem("token"),window.location.href="".concat(c,"auth/logout?redirectUrl=")+encodeURIComponent(t.origin+"/login"),e.next=8;break;case 6:return window.location.href="".concat(c,"auth/logout?redirectUrl=")+encodeURIComponent(t.origin+"/login?logout=true"),e.abrupt("return","/");case 8:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)}),checkAuth:(o=he(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.getItem("token")||s){e.next=3;break}throw new Error;case 3:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)}),checkUser:function(e){return!u||u(e)},checkError:function(e){return Promise.resolve()},getPermissions:(n=he(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=2;break}return e.abrupt("return",!0);case 2:return r=f[t]?f[t].containerUri:t,n=Ne(c,r),e.next=6,m(n);case 6:return o=e.sent,a=o.json,e.abrupt("return",a["@graph"]);case 9:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)}),addPermission:(r=he(regeneratorRuntime.mark((function e(t,r,n,o){var a,i,l,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=f[t]?f[t].containerUri:t,l=Ne(c,i),ge(a={"@id":"#"+o.replace("acl:",""),"@type":"acl:Authorization"},n,r),ge(a,"acl:accessTo",i),ge(a,"acl:mode",o),s=a,e.next=5,m(l,{method:"PATCH",body:JSON.stringify({"@context":Le(l),"@graph":[s]})});case 5:case"end":return e.stop()}}),e)}))),function(e,t,n,o){return r.apply(this,arguments)}),removePermission:(t=he(regeneratorRuntime.mark((function e(t,r,n,o){var a,i,l,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=f[t]?f[t].containerUri:t,i=Ne(c,a),e.next=4,m(i);case 4:return l=e.sent,s=l.json,u=s["@graph"].filter((function(e){return!e["@id"].includes("#Default")})).map((function(e){var t=Te(e["acl:mode"]),a=Te(e[n]);return o&&t.includes(o)&&a&&a.includes(r)&&(a=a.filter((function(e){return e!==r}))),be(be({},e),{},ge({},n,a))})),e.next=9,m(i,{method:"PUT",body:JSON.stringify({"@context":Le(i),"@graph":u})});case 9:case"end":return e.stop()}}),e)}))),function(e,r,n,o){return t.apply(this,arguments)}),getIdentity:function(){var e=localStorage.getItem("token");if(e){var t=Ae(e);return{id:t.webId,fullName:t.name}}}}},Ge="acl:agentClass",Ve=["acl:Append","acl:Write","acl:Control"],$e=["acl:Append","acl:Write","acl:Control"],De=["acl:Write","acl:Control"],Me=["acl:Control"],Be=(ge(_e={},"acl:Read","auth.right.resource.read"),ge(_e,"acl:Append","auth.right.resource.append"),ge(_e,"acl:Write","auth.right.resource.write"),ge(_e,"acl:Control","auth.right.resource.control"),_e),Fe=(ge(Re={},"acl:Read","auth.right.container.read"),ge(Re,"acl:Write","auth.right.container.write"),ge(Re,"acl:Control","auth.right.container.control"),Re),qe=N((function(){return{list:{padding:0,width:"100%"},option:{padding:0}}})),ze=function(n){var o=n.agents,c=n.addPermission,l=qe(),s=a(),u=Ee(t(null),2),m=u[0],d=u[1],f=Ee(t(""),2),p=f[0],h=f[1],g=Ee(t([]),2),v=g[0],y=g[1],b=i("Person",{page:1,perPage:100},{field:"pair:label",order:"ASC"},{q:p},{enabled:p.length>0}),w=b.ids,E=b.data;return r((function(){y(w.length>0?Object.values(E):[])}),[w,E]),e.createElement(ee,{classes:{option:l.option},getOptionLabel:function(e){return e["pair:label"]},filterOptions:function(e){return e.filter((function(e){return!Object.keys(o).includes(e.id)}))},options:v,noOptionsText:s("ra.navigation.no_results"),autoComplete:!0,blurOnSelect:!0,clearOnBlur:!0,disableClearable:!0,value:m,onChange:function(e,t){c(t.id||t["@id"],"acl:agent","acl:Read"),d(null),h(""),y([])},onInputChange:function(e,t){h(t)},renderInput:function(t){return e.createElement(L,ve({},t,{label:s("auth.input.agent_select"),variant:"filled",margin:"dense",fullWidth:!0}))},renderOption:function(t){return e.createElement(W,{dense:!0,className:l.list},e.createElement(G,{button:!0},e.createElement(V,null,e.createElement($,{src:t.image},e.createElement(te,null))),e.createElement(D,{primary:t["pair:label"]})))}})},He=function(t){var r=t.agent;switch(r.predicate){case Ge:return"foaf:Agent"===r.id?e.createElement(oe,null):e.createElement(ae,null);case"acl:agent":return e.createElement(te,null);case"acl:agentGroup":return e.createElement(ie,null);default:throw new Error("Unknown agent predicate: "+r.predicate)}},Je=N((function(){return{listItem:{paddingLeft:4,paddingRight:36},primaryText:{width:"30%",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},secondaryText:{textAlign:"center",width:"60%",fontStyle:"italic",color:"grey"}}})),Ke=function(n){var o=n.isContainer,i=n.agent,u=n.addPermission,m=n.removePermission,d=Je(),f=a(),p=c(),h=Ee(e.useState(null),2),g=h[0],v=h[1],y=Ee(t(),2),b=y[0],w=y[1],E=Ee(t(!0),2),k=E[0],C=E[1],P=Ee(t(),2),x=P[0],O=P[1];if(r((function(){"acl:agent"===i.predicate?p.getOne("Person",{id:i.id}).then((function(e){var t=e.data;w(t),C(!1)})).catch((function(e){O(e),C(!1)})):C(!1)}),[i.id,i.predicate]),"acl:agentGroup"===i.predicate)return null;var I=function(){return v(null)},j=o?Fe:Be;return k?e.createElement(l,null):x?e.createElement(s,null):e.createElement(G,{className:d.listItem},e.createElement(V,null,e.createElement($,{src:null==b?void 0:b.image},e.createElement(He,{agent:i}))),e.createElement(D,{className:d.primaryText,primary:b?b["pair:label"]:f("foaf:Agent"===i.id?"auth.agent.anonymous":"auth.agent.authenticated")}),e.createElement(D,{className:d.secondaryText,primary:i.permissions&&i.permissions.map((function(e){return f(j[e])})).join(", ")}),e.createElement(M,null,e.createElement(B,{onClick:function(e){return v(e.currentTarget)}},e.createElement(re,null)),e.createElement(F,{anchorEl:g,keepMounted:!0,open:Boolean(g),onClose:I},Object.entries(j).map((function(t){var r=Ee(t,2),n=r[0],o=r[1],a=i.permissions&&i.permissions.includes(n);return e.createElement(q,{key:n,onClick:function(){a?m(i.id,i.predicate,n):u(i.id,i.predicate,n),I()}},e.createElement(z,null,a?e.createElement(ne,null):null),e.createElement(D,{primary:f(o)}))})))))},Qe=N((function(e){return{list:{width:"100%",maxWidth:"100%",backgroundColor:e.palette.background.paper}}})),Xe=function(t){var r=t.isContainer,n=t.agents,o=t.addPermission,a=t.removePermission,i=Qe();return e.createElement(W,{dense:!0,className:i.list},Object.entries(n).map((function(t){var n=Ee(t,2),i=n[0],c=n[1];return e.createElement(Ke,{key:i,isContainer:r,agent:c,addPermission:o,removePermission:a})})))},Ye=function(e){var o=u(e).permissions,a=m(),i=Ee(t({}),2),c=i[0],l=i[1];r((function(){var e,t=(ge(e={},"foaf:Agent",{id:"foaf:Agent",predicate:Ge,permissions:[]}),ge(e,"acl:AuthenticatedAgent",{id:"acl:AuthenticatedAgent",predicate:Ge,permissions:[]}),e),r=function(e,r,n){t[e]?t[e].permissions.push(n):t[e]={id:e,predicate:r,permissions:[n]}};if(o){var n,a=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=Ce(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}(o);try{var i=function(){var e=n.value;e[Ge]&&Te(e[Ge]).forEach((function(t){return r(t,Ge,e["acl:mode"])})),e["acl:agent"]&&Te(e["acl:agent"]).forEach((function(t){return r(t,"acl:agent",e["acl:mode"])})),e["acl:agentGroup"]&&Te(e["acl:agentGroup"]).forEach((function(t){return r(t,"acl:agentGroup",e["acl:mode"])}))};for(a.s();!(n=a.n()).done;)i()}catch(e){a.e(e)}finally{a.f()}l(t)}}),[o]);var s=n((function(t,r,n){var o,i=be({},c);l(be(be({},c),{},ge({},t,{id:t,predicate:r,permissions:c[t]?[].concat(ke(null===(o=c[t])||void 0===o?void 0:o.permissions),[n]):[n]}))),a.addPermission(e,t,r,n).catch((function(e){l(i)}))}),[c,l,e,a]),d=n((function(t,r,n){var o=be({},c);l(Object.fromEntries(Object.entries(c).map((function(e){var r=Ee(e,2),o=r[0],a=r[1];return a.id===t&&(a.permissions=a.permissions.filter((function(e){return e!==n}))),[o,a]})).filter((function(e){var t=Ee(e,2),r=(t[0],t[1]);return r.predicate===Ge||r.permissions.length>0})))),a.removePermission(e,t,r,n).catch((function(e){l(o)}))}),[c,l,e,a]);return{agents:c,addPermission:s,removePermission:d}},Ze=N((function(){return{title:{paddingBottom:8},actions:{padding:15},addForm:{paddingTop:0},listForm:{paddingTop:0,paddingBottom:0,paddingRight:0,maxHeight:210}}})),et=function(t){var r=t.open,n=t.onClose,o=t.resourceId,i=t.isContainer,c=Ze(),l=a(),s=Ye(o),u=s.agents,m=s.addPermission,f=s.removePermission;return e.createElement(H,{fullWidth:!0,open:r,onClose:n},e.createElement(J,{className:c.title},l(i?"auth.dialog.container_permissions":"auth.dialog.resource_permissions")),e.createElement(K,{className:c.addForm},e.createElement(ze,{agents:u,addPermission:m})),e.createElement(K,{className:c.listForm},e.createElement(Xe,{isContainer:i,agents:u,addPermission:m,removePermission:f})),e.createElement(Q,{className:c.actions},e.createElement(d,{label:"ra.action.close",variant:"text",onClick:n})))},tt=function(r){var n=r.record,o=r.resource,a=Ee(t(!1),2),i=a[0],c=a[1],l=!!o?o:n.id||n["@id"];return e.createElement(e.Fragment,null,e.createElement(d,{label:"auth.action.permissions",onClick:function(){return c(!0)}},e.createElement(T,null)),e.createElement(et,{resourceId:l,isContainer:!!o,open:i,onClose:function(){return c(!1)}}))},rt=function(t){var r=t.basePath,n=t.className,o=t.data,a=t.hasList,i=t.hasShow,c=t.hasControl,l=we(t,["basePath","className","data","hasList","hasShow","hasControl"]);return e.createElement(_,ve({className:n},l),a&&e.createElement(f,{basePath:r,record:o}),i&&e.createElement(p,{basePath:r,record:o}),o&&c&&e.createElement(tt,{basePath:r,record:o}))},nt=function(t){var r=h(),n=u(r.id).permissions;return n&&n.some((function(e){return De.includes(e["acl:mode"])}))?e.createElement(g,t):null},ot=N((function(){return{toolbar:{flex:1,display:"flex",justifyContent:"space-between"}}})),at=function(t){var r=ot();return e.createElement(v,ve({},t,{className:r.toolbar}),e.createElement(y,null),e.createElement(nt,{undoable:!1}),"}")},it=function(t){var n=u(t.id).permissions,o=b(),a=w();return r((function(){n&&!n.some((function(e){return $e.includes(e["acl:mode"])}))&&(o("auth.message.resource_edit_forbidden","error"),a(t.basePath))}),[n,a,o]),e.createElement(E,ve({actions:e.createElement(rt,{hasControl:!!n&&n.some((function(e){return Me.includes(e["acl:mode"])}))})},t,{permissions:n}),e.cloneElement(t.children,be({toolbar:e.createElement(at,null)},t.children.props)))},ct=function(t){var r=t.actions,n=t.resource,o=t.hasCreate,a=we(t,["actions","resource","hasCreate"]),i=u(n).permissions;return e.createElement(R,ve({},a,{resource:n,hasCreate:o&&!!i&&i.some((function(e){return Ve.includes(e["acl:mode"])})),actions:r&&i&&i.some((function(e){return Me.includes(e["acl:mode"])}))?e.cloneElement(r,{bulkActions:e.createElement(tt,null)}):r}))};ct.defaultProps={actions:e.createElement(U,null)};var lt=function(t){var r=t.basePath,n=t.className,o=t.data,a=t.hasList,i=t.hasEdit,c=t.hasControl,l=we(t,["basePath","className","data","hasList","hasEdit","hasControl"]);return e.createElement(_,ve({className:n},l),a&&e.createElement(f,{basePath:r,record:o}),i&&e.createElement(k,{basePath:r,record:o}),o&&c&&e.createElement(tt,{basePath:r,record:o}))},st=function(t){var r=u(t.id).permissions;return e.createElement(C,ve({actions:e.createElement(lt,{hasControl:!!r&&r.some((function(e){return Me.includes(e["acl:mode"])}))})},t,{permissions:r,hasEdit:t.hasEdit&&!!r&&r.some((function(e){return $e.includes(e["acl:mode"])}))}))},ut=le((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",alignItems:"center",justifyContent:"flex-start",backgroundColor:e.palette.primary[500]},card:{minWidth:300,marginTop:"6em"},lockIconAvatar:{margin:"1em",display:"flex",justifyContent:"center"},lockIcon:{backgroundColor:e.palette.secondary[500]}}})),mt=function(t){var n=t.theme,o=t.history,a=t.location,i=t.buttons,l=t.userResource,s=ut(),u=b(),d=P(),f=c(),p=m();return r((function(){he(regeneratorRuntime.mark((function e(){var t,r,n,i,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=new URLSearchParams(a.search)).has("login")){e.next=14;break}if(!t.has("error")){e.next=6;break}"registration.not-allowed"===t.get("error")?u("auth.message.user_email_not_found","error"):u("auth.message.bad_request","error",{error:t.get("error")}),e.next=14;break;case 6:if(!t.has("token")){e.next=14;break}return r=t.get("token"),n=Ae(r),i=n.webId,e.next=11,f.getOne("Person",{id:i});case 11:c=e.sent,s=c.data,p.checkUser(s)?(localStorage.setItem("token",r),t.has("new")&&"true"===t.get("new")?(u("auth.message.new_user_created","info"),o.push("/"+l+"/"+encodeURIComponent(i)+"/edit")):(u("auth.message.user_connected","info"),o.push("/"))):(u("auth.message.user_not_allowed_to_login","error"),o.replace("/login"));case 14:t.has("logout")&&(localStorage.removeItem("token"),u("auth.message.user_disconnected","info"),o.push("/"));case 15:case"end":return e.stop()}}),e)})))()}),[a.search]),e.createElement(ce,{theme:se(n)},e.createElement("div",{className:s.main},e.createElement(X,{className:s.card},e.createElement("div",{className:s.lockIconAvatar},e.createElement($,{className:s.lockIcon},e.createElement(ue,null))),i&&i.map((function(t,r){return e.createElement(Y,{key:r},e.cloneElement(t,{fullWidth:!0,variant:"outlined",type:"submit",onClick:function(){return d({},"/login")}}))})))),e.createElement(x,null))};mt.defaultProps={buttons:[e.createElement(Z,{startIcon:e.createElement($,{src:"/lescommuns.jpg"})},"Les Communs")],userResource:"Person"};var dt=o((function(t,r){var n=O();return e.createElement(me,{onClick:function(){return n()},ref:r},e.createElement(de,null),"   Se déconnecter")})),ft=function(t){var r=t.name,n=t.create,o=we(t,["name","create"]),a=u(r).permissions;return e.createElement(I,ve({},o,{name:r,create:a&&a.some((function(e){return Ve.includes(e["acl:mode"])}))?n:void 0}))},pt=o((function(t,r){var n=t.onClick,o=t.webId;return e.createElement(j,{ref:r,to:"/Person/".concat(encodeURIComponent(o),"/show"),primaryText:"Voir mon profil",leftIcon:e.createElement(fe,null),onClick:n})})),ht=o((function(t,r){var n=t.onClick,o=t.webId;return e.createElement(j,{ref:r,to:"/Person/".concat(encodeURIComponent(o),"/edit"),primaryText:"Editer mon profil",leftIcon:e.createElement(re,null),onClick:n})})),gt=o((function(t,r){var n=t.onClick;return e.createElement(j,{ref:r,to:"/login",primaryText:"Se connecter",onClick:n})})),vt=function(t){var r=t.logout,n=we(t,["logout"]),o=A().identity;return e.createElement(S,n,o&&""!==o.id?[e.createElement(pt,{webId:o.id,key:"view"}),e.createElement(ht,{webId:o.id,key:"edit"}),e.cloneElement(r,{key:"logout"})]:e.createElement(gt,null))},yt={auth:{dialog:{container_permissions:"Permissions sur le container",resource_permissions:"Permissions sur la resource"},action:{permissions:"Permissions"},right:{resource:{read:"Lire",append:"Enrichir",write:"Modifier",control:"Administrer"},container:{read:"Lister",append:"Ajouter",write:"Ajouter",control:"Administrer"}},agent:{anonymous:"Tous les utilisateurs",authenticated:"Utilisateurs connectés"},input:{agent_select:"Ajouter un utilisateur..."},message:{resource_edit_forbidden:"Vous n'avez pas la permission d'éditer cette ressource",user_not_allowed_to_login:"Vous n'avez pas le droit de vous connecter avec ce compte",user_email_not_found:"Aucun compte trouvé avec cette adresse mail",new_user_created:"Votre compte a été créé, vous pouvez maintenant le compléter",user_connected:"Vous êtes maintenant connecté",user_disconnected:"Vous êtes maintenant déconnecté",bad_request:"Requête erronée (Message d'erreur renvoyé par le serveur: %{error})"}}};export{nt as DeleteButtonWithPermissions,rt as EditActions,at as EditToolbarWithPermissions,it as EditWithPermissions,ct as ListWithPermissions,mt as LoginPage,dt as LogoutButton,tt as PermissionsButton,ft as ResourceWithPermissions,lt as ShowActions,st as ShowWithPermissions,vt as UserMenu,We as authProvider,yt as frenchMessages};
//# sourceMappingURL=index.es.js.map
