import*as e from"react";import t,{useEffect as r,useState as n,useCallback as a,useMemo as o,forwardRef as i}from"react";import{useGetIdentity as c,usePermissionsOptimized as s,useNotify as u,useRedirect as l,Create as d,CreateActions as m,useTranslate as p,useGetList as f,useDataProvider as h,Loading as g,Error as v,useAuthProvider as b,Button as y,TopToolbar as w,ListButton as _,ShowButton as E,useRecordContext as j,DeleteButton as x,Toolbar as k,SaveButton as P,Edit as O,useResourceDefinition as C,CreateButton as S,ExportButton as A,List as I,EditButton as R,Show as T,useLogin as U,Notification as N,useSafeSetState as z,LoginForm as L,useLogout as W,Resource as V,UserMenu as F,MenuItemLink as D,useGetPermissions as Y}from"react-admin";import{useCreateContainer as q}from"@semapps/semantic-data-provider";import B from"@material-ui/icons/Share";import{makeStyles as M,TextField as $,List as H,ListItem as G,ListItemAvatar as J,Avatar as K,ListItemText as Q,ListItemSecondaryAction as X,IconButton as Z,Menu as ee,MenuItem as te,ListItemIcon as re,Dialog as ne,DialogTitle as ae,DialogContent as oe,DialogActions as ie,useMediaQuery as ce,DialogContentText as se,Button as ue,Card as le,Typography as de,CardActions as me,CircularProgress as pe,createTheme as fe,ThemeProvider as he}from"@material-ui/core";import ge from"@material-ui/lab/Autocomplete";import ve from"@material-ui/icons/Person";import be from"@material-ui/icons/Edit";import ye from"@material-ui/icons/Check";import we from"@material-ui/icons/Public";import _e from"@material-ui/icons/VpnLock";import Ee from"@material-ui/icons/Group";import{ThemeProvider as je}from"@material-ui/styles";import{makeStyles as xe,createTheme as ke}from"@material-ui/core/styles";import Pe from"@material-ui/icons/Lock";import{useLocation as Oe,Redirect as Ce,Link as Se}from"react-router-dom";import{Form as Ae,Field as Ie}from"react-final-form";import Re from"@material-ui/icons/PowerSettingsNew";import Te from"@material-ui/icons/AccountCircle";function Ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(r),!0).forEach((function(t){We(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ue(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ze(e,t,r,n,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,a)}function Le(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){ze(o,n,a,i,c,"next",e)}function c(e){ze(o,n,a,i,c,"throw",e)}i(void 0)}))}}function We(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ve(){return(Ve=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Fe(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function De(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,o=[],i=!0,c=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(c)throw a}}return o}(e,t)||qe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ye(e){return function(e){if(Array.isArray(e))return Be(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||qe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qe(e,t){if(e){if("string"==typeof e)return Be(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Be(e,t):void 0}}function Be(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Me(e){this.message=e}Me.prototype=new Error,Me.prototype.name="InvalidCharacterError";var $e="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new Me("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,a=0,o=0,i="";n=t.charAt(o++);~n&&(r=a%4?64*r+n:n,a++%4)?i+=String.fromCharCode(255&r>>(-2*a&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return i};function He(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent($e(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return $e(t)}}function Ge(e){this.message=e}function Je(e,t){if("string"!=typeof e)throw new Ge("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(He(e.split(".")[r]))}catch(e){throw new Ge("Invalid token specified: "+e.message)}}Ge.prototype=new Error,Ge.prototype.name="InvalidTokenError";var Ke="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Qe(e,t){return e(t={exports:{}},t.exports),t.exports}var Xe,Ze,et=Qe((function(e){var t,r;t=Ke,r=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var r=e.shift();e[0]=r+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<e.length;n++){var a=e[n];if("string"!=typeof a)throw new TypeError("Url must be a string. Received "+a);""!==a&&(n>0&&(a=a.replace(/^[\/]+/,"")),a=n<e.length-1?a.replace(/[\/]+$/,""):a.replace(/[\/]+$/,"/"),t.push(a))}var o=t.join("/"),i=(o=o.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return o=i.shift()+(i.length>0?"?":"")+i.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=r():t.urljoin=r()})),tt=function(e){return e?Array.isArray(e)?e:[e]:void 0},rt=function(e){var t=new URL(e);return et(t.origin,"_acl",t.pathname)},nt=function(e){return{"@base":e,acl:"http://www.w3.org/ns/auth/acl#",foaf:"http://xmlns.com/foaf/0.1/","acl:agent":{"@type":"@id"},"acl:agentGroup":{"@type":"@id"},"acl:agentClass":{"@type":"@id"},"acl:mode":{"@type":"@id"},"acl:accessTo":{"@type":"@id"}}},at=["username","email","password","domain"],ot=function(e){var t,r,n,a,o,i,c,s,u,l,d,m,p=e.middlewareUri,f=e.allowAnonymous,h=void 0===f||f,g=e.localAccounts,v=void 0!==g&&g,b=e.checkUser,y=e.httpClient,w=e.checkPermissions;return{login:(m=Le(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,c,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new URL(window.location.href),n=p||t.domain&&"https://".concat(t.domain,"/")){e.next=4;break}throw new Error("You must specify a middlewareUri in the authProvider config, or specify a domain when calling the login method");case 4:if(!v){e.next=21;break}return a=t.username,o=t.password,e.prev=6,e.next=9,y("".concat(n,"auth/login"),{method:"POST",body:JSON.stringify({username:a.trim(),password:o.trim()}),headers:new Headers({"Content-Type":"application/json"})});case 9:i=e.sent,c=i.json,s=c.token,localStorage.setItem("token",s),window.location.reload(),e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(6),new Error("ra.auth.sign_in_error");case 19:e.next=24;break;case 21:u=r.origin+"/login?login=true",t.redirect&&(u+="&redirect="+encodeURIComponent(t.redirect)),window.location.href="".concat(n,"auth?redirectUrl=")+encodeURIComponent(u);case 24:case"end":return e.stop()}}),e,null,[[6,16]])}))),function(e){return m.apply(this,arguments)}),signup:(d=Le(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,c,s,u,l,d,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p||t.domain&&"https://".concat(t.domain,"/")){e.next=3;break}throw new Error("You must specify a middlewareUri in the authProvider config, or specify a domain when calling the signup method");case 3:if(!v){e.next=33;break}return n=t.username,a=t.email,o=t.password,i=t.domain,c=Fe(t,at),e.prev=5,e.next=8,y("".concat(r||"https://".concat(i),"auth/signup"),{method:"POST",body:JSON.stringify(Ne({username:n.trim(),email:a.trim(),password:o.trim()},c)),headers:new Headers({"Content-Type":"application/json"})});case 8:return s=e.sent,u=s.json,l=u.token,localStorage.setItem("token",l),d=Je(l),m=d.webId,e.abrupt("return",m);case 16:if(e.prev=16,e.t0=e.catch(5),"email.already.exists"!==e.t0.message){e.next=22;break}throw new Error("auth.message.user_email_exist");case 22:if("username.already.exists"!==e.t0.message){e.next=26;break}throw new Error("auth.message.username_exist");case 26:if("username.invalid"!==e.t0.message){e.next=30;break}throw new Error("auth.message.username_invalid");case 30:throw new Error(e.t0.message||"ra.auth.sign_in_error");case 31:e.next=34;break;case 33:window.location.href="".concat(r,"auth?redirectUrl=")+encodeURIComponent(url.origin+"/login?login=true");case 34:case"end":return e.stop()}}),e,null,[[5,16]])}))),function(e){return d.apply(this,arguments)}),logout:(l=Le(regeneratorRuntime.mark((function e(){var t,r,n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p?t=p:(r=localStorage.getItem("token"))&&(n=Je(r),a=n.webId,t=new URL(a).origin+"/"),localStorage.removeItem("token"),v?(window.location.reload(),window.location.href="/"):t&&(o=new URL(window.location.href),window.location.href=h?"".concat(t,"auth/logout?redirectUrl=")+encodeURIComponent(o.origin+"/login?logout=true"):"".concat(t,"auth/logout?redirectUrl=")+encodeURIComponent(o.origin+"/login")),e.abrupt("return","/");case 4:case"end":return e.stop()}}),e)}))),function(){return l.apply(this,arguments)}),checkAuth:(u=Le(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.getItem("token")||h){e.next=3;break}throw new Error;case 3:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)}),checkUser:function(e){return!b||b(e)},checkError:function(e){return Promise.resolve()},getPermissions:(s=Le(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.startsWith(p)){e.next=2;break}return e.abrupt("return",!1);case 2:if(w){e.next=4;break}return e.abrupt("return",!0);case 4:if(t&&t.startsWith("http")){e.next=6;break}throw new Error("The first parameter passed to getPermissions must be an URL");case 6:return r=rt(t),e.next=9,y(r);case 9:return n=e.sent,a=n.json,e.abrupt("return",a["@graph"]);case 12:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)}),addPermission:(c=Le(regeneratorRuntime.mark((function e(t,r,n,a){var o,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.startsWith("http")){e.next=2;break}throw new Error("The first parameter passed to addPermission must be an URL");case 2:return t.startsWith(p),i=rt(t),We(o={"@id":"#"+a.replace("acl:",""),"@type":"acl:Authorization"},n,r),We(o,"acl:accessTo",t),We(o,"acl:mode",a),c=o,e.next=7,y(i,{method:"PATCH",body:JSON.stringify({"@context":nt(i),"@graph":[c]})});case 7:case"end":return e.stop()}}),e)}))),function(e,t,r,n){return c.apply(this,arguments)}),removePermission:(i=Le(regeneratorRuntime.mark((function e(t,r,n,a){var o,i,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.startsWith("http")){e.next=2;break}throw new Error("The first parameter passed to removePermission must be an URL");case 2:if(t.startsWith(p)){e.next=4;break}throw new Error("Cannot remove permissions on servers other than the one used for auth");case 4:return o=rt(t),e.next=7,y(o);case 7:return i=e.sent,c=i.json,s=c["@graph"].filter((function(e){return!e["@id"].includes("#Default")})).map((function(e){var t=tt(e["acl:mode"]),o=tt(e[n]);return a&&t.includes(a)&&o&&o.includes(r)&&(o=o.filter((function(e){return e!==r}))),Ne(Ne({},e),{},We({},n,o))})),e.next=12,y(o,{method:"PUT",body:JSON.stringify({"@context":nt(o),"@graph":s})});case 12:case"end":return e.stop()}}),e)}))),function(e,t,r,n){return i.apply(this,arguments)}),getIdentity:(o=Le(regeneratorRuntime.mark((function e(){var t,r,n,a,o,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=localStorage.getItem("token"))){e.next=17;break}return r=Je(t),n=r.webId,e.next=5,y(n);case 5:if(a=e.sent,!(o=a.json).url){e.next=13;break}return e.next=10,y(o.url);case 10:e.t0=e.sent,e.next=14;break;case 13:e.t0={};case 14:return i=e.t0,c=i.json,e.abrupt("return",{id:n,fullName:(null==c?void 0:c["vcard:given-name"])||(null==c?void 0:c["pair:label"])||o["foaf:name"],profileData:c,webIdData:o});case 17:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)}),resetPassword:(a=Le(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p||t.domain&&"https://".concat(t.domain,"/")){e.next=3;break}throw new Error("You must specify a middlewareUri in the authProvider config, or specify a domain when calling the forgot password method");case 3:return n=t.email,e.prev=4,e.next=7,y("".concat(r,"auth/reset_password"),{method:"POST",body:JSON.stringify({email:n.trim()}),headers:new Headers({"Content-Type":"application/json"})});case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(4),new Error("app.notification.reset_password_error");case 12:case"end":return e.stop()}}),e,null,[[4,9]])}))),function(e){return a.apply(this,arguments)}),setNewPassword:(n=Le(regeneratorRuntime.mark((function e(t){var r,n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p||t.domain&&"https://".concat(t.domain,"/")){e.next=3;break}throw new Error("You must specify a middlewareUri in the authProvider config, or specify a domain when calling the new password method");case 3:return n=t.email,a=t.token,o=t.password,e.prev=4,e.next=7,y("".concat(r,"auth/new_password"),{method:"POST",body:JSON.stringify({email:n.trim(),token:a,password:o}),headers:new Headers({"Content-Type":"application/json"})});case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(4),new Error("app.notification.new_password_error");case 12:case"end":return e.stop()}}),e,null,[[4,9]])}))),function(e){return n.apply(this,arguments)}),getAccountSettings:(r=Le(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p||t.domain&&"https://".concat(t.domain,"/")){e.next=3;break}throw new Error("You must specify a middlewareUri in the authProvider config, or specify a domain when calling the getAccountSettings method");case 3:return e.prev=3,e.next=6,y("".concat(r,"auth/account"),{method:"GET"});case 6:return n=e.sent,a=n.json,e.abrupt("return",a);case 11:throw e.prev=11,e.t0=e.catch(3),new Error("app.notification.get_settings_error");case 14:case"end":return e.stop()}}),e,null,[[3,11]])}))),function(e){return r.apply(this,arguments)}),updateAccountSettings:(t=Le(regeneratorRuntime.mark((function e(t){var r,n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p||t.domain&&"https://".concat(t.domain,"/")){e.next=3;break}throw new Error("You must specify a middlewareUri in the authProvider config, or specify a domain when calling the updateAccountSettings method");case 3:return e.prev=3,n=t.email,a=t.currentPassword,o=t.newPassword,e.next=7,y("".concat(r,"auth/account"),{method:"POST",body:JSON.stringify({currentPassword:a,email:n.trim(),newPassword:o}),headers:new Headers({"Content-Type":"application/json"})});case 7:e.next=14;break;case 9:if(e.prev=9,e.t0=e.catch(3),"auth.account.invalid_password"!==e.t0.message){e.next=13;break}throw new Error("app.notification.invalid_password");case 13:throw new Error("app.notification.update_settings_error");case 14:case"end":return e.stop()}}),e,null,[[3,9]])}))),function(e){return t.apply(this,arguments)})}},it="acl:agentClass",ct=["acl:Append","acl:Write","acl:Control"],st=["acl:Append","acl:Write","acl:Control"],ut=["acl:Write","acl:Control"],lt=["acl:Control"],dt={show:["acl:Read","acl:Append","acl:Write","acl:Control"],list:["acl:Read","acl:Append","acl:Write","acl:Control"],create:ct,edit:st,delete:ut,control:lt},mt={show:"auth.message.resource_show_forbidden",edit:"auth.message.resource_edit_forbidden",delete:"auth.message.resource_delete_forbidden",control:"auth.message.resource_control_forbidden",list:"auth.message.container_list_forbidden",create:"auth.message.container_create_forbidden"},pt=(We(Xe={},"acl:Read","auth.right.resource.read"),We(Xe,"acl:Append","auth.right.resource.append"),We(Xe,"acl:Write","auth.right.resource.write"),We(Xe,"acl:Control","auth.right.resource.control"),Xe),ft=(We(Ze={},"acl:Read","auth.right.container.read"),We(Ze,"acl:Write","auth.right.container.write"),We(Ze,"acl:Control","auth.right.container.control"),Ze),ht=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",a=c(),o=a.identity,i=a.loading,d=s(e),m=d.permissions,p=u(),f=l();return r((function(){!i&&o&&m&&!m.some((function(e){return dt[t].includes(e["acl:mode"])}))&&(p(mt[t],"error"),f(n))}),[m,o,f,p,i]),m},gt=function(e){var r=q(e.resource);return ht(r,"create"),t.createElement(d,e)};gt.defaultProps={actions:t.createElement(m,null)};var vt=M((function(){return{list:{padding:0,width:"100%"},option:{padding:0}}})),bt=function(e){var a=e.agents,o=e.addPermission,i=vt(),c=p(),s=De(n(null),2),u=s[0],l=s[1],d=De(n(""),2),m=d[0],h=d[1],g=De(n([]),2),v=g[0],b=g[1],y=f("Person",{page:1,perPage:100},{field:"pair:label",order:"ASC"},{q:m},{enabled:m.length>0}),w=y.ids,_=y.data;return r((function(){b(w.length>0?Object.values(_):[])}),[w,_]),t.createElement(ge,{classes:{option:i.option},getOptionLabel:function(e){return e["pair:label"]},filterOptions:function(e){return e.filter((function(e){return!Object.keys(a).includes(e.id)}))},options:v,noOptionsText:c("ra.navigation.no_results"),autoComplete:!0,blurOnSelect:!0,clearOnBlur:!0,disableClearable:!0,value:u,onChange:function(e,t){o(t.id||t["@id"],"acl:agent","acl:Read"),l(null),h(""),b([])},onInputChange:function(e,t){h(t)},renderInput:function(e){return t.createElement($,Ve({},e,{label:c("auth.input.agent_select"),variant:"filled",margin:"dense",fullWidth:!0}))},renderOption:function(e){return t.createElement(H,{dense:!0,className:i.list},t.createElement(G,{button:!0},t.createElement(J,null,t.createElement(K,{src:e.image},t.createElement(ve,null))),t.createElement(Q,{primary:e["pair:label"]})))}})},yt=function(e){var r=e.agent;switch(r.predicate){case it:return"foaf:Agent"===r.id?t.createElement(we,null):t.createElement(_e,null);case"acl:agent":return t.createElement(ve,null);case"acl:agentGroup":return t.createElement(Ee,null);default:throw new Error("Unknown agent predicate: "+r.predicate)}},wt=M((function(){return{listItem:{paddingLeft:4,paddingRight:36},primaryText:{width:"30%",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},secondaryText:{textAlign:"center",width:"60%",fontStyle:"italic",color:"grey"}}})),_t=function(e){var a=e.isContainer,o=e.agent,i=e.addPermission,c=e.removePermission,s=wt(),u=p(),l=h(),d=De(t.useState(null),2),m=d[0],f=d[1],b=De(n(),2),y=b[0],w=b[1],_=De(n(!0),2),E=_[0],j=_[1],x=De(n(),2),k=x[0],P=x[1];if(r((function(){"acl:agent"===o.predicate?l.getOne("Person",{id:o.id}).then((function(e){var t=e.data;w(t),j(!1)})).catch((function(e){P(e),j(!1)})):j(!1)}),[o.id,o.predicate]),"acl:agentGroup"===o.predicate)return null;var O=function(){return f(null)},C=a?ft:pt;return E?t.createElement(g,null):k?t.createElement(v,null):t.createElement(G,{className:s.listItem},t.createElement(J,null,t.createElement(K,{src:null==y?void 0:y.image},t.createElement(yt,{agent:o}))),t.createElement(Q,{className:s.primaryText,primary:y?y["pair:label"]:u("foaf:Agent"===o.id?"auth.agent.anonymous":"auth.agent.authenticated")}),t.createElement(Q,{className:s.secondaryText,primary:o.permissions&&o.permissions.map((function(e){return u(C[e])})).join(", ")}),t.createElement(X,null,t.createElement(Z,{onClick:function(e){return f(e.currentTarget)}},t.createElement(be,null)),t.createElement(ee,{anchorEl:m,keepMounted:!0,open:Boolean(m),onClose:O},Object.entries(C).map((function(e){var r=De(e,2),n=r[0],a=r[1],s=o.permissions&&o.permissions.includes(n);return t.createElement(te,{key:n,onClick:function(){s?c(o.id,o.predicate,n):i(o.id,o.predicate,n),O()}},t.createElement(re,null,s?t.createElement(ye,null):null),t.createElement(Q,{primary:u(a)}))})))))},Et=M((function(e){return{list:{width:"100%",maxWidth:"100%",backgroundColor:e.palette.background.paper}}})),jt=function(e){var r=e.isContainer,n=e.agents,a=e.addPermission,o=e.removePermission,i=Et();return t.createElement(H,{dense:!0,className:i.list},Object.entries(n).map((function(e){var n=De(e,2),i=n[0],c=n[1];return t.createElement(_t,{key:i,isContainer:r,agent:c,addPermission:a,removePermission:o})})))},xt=function(e){var t=s(e).permissions,o=b(),i=De(n({}),2),c=i[0],u=i[1];r((function(){var e,r=(We(e={},"foaf:Agent",{id:"foaf:Agent",predicate:it,permissions:[]}),We(e,"acl:AuthenticatedAgent",{id:"acl:AuthenticatedAgent",predicate:it,permissions:[]}),e),n=function(e,t,n){r[e]?r[e].permissions.push(n):r[e]={id:e,predicate:t,permissions:[n]}};if(t){var a,o=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=qe(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw o}}}}(t);try{var i=function(){var e=a.value;e[it]&&tt(e[it]).forEach((function(t){return n(t,it,e["acl:mode"])})),e["acl:agent"]&&tt(e["acl:agent"]).forEach((function(t){return n(t,"acl:agent",e["acl:mode"])})),e["acl:agentGroup"]&&tt(e["acl:agentGroup"]).forEach((function(t){return n(t,"acl:agentGroup",e["acl:mode"])}))};for(o.s();!(a=o.n()).done;)i()}catch(e){o.e(e)}finally{o.f()}u(r)}}),[t]);var l=a((function(t,r,n){var a,i=Ne({},c);u(Ne(Ne({},c),{},We({},t,{id:t,predicate:r,permissions:c[t]?[].concat(Ye(null===(a=c[t])||void 0===a?void 0:a.permissions),[n]):[n]}))),o.addPermission(e,t,r,n).catch((function(e){u(i)}))}),[c,u,e,o]),d=a((function(t,r,n){var a=Ne({},c);u(Object.fromEntries(Object.entries(c).map((function(e){var r=De(e,2),a=r[0],o=r[1];return o.id===t&&(o.permissions=o.permissions.filter((function(e){return e!==n}))),[a,o]})).filter((function(e){var t=De(e,2);t[0];var r=t[1];return r.predicate===it||r.permissions.length>0})))),o.removePermission(e,t,r,n).catch((function(e){u(a)}))}),[c,u,e,o]);return{agents:c,addPermission:l,removePermission:d}},kt=M((function(){return{title:{paddingBottom:8},actions:{padding:15},addForm:{paddingTop:0},listForm:{paddingTop:0,paddingBottom:0,paddingRight:0,maxHeight:210}}})),Pt=function(e){var r=e.open,n=e.onClose,a=e.uri,o=e.isContainer,i=kt(),c=p(),s=xt(a),u=s.agents,l=s.addPermission,d=s.removePermission;return t.createElement(ne,{fullWidth:!0,open:r,onClose:n},t.createElement(ae,{className:i.title},c(o?"auth.dialog.container_permissions":"auth.dialog.resource_permissions")),t.createElement(oe,{className:i.addForm},t.createElement(bt,{agents:u,addPermission:l})),t.createElement(oe,{className:i.listForm},t.createElement(jt,{isContainer:o,agents:u,addPermission:l,removePermission:d})),t.createElement(ie,{className:i.actions},t.createElement(y,{label:"ra.action.close",variant:"text",onClick:n})))},Ot=function(e){var r=e.record,a=e.resource,o=De(n(!1),2),i=o[0],c=o[1],s=q(a),u=!!a,l=u?s:r.id||r["@id"];return t.createElement(t.Fragment,null,t.createElement(y,{label:"auth.action.permissions",onClick:function(){return c(!0)}},t.createElement(B,null)),t.createElement(Pt,{uri:l,isContainer:!!u,open:i,onClose:function(){return c(!1)}}))},Ct=function(e){var r=e.basePath,n=e.record,a=e.hasList,o=e.hasShow,i=s(n.id).permissions;return t.createElement(w,null,a&&t.createElement(_,{basePath:r,record:n}),o&&t.createElement(E,{basePath:r,record:n}),!!i&&i.some((function(e){return lt.includes(e["acl:mode"])}))&&t.createElement(Ot,{basePath:r,record:n}))},St=function(e){var r=j(),n=s(r.id).permissions;return n&&n.some((function(e){return ut.includes(e["acl:mode"])}))?t.createElement(x,e):null},At=M((function(){return{toolbar:{flex:1,display:"flex",justifyContent:"space-between"}}})),It=function(e){var r=At();return t.createElement(k,Ve({},e,{className:r.toolbar}),t.createElement(P,null),t.createElement(St,{undoable:!1}),"}")},Rt=function(e){return ht(e.id,"edit"),t.createElement(O,e,t.cloneElement(e.children,Ne({toolbar:t.createElement(It,null)},e.children.props)))};Rt.defaultProps={actions:t.createElement(Ct,null)};var Tt=["bulkActions","basePath","currentSort","displayedFilters","exporter","filters","filterValues","onUnselectItems","resource","selectedIds","showFilter","total"],Ut=function(e){var r=e.bulkActions,n=e.basePath,a=e.currentSort,o=e.displayedFilters,i=e.exporter,c=e.filters,u=e.filterValues,l=e.onUnselectItems,d=e.resource,m=e.selectedIds,p=e.showFilter,f=e.total,h=Fe(e,Tt),g=ce((function(e){return e.breakpoints.down("xs")})),v=C(h),b=q(d),y=s(b).permissions;return t.createElement(w,null,c&&t.cloneElement(c,{resource:d,showFilter:p,displayedFilters:o,filterValues:u,context:"button"}),v.hasCreate&&y&&y.some((function(e){return ct.includes(e["acl:mode"])}))&&t.createElement(S,{basePath:n}),y&&y.some((function(e){return lt.includes(e["acl:mode"])}))&&t.createElement(Ot,{basePath:n,record:b}),!g&&!1!==i&&t.createElement(A,{disabled:0===f,resource:d,sort:a,filter:u,exporter:i}),r&&t.cloneElement(r,{basePath:n,filterValues:u,resource:d,selectedIds:m,onUnselectItems:l}))},Nt=function(e){return t.createElement(I,e)};Nt.defaultProps={actions:t.createElement(Ut,null)};var zt=function(e){var r=e.basePath,n=e.record,a=e.hasList,o=e.hasEdit,i=s(null==n?void 0:n.id).permissions;return t.createElement(w,null,a&&t.createElement(_,{basePath:r,record:n}),o&&i&&i.some((function(e){return st.includes(e["acl:mode"])}))&&t.createElement(R,{basePath:r,record:n}),i&&i.some((function(e){return lt.includes(e["acl:mode"])}))&&t.createElement(Ot,{basePath:r,record:n}))},Lt=function(e){return ht(e.id,"edit"),t.createElement(T,e)};Lt.defaultProps={actions:t.createElement(zt,null)};var Wt=["open","onClose","title","message","redirect"],Vt=function(e){var r=e.open,n=e.onClose,a=e.title,o=e.message,i=e.redirect,c=Fe(e,Wt),s=U(),u=p();return t.createElement(ne,Ve({open:r,onClose:n},c),t.createElement(ae,null,u(a)),t.createElement(oe,null,t.createElement(se,null,u(o))),t.createElement(ie,null,t.createElement(ue,{onClick:n},u("ra.action.cancel")),t.createElement(ue,{onClick:function(){return s({redirect:i||window.location.pathname+window.location.search})},color:"primary",variant:"contained"},u("auth.action.login"))))};Vt.defaultProps={title:"auth.dialog.login_required",message:"auth.message.login_to_continue"};var Ft=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Dt=xe((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",alignItems:"center",justifyContent:"flex-start",backgroundColor:e.palette.grey[300]},text:{maxWidth:300,textAlign:"center",padding:"4px 8px 8px"},card:{minWidth:300,marginTop:"6em"},lockIconAvatar:{margin:"1em",display:"flex",justifyContent:"center"},lockIcon:{backgroundColor:e.palette.grey[500]}}})),Yt=function(e){var n=e.theme,a=e.history,o=e.location,i=e.buttons,c=e.userResource,s=e.propertiesExist,l=e.text,d=Dt(),m=u(),p=U(),f=h(),g=b();return r((function(){Le(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=new URLSearchParams(o.search)).has("login")){e.next=8;break}if(!t.has("error")){e.next=6;break}"registration.not-allowed"===t.get("error")?m("auth.message.user_email_not_found","error"):m("auth.message.bad_request","error",{error:t.get("error")}),e.next=8;break;case 6:if(!t.has("token")){e.next=8;break}return e.delegateYield(regeneratorRuntime.mark((function e(){var r,n,o,i,u,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.get("token"),n=Je(r),o=n.webId,e.next=4,f.getOne(c,{id:o});case 4:if(u=e.sent,i=u.data,!(s.length>0)){e.next=19;break}l=s.every((function(e){return i[e]}));case 8:if(l){e.next=19;break}return console.log("Waiting for all properties to have been created",s),e.next=12,Ft(500);case 12:return e.next=14,f.getOne(c,{id:o});case 14:d=e.sent,i=d.data,l=s.every((function(e){return i[e]})),e.next=8;break;case 19:g.checkUser(i)?(localStorage.setItem("token",r),t.has("redirect")?(m("auth.message.user_connected","info"),a.push(t.get("redirect"))):t.has("new")&&"true"===t.get("new")?(m("auth.message.new_user_created","info"),a.push("/"+c+"/"+encodeURIComponent(o)+"/edit")):(m("auth.message.user_connected","info"),a.push("/"))):(m("auth.message.user_not_allowed_to_login","error"),a.replace("/login"));case 20:case"end":return e.stop()}}),e)}))(),"t0",8);case 8:t.has("logout")&&(localStorage.removeItem("token"),m("auth.message.user_disconnected","info"),a.push("/"));case 9:case"end":return e.stop()}}),e)})))()}),[o.search]),t.createElement(je,{theme:ke(n)},t.createElement("div",{className:d.main},t.createElement(le,{className:d.card},t.createElement("div",{className:d.lockIconAvatar},t.createElement(K,{className:d.lockIcon},t.createElement(Pe,null))),l&&t.createElement(de,{variant:"body2",className:d.text},l),i&&i.map((function(e,r){return t.createElement(me,{key:r},t.cloneElement(e,{fullWidth:!0,variant:"outlined",type:"submit",onClick:function(){return p({},"/login")}}))})))),t.createElement(N,null))};Yt.defaultProps={propertiesExist:[],buttons:[t.createElement(ue,{startIcon:t.createElement(K,{src:"/lescommuns.jpg"})},"Les Communs")],userResource:"Person"};function qt(){}function Bt(){}Bt.resetWarningCache=qt;var Mt=function(){function e(e,t,r,n,a,o){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==o){var i=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function t(){return e}e.isRequired=e;var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:Bt,resetWarningCache:qt};return r.PropTypes=r,r},$t=Qe((function(e){e.exports=Mt()})),Ht=Qe((function(e){
/*!
  Copyright (c) 2018 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
!function(){var t={}.hasOwnProperty;function r(){for(var e=[],n=0;n<arguments.length;n++){var a=arguments[n];if(a){var o=typeof a;if("string"===o||"number"===o)e.push(a);else if(Array.isArray(a)){if(a.length){var i=r.apply(null,a);i&&e.push(i)}}else if("object"===o)if(a.toString===Object.prototype.toString)for(var c in a)t.call(a,c)&&a[c]&&e.push(c);else e.push(a.toString())}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):window.classNames=r}()})),Gt=function(){var e=b();return a((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.signup(t)}),[e])},Jt=["meta","input"],Kt=M((function(e){return{form:{padding:"0 1em 1em 1em"},input:{marginTop:"1em"},button:{width:"100%"},icon:{marginRight:e.spacing(1)}}})),Qt=function(t){var r=t.meta,n=r.touched,a=r.error,o=t.input,i=Fe(t,Jt);return e.createElement($,Ve({error:!(!n||!a),helperText:n&&a},o,i,{fullWidth:!0}))},Xt=function(t){var r=t.redirectTo,n=t.delayBeforeRedirect,a=De(z(!1),2),o=a[0],i=a[1],c=Gt(),s=p(),l=u(),d=Kt(),m=Oe(),f=new URLSearchParams(m.search);return e.createElement(Ae,{onSubmit:function(e){i(!0),c(e).then((function(e){n?setTimeout((function(){window.location.reload(),window.location.href=r||"/",i(!1)}),n):(window.location.reload(),window.location.href=r||"/",i(!1)),l("auth.message.new_user_created","info")})).catch((function(e){i(!1),l("string"==typeof e?e:void 0!==e&&e.message?e.message:"ra.auth.sign_in_error","warning",{_:"string"==typeof e?e:e&&e.message?e.message:void 0})}))},validate:function(e){var t={email:void 0,password:void 0};return e.email||(t.email=s("ra.validation.required")),e.password||(t.password=s("ra.validation.required")),t},initialValues:{name:f.get("name"),email:f.get("email")},render:function(t){var r=t.handleSubmit;return e.createElement("form",{onSubmit:r,noValidate:!0},e.createElement("div",{className:d.form},e.createElement("div",{className:d.input},e.createElement(Ie,{autoFocus:!0,id:"name",name:"name",component:Qt,label:s("auth.input.name"),disabled:o})),e.createElement("div",{className:d.input},e.createElement(Ie,{id:"username",name:"username",component:Qt,label:s("auth.input.username"),disabled:o})),e.createElement("div",{className:d.input},e.createElement(Ie,{id:"email",name:"email",component:Qt,label:s("auth.input.email"),disabled:o||f.has("email")&&f.has("force-email")})),e.createElement("div",{className:d.input},e.createElement(Ie,{id:"password",name:"password",component:Qt,label:s("ra.auth.password"),type:"password",disabled:o}))),e.createElement(me,null,e.createElement(ue,{variant:"contained",type:"submit",color:"primary",disabled:o,className:d.button},o&&e.createElement(pe,{className:d.icon,size:18,thickness:2}),s("auth.action.signup"))))}})};Xt.propTypes={redirectTo:$t.string};var Zt=["theme","title","classes","className"],er=M((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",height:"1px",alignItems:"center",justifyContent:"flex-start",backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundImage:"radial-gradient(circle at 50% 14em, #313264 0%, #00023b 60%, #00023b 100%)"},card:{minWidth:300,marginTop:"6em"},avatar:{margin:"1em",display:"flex",justifyContent:"center"},icon:{backgroundColor:e.palette.secondary[500]},switch:{margin:"1em",display:"flex",justifyContent:"center"}}})),tr=function(e){var r=e.theme;e.title,e.classes;var n=e.className,a=Fe(e,Zt),i=er(e),s=Oe(),u=p(),l=o((function(){return fe(r)}),[r]),d=new URLSearchParams(s.search),m=d.has("signup"),f=d.get("redirect"),h=c(),g=h.identity;return h.loading?null:null!=g&&g.id?t.createElement(Ce,{to:f||"/"}):t.createElement(he,{theme:l},t.createElement("div",Ve({className:Ht(i.main,n)},a),t.createElement(le,{className:i.card},t.createElement("div",{className:i.avatar},t.createElement(K,{className:i.icon},t.createElement(Pe,null))),m?t.createElement(Xt,{redirectTo:f,delayBeforeRedirect:3e3}):t.createElement(L,{redirectTo:f}),t.createElement("div",{className:i.switch},m?t.createElement(Se,{to:"/login"},t.createElement(de,{variant:"body2"},u("auth.action.login"))):t.createElement(Se,{to:"/login?signup=true"},t.createElement(de,{variant:"body2"},u("auth.action.signup"))))),t.createElement(N,null)))};tr.propTypes={children:$t.node,classes:$t.object,className:$t.string,theme:$t.object};var rr=M((function(e){return{root:{color:e.palette.text.secondary},active:{color:e.palette.text.primary},icon:{minWidth:e.spacing(5)}}})),nr=i((function(e,r){var n=rr(),a=W(),o=p();return t.createElement(te,{onClick:function(){return a()},ref:r,className:n.root,activeClassName:n.active},t.createElement(re,{className:n.icon},t.createElement(Re,null)),o("auth.action.logout"))})),ar=["name","create"],or=function(e){var r=e.name,n=e.create,a=Fe(e,ar),o=q(r),i=s(o).permissions;return t.createElement(V,Ve({},a,{name:r,create:i&&i.some((function(e){return ct.includes(e["acl:mode"])}))?n:void 0}))},ir=["logout"],cr=i((function(e,r){var n=e.onClick,a=e.label,o=e.webId;return t.createElement(D,{ref:r,to:"/Person/".concat(encodeURIComponent(o),"/show"),primaryText:a,leftIcon:t.createElement(Te,null),onClick:n})})),sr=i((function(e,r){var n=e.onClick,a=e.label,o=e.webId;return t.createElement(D,{ref:r,to:"/Person/".concat(encodeURIComponent(o)),primaryText:a,leftIcon:t.createElement(be,null),onClick:n})})),ur=i((function(e,r){var n=e.onClick,a=e.label;return t.createElement(D,{ref:r,to:"/login",primaryText:a,onClick:n})})),lr=i((function(e,r){var n=e.onClick,a=e.label;return t.createElement(D,{ref:r,to:"/login?signup=true",primaryText:a,onClick:n})})),dr=function(e){var r=e.logout,n=Fe(e,ir),a=c().identity,o=p();return t.createElement(F,n,a&&""!==a.id?[t.createElement(cr,{webId:a.id,label:o("auth.action.view_my_profile"),key:"view"}),t.createElement(sr,{webId:a.id,label:o("auth.action.edit_my_profile"),key:"edit"}),t.cloneElement(r,{key:"logout"})]:[t.createElement(lr,{label:o("auth.action.signup"),key:"signup"}),t.createElement(ur,{label:o("auth.action.login"),key:"login"})])},mr=function(){var e=c(),t=e.identity,n=e.loading,a=u(),o=l(),i=Oe();return r((function(){n||null!=t&&t.id||(a("ra.auth.auth_check_error","error"),o("/login?redirect="+encodeURIComponent(i.pathname+i.search)))}),[n,t,o,a,i]),{identity:t,loading:n}};var pr=function(){this.__data__=[],this.size=0};var fr=function(e,t){return e===t||e!=e&&t!=t};var hr=function(e,t){for(var r=e.length;r--;)if(fr(e[r][0],t))return r;return-1},gr=Array.prototype.splice;var vr=function(e){var t=this.__data__,r=hr(t,e);return!(r<0)&&(r==t.length-1?t.pop():gr.call(t,r,1),--this.size,!0)};var br=function(e){var t=this.__data__,r=hr(t,e);return r<0?void 0:t[r][1]};var yr=function(e){return hr(this.__data__,e)>-1};var wr=function(e,t){var r=this.__data__,n=hr(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function _r(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}_r.prototype.clear=pr,_r.prototype.delete=vr,_r.prototype.get=br,_r.prototype.has=yr,_r.prototype.set=wr;var Er=_r;var jr=function(){this.__data__=new Er,this.size=0};var xr=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var kr=function(e){return this.__data__.get(e)};var Pr=function(e){return this.__data__.has(e)},Or="object"==typeof Ke&&Ke&&Ke.Object===Object&&Ke,Cr="object"==typeof self&&self&&self.Object===Object&&self,Sr=Or||Cr||Function("return this")(),Ar=Sr.Symbol,Ir=Object.prototype,Rr=Ir.hasOwnProperty,Tr=Ir.toString,Ur=Ar?Ar.toStringTag:void 0;var Nr=function(e){var t=Rr.call(e,Ur),r=e[Ur];try{e[Ur]=void 0;var n=!0}catch(e){}var a=Tr.call(e);return n&&(t?e[Ur]=r:delete e[Ur]),a},zr=Object.prototype.toString;var Lr=function(e){return zr.call(e)},Wr=Ar?Ar.toStringTag:void 0;var Vr=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Wr&&Wr in Object(e)?Nr(e):Lr(e)};var Fr=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Dr,Yr=function(e){if(!Fr(e))return!1;var t=Vr(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},qr=Sr["__core-js_shared__"],Br=(Dr=/[^.]+$/.exec(qr&&qr.keys&&qr.keys.IE_PROTO||""))?"Symbol(src)_1."+Dr:"";var Mr=function(e){return!!Br&&Br in e},$r=Function.prototype.toString;var Hr=function(e){if(null!=e){try{return $r.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Gr=/^\[object .+?Constructor\]$/,Jr=Function.prototype,Kr=Object.prototype,Qr=Jr.toString,Xr=Kr.hasOwnProperty,Zr=RegExp("^"+Qr.call(Xr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var en=function(e){return!(!Fr(e)||Mr(e))&&(Yr(e)?Zr:Gr).test(Hr(e))};var tn=function(e,t){return null==e?void 0:e[t]};var rn=function(e,t){var r=tn(e,t);return en(r)?r:void 0},nn=rn(Sr,"Map"),an=rn(Object,"create");var on=function(){this.__data__=an?an(null):{},this.size=0};var cn=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},sn=Object.prototype.hasOwnProperty;var un=function(e){var t=this.__data__;if(an){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return sn.call(t,e)?t[e]:void 0},ln=Object.prototype.hasOwnProperty;var dn=function(e){var t=this.__data__;return an?void 0!==t[e]:ln.call(t,e)};var mn=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=an&&void 0===t?"__lodash_hash_undefined__":t,this};function pn(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}pn.prototype.clear=on,pn.prototype.delete=cn,pn.prototype.get=un,pn.prototype.has=dn,pn.prototype.set=mn;var fn=pn;var hn=function(){this.size=0,this.__data__={hash:new fn,map:new(nn||Er),string:new fn}};var gn=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var vn=function(e,t){var r=e.__data__;return gn(t)?r["string"==typeof t?"string":"hash"]:r.map};var bn=function(e){var t=vn(this,e).delete(e);return this.size-=t?1:0,t};var yn=function(e){return vn(this,e).get(e)};var wn=function(e){return vn(this,e).has(e)};var _n=function(e,t){var r=vn(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function En(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}En.prototype.clear=hn,En.prototype.delete=bn,En.prototype.get=yn,En.prototype.has=wn,En.prototype.set=_n;var jn=En;var xn=function(e,t){var r=this.__data__;if(r instanceof Er){var n=r.__data__;if(!nn||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new jn(n)}return r.set(e,t),this.size=r.size,this};function kn(e){var t=this.__data__=new Er(e);this.size=t.size}kn.prototype.clear=jr,kn.prototype.delete=xr,kn.prototype.get=kr,kn.prototype.has=Pr,kn.prototype.set=xn;var Pn=kn;var On=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var Cn=function(e){return this.__data__.has(e)};function Sn(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new jn;++t<r;)this.add(e[t])}Sn.prototype.add=Sn.prototype.push=On,Sn.prototype.has=Cn;var An=Sn;var In=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var Rn=function(e,t){return e.has(t)};var Tn=function(e,t,r,n,a,o){var i=1&r,c=e.length,s=t.length;if(c!=s&&!(i&&s>c))return!1;var u=o.get(e),l=o.get(t);if(u&&l)return u==t&&l==e;var d=-1,m=!0,p=2&r?new An:void 0;for(o.set(e,t),o.set(t,e);++d<c;){var f=e[d],h=t[d];if(n)var g=i?n(h,f,d,t,e,o):n(f,h,d,e,t,o);if(void 0!==g){if(g)continue;m=!1;break}if(p){if(!In(t,(function(e,t){if(!Rn(p,t)&&(f===e||a(f,e,r,n,o)))return p.push(t)}))){m=!1;break}}else if(f!==h&&!a(f,h,r,n,o)){m=!1;break}}return o.delete(e),o.delete(t),m},Un=Sr.Uint8Array;var Nn=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var zn=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},Ln=Ar?Ar.prototype:void 0,Wn=Ln?Ln.valueOf:void 0;var Vn=function(e,t,r,n,a,o,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new Un(e),new Un(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return fr(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var c=Nn;case"[object Set]":var s=1&n;if(c||(c=zn),e.size!=t.size&&!s)return!1;var u=i.get(e);if(u)return u==t;n|=2,i.set(e,t);var l=Tn(c(e),c(t),n,a,o,i);return i.delete(e),l;case"[object Symbol]":if(Wn)return Wn.call(e)==Wn.call(t)}return!1};var Fn=function(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e},Dn=Array.isArray;var Yn=function(e,t,r){var n=t(e);return Dn(e)?n:Fn(n,r(e))};var qn=function(e,t){for(var r=-1,n=null==e?0:e.length,a=0,o=[];++r<n;){var i=e[r];t(i,r,e)&&(o[a++]=i)}return o};var Bn=function(){return[]},Mn=Object.prototype.propertyIsEnumerable,$n=Object.getOwnPropertySymbols,Hn=$n?function(e){return null==e?[]:(e=Object(e),qn($n(e),(function(t){return Mn.call(e,t)})))}:Bn;var Gn=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var Jn=function(e){return null!=e&&"object"==typeof e};var Kn=function(e){return Jn(e)&&"[object Arguments]"==Vr(e)},Qn=Object.prototype,Xn=Qn.hasOwnProperty,Zn=Qn.propertyIsEnumerable,ea=Kn(function(){return arguments}())?Kn:function(e){return Jn(e)&&Xn.call(e,"callee")&&!Zn.call(e,"callee")};var ta=function(){return!1},ra=Qe((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r?Sr.Buffer:void 0,o=(a?a.isBuffer:void 0)||ta;e.exports=o})),na=/^(?:0|[1-9]\d*)$/;var aa=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&na.test(e))&&e>-1&&e%1==0&&e<t};var oa=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},ia={};ia["[object Float32Array]"]=ia["[object Float64Array]"]=ia["[object Int8Array]"]=ia["[object Int16Array]"]=ia["[object Int32Array]"]=ia["[object Uint8Array]"]=ia["[object Uint8ClampedArray]"]=ia["[object Uint16Array]"]=ia["[object Uint32Array]"]=!0,ia["[object Arguments]"]=ia["[object Array]"]=ia["[object ArrayBuffer]"]=ia["[object Boolean]"]=ia["[object DataView]"]=ia["[object Date]"]=ia["[object Error]"]=ia["[object Function]"]=ia["[object Map]"]=ia["[object Number]"]=ia["[object Object]"]=ia["[object RegExp]"]=ia["[object Set]"]=ia["[object String]"]=ia["[object WeakMap]"]=!1;var ca=function(e){return Jn(e)&&oa(e.length)&&!!ia[Vr(e)]};var sa=function(e){return function(t){return e(t)}},ua=Qe((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r&&Or.process,o=function(){try{var e=n&&n.require&&n.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=o})),la=ua&&ua.isTypedArray,da=la?sa(la):ca,ma=Object.prototype.hasOwnProperty;var pa=function(e,t){var r=Dn(e),n=!r&&ea(e),a=!r&&!n&&ra(e),o=!r&&!n&&!a&&da(e),i=r||n||a||o,c=i?Gn(e.length,String):[],s=c.length;for(var u in e)!t&&!ma.call(e,u)||i&&("length"==u||a&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||aa(u,s))||c.push(u);return c},fa=Object.prototype;var ha=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||fa)};var ga=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),va=Object.prototype.hasOwnProperty;var ba=function(e){if(!ha(e))return ga(e);var t=[];for(var r in Object(e))va.call(e,r)&&"constructor"!=r&&t.push(r);return t};var ya=function(e){return null!=e&&oa(e.length)&&!Yr(e)};var wa=function(e){return ya(e)?pa(e):ba(e)};var _a=function(e){return Yn(e,wa,Hn)},Ea=Object.prototype.hasOwnProperty;var ja=function(e,t,r,n,a,o){var i=1&r,c=_a(e),s=c.length;if(s!=_a(t).length&&!i)return!1;for(var u=s;u--;){var l=c[u];if(!(i?l in t:Ea.call(t,l)))return!1}var d=o.get(e),m=o.get(t);if(d&&m)return d==t&&m==e;var p=!0;o.set(e,t),o.set(t,e);for(var f=i;++u<s;){var h=e[l=c[u]],g=t[l];if(n)var v=i?n(g,h,l,t,e,o):n(h,g,l,e,t,o);if(!(void 0===v?h===g||a(h,g,r,n,o):v)){p=!1;break}f||(f="constructor"==l)}if(p&&!f){var b=e.constructor,y=t.constructor;b==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof y&&y instanceof y||(p=!1)}return o.delete(e),o.delete(t),p},xa=rn(Sr,"DataView"),ka=rn(Sr,"Promise"),Pa=rn(Sr,"Set"),Oa=rn(Sr,"WeakMap"),Ca=Hr(xa),Sa=Hr(nn),Aa=Hr(ka),Ia=Hr(Pa),Ra=Hr(Oa),Ta=Vr;(xa&&"[object DataView]"!=Ta(new xa(new ArrayBuffer(1)))||nn&&"[object Map]"!=Ta(new nn)||ka&&"[object Promise]"!=Ta(ka.resolve())||Pa&&"[object Set]"!=Ta(new Pa)||Oa&&"[object WeakMap]"!=Ta(new Oa))&&(Ta=function(e){var t=Vr(e),r="[object Object]"==t?e.constructor:void 0,n=r?Hr(r):"";if(n)switch(n){case Ca:return"[object DataView]";case Sa:return"[object Map]";case Aa:return"[object Promise]";case Ia:return"[object Set]";case Ra:return"[object WeakMap]"}return t});var Ua=Ta,Na="[object Object]",za=Object.prototype.hasOwnProperty;var La=function(e,t,r,n,a,o){var i=Dn(e),c=Dn(t),s=i?"[object Array]":Ua(e),u=c?"[object Array]":Ua(t),l=(s="[object Arguments]"==s?Na:s)==Na,d=(u="[object Arguments]"==u?Na:u)==Na,m=s==u;if(m&&ra(e)){if(!ra(t))return!1;i=!0,l=!1}if(m&&!l)return o||(o=new Pn),i||da(e)?Tn(e,t,r,n,a,o):Vn(e,t,s,r,n,a,o);if(!(1&r)){var p=l&&za.call(e,"__wrapped__"),f=d&&za.call(t,"__wrapped__");if(p||f){var h=p?e.value():e,g=f?t.value():t;return o||(o=new Pn),a(h,g,r,n,o)}}return!!m&&(o||(o=new Pn),ja(e,t,r,n,a,o))};var Wa=function e(t,r,n,a,o){return t===r||(null==t||null==r||!Jn(t)&&!Jn(r)?t!=t&&r!=r:La(t,r,n,a,e,o))};var Va=function(e,t){return Wa(e,t)},Fa={},Da={"{}":void 0},Ya=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fa,t=JSON.stringify(e),n=z({permissions:Da[t]}),o=De(n,2),i=o[0],c=o[1],s=Y(),u=a((function(){return s(e).then((function(e){Va(e,i.permissions)||(Da[t]=e,c({permissions:e}))})).catch((function(e){c({error:e})}))}),[t,e,s]);return r((function(){u()}),[t]),Ne(Ne({},i),{},{refetch:u})},qa={auth:{dialog:{container_permissions:"Container permissions",resource_permissions:"Resource permissions",login_required:"Login required"},action:{permissions:"Permissions",signup:"Signup",logout:"Logout",login:"Login",view_my_profile:"View my profile",edit_my_profile:"Edit my profile"},right:{resource:{read:"Read",append:"Append",write:"Write",control:"Control"},container:{read:"List",append:"Add",write:"Add",control:"Control"}},agent:{anonymous:"All users",authenticated:"Connected users"},input:{agent_select:"Add an user...",name:"Surname",username:"User ID",email:"Email address",username_or_email:"User ID or email address"},message:{resource_show_forbidden:"You are not allowed to view this resource",resource_edit_forbidden:"You are not allowed to edit this resource",resource_delete_forbidden:"You are not allowed to delete this resource",resource_control_forbidden:"You are not allowed to control this resource",container_create_forbidden:"You are not allowed to create new resource",container_list_forbidden:"You are not allowed to list these resources",user_not_allowed_to_login:"You are not allowed to login with this account",user_email_not_found:"No account found with this email address",user_email_exist:"An account already exist with this email address",username_exist:"An account already exist with this user ID",username_invalid:"This username is invalid. Only lowercase characters, numbers, dots and hyphens are authorized",new_user_created:"Your account has been successfully created",user_connected:"You are now connected",user_disconnected:"You are now disconnected",bad_request:"Bad request (Error message returned by the server: %{error})",account_settings_updated:"Your account settings have been successfully updated",login_to_continue:"Please login to continue"}}},Ba={auth:{dialog:{container_permissions:"Permissions sur le container",resource_permissions:"Permissions sur la resource",login_required:"Connexion requise"},action:{permissions:"Permissions",signup:"S'inscrire",logout:"Se déconnecter",login:"Se connecter",view_my_profile:"Voir mon profil",edit_my_profile:"Éditer mon profil"},right:{resource:{read:"Lire",append:"Enrichir",write:"Modifier",control:"Administrer"},container:{read:"Lister",append:"Ajouter",write:"Ajouter",control:"Administrer"}},agent:{anonymous:"Tous les utilisateurs",authenticated:"Utilisateurs connectés"},input:{agent_select:"Ajouter un utilisateur...",name:"Prénom",username:"Identifiant unique",email:"Adresse e-mail",username_or_email:"Identifiant ou adresse e-mail"},message:{resource_show_forbidden:"Vous n'avez pas la permission de voir cette ressource",resource_edit_forbidden:"Vous n'avez pas la permission d'éditer cette ressource",resource_delete_forbidden:"Vous n'avez pas la permission d'effacer cette ressource",resource_control_forbidden:"Vous n'avez pas la permission d'administrer cette ressource",container_create_forbidden:"Vous n'avez pas la permission de créer des ressources",container_list_forbidden:"Vous n'avez pas la permission de voir ces ressources",user_not_allowed_to_login:"Vous n'avez pas le droit de vous connecter avec ce compte",user_email_not_found:"Aucun compte trouvé avec cette adresse mail",user_email_exist:"Un compte existe déjà avec cette adresse mail",username_exist:"Un compte existe déjà avec cet identifiant",username_invalid:"Cet identifiant n'est pas valide. Seuls les lettres minuscules, les chiffres, les points et les tirets sont autorisés",new_user_created:"Votre compte a été créé avec succès",user_connected:"Vous êtes maintenant connecté",user_disconnected:"Vous êtes maintenant déconnecté",bad_request:"Requête erronée (Message d'erreur renvoyé par le serveur: %{error})",account_settings_updated:"Les paramètres de votre compte ont été mis à jour avec succès",login_to_continue:"Veuillez vous connecter pour continuer"}}};export{Vt as AuthDialog,gt as CreateWithPermissions,St as DeleteButtonWithPermissions,Ct as EditActionsWithPermissions,It as EditToolbarWithPermissions,Rt as EditWithPermissions,Ut as ListActionsWithPermissions,Nt as ListWithPermissions,tr as LocalLoginPage,Yt as LoginPage,nr as LogoutButton,Ot as PermissionsButton,or as ResourceWithPermissions,zt as ShowActionsWithPermissions,Lt as ShowWithPermissions,Yt as SsoLoginPage,dr as UserMenu,ot as authProvider,qa as englishMessages,Ba as frenchMessages,xt as useAgents,mr as useCheckAuthenticated,ht as useCheckPermissions,Ya as usePermissionsWithRefetch,Gt as useSignup};
//# sourceMappingURL=index.es.js.map
