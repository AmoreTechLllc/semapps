import e,{useState as t,useEffect as r,useCallback as n,createElement as a,useMemo as o,forwardRef as i}from"react";import{useTranslate as c,useGetList as s,useDataProvider as u,Loading as l,Error as m,usePermissionsOptimized as d,useAuthProvider as f,Button as p,ListButton as h,ShowButton as v,useRecordContext as g,DeleteButton as b,Toolbar as y,SaveButton as w,useGetIdentity as _,useNotify as E,useRedirect as j,Edit as k,EditButton as O,Show as x,useLogin as P,Notification as C,useSafeSetState as S,LoginForm as A,useLogout as I,Resource as T,MenuItemLink as R,UserMenu as N,useGetPermissions as U}from"react-admin";import{TopToolbar as z,List as L,ListActions as W}from"@semapps/archipelago-layout";import V from"@material-ui/icons/Share";import{useCreateContainer as D}from"@semapps/semantic-data-provider";import{makeStyles as F,TextField as B,List as M,ListItem as $,ListItemAvatar as q,Avatar as G,ListItemText as H,ListItemSecondaryAction as J,IconButton as Y,Menu as K,MenuItem as Q,ListItemIcon as X,Dialog as Z,DialogTitle as ee,DialogContent as te,DialogActions as re,Card as ne,Typography as ae,CardActions as oe,Button as ie,CircularProgress as ce,createTheme as se,ThemeProvider as ue}from"@material-ui/core";import le from"@material-ui/lab/Autocomplete";import me from"@material-ui/icons/Person";import de from"@material-ui/icons/Edit";import fe from"@material-ui/icons/Check";import pe from"@material-ui/icons/Public";import he from"@material-ui/icons/VpnLock";import ve from"@material-ui/icons/Group";import{useLocation as ge,Redirect as be,Link as ye}from"react-router-dom";import{ThemeProvider as we}from"@material-ui/styles";import{makeStyles as _e,createTheme as Ee}from"@material-ui/core/styles";import je from"@material-ui/icons/Lock";import ke from"classnames";import{Form as Oe,Field as xe}from"react-final-form";import Pe from"@material-ui/core/MenuItem";import Ce from"@material-ui/icons/PowerSettingsNew";import Se from"@material-ui/icons/AccountCircle";function Ae(e,t,r,n,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,a)}function Ie(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Ae(o,n,a,i,c,"next",e)}function c(e){Ae(o,n,a,i,c,"throw",e)}i(void 0)}))}}function Te(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Re(){return(Re=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Ne(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(r),!0).forEach((function(t){Te(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ne(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ze(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function Le(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==c.return||c.return()}finally{if(a)throw o}}return r}(e,t)||Ve(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function We(e){return function(e){if(Array.isArray(e))return De(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Ve(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(e,t){if(e){if("string"==typeof e)return De(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?De(e,t):void 0}}function De(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Fe(e){this.message=e}Fe.prototype=new Error,Fe.prototype.name="InvalidCharacterError";var Be="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new Fe("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,a=0,o=0,i="";n=t.charAt(o++);~n&&(r=a%4?64*r+n:n,a++%4)?i+=String.fromCharCode(255&r>>(-2*a&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return i};function Me(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(Be(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return Be(t)}}function $e(e){this.message=e}function qe(e,t){if("string"!=typeof e)throw new $e("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(Me(e.split(".")[r]))}catch(e){throw new $e("Invalid token specified: "+e.message)}}$e.prototype=new Error,$e.prototype.name="InvalidTokenError";var Ge="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function He(e,t){return e(t={exports:{}},t.exports),t.exports}var Je,Ye,Ke=He((function(e){var t,r;t=Ge,r=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var r=e.shift();e[0]=r+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<e.length;n++){var a=e[n];if("string"!=typeof a)throw new TypeError("Url must be a string. Received "+a);""!==a&&(n>0&&(a=a.replace(/^[\/]+/,"")),a=n<e.length-1?a.replace(/[\/]+$/,""):a.replace(/[\/]+$/,"/"),t.push(a))}var o=t.join("/"),i=(o=o.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return o=i.shift()+(i.length>0?"?":"")+i.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=r():t.urljoin=r()})),Qe=function(e){return e?Array.isArray(e)?e:[e]:void 0},Xe=function(e){var t=new URL(e);return Ke(t.origin,"_acl",t.pathname)},Ze=function(e){return{"@base":e,acl:"http://www.w3.org/ns/auth/acl#",foaf:"http://xmlns.com/foaf/0.1/","acl:agent":{"@type":"@id"},"acl:agentGroup":{"@type":"@id"},"acl:agentClass":{"@type":"@id"},"acl:mode":{"@type":"@id"},"acl:accessTo":{"@type":"@id"}}},et=function(e){var t,r,n,a,o,i,c,s,u=e.middlewareUri,l=e.allowAnonymous,m=void 0===l||l,d=e.localAccounts,f=void 0!==d&&d,p=e.checkUser,h=e.httpClient,v=e.checkPermissions;return{login:(s=Ie(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new URL(window.location.href),n=u||t.domain&&"https://".concat(t.domain,"/")){e.next=4;break}throw new Error("You must specify a middlewareUri in the authProvider config, or specify a domain when calling the login method");case 4:if(!f){e.next=21;break}return a=t.username,o=t.password,e.prev=6,e.next=9,h("".concat(n,"auth/login"),{method:"POST",body:JSON.stringify({username:a.trim(),password:o.trim()}),headers:new Headers({"Content-Type":"application/json"})});case 9:i=e.sent,c=i.json,s=c.token,localStorage.setItem("token",s),window.location.reload(),e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(6),new Error("ra.auth.sign_in_error");case 19:e.next=22;break;case 21:window.location.href="".concat(n,"auth?redirectUrl=")+encodeURIComponent(r.origin+"/login?login=true");case 22:case"end":return e.stop()}}),e,null,[[6,16]])}))),function(e){return s.apply(this,arguments)}),signup:(c=Ie(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,c,s,l,m,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u||t.domain&&"https://".concat(t.domain,"/")){e.next=3;break}throw new Error("You must specify a middlewareUri in the authProvider config, or specify a domain when calling the signup method");case 3:if(!f){e.next=33;break}return n=t.username,a=t.email,o=t.password,i=t.domain,c=ze(t,["username","email","password","domain"]),e.prev=5,e.next=8,h("".concat(r||"https://".concat(i),"auth/signup"),{method:"POST",body:JSON.stringify(Ue({username:n.trim(),email:a.trim(),password:o.trim()},c)),headers:new Headers({"Content-Type":"application/json"})});case 8:return s=e.sent,l=s.json,m=l.token,localStorage.setItem("token",m),d=qe(m),p=d.webId,e.abrupt("return",p);case 16:if(e.prev=16,e.t0=e.catch(5),"email.already.exists"!==e.t0.message){e.next=22;break}throw new Error("auth.message.user_email_exist");case 22:if("username.already.exists"!==e.t0.message){e.next=26;break}throw new Error("auth.message.username_exist");case 26:if("username.invalid"!==e.t0.message){e.next=30;break}throw new Error("auth.message.username_invalid");case 30:throw new Error(e.t0.message||"ra.auth.sign_in_error");case 31:e.next=34;break;case 33:window.location.href="".concat(r,"auth?redirectUrl=")+encodeURIComponent(url.origin+"/login?login=true");case 34:case"end":return e.stop()}}),e,null,[[5,16]])}))),function(e){return c.apply(this,arguments)}),logout:(i=Ie(regeneratorRuntime.mark((function e(){var t,r,n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u?t=u:(r=localStorage.getItem("token"))&&(n=qe(r),a=n.webId,t=new URL(a).origin+"/"),localStorage.removeItem("token"),f?(window.location.reload(),window.location.href="/"):t&&(o=new URL(window.location.href),window.location.href=m?"".concat(t,"auth/logout?redirectUrl=")+encodeURIComponent(o.origin+"/login?logout=true"):"".concat(t,"auth/logout?redirectUrl=")+encodeURIComponent(o.origin+"/login")),e.abrupt("return","/");case 4:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)}),checkAuth:(o=Ie(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.getItem("token")||m){e.next=3;break}throw new Error;case 3:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)}),checkUser:function(e){return!p||p(e)},checkError:function(e){return Promise.resolve()},getPermissions:(a=Ie(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v){e.next=2;break}return e.abrupt("return",!0);case 2:if(t&&t.startsWith("http")){e.next=4;break}throw new Error("The first parameter passed to getPermissions must be an URL");case 4:return r=Xe(t),e.next=7,h(r);case 7:return n=e.sent,a=n.json,e.abrupt("return",a["@graph"]);case 10:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)}),addPermission:(n=Ie(regeneratorRuntime.mark((function e(t,r,n,a){var o,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Xe(t),t&&t.startsWith("http")){e.next=3;break}throw new Error("The first parameter passed to addPermission must be an URL");case 3:return Te(o={"@id":"#"+a.replace("acl:",""),"@type":"acl:Authorization"},n,r),Te(o,"acl:accessTo",resourceUri),Te(o,"acl:mode",a),c=o,e.next=6,h(i,{method:"PATCH",body:JSON.stringify({"@context":Ze(i),"@graph":[c]})});case 6:case"end":return e.stop()}}),e)}))),function(e,t,r,a){return n.apply(this,arguments)}),removePermission:(r=Ie(regeneratorRuntime.mark((function e(t,r,n,a){var o,i,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.startsWith("http")){e.next=2;break}throw new Error("The first parameter passed to removePermission must be an URL");case 2:return o=Xe(t),e.next=5,h(o);case 5:return i=e.sent,c=i.json,s=c["@graph"].filter((function(e){return!e["@id"].includes("#Default")})).map((function(e){var t=Qe(e["acl:mode"]),o=Qe(e[n]);return a&&t.includes(a)&&o&&o.includes(r)&&(o=o.filter((function(e){return e!==r}))),Ue(Ue({},e),{},Te({},n,o))})),e.next=10,h(o,{method:"PUT",body:JSON.stringify({"@context":Ze(o),"@graph":s})});case 10:case"end":return e.stop()}}),e)}))),function(e,t,n,a){return r.apply(this,arguments)}),getIdentity:(t=Ie(regeneratorRuntime.mark((function e(){var t,r,n,a,o,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=localStorage.getItem("token"))){e.next=17;break}return r=qe(t),n=r.webId,e.next=5,h(n);case 5:if(a=e.sent,!(o=a.json).url){e.next=13;break}return e.next=10,h(o.url);case 10:e.t0=e.sent,e.next=14;break;case 13:e.t0={};case 14:return i=e.t0,c=i.json,e.abrupt("return",{id:n,fullName:(null==c?void 0:c["vcard:given-name"])||(null==c?void 0:c["pair:label"])||o["foaf:name"],profileData:c,webIdData:o});case 17:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}},tt="acl:agentClass",rt=["acl:Append","acl:Write","acl:Control"],nt=["acl:Append","acl:Write","acl:Control"],at=["acl:Write","acl:Control"],ot=["acl:Control"],it={show:["acl:Read","acl:Append","acl:Write","acl:Control"],list:["acl:Read","acl:Append","acl:Write","acl:Control"],create:rt,edit:nt,delete:at,control:ot},ct={show:"auth.message.resource_show_forbidden",edit:"auth.message.resource_edit_forbidden",delete:"auth.message.resource_delete_forbidden",control:"auth.message.resource_control_forbidden",list:"auth.message.container_list_forbidden",create:"auth.message.container_create_forbidden"},st=(Te(Je={},"acl:Read","auth.right.resource.read"),Te(Je,"acl:Append","auth.right.resource.append"),Te(Je,"acl:Write","auth.right.resource.write"),Te(Je,"acl:Control","auth.right.resource.control"),Je),ut=(Te(Ye={},"acl:Read","auth.right.container.read"),Te(Ye,"acl:Write","auth.right.container.write"),Te(Ye,"acl:Control","auth.right.container.control"),Ye),lt=F((function(){return{list:{padding:0,width:"100%"},option:{padding:0}}})),mt=function(n){var a=n.agents,o=n.addPermission,i=lt(),u=c(),l=Le(t(null),2),m=l[0],d=l[1],f=Le(t(""),2),p=f[0],h=f[1],v=Le(t([]),2),g=v[0],b=v[1],y=s("Person",{page:1,perPage:100},{field:"pair:label",order:"ASC"},{q:p},{enabled:p.length>0}),w=y.ids,_=y.data;return r((function(){b(w.length>0?Object.values(_):[])}),[w,_]),e.createElement(le,{classes:{option:i.option},getOptionLabel:function(e){return e["pair:label"]},filterOptions:function(e){return e.filter((function(e){return!Object.keys(a).includes(e.id)}))},options:g,noOptionsText:u("ra.navigation.no_results"),autoComplete:!0,blurOnSelect:!0,clearOnBlur:!0,disableClearable:!0,value:m,onChange:function(e,t){o(t.id||t["@id"],"acl:agent","acl:Read"),d(null),h(""),b([])},onInputChange:function(e,t){h(t)},renderInput:function(t){return e.createElement(B,Re({},t,{label:u("auth.input.agent_select"),variant:"filled",margin:"dense",fullWidth:!0}))},renderOption:function(t){return e.createElement(M,{dense:!0,className:i.list},e.createElement($,{button:!0},e.createElement(q,null,e.createElement(G,{src:t.image},e.createElement(me,null))),e.createElement(H,{primary:t["pair:label"]})))}})},dt=function(t){var r=t.agent;switch(r.predicate){case tt:return"foaf:Agent"===r.id?e.createElement(pe,null):e.createElement(he,null);case"acl:agent":return e.createElement(me,null);case"acl:agentGroup":return e.createElement(ve,null);default:throw new Error("Unknown agent predicate: "+r.predicate)}},ft=F((function(){return{listItem:{paddingLeft:4,paddingRight:36},primaryText:{width:"30%",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},secondaryText:{textAlign:"center",width:"60%",fontStyle:"italic",color:"grey"}}})),pt=function(n){var a=n.isContainer,o=n.agent,i=n.addPermission,s=n.removePermission,d=ft(),f=c(),p=u(),h=Le(e.useState(null),2),v=h[0],g=h[1],b=Le(t(),2),y=b[0],w=b[1],_=Le(t(!0),2),E=_[0],j=_[1],k=Le(t(),2),O=k[0],x=k[1];if(r((function(){"acl:agent"===o.predicate?p.getOne("Person",{id:o.id}).then((function(e){var t=e.data;w(t),j(!1)})).catch((function(e){x(e),j(!1)})):j(!1)}),[o.id,o.predicate]),"acl:agentGroup"===o.predicate)return null;var P=function(){return g(null)},C=a?ut:st;return E?e.createElement(l,null):O?e.createElement(m,null):e.createElement($,{className:d.listItem},e.createElement(q,null,e.createElement(G,{src:null==y?void 0:y.image},e.createElement(dt,{agent:o}))),e.createElement(H,{className:d.primaryText,primary:y?y["pair:label"]:f("foaf:Agent"===o.id?"auth.agent.anonymous":"auth.agent.authenticated")}),e.createElement(H,{className:d.secondaryText,primary:o.permissions&&o.permissions.map((function(e){return f(C[e])})).join(", ")}),e.createElement(J,null,e.createElement(Y,{onClick:function(e){return g(e.currentTarget)}},e.createElement(de,null)),e.createElement(K,{anchorEl:v,keepMounted:!0,open:Boolean(v),onClose:P},Object.entries(C).map((function(t){var r=Le(t,2),n=r[0],a=r[1],c=o.permissions&&o.permissions.includes(n);return e.createElement(Q,{key:n,onClick:function(){c?s(o.id,o.predicate,n):i(o.id,o.predicate,n),P()}},e.createElement(X,null,c?e.createElement(fe,null):null),e.createElement(H,{primary:f(a)}))})))))},ht=F((function(e){return{list:{width:"100%",maxWidth:"100%",backgroundColor:e.palette.background.paper}}})),vt=function(t){var r=t.isContainer,n=t.agents,a=t.addPermission,o=t.removePermission,i=ht();return e.createElement(M,{dense:!0,className:i.list},Object.entries(n).map((function(t){var n=Le(t,2),i=n[0],c=n[1];return e.createElement(pt,{key:i,isContainer:r,agent:c,addPermission:a,removePermission:o})})))},gt=function(e){var a=d(e).permissions,o=f(),i=Le(t({}),2),c=i[0],s=i[1];r((function(){var e,t=(Te(e={},"foaf:Agent",{id:"foaf:Agent",predicate:tt,permissions:[]}),Te(e,"acl:AuthenticatedAgent",{id:"acl:AuthenticatedAgent",predicate:tt,permissions:[]}),e),r=function(e,r,n){t[e]?t[e].permissions.push(n):t[e]={id:e,predicate:r,permissions:[n]}};if(a){var n,o=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=Ve(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a,o=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw a}}}}(a);try{var i=function(){var e=n.value;e[tt]&&Qe(e[tt]).forEach((function(t){return r(t,tt,e["acl:mode"])})),e["acl:agent"]&&Qe(e["acl:agent"]).forEach((function(t){return r(t,"acl:agent",e["acl:mode"])})),e["acl:agentGroup"]&&Qe(e["acl:agentGroup"]).forEach((function(t){return r(t,"acl:agentGroup",e["acl:mode"])}))};for(o.s();!(n=o.n()).done;)i()}catch(e){o.e(e)}finally{o.f()}s(t)}}),[a]);var u=n((function(t,r,n){var a,i=Ue({},c);s(Ue(Ue({},c),{},Te({},t,{id:t,predicate:r,permissions:c[t]?[].concat(We(null===(a=c[t])||void 0===a?void 0:a.permissions),[n]):[n]}))),o.addPermission(e,t,r,n).catch((function(e){s(i)}))}),[c,s,e,o]),l=n((function(t,r,n){var a=Ue({},c);s(Object.fromEntries(Object.entries(c).map((function(e){var r=Le(e,2),a=r[0],o=r[1];return o.id===t&&(o.permissions=o.permissions.filter((function(e){return e!==n}))),[a,o]})).filter((function(e){var t=Le(e,2),r=(t[0],t[1]);return r.predicate===tt||r.permissions.length>0})))),o.removePermission(e,t,r,n).catch((function(e){s(a)}))}),[c,s,e,o]);return{agents:c,addPermission:u,removePermission:l}},bt=F((function(){return{title:{paddingBottom:8},actions:{padding:15},addForm:{paddingTop:0},listForm:{paddingTop:0,paddingBottom:0,paddingRight:0,maxHeight:210}}})),yt=function(t){var r=t.open,n=t.onClose,a=t.uri,o=t.isContainer,i=bt(),s=c(),u=gt(a),l=u.agents,m=u.addPermission,d=u.removePermission;return e.createElement(Z,{fullWidth:!0,open:r,onClose:n},e.createElement(ee,{className:i.title},s(o?"auth.dialog.container_permissions":"auth.dialog.resource_permissions")),e.createElement(te,{className:i.addForm},e.createElement(mt,{agents:l,addPermission:m})),e.createElement(te,{className:i.listForm},e.createElement(vt,{isContainer:o,agents:l,addPermission:m,removePermission:d})),e.createElement(re,{className:i.actions},e.createElement(p,{label:"ra.action.close",variant:"text",onClick:n})))},wt=function(r){var n=r.record,a=r.resource,o=Le(t(!1),2),i=o[0],c=o[1],s=D(a),u=!!a,l=u?s:n.id||n["@id"];return e.createElement(e.Fragment,null,e.createElement(p,{label:"auth.action.permissions",onClick:function(){return c(!0)}},e.createElement(V,null)),e.createElement(yt,{uri:l,isContainer:!!u,open:i,onClose:function(){return c(!1)}}))},_t=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,i=t.hasShow,c=t.hasControl,s=ze(t,["basePath","className","data","hasList","hasShow","hasControl"]);return e.createElement(z,Re({className:n},s),o&&e.createElement(h,{basePath:r,record:a}),i&&e.createElement(v,{basePath:r,record:a}),a&&c&&e.createElement(wt,{basePath:r,record:a}))},Et=function(t){var r=g(),n=d(r.id).permissions;return n&&n.some((function(e){return at.includes(e["acl:mode"])}))?e.createElement(b,t):null},jt=F((function(){return{toolbar:{flex:1,display:"flex",justifyContent:"space-between"}}})),kt=function(t){var r=jt();return e.createElement(y,Re({},t,{className:r.toolbar}),e.createElement(w,null),e.createElement(Et,{undoable:!1}),"}")},Ot=function(){var e=_(),t=e.identity,n=e.loading,a=E(),o=j(),i=ge();return r((function(){n||(null==t?void 0:t.id)||(a("ra.auth.auth_check_error","error"),o("/login?redirect="+encodeURIComponent(i.pathname+i.search)))}),[n,t,o,a,i]),{identity:t,loading:n}},xt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",a=Ot(),o=a.identity,i=d(e),c=i.permissions,s=E(),u=j();return r((function(){(null==o?void 0:o.id)&&c&&!c.some((function(e){return it[t].includes(e["acl:mode"])}))&&(s(ct[t],"error"),u(n))}),[c,o,u,s]),c},Pt=function(t){var r=xt(t.id,"edit");return e.createElement(k,Re({actions:e.createElement(_t,{hasControl:!!r&&r.some((function(e){return ot.includes(e["acl:mode"])}))})},t,{permissions:r}),e.cloneElement(t.children,Ue({toolbar:e.createElement(kt,null)},t.children.props)))},Ct=function(t){var r=t.actions,n=t.resource,a=t.hasCreate,o=ze(t,["actions","resource","hasCreate"]),i=D(n),c=d(i).permissions;return e.createElement(L,Re({},o,{resource:n,hasCreate:a&&!!c&&c.some((function(e){return rt.includes(e["acl:mode"])})),actions:r&&c&&c.some((function(e){return ot.includes(e["acl:mode"])}))?e.cloneElement(r,{bulkActions:e.createElement(wt,null)}):r}))};Ct.defaultProps={actions:e.createElement(W,null)};var St=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,i=t.hasEdit,c=t.hasControl,s=ze(t,["basePath","className","data","hasList","hasEdit","hasControl"]);return e.createElement(z,Re({className:n},s),o&&e.createElement(h,{basePath:r,record:a}),i&&e.createElement(O,{basePath:r,record:a}),a&&c&&e.createElement(wt,{basePath:r,record:a}))},At=function(t){var r=d(t.id).permissions;return e.createElement(x,Re({actions:e.createElement(St,{hasControl:!!r&&r.some((function(e){return ot.includes(e["acl:mode"])}))})},t,{permissions:r,hasEdit:t.hasEdit&&!!r&&r.some((function(e){return nt.includes(e["acl:mode"])}))}))},It=_e((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",alignItems:"center",justifyContent:"flex-start",backgroundColor:e.palette.grey[300]},text:{maxWidth:300,textAlign:"center",padding:"4px 8px 8px"},card:{minWidth:300,marginTop:"6em"},lockIconAvatar:{margin:"1em",display:"flex",justifyContent:"center"},lockIcon:{backgroundColor:e.palette.grey[500]}}})),Tt=function(t){var n=t.theme,a=t.history,o=t.location,i=t.buttons,c=t.userResource,s=t.text,l=It(),m=E(),d=P(),p=u(),h=f();return r((function(){Ie(regeneratorRuntime.mark((function e(){var t,r,n,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=new URLSearchParams(o.search)).has("login")){e.next=14;break}if(!t.has("error")){e.next=6;break}"registration.not-allowed"===t.get("error")?m("auth.message.user_email_not_found","error"):m("auth.message.bad_request","error",{error:t.get("error")}),e.next=14;break;case 6:if(!t.has("token")){e.next=14;break}return r=t.get("token"),n=qe(r),i=n.webId,e.next=11,p.getOne("Person",{id:i});case 11:s=e.sent,u=s.data,h.checkUser(u)?(localStorage.setItem("token",r),t.has("new")&&"true"===t.get("new")?(m("auth.message.new_user_created","info"),a.push("/"+c+"/"+encodeURIComponent(i)+"/edit")):(m("auth.message.user_connected","info"),a.push("/"))):(m("auth.message.user_not_allowed_to_login","error"),a.replace("/login"));case 14:t.has("logout")&&(localStorage.removeItem("token"),m("auth.message.user_disconnected","info"),a.push("/"));case 15:case"end":return e.stop()}}),e)})))()}),[o.search]),e.createElement(we,{theme:Ee(n)},e.createElement("div",{className:l.main},e.createElement(ne,{className:l.card},e.createElement("div",{className:l.lockIconAvatar},e.createElement(G,{className:l.lockIcon},e.createElement(je,null))),s&&e.createElement(ae,{variant:"body2",className:l.text},s),i&&i.map((function(t,r){return e.createElement(oe,{key:r},e.cloneElement(t,{fullWidth:!0,variant:"outlined",type:"submit",onClick:function(){return d({},"/login")}}))})))),e.createElement(C,null))};Tt.defaultProps={buttons:[e.createElement(ie,{startIcon:e.createElement(G,{src:"/lescommuns.jpg"})},"Les Communs")],userResource:"Person"};function Rt(){}function Nt(){}Nt.resetWarningCache=Rt;var Ut=He((function(e){e.exports=function(){function e(e,t,r,n,a,o){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==o){var i=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function t(){return e}e.isRequired=e;var r={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:Nt,resetWarningCache:Rt};return r.PropTypes=r,r}()})),zt=function(){var e=f();return n((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.signup(t)}),[e])},Lt=F((function(e){return{form:{padding:"0 1em 1em 1em"},input:{marginTop:"1em"},button:{width:"100%"},icon:{marginRight:e.spacing(1)}}})),Wt=function(e){var t=e.meta,r=t.touched,n=t.error,o=e.input,i=ze(e,["meta","input"]);return a(B,Re({error:!(!r||!n),helperText:r&&n},o,i,{fullWidth:!0}))},Vt=function(e){var t=e.redirectTo,r=e.delayBeforeRedirect,n=Le(S(!1),2),o=n[0],i=n[1],s=zt(),u=c(),l=E(),m=Lt(),d=ge(),f=new URLSearchParams(d.search);return a(Oe,{onSubmit:function(e){i(!0),s(e).then((function(e){r?setTimeout((function(){window.location.reload(),window.location.href=t||"/",i(!1)}),r):(window.location.reload(),window.location.href=t||"/",i(!1)),l("auth.message.new_user_created","info")})).catch((function(e){i(!1),l("string"==typeof e?e:void 0!==e&&e.message?e.message:"ra.auth.sign_in_error","warning",{_:"string"==typeof e?e:e&&e.message?e.message:void 0})}))},validate:function(e){var t={email:void 0,password:void 0};return e.email||(t.email=u("ra.validation.required")),e.password||(t.password=u("ra.validation.required")),t},initialValues:{name:f.get("name"),email:f.get("email")},render:function(e){var t=e.handleSubmit;return a("form",{onSubmit:t,noValidate:!0},a("div",{className:m.form},a("div",{className:m.input},a(xe,{autoFocus:!0,id:"name",name:"name",component:Wt,label:u("auth.input.name"),disabled:o})),a("div",{className:m.input},a(xe,{id:"username",name:"username",component:Wt,label:u("auth.input.username"),disabled:o})),a("div",{className:m.input},a(xe,{id:"email",name:"email",component:Wt,label:u("auth.input.email"),disabled:o||f.has("email")&&f.has("force-email")})),a("div",{className:m.input},a(xe,{id:"password",name:"password",component:Wt,label:u("ra.auth.password"),type:"password",disabled:o}))),a(oe,null,a(ie,{variant:"contained",type:"submit",color:"primary",disabled:o,className:m.button},o&&a(ce,{className:m.icon,size:18,thickness:2}),u("auth.action.signup"))))}})};Vt.propTypes={redirectTo:Ut.string};var Dt=F((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",height:"1px",alignItems:"center",justifyContent:"flex-start",backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundImage:"radial-gradient(circle at 50% 14em, #313264 0%, #00023b 60%, #00023b 100%)"},card:{minWidth:300,marginTop:"6em"},avatar:{margin:"1em",display:"flex",justifyContent:"center"},icon:{backgroundColor:e.palette.secondary[500]},switch:{margin:"1em",display:"flex",justifyContent:"center"}}})),Ft=function(t){var r=t.theme,n=(t.title,t.classes,t.className),a=ze(t,["theme","title","classes","className"]),i=Dt(t),c=ge(),s=o((function(){return se(r)}),[r]),u=new URLSearchParams(c.search),l=u.has("signup"),m=u.get("redirect"),d=_(),f=d.identity;return d.loading?null:(null==f?void 0:f.id)?e.createElement(be,{to:m||"/"}):e.createElement(ue,{theme:s},e.createElement("div",Re({className:ke(i.main,n)},a),e.createElement(ne,{className:i.card},e.createElement("div",{className:i.avatar},e.createElement(G,{className:i.icon},e.createElement(je,null))),l?e.createElement(Vt,{redirectTo:m,delayBeforeRedirect:3e3}):e.createElement(A,{redirectTo:m}),e.createElement("div",{className:i.switch},l?e.createElement(ye,{to:"/login"},e.createElement(ae,{variant:"body2"},"Se connecter avec un compte")):e.createElement(ye,{to:"/login?signup=true"},e.createElement(ae,{variant:"body2"},"Créer un nouveau compte")))),e.createElement(C,null)))};Ft.propTypes={children:Ut.node,classes:Ut.object,className:Ut.string,theme:Ut.object};var Bt=i((function(t,r){var n=I();return e.createElement(Pe,{onClick:function(){return n()},ref:r},e.createElement(Ce,null),"   Se déconnecter")})),Mt=function(t){var r=t.name,n=t.create,a=ze(t,["name","create"]),o=D(r),i=d(o).permissions;return e.createElement(T,Re({},a,{name:r,create:i&&i.some((function(e){return rt.includes(e["acl:mode"])}))?n:void 0}))},$t=i((function(t,r){var n=t.onClick,a=t.webId;return e.createElement(R,{ref:r,to:"/Person/".concat(encodeURIComponent(a),"/show"),primaryText:"Voir mon profil",leftIcon:e.createElement(Se,null),onClick:n})})),qt=i((function(t,r){var n=t.onClick,a=t.webId;return e.createElement(R,{ref:r,to:"/Person/".concat(encodeURIComponent(a),"/edit"),primaryText:"Editer mon profil",leftIcon:e.createElement(de,null),onClick:n})})),Gt=i((function(t,r){var n=t.onClick;return e.createElement(R,{ref:r,to:"/login",primaryText:"Se connecter",onClick:n})})),Ht=i((function(t,r){var n=t.onClick;return e.createElement(R,{ref:r,to:"/login?signup=true",primaryText:"Créer un compte",onClick:n})})),Jt=function(t){var r=t.logout,n=ze(t,["logout"]),a=_().identity;return e.createElement(N,n,a&&""!==a.id?[e.createElement($t,{webId:a.id,key:"view"}),e.createElement(qt,{webId:a.id,key:"edit"}),e.cloneElement(r,{key:"logout"})]:[e.createElement(Ht,{key:"signup"}),e.createElement(Gt,{key:"login"})])};var Yt=function(){this.__data__=[],this.size=0};var Kt=function(e,t){return e===t||e!=e&&t!=t};var Qt=function(e,t){for(var r=e.length;r--;)if(Kt(e[r][0],t))return r;return-1},Xt=Array.prototype.splice;var Zt=function(e){var t=this.__data__,r=Qt(t,e);return!(r<0)&&(r==t.length-1?t.pop():Xt.call(t,r,1),--this.size,!0)};var er=function(e){var t=this.__data__,r=Qt(t,e);return r<0?void 0:t[r][1]};var tr=function(e){return Qt(this.__data__,e)>-1};var rr=function(e,t){var r=this.__data__,n=Qt(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function nr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}nr.prototype.clear=Yt,nr.prototype.delete=Zt,nr.prototype.get=er,nr.prototype.has=tr,nr.prototype.set=rr;var ar=nr;var or=function(){this.__data__=new ar,this.size=0};var ir=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var cr=function(e){return this.__data__.get(e)};var sr=function(e){return this.__data__.has(e)},ur="object"==typeof Ge&&Ge&&Ge.Object===Object&&Ge,lr="object"==typeof self&&self&&self.Object===Object&&self,mr=ur||lr||Function("return this")(),dr=mr.Symbol,fr=Object.prototype,pr=fr.hasOwnProperty,hr=fr.toString,vr=dr?dr.toStringTag:void 0;var gr=function(e){var t=pr.call(e,vr),r=e[vr];try{e[vr]=void 0;var n=!0}catch(e){}var a=hr.call(e);return n&&(t?e[vr]=r:delete e[vr]),a},br=Object.prototype.toString;var yr=function(e){return br.call(e)},wr=dr?dr.toStringTag:void 0;var _r=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":wr&&wr in Object(e)?gr(e):yr(e)};var Er=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var jr,kr=function(e){if(!Er(e))return!1;var t=_r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Or=mr["__core-js_shared__"],xr=(jr=/[^.]+$/.exec(Or&&Or.keys&&Or.keys.IE_PROTO||""))?"Symbol(src)_1."+jr:"";var Pr=function(e){return!!xr&&xr in e},Cr=Function.prototype.toString;var Sr=function(e){if(null!=e){try{return Cr.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Ar=/^\[object .+?Constructor\]$/,Ir=Function.prototype,Tr=Object.prototype,Rr=Ir.toString,Nr=Tr.hasOwnProperty,Ur=RegExp("^"+Rr.call(Nr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var zr=function(e){return!(!Er(e)||Pr(e))&&(kr(e)?Ur:Ar).test(Sr(e))};var Lr=function(e,t){return null==e?void 0:e[t]};var Wr=function(e,t){var r=Lr(e,t);return zr(r)?r:void 0},Vr=Wr(mr,"Map"),Dr=Wr(Object,"create");var Fr=function(){this.__data__=Dr?Dr(null):{},this.size=0};var Br=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Mr=Object.prototype.hasOwnProperty;var $r=function(e){var t=this.__data__;if(Dr){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Mr.call(t,e)?t[e]:void 0},qr=Object.prototype.hasOwnProperty;var Gr=function(e){var t=this.__data__;return Dr?void 0!==t[e]:qr.call(t,e)};var Hr=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Dr&&void 0===t?"__lodash_hash_undefined__":t,this};function Jr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Jr.prototype.clear=Fr,Jr.prototype.delete=Br,Jr.prototype.get=$r,Jr.prototype.has=Gr,Jr.prototype.set=Hr;var Yr=Jr;var Kr=function(){this.size=0,this.__data__={hash:new Yr,map:new(Vr||ar),string:new Yr}};var Qr=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Xr=function(e,t){var r=e.__data__;return Qr(t)?r["string"==typeof t?"string":"hash"]:r.map};var Zr=function(e){var t=Xr(this,e).delete(e);return this.size-=t?1:0,t};var en=function(e){return Xr(this,e).get(e)};var tn=function(e){return Xr(this,e).has(e)};var rn=function(e,t){var r=Xr(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function nn(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}nn.prototype.clear=Kr,nn.prototype.delete=Zr,nn.prototype.get=en,nn.prototype.has=tn,nn.prototype.set=rn;var an=nn;var on=function(e,t){var r=this.__data__;if(r instanceof ar){var n=r.__data__;if(!Vr||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new an(n)}return r.set(e,t),this.size=r.size,this};function cn(e){var t=this.__data__=new ar(e);this.size=t.size}cn.prototype.clear=or,cn.prototype.delete=ir,cn.prototype.get=cr,cn.prototype.has=sr,cn.prototype.set=on;var sn=cn;var un=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var ln=function(e){return this.__data__.has(e)};function mn(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new an;++t<r;)this.add(e[t])}mn.prototype.add=mn.prototype.push=un,mn.prototype.has=ln;var dn=mn;var fn=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var pn=function(e,t){return e.has(t)};var hn=function(e,t,r,n,a,o){var i=1&r,c=e.length,s=t.length;if(c!=s&&!(i&&s>c))return!1;var u=o.get(e);if(u&&o.get(t))return u==t;var l=-1,m=!0,d=2&r?new dn:void 0;for(o.set(e,t),o.set(t,e);++l<c;){var f=e[l],p=t[l];if(n)var h=i?n(p,f,l,t,e,o):n(f,p,l,e,t,o);if(void 0!==h){if(h)continue;m=!1;break}if(d){if(!fn(t,(function(e,t){if(!pn(d,t)&&(f===e||a(f,e,r,n,o)))return d.push(t)}))){m=!1;break}}else if(f!==p&&!a(f,p,r,n,o)){m=!1;break}}return o.delete(e),o.delete(t),m},vn=mr.Uint8Array;var gn=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var bn=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},yn=dr?dr.prototype:void 0,wn=yn?yn.valueOf:void 0;var _n=function(e,t,r,n,a,o,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new vn(e),new vn(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Kt(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var c=gn;case"[object Set]":var s=1&n;if(c||(c=bn),e.size!=t.size&&!s)return!1;var u=i.get(e);if(u)return u==t;n|=2,i.set(e,t);var l=hn(c(e),c(t),n,a,o,i);return i.delete(e),l;case"[object Symbol]":if(wn)return wn.call(e)==wn.call(t)}return!1};var En=function(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e},jn=Array.isArray;var kn=function(e,t,r){var n=t(e);return jn(e)?n:En(n,r(e))};var On=function(e,t){for(var r=-1,n=null==e?0:e.length,a=0,o=[];++r<n;){var i=e[r];t(i,r,e)&&(o[a++]=i)}return o};var xn=function(){return[]},Pn=Object.prototype.propertyIsEnumerable,Cn=Object.getOwnPropertySymbols,Sn=Cn?function(e){return null==e?[]:(e=Object(e),On(Cn(e),(function(t){return Pn.call(e,t)})))}:xn;var An=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var In=function(e){return null!=e&&"object"==typeof e};var Tn=function(e){return In(e)&&"[object Arguments]"==_r(e)},Rn=Object.prototype,Nn=Rn.hasOwnProperty,Un=Rn.propertyIsEnumerable,zn=Tn(function(){return arguments}())?Tn:function(e){return In(e)&&Nn.call(e,"callee")&&!Un.call(e,"callee")};var Ln=function(){return!1},Wn=He((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r?mr.Buffer:void 0,o=(a?a.isBuffer:void 0)||Ln;e.exports=o})),Vn=/^(?:0|[1-9]\d*)$/;var Dn=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Vn.test(e))&&e>-1&&e%1==0&&e<t};var Fn=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Bn={};Bn["[object Float32Array]"]=Bn["[object Float64Array]"]=Bn["[object Int8Array]"]=Bn["[object Int16Array]"]=Bn["[object Int32Array]"]=Bn["[object Uint8Array]"]=Bn["[object Uint8ClampedArray]"]=Bn["[object Uint16Array]"]=Bn["[object Uint32Array]"]=!0,Bn["[object Arguments]"]=Bn["[object Array]"]=Bn["[object ArrayBuffer]"]=Bn["[object Boolean]"]=Bn["[object DataView]"]=Bn["[object Date]"]=Bn["[object Error]"]=Bn["[object Function]"]=Bn["[object Map]"]=Bn["[object Number]"]=Bn["[object Object]"]=Bn["[object RegExp]"]=Bn["[object Set]"]=Bn["[object String]"]=Bn["[object WeakMap]"]=!1;var Mn=function(e){return In(e)&&Fn(e.length)&&!!Bn[_r(e)]};var $n=function(e){return function(t){return e(t)}},qn=He((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r&&ur.process,o=function(){try{var e=n&&n.require&&n.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=o})),Gn=qn&&qn.isTypedArray,Hn=Gn?$n(Gn):Mn,Jn=Object.prototype.hasOwnProperty;var Yn=function(e,t){var r=jn(e),n=!r&&zn(e),a=!r&&!n&&Wn(e),o=!r&&!n&&!a&&Hn(e),i=r||n||a||o,c=i?An(e.length,String):[],s=c.length;for(var u in e)!t&&!Jn.call(e,u)||i&&("length"==u||a&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Dn(u,s))||c.push(u);return c},Kn=Object.prototype;var Qn=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Kn)};var Xn=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),Zn=Object.prototype.hasOwnProperty;var ea=function(e){if(!Qn(e))return Xn(e);var t=[];for(var r in Object(e))Zn.call(e,r)&&"constructor"!=r&&t.push(r);return t};var ta=function(e){return null!=e&&Fn(e.length)&&!kr(e)};var ra=function(e){return ta(e)?Yn(e):ea(e)};var na=function(e){return kn(e,ra,Sn)},aa=Object.prototype.hasOwnProperty;var oa=function(e,t,r,n,a,o){var i=1&r,c=na(e),s=c.length;if(s!=na(t).length&&!i)return!1;for(var u=s;u--;){var l=c[u];if(!(i?l in t:aa.call(t,l)))return!1}var m=o.get(e);if(m&&o.get(t))return m==t;var d=!0;o.set(e,t),o.set(t,e);for(var f=i;++u<s;){var p=e[l=c[u]],h=t[l];if(n)var v=i?n(h,p,l,t,e,o):n(p,h,l,e,t,o);if(!(void 0===v?p===h||a(p,h,r,n,o):v)){d=!1;break}f||(f="constructor"==l)}if(d&&!f){var g=e.constructor,b=t.constructor;g==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b||(d=!1)}return o.delete(e),o.delete(t),d},ia=Wr(mr,"DataView"),ca=Wr(mr,"Promise"),sa=Wr(mr,"Set"),ua=Wr(mr,"WeakMap"),la=Sr(ia),ma=Sr(Vr),da=Sr(ca),fa=Sr(sa),pa=Sr(ua),ha=_r;(ia&&"[object DataView]"!=ha(new ia(new ArrayBuffer(1)))||Vr&&"[object Map]"!=ha(new Vr)||ca&&"[object Promise]"!=ha(ca.resolve())||sa&&"[object Set]"!=ha(new sa)||ua&&"[object WeakMap]"!=ha(new ua))&&(ha=function(e){var t=_r(e),r="[object Object]"==t?e.constructor:void 0,n=r?Sr(r):"";if(n)switch(n){case la:return"[object DataView]";case ma:return"[object Map]";case da:return"[object Promise]";case fa:return"[object Set]";case pa:return"[object WeakMap]"}return t});var va=ha,ga=Object.prototype.hasOwnProperty;var ba=function(e,t,r,n,a,o){var i=jn(e),c=jn(t),s=i?"[object Array]":va(e),u=c?"[object Array]":va(t),l="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s),m="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),d=s==u;if(d&&Wn(e)){if(!Wn(t))return!1;i=!0,l=!1}if(d&&!l)return o||(o=new sn),i||Hn(e)?hn(e,t,r,n,a,o):_n(e,t,s,r,n,a,o);if(!(1&r)){var f=l&&ga.call(e,"__wrapped__"),p=m&&ga.call(t,"__wrapped__");if(f||p){var h=f?e.value():e,v=p?t.value():t;return o||(o=new sn),a(h,v,r,n,o)}}return!!d&&(o||(o=new sn),oa(e,t,r,n,a,o))};var ya=function e(t,r,n,a,o){return t===r||(null==t||null==r||!In(t)&&!In(r)?t!=t&&r!=r:ba(t,r,n,a,e,o))};var wa=function(e,t){return ya(e,t)},_a={},Ea={"{}":void 0},ja=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_a,t=JSON.stringify(e),a=S({permissions:Ea[t]}),o=Le(a,2),i=o[0],c=o[1],s=U(),u=n((function(){return s(e).then((function(e){wa(e,i.permissions)||(Ea[t]=e,c({permissions:e}))})).catch((function(e){c({error:e})}))}),[t,e,s]);return r((function(){u()}),[t]),Ue(Ue({},i),{},{refetch:u})},ka={auth:{dialog:{container_permissions:"Permissions sur le container",resource_permissions:"Permissions sur la resource"},action:{permissions:"Permissions",signup:"S'inscrire"},right:{resource:{read:"Lire",append:"Enrichir",write:"Modifier",control:"Administrer"},container:{read:"Lister",append:"Ajouter",write:"Ajouter",control:"Administrer"}},agent:{anonymous:"Tous les utilisateurs",authenticated:"Utilisateurs connectés"},input:{agent_select:"Ajouter un utilisateur...",name:"Prénom",username:"Identifiant unique",email:"Adresse e-mail",username_or_email:"Identifiant ou adresse e-mail"},message:{resource_show_forbidden:"Vous n'avez pas la permission de voir cette ressource",resource_edit_forbidden:"Vous n'avez pas la permission d'éditer cette ressource",resource_delete_forbidden:"Vous n'avez pas la permission d'effacer cette ressource",resource_control_forbidden:"Vous n'avez pas la permission d'administrer cette ressource",container_create_forbidden:"Vous n'avez pas la permission de créer des ressources",container_list_forbidden:"Vous n'avez pas la permission de voir ces ressources",user_not_allowed_to_login:"Vous n'avez pas le droit de vous connecter avec ce compte",user_email_not_found:"Aucun compte trouvé avec cette adresse mail",user_email_exist:"Un compte existe déjà avec cette adresse mail",username_exist:"Un compte existe déjà avec cet identifiant",username_invalid:"Cet identifiant n'est pas valide. Seuls les lettres minuscules, les chiffres, les points et les tirets sont autorisés",new_user_created:"Votre compte a été créé avec succès",user_connected:"Vous êtes maintenant connecté",user_disconnected:"Vous êtes maintenant déconnecté",bad_request:"Requête erronée (Message d'erreur renvoyé par le serveur: %{error})"}}};export{Et as DeleteButtonWithPermissions,_t as EditActions,kt as EditToolbarWithPermissions,Pt as EditWithPermissions,Ct as ListWithPermissions,Ft as LocalLoginPage,Tt as LoginPage,Bt as LogoutButton,wt as PermissionsButton,Mt as ResourceWithPermissions,St as ShowActions,At as ShowWithPermissions,Tt as SsoLoginPage,Jt as UserMenu,et as authProvider,ka as frenchMessages,gt as useAgents,Ot as useCheckAuthenticated,xt as useCheckPermissions,ja as usePermissionsWithRefetch,zt as useSignup};
//# sourceMappingURL=index.es.js.map
