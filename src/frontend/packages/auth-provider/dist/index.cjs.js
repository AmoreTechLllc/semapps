"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),r=e(t),n=require("react-admin"),o=require("@semapps/archipelago-layout"),a=e(require("@material-ui/icons/Share")),i=require("@material-ui/core"),c=e(require("@material-ui/lab/Autocomplete")),s=e(require("@material-ui/icons/Person")),u=e(require("@material-ui/icons/Edit")),l=e(require("@material-ui/icons/Check")),f=e(require("@material-ui/icons/Public")),d=e(require("@material-ui/icons/VpnLock")),p=e(require("@material-ui/icons/Group")),m=require("@material-ui/styles"),h=require("@material-ui/core/styles"),v=e(require("@material-ui/icons/Lock")),g=e(require("@material-ui/core/MenuItem")),b=e(require("@material-ui/icons/PowerSettingsNew")),y=e(require("@material-ui/icons/AccountCircle"));function _(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function w(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){_(a,n,o,i,c,"next",e)}function c(e){_(a,n,o,i,c,"throw",e)}i(void 0)}))}}function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function k(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}(e,t)||S(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e){return function(e){if(Array.isArray(e))return C(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||S(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){if(e){if("string"==typeof e)return C(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(e,t):void 0}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function I(e){this.message=e}I.prototype=new Error,I.prototype.name="InvalidCharacterError";var T="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new I("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,o=0,a=0,i="";n=t.charAt(a++);~n&&(r=o%4?64*r+n:n,o++%4)?i+=String.fromCharCode(255&r>>(-2*o&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return i};function R(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(T(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return T(t)}}function L(e){this.message=e}function z(e,t){if("string"!=typeof e)throw new L("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(R(e.split(".")[r]))}catch(e){throw new L("Invalid token specified: "+e.message)}}L.prototype=new Error,L.prototype.name="InvalidTokenError";var U="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function N(e,t){return e(t={exports:{}},t.exports),t.exports}var q,B,M=N((function(e){var t,r;t=U,r=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var r=e.shift();e[0]=r+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(n>0&&(o=o.replace(/^[\/]+/,"")),o=n<e.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),t.push(o))}var a=t.join("/"),i=(a=a.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return a=i.shift()+(i.length>0?"?":"")+i.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=r():t.urljoin=r()})),W=function(e){return e?Array.isArray(e)?e:[e]:void 0},D=function(e,t){return M(e,t.replace(e,"_acl/"))},V=function(e){return{"@base":e,acl:"http://www.w3.org/ns/auth/acl#",foaf:"http://xmlns.com/foaf/0.1/","acl:agent":{"@type":"@id"},"acl:agentGroup":{"@type":"@id"},"acl:agentClass":{"@type":"@id"},"acl:mode":{"@type":"@id"},"acl:accessTo":{"@type":"@id"}}},F="acl:agentClass",$=["acl:Append","acl:Write","acl:Control"],G=["acl:Append","acl:Write","acl:Control"],J=["acl:Write","acl:Control"],H=["acl:Control"],K={show:["acl:Read","acl:Append","acl:Write","acl:Control"],list:["acl:Read","acl:Append","acl:Write","acl:Control"],create:$,edit:G,delete:J,control:H},Q={show:"auth.message.resource_show_forbidden",edit:"auth.message.resource_edit_forbidden",delete:"auth.message.resource_delete_forbidden",control:"auth.message.resource_control_forbidden",list:"auth.message.container_list_forbidden",create:"auth.message.container_create_forbidden"},X=(j(q={},"acl:Read","auth.right.resource.read"),j(q,"acl:Append","auth.right.resource.append"),j(q,"acl:Write","auth.right.resource.write"),j(q,"acl:Control","auth.right.resource.control"),q),Y=(j(B={},"acl:Read","auth.right.container.read"),j(B,"acl:Write","auth.right.container.write"),j(B,"acl:Control","auth.right.container.control"),B),Z=i.makeStyles((function(){return{list:{padding:0,width:"100%"},option:{padding:0}}})),ee=function(e){var o=e.agents,a=e.addPermission,u=Z(),l=n.useTranslate(),f=A(t.useState(null),2),d=f[0],p=f[1],m=A(t.useState(""),2),h=m[0],v=m[1],g=A(t.useState([]),2),b=g[0],y=g[1],_=n.useGetList("Person",{page:1,perPage:100},{field:"pair:label",order:"ASC"},{q:h},{enabled:h.length>0}),w=_.ids,j=_.data;return t.useEffect((function(){y(w.length>0?Object.values(j):[])}),[w,j]),r.createElement(c,{classes:{option:u.option},getOptionLabel:function(e){return e["pair:label"]},filterOptions:function(e){return e.filter((function(e){return!Object.keys(o).includes(e.id)}))},options:b,noOptionsText:l("ra.navigation.no_results"),autoComplete:!0,blurOnSelect:!0,clearOnBlur:!0,disableClearable:!0,value:d,onChange:function(e,t){a(t.id||t["@id"],"acl:agent","acl:Read"),p(null),v(""),y([])},onInputChange:function(e,t){v(t)},renderInput:function(e){return r.createElement(i.TextField,E({},e,{label:l("auth.input.agent_select"),variant:"filled",margin:"dense",fullWidth:!0}))},renderOption:function(e){return r.createElement(i.List,{dense:!0,className:u.list},r.createElement(i.ListItem,{button:!0},r.createElement(i.ListItemAvatar,null,r.createElement(i.Avatar,{src:e.image},r.createElement(s,null))),r.createElement(i.ListItemText,{primary:e["pair:label"]})))}})},te=function(e){var t=e.agent;switch(t.predicate){case F:return"foaf:Agent"===t.id?r.createElement(f,null):r.createElement(d,null);case"acl:agent":return r.createElement(s,null);case"acl:agentGroup":return r.createElement(p,null);default:throw new Error("Unknown agent predicate: "+t.predicate)}},re=i.makeStyles((function(){return{listItem:{paddingLeft:4,paddingRight:36},primaryText:{width:"30%",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},secondaryText:{textAlign:"center",width:"60%",fontStyle:"italic",color:"grey"}}})),ne=function(e){var o=e.isContainer,a=e.agent,c=e.addPermission,s=e.removePermission,f=re(),d=n.useTranslate(),p=n.useDataProvider(),m=A(r.useState(null),2),h=m[0],v=m[1],g=A(t.useState(),2),b=g[0],y=g[1],_=A(t.useState(!0),2),w=_[0],j=_[1],E=A(t.useState(),2),O=E[0],P=E[1];if(t.useEffect((function(){"acl:agent"===a.predicate?p.getOne("Person",{id:a.id}).then((function(e){var t=e.data;y(t),j(!1)})).catch((function(e){P(e),j(!1)})):j(!1)}),[a.id,a.predicate]),"acl:agentGroup"===a.predicate)return null;var k=function(){return v(null)},x=o?Y:X;return w?r.createElement(n.Loading,null):O?r.createElement(n.Error,null):r.createElement(i.ListItem,{className:f.listItem},r.createElement(i.ListItemAvatar,null,r.createElement(i.Avatar,{src:null==b?void 0:b.image},r.createElement(te,{agent:a}))),r.createElement(i.ListItemText,{className:f.primaryText,primary:b?b["pair:label"]:d("foaf:Agent"===a.id?"auth.agent.anonymous":"auth.agent.authenticated")}),r.createElement(i.ListItemText,{className:f.secondaryText,primary:a.permissions&&a.permissions.map((function(e){return d(x[e])})).join(", ")}),r.createElement(i.ListItemSecondaryAction,null,r.createElement(i.IconButton,{onClick:function(e){return v(e.currentTarget)}},r.createElement(u,null)),r.createElement(i.Menu,{anchorEl:h,keepMounted:!0,open:Boolean(h),onClose:k},Object.entries(x).map((function(e){var t=A(e,2),n=t[0],o=t[1],u=a.permissions&&a.permissions.includes(n);return r.createElement(i.MenuItem,{key:n,onClick:function(){u?s(a.id,a.predicate,n):c(a.id,a.predicate,n),k()}},r.createElement(i.ListItemIcon,null,u?r.createElement(l,null):null),r.createElement(i.ListItemText,{primary:d(o)}))})))))},oe=i.makeStyles((function(e){return{list:{width:"100%",maxWidth:"100%",backgroundColor:e.palette.background.paper}}})),ae=function(e){var t=e.isContainer,n=e.agents,o=e.addPermission,a=e.removePermission,c=oe();return r.createElement(i.List,{dense:!0,className:c.list},Object.entries(n).map((function(e){var n=A(e,2),i=n[0],c=n[1];return r.createElement(ne,{key:i,isContainer:t,agent:c,addPermission:o,removePermission:a})})))},ie=function(e){var r=n.usePermissionsOptimized(e).permissions,o=n.useAuthProvider(),a=A(t.useState({}),2),i=a[0],c=a[1];t.useEffect((function(){var e,t=(j(e={},"foaf:Agent",{id:"foaf:Agent",predicate:F,permissions:[]}),j(e,"acl:AuthenticatedAgent",{id:"acl:AuthenticatedAgent",predicate:F,permissions:[]}),e),n=function(e,r,n){t[e]?t[e].permissions.push(n):t[e]={id:e,predicate:r,permissions:[n]}};if(r){var o,a=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=S(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}(r);try{var i=function(){var e=o.value;e[F]&&W(e[F]).forEach((function(t){return n(t,F,e["acl:mode"])})),e["acl:agent"]&&W(e["acl:agent"]).forEach((function(t){return n(t,"acl:agent",e["acl:mode"])})),e["acl:agentGroup"]&&W(e["acl:agentGroup"]).forEach((function(t){return n(t,"acl:agentGroup",e["acl:mode"])}))};for(a.s();!(o=a.n()).done;)i()}catch(e){a.e(e)}finally{a.f()}c(t)}}),[r]);var s=t.useCallback((function(t,r,n){var a,s=P({},i);c(P(P({},i),{},j({},t,{id:t,predicate:r,permissions:i[t]?[].concat(x(null===(a=i[t])||void 0===a?void 0:a.permissions),[n]):[n]}))),o.addPermission(e,t,r,n).catch((function(e){c(s)}))}),[i,c,e,o]),u=t.useCallback((function(t,r,n){var a=P({},i);c(Object.fromEntries(Object.entries(i).map((function(e){var r=A(e,2),o=r[0],a=r[1];return a.id===t&&(a.permissions=a.permissions.filter((function(e){return e!==n}))),[o,a]})).filter((function(e){var t=A(e,2),r=(t[0],t[1]);return r.predicate===F||r.permissions.length>0})))),o.removePermission(e,t,r,n).catch((function(e){c(a)}))}),[i,c,e,o]);return{agents:i,addPermission:s,removePermission:u}},ce=i.makeStyles((function(){return{title:{paddingBottom:8},actions:{padding:15},addForm:{paddingTop:0},listForm:{paddingTop:0,paddingBottom:0,paddingRight:0,maxHeight:210}}})),se=function(e){var t=e.open,o=e.onClose,a=e.resourceId,c=e.isContainer,s=ce(),u=n.useTranslate(),l=ie(a),f=l.agents,d=l.addPermission,p=l.removePermission;return r.createElement(i.Dialog,{fullWidth:!0,open:t,onClose:o},r.createElement(i.DialogTitle,{className:s.title},u(c?"auth.dialog.container_permissions":"auth.dialog.resource_permissions")),r.createElement(i.DialogContent,{className:s.addForm},r.createElement(ee,{agents:f,addPermission:d})),r.createElement(i.DialogContent,{className:s.listForm},r.createElement(ae,{isContainer:c,agents:f,addPermission:d,removePermission:p})),r.createElement(i.DialogActions,{className:s.actions},r.createElement(n.Button,{label:"ra.action.close",variant:"text",onClick:o})))},ue=function(e){var o=e.record,i=e.resource,c=A(t.useState(!1),2),s=c[0],u=c[1],l=!!i?i:o.id||o["@id"];return r.createElement(r.Fragment,null,r.createElement(n.Button,{label:"auth.action.permissions",onClick:function(){return u(!0)}},r.createElement(a,null)),r.createElement(se,{resourceId:l,isContainer:!!i,open:s,onClose:function(){return u(!1)}}))},le=function(e){var t=e.basePath,a=e.className,i=e.data,c=e.hasList,s=e.hasShow,u=e.hasControl,l=k(e,["basePath","className","data","hasList","hasShow","hasControl"]);return r.createElement(o.TopToolbar,E({className:a},l),c&&r.createElement(n.ListButton,{basePath:t,record:i}),s&&r.createElement(n.ShowButton,{basePath:t,record:i}),i&&u&&r.createElement(ue,{basePath:t,record:i}))},fe=function(e){var t=n.useRecordContext(),o=n.usePermissionsOptimized(t.id).permissions;return o&&o.some((function(e){return J.includes(e["acl:mode"])}))?r.createElement(n.DeleteButton,e):null},de=i.makeStyles((function(){return{toolbar:{flex:1,display:"flex",justifyContent:"space-between"}}})),pe=function(e){var t=de();return r.createElement(n.Toolbar,E({},e,{className:t.toolbar}),r.createElement(n.SaveButton,null),r.createElement(fe,{undoable:!1}),"}")},me=function(e,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",a=n.usePermissionsOptimized(e),i=a.permissions,c=n.useNotify(),s=n.useRedirect();return t.useEffect((function(){i&&!i.some((function(e){return K[r].includes(e["acl:mode"])}))&&(c(Q[r],"error"),s(o))}),[i,s,c]),i},he=function(e){var t=e.actions,a=e.resource,i=e.hasCreate,c=k(e,["actions","resource","hasCreate"]),s=n.usePermissionsOptimized(a).permissions;return r.createElement(o.List,E({},c,{resource:a,hasCreate:i&&!!s&&s.some((function(e){return $.includes(e["acl:mode"])})),actions:t&&s&&s.some((function(e){return H.includes(e["acl:mode"])}))?r.cloneElement(t,{bulkActions:r.createElement(ue,null)}):t}))};he.defaultProps={actions:r.createElement(o.ListActions,null)};var ve=function(e){var t=e.basePath,a=e.className,i=e.data,c=e.hasList,s=e.hasEdit,u=e.hasControl,l=k(e,["basePath","className","data","hasList","hasEdit","hasControl"]);return r.createElement(o.TopToolbar,E({className:a},l),c&&r.createElement(n.ListButton,{basePath:t,record:i}),s&&r.createElement(n.EditButton,{basePath:t,record:i}),i&&u&&r.createElement(ue,{basePath:t,record:i}))},ge=h.makeStyles((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",alignItems:"center",justifyContent:"flex-start",backgroundColor:e.palette.primary[500]},card:{minWidth:300,marginTop:"6em"},lockIconAvatar:{margin:"1em",display:"flex",justifyContent:"center"},lockIcon:{backgroundColor:e.palette.secondary[500]}}})),be=function(e){var o=e.theme,a=e.history,c=e.location,s=e.buttons,u=e.userResource,l=ge(),f=n.useNotify(),d=n.useLogin(),p=n.useDataProvider(),g=n.useAuthProvider();return t.useEffect((function(){w(regeneratorRuntime.mark((function e(){var t,r,n,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=new URLSearchParams(c.search)).has("login")){e.next=14;break}if(!t.has("error")){e.next=6;break}"registration.not-allowed"===t.get("error")?f("auth.message.user_email_not_found","error"):f("auth.message.bad_request","error",{error:t.get("error")}),e.next=14;break;case 6:if(!t.has("token")){e.next=14;break}return r=t.get("token"),n=z(r),o=n.webId,e.next=11,p.getOne("Person",{id:o});case 11:i=e.sent,s=i.data,g.checkUser(s)?(localStorage.setItem("token",r),t.has("new")&&"true"===t.get("new")?(f("auth.message.new_user_created","info"),a.push("/"+u+"/"+encodeURIComponent(o)+"/edit")):(f("auth.message.user_connected","info"),a.push("/"))):(f("auth.message.user_not_allowed_to_login","error"),a.replace("/login"));case 14:t.has("logout")&&(localStorage.removeItem("token"),f("auth.message.user_disconnected","info"),a.push("/"));case 15:case"end":return e.stop()}}),e)})))()}),[c.search]),r.createElement(m.ThemeProvider,{theme:h.createMuiTheme(o)},r.createElement("div",{className:l.main},r.createElement(i.Card,{className:l.card},r.createElement("div",{className:l.lockIconAvatar},r.createElement(i.Avatar,{className:l.lockIcon},r.createElement(v,null))),s&&s.map((function(e,t){return r.createElement(i.CardActions,{key:t},r.cloneElement(e,{fullWidth:!0,variant:"outlined",type:"submit",onClick:function(){return d({},"/login")}}))})))),r.createElement(n.Notification,null))};be.defaultProps={buttons:[r.createElement(i.Button,{startIcon:r.createElement(i.Avatar,{src:"/lescommuns.jpg"})},"Les Communs")],userResource:"Person"};var ye=t.forwardRef((function(e,t){var o=n.useLogout();return r.createElement(g,{onClick:function(){return o()},ref:t},r.createElement(b,null),"   Se déconnecter")})),_e=t.forwardRef((function(e,t){var o=e.onClick,a=e.webId;return r.createElement(n.MenuItemLink,{ref:t,to:"/Person/".concat(encodeURIComponent(a),"/show"),primaryText:"Voir mon profil",leftIcon:r.createElement(y,null),onClick:o})})),we=t.forwardRef((function(e,t){var o=e.onClick,a=e.webId;return r.createElement(n.MenuItemLink,{ref:t,to:"/Person/".concat(encodeURIComponent(a),"/edit"),primaryText:"Editer mon profil",leftIcon:r.createElement(u,null),onClick:o})})),je=t.forwardRef((function(e,t){var o=e.onClick;return r.createElement(n.MenuItemLink,{ref:t,to:"/login",primaryText:"Se connecter",onClick:o})}));var Ee=function(){this.__data__=[],this.size=0};var Oe=function(e,t){return e===t||e!=e&&t!=t};var Pe=function(e,t){for(var r=e.length;r--;)if(Oe(e[r][0],t))return r;return-1},ke=Array.prototype.splice;var Ae=function(e){var t=this.__data__,r=Pe(t,e);return!(r<0)&&(r==t.length-1?t.pop():ke.call(t,r,1),--this.size,!0)};var xe=function(e){var t=this.__data__,r=Pe(t,e);return r<0?void 0:t[r][1]};var Se=function(e){return Pe(this.__data__,e)>-1};var Ce=function(e,t){var r=this.__data__,n=Pe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function Ie(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ie.prototype.clear=Ee,Ie.prototype.delete=Ae,Ie.prototype.get=xe,Ie.prototype.has=Se,Ie.prototype.set=Ce;var Te=Ie;var Re=function(){this.__data__=new Te,this.size=0};var Le=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var ze=function(e){return this.__data__.get(e)};var Ue=function(e){return this.__data__.has(e)},Ne="object"==typeof U&&U&&U.Object===Object&&U,qe="object"==typeof self&&self&&self.Object===Object&&self,Be=Ne||qe||Function("return this")(),Me=Be.Symbol,We=Object.prototype,De=We.hasOwnProperty,Ve=We.toString,Fe=Me?Me.toStringTag:void 0;var $e=function(e){var t=De.call(e,Fe),r=e[Fe];try{e[Fe]=void 0;var n=!0}catch(e){}var o=Ve.call(e);return n&&(t?e[Fe]=r:delete e[Fe]),o},Ge=Object.prototype.toString;var Je=function(e){return Ge.call(e)},He=Me?Me.toStringTag:void 0;var Ke=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":He&&He in Object(e)?$e(e):Je(e)};var Qe=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Xe,Ye=function(e){if(!Qe(e))return!1;var t=Ke(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Ze=Be["__core-js_shared__"],et=(Xe=/[^.]+$/.exec(Ze&&Ze.keys&&Ze.keys.IE_PROTO||""))?"Symbol(src)_1."+Xe:"";var tt=function(e){return!!et&&et in e},rt=Function.prototype.toString;var nt=function(e){if(null!=e){try{return rt.call(e)}catch(e){}try{return e+""}catch(e){}}return""},ot=/^\[object .+?Constructor\]$/,at=Function.prototype,it=Object.prototype,ct=at.toString,st=it.hasOwnProperty,ut=RegExp("^"+ct.call(st).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var lt=function(e){return!(!Qe(e)||tt(e))&&(Ye(e)?ut:ot).test(nt(e))};var ft=function(e,t){return null==e?void 0:e[t]};var dt=function(e,t){var r=ft(e,t);return lt(r)?r:void 0},pt=dt(Be,"Map"),mt=dt(Object,"create");var ht=function(){this.__data__=mt?mt(null):{},this.size=0};var vt=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},gt=Object.prototype.hasOwnProperty;var bt=function(e){var t=this.__data__;if(mt){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return gt.call(t,e)?t[e]:void 0},yt=Object.prototype.hasOwnProperty;var _t=function(e){var t=this.__data__;return mt?void 0!==t[e]:yt.call(t,e)};var wt=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=mt&&void 0===t?"__lodash_hash_undefined__":t,this};function jt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}jt.prototype.clear=ht,jt.prototype.delete=vt,jt.prototype.get=bt,jt.prototype.has=_t,jt.prototype.set=wt;var Et=jt;var Ot=function(){this.size=0,this.__data__={hash:new Et,map:new(pt||Te),string:new Et}};var Pt=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var kt=function(e,t){var r=e.__data__;return Pt(t)?r["string"==typeof t?"string":"hash"]:r.map};var At=function(e){var t=kt(this,e).delete(e);return this.size-=t?1:0,t};var xt=function(e){return kt(this,e).get(e)};var St=function(e){return kt(this,e).has(e)};var Ct=function(e,t){var r=kt(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function It(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}It.prototype.clear=Ot,It.prototype.delete=At,It.prototype.get=xt,It.prototype.has=St,It.prototype.set=Ct;var Tt=It;var Rt=function(e,t){var r=this.__data__;if(r instanceof Te){var n=r.__data__;if(!pt||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Tt(n)}return r.set(e,t),this.size=r.size,this};function Lt(e){var t=this.__data__=new Te(e);this.size=t.size}Lt.prototype.clear=Re,Lt.prototype.delete=Le,Lt.prototype.get=ze,Lt.prototype.has=Ue,Lt.prototype.set=Rt;var zt=Lt;var Ut=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var Nt=function(e){return this.__data__.has(e)};function qt(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Tt;++t<r;)this.add(e[t])}qt.prototype.add=qt.prototype.push=Ut,qt.prototype.has=Nt;var Bt=qt;var Mt=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var Wt=function(e,t){return e.has(t)};var Dt=function(e,t,r,n,o,a){var i=1&r,c=e.length,s=t.length;if(c!=s&&!(i&&s>c))return!1;var u=a.get(e);if(u&&a.get(t))return u==t;var l=-1,f=!0,d=2&r?new Bt:void 0;for(a.set(e,t),a.set(t,e);++l<c;){var p=e[l],m=t[l];if(n)var h=i?n(m,p,l,t,e,a):n(p,m,l,e,t,a);if(void 0!==h){if(h)continue;f=!1;break}if(d){if(!Mt(t,(function(e,t){if(!Wt(d,t)&&(p===e||o(p,e,r,n,a)))return d.push(t)}))){f=!1;break}}else if(p!==m&&!o(p,m,r,n,a)){f=!1;break}}return a.delete(e),a.delete(t),f},Vt=Be.Uint8Array;var Ft=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var $t=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},Gt=Me?Me.prototype:void 0,Jt=Gt?Gt.valueOf:void 0;var Ht=function(e,t,r,n,o,a,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new Vt(e),new Vt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Oe(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var c=Ft;case"[object Set]":var s=1&n;if(c||(c=$t),e.size!=t.size&&!s)return!1;var u=i.get(e);if(u)return u==t;n|=2,i.set(e,t);var l=Dt(c(e),c(t),n,o,a,i);return i.delete(e),l;case"[object Symbol]":if(Jt)return Jt.call(e)==Jt.call(t)}return!1};var Kt=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e},Qt=Array.isArray;var Xt=function(e,t,r){var n=t(e);return Qt(e)?n:Kt(n,r(e))};var Yt=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var i=e[r];t(i,r,e)&&(a[o++]=i)}return a};var Zt=function(){return[]},er=Object.prototype.propertyIsEnumerable,tr=Object.getOwnPropertySymbols,rr=tr?function(e){return null==e?[]:(e=Object(e),Yt(tr(e),(function(t){return er.call(e,t)})))}:Zt;var nr=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var or=function(e){return null!=e&&"object"==typeof e};var ar=function(e){return or(e)&&"[object Arguments]"==Ke(e)},ir=Object.prototype,cr=ir.hasOwnProperty,sr=ir.propertyIsEnumerable,ur=ar(function(){return arguments}())?ar:function(e){return or(e)&&cr.call(e,"callee")&&!sr.call(e,"callee")};var lr=function(){return!1},fr=N((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?Be.Buffer:void 0,a=(o?o.isBuffer:void 0)||lr;e.exports=a})),dr=/^(?:0|[1-9]\d*)$/;var pr=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&dr.test(e))&&e>-1&&e%1==0&&e<t};var mr=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},hr={};hr["[object Float32Array]"]=hr["[object Float64Array]"]=hr["[object Int8Array]"]=hr["[object Int16Array]"]=hr["[object Int32Array]"]=hr["[object Uint8Array]"]=hr["[object Uint8ClampedArray]"]=hr["[object Uint16Array]"]=hr["[object Uint32Array]"]=!0,hr["[object Arguments]"]=hr["[object Array]"]=hr["[object ArrayBuffer]"]=hr["[object Boolean]"]=hr["[object DataView]"]=hr["[object Date]"]=hr["[object Error]"]=hr["[object Function]"]=hr["[object Map]"]=hr["[object Number]"]=hr["[object Object]"]=hr["[object RegExp]"]=hr["[object Set]"]=hr["[object String]"]=hr["[object WeakMap]"]=!1;var vr=function(e){return or(e)&&mr(e.length)&&!!hr[Ke(e)]};var gr=function(e){return function(t){return e(t)}},br=N((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r&&Ne.process,a=function(){try{var e=n&&n.require&&n.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a})),yr=br&&br.isTypedArray,_r=yr?gr(yr):vr,wr=Object.prototype.hasOwnProperty;var jr=function(e,t){var r=Qt(e),n=!r&&ur(e),o=!r&&!n&&fr(e),a=!r&&!n&&!o&&_r(e),i=r||n||o||a,c=i?nr(e.length,String):[],s=c.length;for(var u in e)!t&&!wr.call(e,u)||i&&("length"==u||o&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||pr(u,s))||c.push(u);return c},Er=Object.prototype;var Or=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Er)};var Pr=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),kr=Object.prototype.hasOwnProperty;var Ar=function(e){if(!Or(e))return Pr(e);var t=[];for(var r in Object(e))kr.call(e,r)&&"constructor"!=r&&t.push(r);return t};var xr=function(e){return null!=e&&mr(e.length)&&!Ye(e)};var Sr=function(e){return xr(e)?jr(e):Ar(e)};var Cr=function(e){return Xt(e,Sr,rr)},Ir=Object.prototype.hasOwnProperty;var Tr=function(e,t,r,n,o,a){var i=1&r,c=Cr(e),s=c.length;if(s!=Cr(t).length&&!i)return!1;for(var u=s;u--;){var l=c[u];if(!(i?l in t:Ir.call(t,l)))return!1}var f=a.get(e);if(f&&a.get(t))return f==t;var d=!0;a.set(e,t),a.set(t,e);for(var p=i;++u<s;){var m=e[l=c[u]],h=t[l];if(n)var v=i?n(h,m,l,t,e,a):n(m,h,l,e,t,a);if(!(void 0===v?m===h||o(m,h,r,n,a):v)){d=!1;break}p||(p="constructor"==l)}if(d&&!p){var g=e.constructor,b=t.constructor;g==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b||(d=!1)}return a.delete(e),a.delete(t),d},Rr=dt(Be,"DataView"),Lr=dt(Be,"Promise"),zr=dt(Be,"Set"),Ur=dt(Be,"WeakMap"),Nr=nt(Rr),qr=nt(pt),Br=nt(Lr),Mr=nt(zr),Wr=nt(Ur),Dr=Ke;(Rr&&"[object DataView]"!=Dr(new Rr(new ArrayBuffer(1)))||pt&&"[object Map]"!=Dr(new pt)||Lr&&"[object Promise]"!=Dr(Lr.resolve())||zr&&"[object Set]"!=Dr(new zr)||Ur&&"[object WeakMap]"!=Dr(new Ur))&&(Dr=function(e){var t=Ke(e),r="[object Object]"==t?e.constructor:void 0,n=r?nt(r):"";if(n)switch(n){case Nr:return"[object DataView]";case qr:return"[object Map]";case Br:return"[object Promise]";case Mr:return"[object Set]";case Wr:return"[object WeakMap]"}return t});var Vr=Dr,Fr=Object.prototype.hasOwnProperty;var $r=function(e,t,r,n,o,a){var i=Qt(e),c=Qt(t),s=i?"[object Array]":Vr(e),u=c?"[object Array]":Vr(t),l="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s),f="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),d=s==u;if(d&&fr(e)){if(!fr(t))return!1;i=!0,l=!1}if(d&&!l)return a||(a=new zt),i||_r(e)?Dt(e,t,r,n,o,a):Ht(e,t,s,r,n,o,a);if(!(1&r)){var p=l&&Fr.call(e,"__wrapped__"),m=f&&Fr.call(t,"__wrapped__");if(p||m){var h=p?e.value():e,v=m?t.value():t;return a||(a=new zt),o(h,v,r,n,a)}}return!!d&&(a||(a=new zt),Tr(e,t,r,n,o,a))};var Gr=function e(t,r,n,o,a){return t===r||(null==t||null==r||!or(t)&&!or(r)?t!=t&&r!=r:$r(t,r,n,o,e,a))};var Jr=function(e,t){return Gr(e,t)},Hr={},Kr={"{}":void 0};exports.DeleteButtonWithPermissions=fe,exports.EditActions=le,exports.EditToolbarWithPermissions=pe,exports.EditWithPermissions=function(e){var t=me(e.id,"edit");return r.createElement(n.Edit,E({actions:r.createElement(le,{hasControl:!!t&&t.some((function(e){return H.includes(e["acl:mode"])}))})},e,{permissions:t}),r.cloneElement(e.children,P({toolbar:r.createElement(pe,null)},e.children.props)))},exports.ListWithPermissions=he,exports.LoginPage=be,exports.LogoutButton=ye,exports.PermissionsButton=ue,exports.ResourceWithPermissions=function(e){var t=e.name,o=e.create,a=k(e,["name","create"]),i=n.usePermissionsOptimized(t).permissions;return r.createElement(n.Resource,E({},a,{name:t,create:i&&i.some((function(e){return $.includes(e["acl:mode"])}))?o:void 0}))},exports.ShowActions=ve,exports.ShowWithPermissions=function(e){var t=n.usePermissionsOptimized(e.id).permissions;return r.createElement(n.Show,E({actions:r.createElement(ve,{hasControl:!!t&&t.some((function(e){return H.includes(e["acl:mode"])}))})},e,{permissions:t,hasEdit:e.hasEdit&&!!t&&t.some((function(e){return G.includes(e["acl:mode"])}))}))},exports.UserMenu=function(e){var t=e.logout,o=k(e,["logout"]),a=n.useGetIdentity().identity;return r.createElement(n.UserMenu,o,a&&""!==a.id?[r.createElement(_e,{webId:a.id,key:"view"}),r.createElement(we,{webId:a.id,key:"edit"}),r.cloneElement(t,{key:"logout"})]:r.createElement(je,null))},exports.authProvider=function(e){var t,r,n,o,a,i,c=e.middlewareUri,s=e.allowAnonymous,u=void 0===s||s,l=e.checkUser,f=e.httpClient,d=e.checkPermissions,p=e.resources;return{login:(i=w(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new URL(window.location.href),window.location.href="".concat(c,"auth?redirectUrl=")+encodeURIComponent(r.origin+"/login?login=true");case 2:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)}),logout:(a=w(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new URL(window.location.href),u){e.next=6;break}localStorage.removeItem("token"),window.location.href="".concat(c,"auth/logout?redirectUrl=")+encodeURIComponent(t.origin+"/login"),e.next=8;break;case 6:return window.location.href="".concat(c,"auth/logout?redirectUrl=")+encodeURIComponent(t.origin+"/login?logout=true"),e.abrupt("return","/");case 8:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)}),checkAuth:(o=w(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.getItem("token")||u){e.next=3;break}throw new Error;case 3:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)}),checkUser:function(e){return!l||l(e)},checkError:function(e){return Promise.resolve()},getPermissions:(n=w(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=2;break}return e.abrupt("return",!0);case 2:return r=p[t]?p[t].containerUri:t,n=D(c,r),e.next=6,f(n);case 6:return o=e.sent,a=o.json,e.abrupt("return",a["@graph"]);case 9:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)}),addPermission:(r=w(regeneratorRuntime.mark((function e(t,r,n,o){var a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=p[t]?p[t].containerUri:t,s=D(c,i),j(a={"@id":"#"+o.replace("acl:",""),"@type":"acl:Authorization"},n,r),j(a,"acl:accessTo",i),j(a,"acl:mode",o),u=a,e.next=5,f(s,{method:"PATCH",body:JSON.stringify({"@context":V(s),"@graph":[u]})});case 5:case"end":return e.stop()}}),e)}))),function(e,t,n,o){return r.apply(this,arguments)}),removePermission:(t=w(regeneratorRuntime.mark((function e(t,r,n,o){var a,i,s,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=p[t]?p[t].containerUri:t,i=D(c,a),e.next=4,f(i);case 4:return s=e.sent,u=s.json,l=u["@graph"].filter((function(e){return!e["@id"].includes("#Default")})).map((function(e){var t=W(e["acl:mode"]),a=W(e[n]);return o&&t.includes(o)&&a&&a.includes(r)&&(a=a.filter((function(e){return e!==r}))),P(P({},e),{},j({},n,a))})),e.next=9,f(i,{method:"PUT",body:JSON.stringify({"@context":V(i),"@graph":l})});case 9:case"end":return e.stop()}}),e)}))),function(e,r,n,o){return t.apply(this,arguments)}),getIdentity:function(){var e=localStorage.getItem("token");if(e){var t=z(e);return{id:t.webId,fullName:t.name}}}}},exports.frenchMessages={auth:{dialog:{container_permissions:"Permissions sur le container",resource_permissions:"Permissions sur la resource"},action:{permissions:"Permissions"},right:{resource:{read:"Lire",append:"Enrichir",write:"Modifier",control:"Administrer"},container:{read:"Lister",append:"Ajouter",write:"Ajouter",control:"Administrer"}},agent:{anonymous:"Tous les utilisateurs",authenticated:"Utilisateurs connectés"},input:{agent_select:"Ajouter un utilisateur..."},message:{resource_show_forbidden:"Vous n'avez pas la permission de voir cette ressource",resource_edit_forbidden:"Vous n'avez pas la permission d'éditer cette ressource",resource_delete_forbidden:"Vous n'avez pas la permission d'effacer cette ressource",resource_control_forbidden:"Vous n'avez pas la permission d'administrer cette ressource",container_create_forbidden:"Vous n'avez pas la permission de créer des ressources",container_list_forbidden:"Vous n'avez pas la permission de voir ces ressources",user_not_allowed_to_login:"Vous n'avez pas le droit de vous connecter avec ce compte",user_email_not_found:"Aucun compte trouvé avec cette adresse mail",new_user_created:"Votre compte a été créé, vous pouvez maintenant le compléter",user_connected:"Vous êtes maintenant connecté",user_disconnected:"Vous êtes maintenant déconnecté",bad_request:"Requête erronée (Message d'erreur renvoyé par le serveur: %{error})"}}},exports.useAgents=ie,exports.useCheckPermissions=me,exports.usePermissionsWithRefetch=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Hr,r=JSON.stringify(e),o=n.useSafeSetState({permissions:Kr[r]}),a=A(o,2),i=a[0],c=a[1],s=n.useGetPermissions(),u=t.useCallback((function(){return s(e).then((function(e){Jr(e,i.permissions)||(Kr[r]=e,c({permissions:e}))})).catch((function(e){c({error:e})}))}),[r,e,s]);return t.useEffect((function(){u()}),[r]),P(P({},i),{},{refetch:u})};
//# sourceMappingURL=index.cjs.js.map
