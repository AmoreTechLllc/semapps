"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),r=e(t),n=e(require("@material-ui/icons/Public")),o=e(require("@material-ui/icons/VpnLock")),a=e(require("@material-ui/icons/Person")),i=e(require("@material-ui/icons/Group")),c=require("react-admin"),u=require("@material-ui/core"),s=require("@material-ui/styles"),l=require("@material-ui/core/styles"),f=e(require("@material-ui/icons/Lock")),p=e(require("@material-ui/core/MenuItem")),d=e(require("@material-ui/icons/PowerSettingsNew")),m=e(require("@material-ui/icons/Share")),h=e(require("@material-ui/lab/Autocomplete")),v=e(require("@material-ui/icons/Edit")),b=e(require("@material-ui/icons/Check")),y=e(require("@material-ui/icons/AccountCircle"));function g(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function j(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){g(a,n,o,i,c,"next",e)}function c(e){g(a,n,o,i,c,"throw",e)}i(void 0)}))}}function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w(){return(w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){_(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}(e,t)||A(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){if(e){if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function C(e){this.message=e}C.prototype=new Error,C.prototype.name="InvalidCharacterError";var I,x="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new C("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,o=0,a=0,i="";n=t.charAt(a++);~n&&(r=o%4?64*r+n:n,o++%4)?i+=String.fromCharCode(255&r>>(-2*o&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return i};function T(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(x(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return x(t)}}function L(e){this.message=e}L.prototype=new Error,L.prototype.name="InvalidTokenError";var U=["acl:Read","acl:Append","acl:Write","acl:Control"],N=["acl:Append","acl:Write","acl:Control"],R=["acl:Append","acl:Write","acl:Control"],z=["acl:Write","acl:Control"],M=["acl:Control"],B=(_(I={},"acl:Read","Lire"),_(I,"acl:Append","Enrichir"),_(I,"acl:Write","Modifier"),_(I,"acl:Control","Administrer"),I),D={anon:"acl:agentClass",anyUser:"acl:agentClass",user:"acl:agent",group:"acl:group"},q={anon:{label:"Tous les utilisateurs",icon:r.createElement(n,null)},anyUser:{label:"Utilisateurs connectés",icon:r.createElement(o,null)},user:{icon:r.createElement(a,null)},group:{icon:r.createElement(i,null)}},W="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function F(e,t){return e(t={exports:{}},t.exports),t.exports}var $=F((function(e){var t,r;t=W,r=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var r=e.shift();e[0]=r+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(n>0&&(o=o.replace(/^[\/]+/,"")),o=n<e.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),t.push(o))}var a=t.join("/"),i=(a=a.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return a=i.shift()+(i.length>0?"?":"")+i.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=r():t.urljoin=r()})),V=function(e){return e?Array.isArray(e)?e:[e]:void 0},G=function(e,t){return $(e,t.replace(e,"_acl/"))},J=function(e){var t=e.basePath,n=e.className,o=e.data,a=e.hasList,i=e.hasShow,u=P(e,["basePath","className","data","hasList","hasShow"]);return r.createElement(c.TopToolbar,w({className:n},u),a&&r.createElement(c.ListButton,{basePath:t,record:o}),i&&r.createElement(c.ShowButton,{basePath:t,record:o}))},H=u.makeStyles((function(){return{toolbar:{flex:1,display:"flex",justifyContent:"space-between"}}})),K=function(e){var t=e.hasDelete,n=P(e,["hasDelete"]),o=H();return r.createElement(c.Toolbar,w({},n,{className:o.toolbar}),r.createElement(c.SaveButton,null),t&&r.createElement(c.DeleteButton,{undoable:!1}))},Q=l.makeStyles((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",alignItems:"center",justifyContent:"flex-start",backgroundColor:e.palette.primary[500]},card:{minWidth:300,marginTop:"6em"},lockIconAvatar:{margin:"1em",display:"flex",justifyContent:"center"},lockIcon:{backgroundColor:e.palette.secondary[500]}}})),X=function(e){var r=e.theme,n=e.history,o=e.location,a=e.buttons,i=Q(),p=c.useNotify(),d=c.useLogin(),m=new URLSearchParams(o.search);return m.has("token")&&(localStorage.setItem("token",m.get("token")),p("Vous êtes maintenant connecté","info"),n.push("/")),m.has("logout")&&(localStorage.removeItem("token"),p("Vous êtes maintenant déconnecté","info"),n.push("/")),t.createElement(s.ThemeProvider,{theme:l.createMuiTheme(r)},t.createElement("div",{className:i.main},t.createElement(u.Card,{className:i.card},t.createElement("div",{className:i.lockIconAvatar},t.createElement(u.Avatar,{className:i.lockIcon},t.createElement(f,null))),a&&a.map((function(e){return t.createElement(u.CardActions,null,t.cloneElement(e,{fullWidth:!0,variant:"outlined",type:"submit",onClick:function(){return d({},"/login")}}))})))),t.createElement(c.Notification,null))};X.defaultProps={buttons:[t.createElement(u.Button,{startIcon:t.createElement(u.Avatar,{src:"/lescommuns.jpg"})},"Les Communs")]};var Y=t.forwardRef((function(e,t){var n=c.useLogout();return r.createElement(p,{onClick:function(){return n()},ref:t},r.createElement(d,null),"   Se déconnecter")})),Z=u.makeStyles((function(){return{list:{padding:0,width:"100%"},option:{padding:0}}})),ee=function(e){var n=e.addPermission,o=Z(),i=k(r.useState(null),2),s=i[0],l=i[1],f=k(r.useState(""),2),p=f[0],d=f[1],m=k(r.useState([]),2),v=m[0],b=m[1],y=c.useGetList("Person",{page:1,perPage:100},{field:"pair:label",order:"ASC"},{q:p},{enabled:p.length>0}),g=y.ids,j=y.data;return t.useEffect((function(){b(g.length>0?Object.values(j):[])}),[g,j]),r.createElement(h,{classes:{option:o.option},getOptionLabel:function(e){return e["pair:label"]},filterOptions:function(e){return e},options:v,noOptionsText:"Aucun résultat",autoComplete:!0,blurOnSelect:!0,clearOnBlur:!0,disableClearable:!0,value:s,onChange:function(e,t){n(t.id||t["@id"],"user","acl:Read"),l(null),d(""),b([])},onInputChange:function(e,t){d(t)},renderInput:function(e){return r.createElement(u.TextField,w({},e,{label:"Ajouter un utilisateur ou un groupe...",variant:"filled",margin:"dense",fullWidth:!0}))},renderOption:function(e){return r.createElement(u.List,{dense:!0,className:o.list},r.createElement(u.ListItem,{button:!0},r.createElement(u.ListItemAvatar,null,r.createElement(u.Avatar,{src:e.image},r.createElement(a,null))),r.createElement(u.ListItemText,{primary:e["pair:label"]})))}})},te=u.makeStyles((function(){return{listItem:{paddingLeft:4,paddingRight:36},secondaryText:{textAlign:"center",width:"50%",fontStyle:"italic",color:"grey"}}})),re=function(e){var n=e.agent,o=e.addPermission,a=e.removePermission,i=te(),s=c.useDataProvider(),l=k(r.useState(null),2),f=l[0],p=l[1],d=k(t.useState(),2),m=d[0],h=d[1],y=k(t.useState(!0),2),g=y[0],j=y[1],_=k(t.useState(),2),w=_[0],E=_[1];if(t.useEffect((function(){"user"===n.type?s.getOne("Person",{id:n.id}).then((function(e){var t=e.data;h(t),j(!1)})).catch((function(e){E(e),j(!1)})):j(!1)}),[n.id,n.type]),"group"===n.type)return null;var O=function(){return p(null)};return g?r.createElement(c.Loading,null):w?r.createElement(c.Error,null):r.createElement(u.ListItem,{button:!0,className:i.listItem},r.createElement(u.ListItemAvatar,null,r.createElement(u.Avatar,{src:null==m?void 0:m.image},n.icon)),r.createElement(u.ListItemText,{primary:n.label||(null==m?void 0:m["pair:label"])}),r.createElement(u.ListItemText,{className:i.secondaryText,primary:n.permissions&&n.permissions.map((function(e){return B[e]})).join(", ")}),r.createElement(u.ListItemSecondaryAction,null,r.createElement(u.IconButton,{onClick:function(e){return p(e.currentTarget)}},r.createElement(v,null)),r.createElement(u.Menu,{anchorEl:f,keepMounted:!0,open:Boolean(f),onClose:O},Object.entries(B).map((function(e){var t=k(e,2),i=t[0],c=t[1],s=n.permissions&&n.permissions.includes(i);return r.createElement(u.MenuItem,{onClick:function(){s?a(n.id,n.type,i):o(n.id,n.type,i),O()}},r.createElement(u.ListItemIcon,null,s?r.createElement(b,null):null),r.createElement(u.ListItemText,{primary:c}))})))))},ne=u.makeStyles((function(e){return{list:{width:"100%",maxWidth:"100%",backgroundColor:e.palette.background.paper}}})),oe=function(e){var t=e.agents,n=e.addPermission,o=e.removePermission,a=ne();return r.createElement(u.List,{dense:!0,className:a.list},Object.entries(t).map((function(e){var t=k(e,2),a=t[0],i=t[1];return r.createElement(re,{key:a,agent:i,addPermission:n,removePermission:o})})))};var ae=function(){this.__data__=[],this.size=0};var ie=function(e,t){return e===t||e!=e&&t!=t};var ce=function(e,t){for(var r=e.length;r--;)if(ie(e[r][0],t))return r;return-1},ue=Array.prototype.splice;var se=function(e){var t=this.__data__,r=ce(t,e);return!(r<0)&&(r==t.length-1?t.pop():ue.call(t,r,1),--this.size,!0)};var le=function(e){var t=this.__data__,r=ce(t,e);return r<0?void 0:t[r][1]};var fe=function(e){return ce(this.__data__,e)>-1};var pe=function(e,t){var r=this.__data__,n=ce(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function de(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}de.prototype.clear=ae,de.prototype.delete=se,de.prototype.get=le,de.prototype.has=fe,de.prototype.set=pe;var me=de;var he=function(){this.__data__=new me,this.size=0};var ve=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var be=function(e){return this.__data__.get(e)};var ye=function(e){return this.__data__.has(e)},ge="object"==typeof W&&W&&W.Object===Object&&W,je="object"==typeof self&&self&&self.Object===Object&&self,_e=ge||je||Function("return this")(),we=_e.Symbol,Ee=Object.prototype,Oe=Ee.hasOwnProperty,Pe=Ee.toString,ke=we?we.toStringTag:void 0;var Ae=function(e){var t=Oe.call(e,ke),r=e[ke];try{e[ke]=void 0;var n=!0}catch(e){}var o=Pe.call(e);return n&&(t?e[ke]=r:delete e[ke]),o},Se=Object.prototype.toString;var Ce=function(e){return Se.call(e)},Ie=we?we.toStringTag:void 0;var xe=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Ie&&Ie in Object(e)?Ae(e):Ce(e)};var Te=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Le,Ue=function(e){if(!Te(e))return!1;var t=xe(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Ne=_e["__core-js_shared__"],Re=(Le=/[^.]+$/.exec(Ne&&Ne.keys&&Ne.keys.IE_PROTO||""))?"Symbol(src)_1."+Le:"";var ze=function(e){return!!Re&&Re in e},Me=Function.prototype.toString;var Be=function(e){if(null!=e){try{return Me.call(e)}catch(e){}try{return e+""}catch(e){}}return""},De=/^\[object .+?Constructor\]$/,qe=Function.prototype,We=Object.prototype,Fe=qe.toString,$e=We.hasOwnProperty,Ve=RegExp("^"+Fe.call($e).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Ge=function(e){return!(!Te(e)||ze(e))&&(Ue(e)?Ve:De).test(Be(e))};var Je=function(e,t){return null==e?void 0:e[t]};var He=function(e,t){var r=Je(e,t);return Ge(r)?r:void 0},Ke=He(_e,"Map"),Qe=He(Object,"create");var Xe=function(){this.__data__=Qe?Qe(null):{},this.size=0};var Ye=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ze=Object.prototype.hasOwnProperty;var et=function(e){var t=this.__data__;if(Qe){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Ze.call(t,e)?t[e]:void 0},tt=Object.prototype.hasOwnProperty;var rt=function(e){var t=this.__data__;return Qe?void 0!==t[e]:tt.call(t,e)};var nt=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Qe&&void 0===t?"__lodash_hash_undefined__":t,this};function ot(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ot.prototype.clear=Xe,ot.prototype.delete=Ye,ot.prototype.get=et,ot.prototype.has=rt,ot.prototype.set=nt;var at=ot;var it=function(){this.size=0,this.__data__={hash:new at,map:new(Ke||me),string:new at}};var ct=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var ut=function(e,t){var r=e.__data__;return ct(t)?r["string"==typeof t?"string":"hash"]:r.map};var st=function(e){var t=ut(this,e).delete(e);return this.size-=t?1:0,t};var lt=function(e){return ut(this,e).get(e)};var ft=function(e){return ut(this,e).has(e)};var pt=function(e,t){var r=ut(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function dt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}dt.prototype.clear=it,dt.prototype.delete=st,dt.prototype.get=lt,dt.prototype.has=ft,dt.prototype.set=pt;var mt=dt;var ht=function(e,t){var r=this.__data__;if(r instanceof me){var n=r.__data__;if(!Ke||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new mt(n)}return r.set(e,t),this.size=r.size,this};function vt(e){var t=this.__data__=new me(e);this.size=t.size}vt.prototype.clear=he,vt.prototype.delete=ve,vt.prototype.get=be,vt.prototype.has=ye,vt.prototype.set=ht;var bt=vt;var yt=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var gt=function(e){return this.__data__.has(e)};function jt(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new mt;++t<r;)this.add(e[t])}jt.prototype.add=jt.prototype.push=yt,jt.prototype.has=gt;var _t=jt;var wt=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var Et=function(e,t){return e.has(t)};var Ot=function(e,t,r,n,o,a){var i=1&r,c=e.length,u=t.length;if(c!=u&&!(i&&u>c))return!1;var s=a.get(e);if(s&&a.get(t))return s==t;var l=-1,f=!0,p=2&r?new _t:void 0;for(a.set(e,t),a.set(t,e);++l<c;){var d=e[l],m=t[l];if(n)var h=i?n(m,d,l,t,e,a):n(d,m,l,e,t,a);if(void 0!==h){if(h)continue;f=!1;break}if(p){if(!wt(t,(function(e,t){if(!Et(p,t)&&(d===e||o(d,e,r,n,a)))return p.push(t)}))){f=!1;break}}else if(d!==m&&!o(d,m,r,n,a)){f=!1;break}}return a.delete(e),a.delete(t),f},Pt=_e.Uint8Array;var kt=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var At=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},St=we?we.prototype:void 0,Ct=St?St.valueOf:void 0;var It=function(e,t,r,n,o,a,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new Pt(e),new Pt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ie(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var c=kt;case"[object Set]":var u=1&n;if(c||(c=At),e.size!=t.size&&!u)return!1;var s=i.get(e);if(s)return s==t;n|=2,i.set(e,t);var l=Ot(c(e),c(t),n,o,a,i);return i.delete(e),l;case"[object Symbol]":if(Ct)return Ct.call(e)==Ct.call(t)}return!1};var xt=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e},Tt=Array.isArray;var Lt=function(e,t,r){var n=t(e);return Tt(e)?n:xt(n,r(e))};var Ut=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var i=e[r];t(i,r,e)&&(a[o++]=i)}return a};var Nt=function(){return[]},Rt=Object.prototype.propertyIsEnumerable,zt=Object.getOwnPropertySymbols,Mt=zt?function(e){return null==e?[]:(e=Object(e),Ut(zt(e),(function(t){return Rt.call(e,t)})))}:Nt;var Bt=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var Dt=function(e){return null!=e&&"object"==typeof e};var qt=function(e){return Dt(e)&&"[object Arguments]"==xe(e)},Wt=Object.prototype,Ft=Wt.hasOwnProperty,$t=Wt.propertyIsEnumerable,Vt=qt(function(){return arguments}())?qt:function(e){return Dt(e)&&Ft.call(e,"callee")&&!$t.call(e,"callee")};var Gt=function(){return!1},Jt=F((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?_e.Buffer:void 0,a=(o?o.isBuffer:void 0)||Gt;e.exports=a})),Ht=/^(?:0|[1-9]\d*)$/;var Kt=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Ht.test(e))&&e>-1&&e%1==0&&e<t};var Qt=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Xt={};Xt["[object Float32Array]"]=Xt["[object Float64Array]"]=Xt["[object Int8Array]"]=Xt["[object Int16Array]"]=Xt["[object Int32Array]"]=Xt["[object Uint8Array]"]=Xt["[object Uint8ClampedArray]"]=Xt["[object Uint16Array]"]=Xt["[object Uint32Array]"]=!0,Xt["[object Arguments]"]=Xt["[object Array]"]=Xt["[object ArrayBuffer]"]=Xt["[object Boolean]"]=Xt["[object DataView]"]=Xt["[object Date]"]=Xt["[object Error]"]=Xt["[object Function]"]=Xt["[object Map]"]=Xt["[object Number]"]=Xt["[object Object]"]=Xt["[object RegExp]"]=Xt["[object Set]"]=Xt["[object String]"]=Xt["[object WeakMap]"]=!1;var Yt=function(e){return Dt(e)&&Qt(e.length)&&!!Xt[xe(e)]};var Zt=function(e){return function(t){return e(t)}},er=F((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r&&ge.process,a=function(){try{var e=n&&n.require&&n.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a})),tr=er&&er.isTypedArray,rr=tr?Zt(tr):Yt,nr=Object.prototype.hasOwnProperty;var or=function(e,t){var r=Tt(e),n=!r&&Vt(e),o=!r&&!n&&Jt(e),a=!r&&!n&&!o&&rr(e),i=r||n||o||a,c=i?Bt(e.length,String):[],u=c.length;for(var s in e)!t&&!nr.call(e,s)||i&&("length"==s||o&&("offset"==s||"parent"==s)||a&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||Kt(s,u))||c.push(s);return c},ar=Object.prototype;var ir=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ar)};var cr=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),ur=Object.prototype.hasOwnProperty;var sr=function(e){if(!ir(e))return cr(e);var t=[];for(var r in Object(e))ur.call(e,r)&&"constructor"!=r&&t.push(r);return t};var lr=function(e){return null!=e&&Qt(e.length)&&!Ue(e)};var fr=function(e){return lr(e)?or(e):sr(e)};var pr=function(e){return Lt(e,fr,Mt)},dr=Object.prototype.hasOwnProperty;var mr=function(e,t,r,n,o,a){var i=1&r,c=pr(e),u=c.length;if(u!=pr(t).length&&!i)return!1;for(var s=u;s--;){var l=c[s];if(!(i?l in t:dr.call(t,l)))return!1}var f=a.get(e);if(f&&a.get(t))return f==t;var p=!0;a.set(e,t),a.set(t,e);for(var d=i;++s<u;){var m=e[l=c[s]],h=t[l];if(n)var v=i?n(h,m,l,t,e,a):n(m,h,l,e,t,a);if(!(void 0===v?m===h||o(m,h,r,n,a):v)){p=!1;break}d||(d="constructor"==l)}if(p&&!d){var b=e.constructor,y=t.constructor;b==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof y&&y instanceof y||(p=!1)}return a.delete(e),a.delete(t),p},hr=He(_e,"DataView"),vr=He(_e,"Promise"),br=He(_e,"Set"),yr=He(_e,"WeakMap"),gr=Be(hr),jr=Be(Ke),_r=Be(vr),wr=Be(br),Er=Be(yr),Or=xe;(hr&&"[object DataView]"!=Or(new hr(new ArrayBuffer(1)))||Ke&&"[object Map]"!=Or(new Ke)||vr&&"[object Promise]"!=Or(vr.resolve())||br&&"[object Set]"!=Or(new br)||yr&&"[object WeakMap]"!=Or(new yr))&&(Or=function(e){var t=xe(e),r="[object Object]"==t?e.constructor:void 0,n=r?Be(r):"";if(n)switch(n){case gr:return"[object DataView]";case jr:return"[object Map]";case _r:return"[object Promise]";case wr:return"[object Set]";case Er:return"[object WeakMap]"}return t});var Pr=Or,kr=Object.prototype.hasOwnProperty;var Ar=function(e,t,r,n,o,a){var i=Tt(e),c=Tt(t),u=i?"[object Array]":Pr(e),s=c?"[object Array]":Pr(t),l="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),f="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s),p=u==s;if(p&&Jt(e)){if(!Jt(t))return!1;i=!0,l=!1}if(p&&!l)return a||(a=new bt),i||rr(e)?Ot(e,t,r,n,o,a):It(e,t,u,r,n,o,a);if(!(1&r)){var d=l&&kr.call(e,"__wrapped__"),m=f&&kr.call(t,"__wrapped__");if(d||m){var h=d?e.value():e,v=m?t.value():t;return a||(a=new bt),o(h,v,r,n,a)}}return!!p&&(a||(a=new bt),mr(e,t,r,n,o,a))};var Sr=function e(t,r,n,o,a){return t===r||(null==t||null==r||!Dt(t)&&!Dt(r)?t!=t&&r!=r:Ar(t,r,n,o,e,a))};var Cr=function(e,t){return Sr(e,t)},Ir={},xr={"{}":void 0},Tr=u.makeStyles((function(){return{title:{paddingBottom:8},actions:{padding:15},addForm:{paddingTop:0},listForm:{paddingTop:0,paddingBottom:0,paddingRight:0,maxHeight:210}}})),Lr=function(e,t){return Array.isArray(e["acl:agentClass"])?e["acl:agentClass"].includes(t):e["acl:agentClass"]===t},Ur=function(e,t,r,n){e[t]?e[t].permissions.push(n):e[t]=O(O({id:t,type:r},q[r]),{},{permissions:[n]})},Nr=function(e){var n=e.open,o=e.onClose,a=e.resourceId,i=Tr(),s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ir,r=JSON.stringify(e),n=c.useSafeSetState({permissions:xr[r]}),o=k(n,2),a=o[0],i=o[1],u=c.useGetPermissions(),s=t.useCallback((function(){return u(e).then((function(e){Cr(e,a.permissions)||(xr[r]=e,i({permissions:e}))})).catch((function(e){i({error:e})}))}),[r,e,u]);return t.useEffect((function(){s()}),[r]),O(O({},a),{},{refetch:s})}(a),l=s.permissions,f=s.refetch,p=c.useAuthProvider(),d=t.useMemo((function(){var e={};if(l){var t,r=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=A(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}(l);try{var n=function(){var r=t.value;Lr(r,"foaf:Agent")&&Ur(e,"foaf:Agent","anon",r["acl:mode"]),Lr(r,"acl:AuthenticatedAgent")&&Ur(e,"acl:AuthenticatedAgent","anyUser",r["acl:mode"]),r["acl:agent"]&&V(r["acl:agent"]).forEach((function(t){return Ur(e,t,"user",r["acl:mode"])})),r["acl:agentGroup"]&&V(r["acl:agentGroup"]).forEach((function(t){return Ur(e,t,"group",r["acl:mode"])}))};for(r.s();!(t=r.n()).done;)n()}catch(e){r.e(e)}finally{r.f()}}return e}),[l]),m=t.useCallback((function(e,t,r){p.addPermission(a,e,t,r).then((function(){return f()}))}),[a,p,f]),h=t.useCallback((function(e,t,r){p.removePermission(a,e,t,r).then((function(){return f()}))}),[a,p,f]);return r.createElement(u.Dialog,{fullWidth:!0,open:n,onClose:o},r.createElement(u.DialogTitle,{className:i.title},"Permissions sur la ressource"),r.createElement(u.DialogContent,{className:i.addForm},r.createElement(ee,{addPermission:m})),r.createElement(u.DialogContent,{className:i.listForm},r.createElement(oe,{agents:d,addPermission:m,removePermission:h})),r.createElement(u.DialogActions,{className:i.actions},r.createElement(c.Button,{label:"ra.action.close",variant:"inlined",onClick:o})))},Rr=function(e){var n=e.record,o=k(t.useState(!1),2),a=o[0],i=o[1];return n?r.createElement(r.Fragment,null,r.createElement(c.Button,{label:"Permissions",onClick:function(){return i(!0)}},r.createElement(m,null)),r.createElement(Nr,{resourceId:n.id||n["@id"],open:a,onClose:function(){return i(!1)}})):null},zr=function(e){var t=e.basePath,n=e.className,o=e.data,a=e.hasList,i=e.hasEdit,u=e.hasControl,s=P(e,["basePath","className","data","hasList","hasEdit","hasControl"]);return r.createElement(c.TopToolbar,w({className:n},s),a&&r.createElement(c.ListButton,{basePath:t,record:o}),i&&r.createElement(c.EditButton,{basePath:t,record:o}),u&&r.createElement(Rr,{basePath:t,record:o}))},Mr=t.forwardRef((function(e,t){var n=e.onClick,o=e.webId;return r.createElement(c.MenuItemLink,{ref:t,to:"/Person/".concat(encodeURIComponent(o),"/show"),primaryText:"Voir mon profil",leftIcon:r.createElement(y,null),onClick:n})})),Br=t.forwardRef((function(e,t){var n=e.onClick,o=e.webId;return r.createElement(c.MenuItemLink,{ref:t,to:"/Person/".concat(encodeURIComponent(o),"/edit"),primaryText:"Editer mon profil",leftIcon:r.createElement(v,null),onClick:n})})),Dr=t.forwardRef((function(e,t){var n=e.onClick;return r.createElement(c.MenuItemLink,{ref:t,to:"/login",primaryText:"Se connecter",onClick:n})}));exports.EditActions=J,exports.EditWithPermissions=function(e){var t=c.usePermissionsOptimized(e.id).permissions;return r.createElement(c.Edit,w({actions:r.createElement(J,null)},e,{permissions:t}),r.cloneElement(e.children,{toolbar:r.createElement(K,{hasDelete:t&&t.some((function(e){return z.includes(e["acl:mode"])}))})}))},exports.LoginPage=X,exports.LogoutButton=Y,exports.ResourceWithPermissions=function(e){var t=e.name,n=e.list,o=e.create,a=P(e,["name","list","create"]),i=c.usePermissionsOptimized(t).permissions;return r.createElement(c.Resource,w({},a,{name:t,list:i&&i.some((function(e){return U.includes(e["acl:mode"])}))?n:void 0,create:i&&i.some((function(e){return N.includes(e["acl:mode"])}))?o:void 0}))},exports.ShowActions=zr,exports.ShowWithPermissions=function(e){var t=c.usePermissionsOptimized(e.id).permissions;return r.createElement(c.Show,w({actions:r.createElement(zr,{hasControl:t&&t.some((function(e){return M.includes(e["acl:mode"])}))})},e,{permissions:t,hasEdit:t&&t.some((function(e){return R.includes(e["acl:mode"])}))}))},exports.UserMenu=function(e){var t=e.logout,n=P(e,["logout"]),o=c.useGetIdentity().identity;return r.createElement(c.UserMenu,n,o&&""!==o.id?[r.createElement(Mr,{webId:o.id,key:"view"}),r.createElement(Br,{webId:o.id,key:"edit"}),r.cloneElement(t,{key:"logout"})]:r.createElement(Dr,null))},exports.authProvider=function(e){var t,r,n,o=e.middlewareUri,a=e.httpClient,i=e.checkPermissions,c=e.resources;return{login:function(e){return window.location.href="".concat(o,"auth?redirectUrl=")+encodeURIComponent(window.location.href),Promise.resolve()},logout:function(){var e=new URL(window.location.href);return window.location.href="".concat(o,"auth/logout?redirectUrl=")+encodeURIComponent(e.origin+"/login?logout"),Promise.resolve("/")},checkAuth:function(){return localStorage.getItem("token"),Promise.resolve()},checkError:function(e){return Promise.resolve()},getPermissions:(n=j(regeneratorRuntime.mark((function e(t){var r,n,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",!0);case 2:return r=c[t]?c[t].containerUri:t,n=G(o,r),e.next=6,a(n);case 6:return u=e.sent,s=u.json,e.abrupt("return",s["@graph"]);case 9:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)}),addPermission:(r=j(regeneratorRuntime.mark((function e(t,r,n,i){var u,s,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=c[t]?c[t].containerUri:t,s=G(o,u),l={"@id":s+"#"+i.replace("acl:",""),"@type":"acl:Authorization","acl:accessTo":u,"acl:mode":i},e.t0=n,e.next="user"===e.t0?6:"group"===e.t0?8:"anon"===e.t0||"anyUser"===e.t0?10:12;break;case 6:return l["acl:agent"]=r,e.abrupt("break",13);case 8:return l["acl:agentGroup"]=r,e.abrupt("break",13);case 10:return l["acl:agentClass"]=r,e.abrupt("break",13);case 12:throw new Error("Unknown agent type: "+n);case 13:return e.next=15,a(s,{method:"PATCH",body:JSON.stringify({"@context":{acl:"http://www.w3.org/ns/auth/acl#",foaf:"http://xmlns.com/foaf/0.1/"},"@graph":[l]})});case 15:case"end":return e.stop()}}),e)}))),function(e,t,n,o){return r.apply(this,arguments)}),removePermission:(t=j(regeneratorRuntime.mark((function e(t,r,n,i){var u,s,l,f,p,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=c[t]?c[t].containerUri:t,s=D[n],l=G(o,u),e.next=5,a(l);case 5:return f=e.sent,p=f.json,d=p["@graph"].map((function(e){var t=V(e["acl:mode"]),n=V(e[s]);return i&&t.includes(i)&&n&&n.includes(r)&&(n=n.filter((function(e){return e!==r}))),O(O({},e),{},_({},s,n))})),e.next=10,a(l,{method:"PUT",body:JSON.stringify(O(O({},p),{},{"@graph":d}))});case 10:case"end":return e.stop()}}),e)}))),function(e,r,n,o){return t.apply(this,arguments)}),getIdentity:function(){var e=localStorage.getItem("token");if(e){var t=function(e,t){if("string"!=typeof e)throw new L("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(T(e.split(".")[r]))}catch(e){throw new L("Invalid token specified: "+e.message)}}(e);return{id:t.webId,fullName:t.name}}}}};
