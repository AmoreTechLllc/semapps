"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),r=e(t),n=e(require("@material-ui/icons/Public")),o=e(require("@material-ui/icons/VpnLock")),a=e(require("@material-ui/icons/Person")),i=e(require("@material-ui/icons/Group")),c=require("react-admin"),u=require("@material-ui/core"),s=require("@material-ui/styles"),l=require("@material-ui/core/styles"),f=e(require("@material-ui/icons/Lock")),p=e(require("@material-ui/core/MenuItem")),d=e(require("@material-ui/icons/PowerSettingsNew")),m=e(require("@material-ui/icons/Share")),h=e(require("@material-ui/icons/Edit")),v=e(require("@material-ui/icons/Check")),y=e(require("@material-ui/icons/AccountCircle"));function b(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function g(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){b(a,n,o,i,c,"next",e)}function c(e){b(a,n,o,i,c,"throw",e)}i(void 0)}))}}function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function O(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}(e,t)||k(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){if(e){if("string"==typeof e)return A(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function S(e){this.message=e}S.prototype=new Error,S.prototype.name="InvalidCharacterError";var C,I="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new S("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,o=0,a=0,i="";n=t.charAt(a++);~n&&(r=o%4?64*r+n:n,o++%4)?i+=String.fromCharCode(255&r>>(-2*o&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return i};function x(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(I(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return I(t)}}function T(e){this.message=e}T.prototype=new Error,T.prototype.name="InvalidTokenError";var L=["acl:Read","acl:Append","acl:Write","acl:Control"],U=["acl:Append","acl:Write","acl:Control"],N=["acl:Append","acl:Write","acl:Control"],R=["acl:Write","acl:Control"],z=["acl:Control"],M=(j(C={},"acl:Read","Lire"),j(C,"acl:Append","Enrichir"),j(C,"acl:Write","Modifier"),j(C,"acl:Control","Administrer"),C),D={anon:"acl:agentClass",anyUser:"acl:agentClass",user:"acl:agent",group:"acl:group"},B={anon:{label:"Tous les utilisateurs",icon:r.createElement(n,null)},anyUser:{label:"Utilisateurs connectés",icon:r.createElement(o,null)},user:{icon:r.createElement(a,null)},group:{icon:r.createElement(i,null)}},q="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function W(e,t){return e(t={exports:{}},t.exports),t.exports}var F=W((function(e){var t,r;t=q,r=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var r=e.shift();e[0]=r+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(n>0&&(o=o.replace(/^[\/]+/,"")),o=n<e.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),t.push(o))}var a=t.join("/"),i=(a=a.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return a=i.shift()+(i.length>0?"?":"")+i.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=r():t.urljoin=r()})),$=function(e){return e?Array.isArray(e)?e:[e]:void 0},V=function(e,t){return F(e,t.replace(e,"_acl/"))},G=function(e){var t=e.basePath,n=e.className,o=e.data,a=e.hasList,i=e.hasShow,u=O(e,["basePath","className","data","hasList","hasShow"]);return r.createElement(c.TopToolbar,_({className:n},u),a&&r.createElement(c.ListButton,{basePath:t,record:o}),i&&r.createElement(c.ShowButton,{basePath:t,record:o}))},J=u.makeStyles((function(){return{toolbar:{flex:1,display:"flex",justifyContent:"space-between"}}})),H=function(e){var t=e.hasDelete,n=O(e,["hasDelete"]),o=J();return r.createElement(c.Toolbar,_({},n,{className:o.toolbar}),r.createElement(c.SaveButton,null),t&&r.createElement(c.DeleteButton,{undoable:!1}))},K=l.makeStyles((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",alignItems:"center",justifyContent:"flex-start",backgroundColor:e.palette.primary[500]},card:{minWidth:300,marginTop:"6em"},lockIconAvatar:{margin:"1em",display:"flex",justifyContent:"center"},lockIcon:{backgroundColor:e.palette.secondary[500]}}})),Q=function(e){var r=e.theme,n=e.history,o=e.location,a=e.buttons,i=K(),p=c.useNotify(),d=c.useLogin(),m=new URLSearchParams(o.search);return m.has("token")&&(localStorage.setItem("token",m.get("token")),p("Vous êtes maintenant connecté","info"),n.push("/")),m.has("logout")&&(localStorage.removeItem("token"),p("Vous êtes maintenant déconnecté","info"),n.push("/")),t.createElement(s.ThemeProvider,{theme:l.createMuiTheme(r)},t.createElement("div",{className:i.main},t.createElement(u.Card,{className:i.card},t.createElement("div",{className:i.lockIconAvatar},t.createElement(u.Avatar,{className:i.lockIcon},t.createElement(f,null))),a&&a.map((function(e){return t.createElement(u.CardActions,null,t.cloneElement(e,{fullWidth:!0,variant:"outlined",type:"submit",onClick:function(){return d({},"/login")}}))})))),t.createElement(c.Notification,null))};Q.defaultProps={buttons:[t.createElement(u.Button,{startIcon:t.createElement(u.Avatar,{src:"/lescommuns.jpg"})},"Les Communs")]};var X=t.forwardRef((function(e,t){var n=c.useLogout();return r.createElement(p,{onClick:function(){return n()},ref:t},r.createElement(d,null),"   Se déconnecter")})),Y=u.makeStyles((function(){return{listItem:{paddingLeft:4,paddingRight:36},secondaryText:{textAlign:"center",width:"50%",fontStyle:"italic",color:"grey"}}})),Z=function(e){var n=e.agent,o=e.addPermission,a=e.removePermission,i=Y(),s=c.useDataProvider(),l=P(r.useState(null),2),f=l[0],p=l[1],d=P(t.useState(),2),m=d[0],y=d[1],b=P(t.useState(!0),2),g=b[0],j=b[1],_=P(t.useState(),2),w=_[0],E=_[1];if(t.useEffect((function(){"user"===n.type?s.getOne("Person",{id:n.id}).then((function(e){var t=e.data;y(t),j(!1)})).catch((function(e){E(e),j(!1)})):j(!1)}),[n.id,n.type]),"group"===n.type)return null;var O=function(){return p(null)};return g?r.createElement(c.Loading,null):w?r.createElement(c.Error,null):r.createElement(u.ListItem,{button:!0,className:i.listItem},r.createElement(u.ListItemAvatar,null,r.createElement(u.Avatar,{src:null==m?void 0:m.image},n.icon)),r.createElement(u.ListItemText,{primary:n.label||(null==m?void 0:m["pair:label"])}),r.createElement(u.ListItemText,{className:i.secondaryText,primary:n.permissions&&n.permissions.map((function(e){return M[e]})).join(", ")}),r.createElement(u.ListItemSecondaryAction,null,r.createElement(u.IconButton,{onClick:function(e){return p(e.currentTarget)}},r.createElement(h,null)),r.createElement(u.Menu,{anchorEl:f,keepMounted:!0,open:Boolean(f),onClose:O},Object.entries(M).map((function(e){var t=P(e,2),i=t[0],c=t[1],s=n.permissions&&n.permissions.includes(i);return r.createElement(u.MenuItem,{onClick:function(){s?a(n.id,n.type,i):o(n.id,n.type,i),O()}},r.createElement(u.ListItemIcon,null,s?r.createElement(v,null):null),r.createElement(u.ListItemText,{primary:c}))})))))};var ee=function(){this.__data__=[],this.size=0};var te=function(e,t){return e===t||e!=e&&t!=t};var re=function(e,t){for(var r=e.length;r--;)if(te(e[r][0],t))return r;return-1},ne=Array.prototype.splice;var oe=function(e){var t=this.__data__,r=re(t,e);return!(r<0)&&(r==t.length-1?t.pop():ne.call(t,r,1),--this.size,!0)};var ae=function(e){var t=this.__data__,r=re(t,e);return r<0?void 0:t[r][1]};var ie=function(e){return re(this.__data__,e)>-1};var ce=function(e,t){var r=this.__data__,n=re(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function ue(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ue.prototype.clear=ee,ue.prototype.delete=oe,ue.prototype.get=ae,ue.prototype.has=ie,ue.prototype.set=ce;var se=ue;var le=function(){this.__data__=new se,this.size=0};var fe=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var pe=function(e){return this.__data__.get(e)};var de=function(e){return this.__data__.has(e)},me="object"==typeof q&&q&&q.Object===Object&&q,he="object"==typeof self&&self&&self.Object===Object&&self,ve=me||he||Function("return this")(),ye=ve.Symbol,be=Object.prototype,ge=be.hasOwnProperty,je=be.toString,_e=ye?ye.toStringTag:void 0;var we=function(e){var t=ge.call(e,_e),r=e[_e];try{e[_e]=void 0;var n=!0}catch(e){}var o=je.call(e);return n&&(t?e[_e]=r:delete e[_e]),o},Ee=Object.prototype.toString;var Oe=function(e){return Ee.call(e)},Pe=ye?ye.toStringTag:void 0;var ke=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Pe&&Pe in Object(e)?we(e):Oe(e)};var Ae=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Se,Ce=function(e){if(!Ae(e))return!1;var t=ke(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Ie=ve["__core-js_shared__"],xe=(Se=/[^.]+$/.exec(Ie&&Ie.keys&&Ie.keys.IE_PROTO||""))?"Symbol(src)_1."+Se:"";var Te=function(e){return!!xe&&xe in e},Le=Function.prototype.toString;var Ue=function(e){if(null!=e){try{return Le.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Ne=/^\[object .+?Constructor\]$/,Re=Function.prototype,ze=Object.prototype,Me=Re.toString,De=ze.hasOwnProperty,Be=RegExp("^"+Me.call(De).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var qe=function(e){return!(!Ae(e)||Te(e))&&(Ce(e)?Be:Ne).test(Ue(e))};var We=function(e,t){return null==e?void 0:e[t]};var Fe=function(e,t){var r=We(e,t);return qe(r)?r:void 0},$e=Fe(ve,"Map"),Ve=Fe(Object,"create");var Ge=function(){this.__data__=Ve?Ve(null):{},this.size=0};var Je=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},He=Object.prototype.hasOwnProperty;var Ke=function(e){var t=this.__data__;if(Ve){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return He.call(t,e)?t[e]:void 0},Qe=Object.prototype.hasOwnProperty;var Xe=function(e){var t=this.__data__;return Ve?void 0!==t[e]:Qe.call(t,e)};var Ye=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Ve&&void 0===t?"__lodash_hash_undefined__":t,this};function Ze(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ze.prototype.clear=Ge,Ze.prototype.delete=Je,Ze.prototype.get=Ke,Ze.prototype.has=Xe,Ze.prototype.set=Ye;var et=Ze;var tt=function(){this.size=0,this.__data__={hash:new et,map:new($e||se),string:new et}};var rt=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var nt=function(e,t){var r=e.__data__;return rt(t)?r["string"==typeof t?"string":"hash"]:r.map};var ot=function(e){var t=nt(this,e).delete(e);return this.size-=t?1:0,t};var at=function(e){return nt(this,e).get(e)};var it=function(e){return nt(this,e).has(e)};var ct=function(e,t){var r=nt(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function ut(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ut.prototype.clear=tt,ut.prototype.delete=ot,ut.prototype.get=at,ut.prototype.has=it,ut.prototype.set=ct;var st=ut;var lt=function(e,t){var r=this.__data__;if(r instanceof se){var n=r.__data__;if(!$e||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new st(n)}return r.set(e,t),this.size=r.size,this};function ft(e){var t=this.__data__=new se(e);this.size=t.size}ft.prototype.clear=le,ft.prototype.delete=fe,ft.prototype.get=pe,ft.prototype.has=de,ft.prototype.set=lt;var pt=ft;var dt=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var mt=function(e){return this.__data__.has(e)};function ht(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new st;++t<r;)this.add(e[t])}ht.prototype.add=ht.prototype.push=dt,ht.prototype.has=mt;var vt=ht;var yt=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var bt=function(e,t){return e.has(t)};var gt=function(e,t,r,n,o,a){var i=1&r,c=e.length,u=t.length;if(c!=u&&!(i&&u>c))return!1;var s=a.get(e);if(s&&a.get(t))return s==t;var l=-1,f=!0,p=2&r?new vt:void 0;for(a.set(e,t),a.set(t,e);++l<c;){var d=e[l],m=t[l];if(n)var h=i?n(m,d,l,t,e,a):n(d,m,l,e,t,a);if(void 0!==h){if(h)continue;f=!1;break}if(p){if(!yt(t,(function(e,t){if(!bt(p,t)&&(d===e||o(d,e,r,n,a)))return p.push(t)}))){f=!1;break}}else if(d!==m&&!o(d,m,r,n,a)){f=!1;break}}return a.delete(e),a.delete(t),f},jt=ve.Uint8Array;var _t=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var wt=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},Et=ye?ye.prototype:void 0,Ot=Et?Et.valueOf:void 0;var Pt=function(e,t,r,n,o,a,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new jt(e),new jt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return te(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var c=_t;case"[object Set]":var u=1&n;if(c||(c=wt),e.size!=t.size&&!u)return!1;var s=i.get(e);if(s)return s==t;n|=2,i.set(e,t);var l=gt(c(e),c(t),n,o,a,i);return i.delete(e),l;case"[object Symbol]":if(Ot)return Ot.call(e)==Ot.call(t)}return!1};var kt=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e},At=Array.isArray;var St=function(e,t,r){var n=t(e);return At(e)?n:kt(n,r(e))};var Ct=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var i=e[r];t(i,r,e)&&(a[o++]=i)}return a};var It=function(){return[]},xt=Object.prototype.propertyIsEnumerable,Tt=Object.getOwnPropertySymbols,Lt=Tt?function(e){return null==e?[]:(e=Object(e),Ct(Tt(e),(function(t){return xt.call(e,t)})))}:It;var Ut=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var Nt=function(e){return null!=e&&"object"==typeof e};var Rt=function(e){return Nt(e)&&"[object Arguments]"==ke(e)},zt=Object.prototype,Mt=zt.hasOwnProperty,Dt=zt.propertyIsEnumerable,Bt=Rt(function(){return arguments}())?Rt:function(e){return Nt(e)&&Mt.call(e,"callee")&&!Dt.call(e,"callee")};var qt=function(){return!1},Wt=W((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?ve.Buffer:void 0,a=(o?o.isBuffer:void 0)||qt;e.exports=a})),Ft=/^(?:0|[1-9]\d*)$/;var $t=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Ft.test(e))&&e>-1&&e%1==0&&e<t};var Vt=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Gt={};Gt["[object Float32Array]"]=Gt["[object Float64Array]"]=Gt["[object Int8Array]"]=Gt["[object Int16Array]"]=Gt["[object Int32Array]"]=Gt["[object Uint8Array]"]=Gt["[object Uint8ClampedArray]"]=Gt["[object Uint16Array]"]=Gt["[object Uint32Array]"]=!0,Gt["[object Arguments]"]=Gt["[object Array]"]=Gt["[object ArrayBuffer]"]=Gt["[object Boolean]"]=Gt["[object DataView]"]=Gt["[object Date]"]=Gt["[object Error]"]=Gt["[object Function]"]=Gt["[object Map]"]=Gt["[object Number]"]=Gt["[object Object]"]=Gt["[object RegExp]"]=Gt["[object Set]"]=Gt["[object String]"]=Gt["[object WeakMap]"]=!1;var Jt=function(e){return Nt(e)&&Vt(e.length)&&!!Gt[ke(e)]};var Ht=function(e){return function(t){return e(t)}},Kt=W((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r&&me.process,a=function(){try{var e=n&&n.require&&n.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a})),Qt=Kt&&Kt.isTypedArray,Xt=Qt?Ht(Qt):Jt,Yt=Object.prototype.hasOwnProperty;var Zt=function(e,t){var r=At(e),n=!r&&Bt(e),o=!r&&!n&&Wt(e),a=!r&&!n&&!o&&Xt(e),i=r||n||o||a,c=i?Ut(e.length,String):[],u=c.length;for(var s in e)!t&&!Yt.call(e,s)||i&&("length"==s||o&&("offset"==s||"parent"==s)||a&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||$t(s,u))||c.push(s);return c},er=Object.prototype;var tr=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||er)};var rr=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),nr=Object.prototype.hasOwnProperty;var or=function(e){if(!tr(e))return rr(e);var t=[];for(var r in Object(e))nr.call(e,r)&&"constructor"!=r&&t.push(r);return t};var ar=function(e){return null!=e&&Vt(e.length)&&!Ce(e)};var ir=function(e){return ar(e)?Zt(e):or(e)};var cr=function(e){return St(e,ir,Lt)},ur=Object.prototype.hasOwnProperty;var sr=function(e,t,r,n,o,a){var i=1&r,c=cr(e),u=c.length;if(u!=cr(t).length&&!i)return!1;for(var s=u;s--;){var l=c[s];if(!(i?l in t:ur.call(t,l)))return!1}var f=a.get(e);if(f&&a.get(t))return f==t;var p=!0;a.set(e,t),a.set(t,e);for(var d=i;++s<u;){var m=e[l=c[s]],h=t[l];if(n)var v=i?n(h,m,l,t,e,a):n(m,h,l,e,t,a);if(!(void 0===v?m===h||o(m,h,r,n,a):v)){p=!1;break}d||(d="constructor"==l)}if(p&&!d){var y=e.constructor,b=t.constructor;y==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(p=!1)}return a.delete(e),a.delete(t),p},lr=Fe(ve,"DataView"),fr=Fe(ve,"Promise"),pr=Fe(ve,"Set"),dr=Fe(ve,"WeakMap"),mr=Ue(lr),hr=Ue($e),vr=Ue(fr),yr=Ue(pr),br=Ue(dr),gr=ke;(lr&&"[object DataView]"!=gr(new lr(new ArrayBuffer(1)))||$e&&"[object Map]"!=gr(new $e)||fr&&"[object Promise]"!=gr(fr.resolve())||pr&&"[object Set]"!=gr(new pr)||dr&&"[object WeakMap]"!=gr(new dr))&&(gr=function(e){var t=ke(e),r="[object Object]"==t?e.constructor:void 0,n=r?Ue(r):"";if(n)switch(n){case mr:return"[object DataView]";case hr:return"[object Map]";case vr:return"[object Promise]";case yr:return"[object Set]";case br:return"[object WeakMap]"}return t});var jr=gr,_r=Object.prototype.hasOwnProperty;var wr=function(e,t,r,n,o,a){var i=At(e),c=At(t),u=i?"[object Array]":jr(e),s=c?"[object Array]":jr(t),l="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),f="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s),p=u==s;if(p&&Wt(e)){if(!Wt(t))return!1;i=!0,l=!1}if(p&&!l)return a||(a=new pt),i||Xt(e)?gt(e,t,r,n,o,a):Pt(e,t,u,r,n,o,a);if(!(1&r)){var d=l&&_r.call(e,"__wrapped__"),m=f&&_r.call(t,"__wrapped__");if(d||m){var h=d?e.value():e,v=m?t.value():t;return a||(a=new pt),o(h,v,r,n,a)}}return!!p&&(a||(a=new pt),sr(e,t,r,n,o,a))};var Er=function e(t,r,n,o,a){return t===r||(null==t||null==r||!Nt(t)&&!Nt(r)?t!=t&&r!=r:wr(t,r,n,o,e,a))};var Or=function(e,t){return Er(e,t)},Pr={},kr={"{}":void 0},Ar=u.makeStyles((function(e){return{list:{width:"100%",maxWidth:"100%",backgroundColor:e.palette.background.paper}}})),Sr=function(e,t){return Array.isArray(e["acl:agentClass"])?e["acl:agentClass"].includes(t):e["acl:agentClass"]===t},Cr=function(e,t,r,n){e[t]?e[t].permissions.push(n):e[t]=E(E({id:t,type:r},B[r]),{},{permissions:[n]})},Ir=function(e){var n=e.resourceId,o=Ar(),a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Pr,r=JSON.stringify(e),n=c.useSafeSetState({permissions:kr[r]}),o=P(n,2),a=o[0],i=o[1],u=c.useGetPermissions(),s=t.useCallback((function(){return u(e).then((function(e){Or(e,a.permissions)||(kr[r]=e,i({permissions:e}))})).catch((function(e){i({error:e})}))}),[r,e,u]);return t.useEffect((function(){s()}),[r]),E(E({},a),{},{refetch:s})}(n),i=a.permissions,s=a.refetch,l=c.useAuthProvider(),f=t.useMemo((function(){var e={};if(i){var t,r=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=k(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}(i);try{var n=function(){var r=t.value;Sr(r,"foaf:Agent")&&Cr(e,"foaf:Agent","anon",r["acl:mode"]),Sr(r,"acl:AuthenticatedAgent")&&Cr(e,"acl:AuthenticatedAgent","anyUser",r["acl:mode"]),r["acl:agent"]&&$(r["acl:agent"]).forEach((function(t){return Cr(e,t,"user",r["acl:mode"])})),r["acl:agentGroup"]&&$(r["acl:agentGroup"]).forEach((function(t){return Cr(e,t,"group",r["acl:mode"])}))};for(r.s();!(t=r.n()).done;)n()}catch(e){r.e(e)}finally{r.f()}}return e}),[i]),p=t.useCallback((function(e,t,r){l.addPermission(n,e,t,r).then((function(){return s()}))}),[n,l,s]),d=t.useCallback((function(e,t,r){l.removePermission(n,e,t,r).then((function(){return s()}))}),[n,l,s]);return r.createElement(u.List,{dense:!0,className:o.list},Object.entries(f).map((function(e){var t=P(e,2),n=t[0],o=t[1];return r.createElement(Z,{key:n,agent:o,addPermission:p,removePermission:d})})))},xr=u.makeStyles((function(){return{title:{paddingBottom:8},actions:{padding:15},addForm:{paddingTop:0},listForm:{paddingTop:0,paddingBottom:0,paddingRight:0,maxHeight:210}}})),Tr=function(e){var t=e.open,n=e.onClose,o=e.resourceId,a=xr();return r.createElement(u.Dialog,{fullWidth:!0,open:t,onClose:n},r.createElement(u.DialogTitle,{className:a.title},"Permissions sur la ressource"),r.createElement(u.DialogContent,{className:a.addForm},r.createElement(u.TextField,{label:"Ajouter un utilisateur ou un groupe...",variant:"filled",margin:"dense",fullWidth:!0})),r.createElement(u.DialogContent,{className:a.listForm},r.createElement(Ir,{resourceId:o})),r.createElement(u.DialogActions,{className:a.actions},r.createElement(c.Button,{label:"ra.action.close",variant:"inlined",onClick:n})))},Lr=function(e){var n=e.record,o=P(t.useState(!1),2),a=o[0],i=o[1];return n?r.createElement(r.Fragment,null,r.createElement(c.Button,{label:"Permissions",onClick:function(){return i(!0)}},r.createElement(m,null)),r.createElement(Tr,{resourceId:n.id||n["@id"],open:a,onClose:function(){return i(!1)}})):null},Ur=function(e){var t=e.basePath,n=e.className,o=e.data,a=e.hasList,i=e.hasEdit,u=e.hasControl,s=O(e,["basePath","className","data","hasList","hasEdit","hasControl"]);return r.createElement(c.TopToolbar,_({className:n},s),a&&r.createElement(c.ListButton,{basePath:t,record:o}),i&&r.createElement(c.EditButton,{basePath:t,record:o}),u&&r.createElement(Lr,{basePath:t,record:o}))},Nr=t.forwardRef((function(e,t){var n=e.onClick,o=e.webId;return r.createElement(c.MenuItemLink,{ref:t,to:"/Person/".concat(encodeURIComponent(o),"/show"),primaryText:"Voir mon profil",leftIcon:r.createElement(y,null),onClick:n})})),Rr=t.forwardRef((function(e,t){var n=e.onClick,o=e.webId;return r.createElement(c.MenuItemLink,{ref:t,to:"/Person/".concat(encodeURIComponent(o),"/edit"),primaryText:"Editer mon profil",leftIcon:r.createElement(h,null),onClick:n})})),zr=t.forwardRef((function(e,t){var n=e.onClick;return r.createElement(c.MenuItemLink,{ref:t,to:"/login",primaryText:"Se connecter",onClick:n})}));exports.EditActions=G,exports.EditWithPermissions=function(e){var t=c.usePermissionsOptimized(e.id).permissions;return r.createElement(c.Edit,_({actions:r.createElement(G,null)},e,{permissions:t}),r.cloneElement(e.children,{toolbar:r.createElement(H,{hasDelete:t&&t.some((function(e){return R.includes(e["acl:mode"])}))})}))},exports.LoginPage=Q,exports.LogoutButton=X,exports.ResourceWithPermissions=function(e){var t=e.name,n=e.list,o=e.create,a=O(e,["name","list","create"]),i=c.usePermissionsOptimized(t).permissions;return r.createElement(c.Resource,_({},a,{name:t,list:i&&i.some((function(e){return L.includes(e["acl:mode"])}))?n:void 0,create:i&&i.some((function(e){return U.includes(e["acl:mode"])}))?o:void 0}))},exports.ShowActions=Ur,exports.ShowWithPermissions=function(e){var t=c.usePermissionsOptimized(e.id).permissions;return r.createElement(c.Show,_({actions:r.createElement(Ur,{hasControl:t&&t.some((function(e){return z.includes(e["acl:mode"])}))})},e,{permissions:t,hasEdit:t&&t.some((function(e){return N.includes(e["acl:mode"])}))}))},exports.UserMenu=function(e){var t=e.logout,n=O(e,["logout"]),o=c.useGetIdentity().identity;return r.createElement(c.UserMenu,n,o&&""!==o.id?[r.createElement(Nr,{webId:o.id,key:"view"}),r.createElement(Rr,{webId:o.id,key:"edit"}),r.cloneElement(t,{key:"logout"})]:r.createElement(zr,null))},exports.authProvider=function(e){var t,r,n,o=e.middlewareUri,a=e.httpClient,i=e.checkPermissions,c=e.resources;return{login:function(e){return window.location.href="".concat(o,"auth?redirectUrl=")+encodeURIComponent(window.location.href),Promise.resolve()},logout:function(){var e=new URL(window.location.href);return window.location.href="".concat(o,"auth/logout?redirectUrl=")+encodeURIComponent(e.origin+"/login?logout"),Promise.resolve("/")},checkAuth:function(){return localStorage.getItem("token"),Promise.resolve()},checkError:function(e){return Promise.resolve()},getPermissions:(n=g(regeneratorRuntime.mark((function e(t){var r,n,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",!0);case 2:return r=c[t]?c[t].containerUri:t,n=V(o,r),e.next=6,a(n);case 6:return u=e.sent,s=u.json,e.abrupt("return",s["@graph"]);case 9:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)}),addPermission:(r=g(regeneratorRuntime.mark((function e(t,r,n,i){var u,s,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=c[t]?c[t].containerUri:t,s=V(o,u),l={"@id":s+"#"+i.replace("acl:",""),"@type":"acl:Authorization","acl:accessTo":u,"acl:mode":i},e.t0=n,e.next="user"===e.t0?6:"group"===e.t0?8:"anon"===e.t0||"anyUser"===e.t0?10:12;break;case 6:return l["acl:agent"]=r,e.abrupt("break",13);case 8:return l["acl:agentGroup"]=r,e.abrupt("break",13);case 10:return l["acl:agentClass"]=r,e.abrupt("break",13);case 12:throw new Error("Unknown agent type: "+n);case 13:return e.next=15,a(s,{method:"PATCH",body:JSON.stringify({"@context":{acl:"http://www.w3.org/ns/auth/acl#",foaf:"http://xmlns.com/foaf/0.1/"},"@graph":[l]})});case 15:case"end":return e.stop()}}),e)}))),function(e,t,n,o){return r.apply(this,arguments)}),removePermission:(t=g(regeneratorRuntime.mark((function e(t,r,n,i){var u,s,l,f,p,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=c[t]?c[t].containerUri:t,s=D[n],l=V(o,u),e.next=5,a(l);case 5:return f=e.sent,p=f.json,d=p["@graph"].map((function(e){var t=$(e["acl:mode"]),n=$(e[s]);return i&&t.includes(i)&&n&&n.includes(r)&&(n=n.filter((function(e){return e!==r}))),E(E({},e),{},j({},s,n))})),e.next=10,a(l,{method:"PUT",body:JSON.stringify(E(E({},p),{},{"@graph":d}))});case 10:case"end":return e.stop()}}),e)}))),function(e,r,n,o){return t.apply(this,arguments)}),getIdentity:function(){var e=localStorage.getItem("token");if(e){var t=function(e,t){if("string"!=typeof e)throw new T("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(x(e.split(".")[r]))}catch(e){throw new T("Invalid token specified: "+e.message)}}(e);return{id:t.webId,fullName:t.name}}}}};
