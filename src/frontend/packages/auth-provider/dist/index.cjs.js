"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),r=e(t),n=require("react-admin"),o=require("@material-ui/core"),a=e(require("@material-ui/icons/Public")),i=e(require("@material-ui/icons/VpnLock")),c=e(require("@material-ui/icons/Person")),u=e(require("@material-ui/icons/Group")),s=require("@material-ui/styles"),l=require("@material-ui/core/styles"),f=e(require("@material-ui/icons/Lock")),p=e(require("@material-ui/core/MenuItem")),d=e(require("@material-ui/icons/PowerSettingsNew")),m=e(require("@material-ui/icons/Share")),h=e(require("@material-ui/icons/Edit")),v=e(require("@material-ui/icons/Check")),y=e(require("@material-ui/icons/AccountCircle"));function b(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function g(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){b(a,n,o,i,c,"next",e)}function c(e){b(a,n,o,i,c,"throw",e)}i(void 0)}))}}function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function O(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}(e,t)||P(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){if(e){if("string"==typeof e)return A(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function S(e){this.message=e}S.prototype=new Error,S.prototype.name="InvalidCharacterError";var I="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new S("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,o=0,a=0,i="";n=t.charAt(a++);~n&&(r=o%4?64*r+n:n,o++%4)?i+=String.fromCharCode(255&r>>(-2*o&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return i};function C(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(I(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return I(t)}}function x(e){this.message=e}x.prototype=new Error,x.prototype.name="InvalidTokenError";var T="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function L(e,t){return e(t={exports:{}},t.exports),t.exports}var U,z=L((function(e){var t,r;t=T,r=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var r=e.shift();e[0]=r+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(n>0&&(o=o.replace(/^[\/]+/,"")),o=n<e.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),t.push(o))}var a=t.join("/"),i=(a=a.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return a=i.shift()+(i.length>0?"?":"")+i.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=r():t.urljoin=r()})),N=function(e,t){return z(e,t.replace(e,"_acl/"))},R=function(e){var t=e.basePath,o=e.className,a=e.data,i=e.hasList,c=e.hasShow,u=O(e,["basePath","className","data","hasList","hasShow"]);return r.createElement(n.TopToolbar,_({className:o},u),i&&r.createElement(n.ListButton,{basePath:t,record:a}),c&&r.createElement(n.ShowButton,{basePath:t,record:a}))},M=o.makeStyles((function(){return{toolbar:{flex:1,display:"flex",justifyContent:"space-between"}}})),D=function(e){var t=e.hasDelete,o=O(e,["hasDelete"]),a=M();return r.createElement(n.Toolbar,_({},o,{className:a.toolbar}),r.createElement(n.SaveButton,null),t&&r.createElement(n.DeleteButton,{undoable:!1}))},B=["acl:Read","acl:Append","acl:Write","acl:Control"],q=["acl:Append","acl:Write","acl:Control"],W=["acl:Append","acl:Write","acl:Control"],F=["acl:Write","acl:Control"],$=["acl:Control"],V=(j(U={},"acl:Read","Lire"),j(U,"acl:Append","Enrichir"),j(U,"acl:Write","Modifier"),j(U,"acl:Control","Administrer"),U),G={anon:{label:"Tous les utilisateurs",icon:r.createElement(a,null)},anyUser:{label:"Utilisateurs connectés",icon:r.createElement(i,null)},user:{icon:r.createElement(c,null)},group:{icon:r.createElement(u,null)}},H=l.makeStyles((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",alignItems:"center",justifyContent:"flex-start",backgroundColor:e.palette.primary[500]},card:{minWidth:300,marginTop:"6em"},lockIconAvatar:{margin:"1em",display:"flex",justifyContent:"center"},lockIcon:{backgroundColor:e.palette.secondary[500]}}})),J=function(e){var r=e.theme,a=e.history,i=e.location,c=e.buttons,u=H(),p=n.useNotify(),d=n.useLogin(),m=new URLSearchParams(i.search);return m.has("token")&&(localStorage.setItem("token",m.get("token")),p("Vous êtes maintenant connecté","info"),a.push("/")),m.has("logout")&&(localStorage.removeItem("token"),p("Vous êtes maintenant déconnecté","info"),a.push("/")),t.createElement(s.ThemeProvider,{theme:l.createMuiTheme(r)},t.createElement("div",{className:u.main},t.createElement(o.Card,{className:u.card},t.createElement("div",{className:u.lockIconAvatar},t.createElement(o.Avatar,{className:u.lockIcon},t.createElement(f,null))),c&&c.map((function(e){return t.createElement(o.CardActions,null,t.cloneElement(e,{fullWidth:!0,variant:"outlined",type:"submit",onClick:function(){return d({},"/login")}}))})))),t.createElement(n.Notification,null))};J.defaultProps={buttons:[t.createElement(o.Button,{startIcon:t.createElement(o.Avatar,{src:"/lescommuns.jpg"})},"Les Communs")]};var K=t.forwardRef((function(e,t){var o=n.useLogout();return r.createElement(p,{onClick:function(){return o()},ref:t},r.createElement(d,null),"   Se déconnecter")})),Q=o.makeStyles((function(){return{listItem:{paddingLeft:4,paddingRight:36},secondaryText:{textAlign:"center",width:"50%",fontStyle:"italic",color:"grey"}}})),X=function(e){var a=e.agent,i=e.addPermission,c=Q(),u=n.useDataProvider(),s=k(r.useState(null),2),l=s[0],f=s[1],p=k(t.useState(),2),d=p[0],m=p[1],y=k(t.useState(!0),2),b=y[0],g=y[1],j=k(t.useState(),2),_=j[0],w=j[1];if(t.useEffect((function(){"user"===a.type?u.getOne("Person",{id:a.id}).then((function(e){var t=e.data;m(t),g(!1)})).catch((function(e){w(e),g(!1)})):g(!1)}),[a.id,a.type]),"group"===a.type)return null;var E=function(){return f(null)};return b?r.createElement(n.Loading,null):_?r.createElement(n.Error,null):r.createElement(o.ListItem,{button:!0,className:c.listItem},r.createElement(o.ListItemAvatar,null,r.createElement(o.Avatar,{src:null==d?void 0:d.image},a.icon)),r.createElement(o.ListItemText,{primary:a.label||(null==d?void 0:d.name)}),r.createElement(o.ListItemText,{className:c.secondaryText,primary:a.permissions&&a.permissions.map((function(e){return V[e]})).join(", ")}),r.createElement(o.ListItemSecondaryAction,null,r.createElement(o.IconButton,{onClick:function(e){return f(e.currentTarget)}},r.createElement(h,null)),r.createElement(o.Menu,{anchorEl:l,keepMounted:!0,open:Boolean(l),onClose:E},Object.entries(V).map((function(e){var t=k(e,2),n=t[0],c=t[1];return r.createElement(o.MenuItem,{onClick:function(){i(a.id,a.type,n),E()}},r.createElement(o.ListItemIcon,null,a.permissions&&a.permissions.includes(n)?r.createElement(v,null):null),r.createElement(o.ListItemText,{primary:c}))})))))};var Y=function(){this.__data__=[],this.size=0};var Z=function(e,t){return e===t||e!=e&&t!=t};var ee=function(e,t){for(var r=e.length;r--;)if(Z(e[r][0],t))return r;return-1},te=Array.prototype.splice;var re=function(e){var t=this.__data__,r=ee(t,e);return!(r<0)&&(r==t.length-1?t.pop():te.call(t,r,1),--this.size,!0)};var ne=function(e){var t=this.__data__,r=ee(t,e);return r<0?void 0:t[r][1]};var oe=function(e){return ee(this.__data__,e)>-1};var ae=function(e,t){var r=this.__data__,n=ee(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function ie(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ie.prototype.clear=Y,ie.prototype.delete=re,ie.prototype.get=ne,ie.prototype.has=oe,ie.prototype.set=ae;var ce=ie;var ue=function(){this.__data__=new ce,this.size=0};var se=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var le=function(e){return this.__data__.get(e)};var fe=function(e){return this.__data__.has(e)},pe="object"==typeof T&&T&&T.Object===Object&&T,de="object"==typeof self&&self&&self.Object===Object&&self,me=pe||de||Function("return this")(),he=me.Symbol,ve=Object.prototype,ye=ve.hasOwnProperty,be=ve.toString,ge=he?he.toStringTag:void 0;var je=function(e){var t=ye.call(e,ge),r=e[ge];try{e[ge]=void 0;var n=!0}catch(e){}var o=be.call(e);return n&&(t?e[ge]=r:delete e[ge]),o},_e=Object.prototype.toString;var we=function(e){return _e.call(e)},Ee=he?he.toStringTag:void 0;var Oe=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Ee&&Ee in Object(e)?je(e):we(e)};var ke=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Pe,Ae=function(e){if(!ke(e))return!1;var t=Oe(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Se=me["__core-js_shared__"],Ie=(Pe=/[^.]+$/.exec(Se&&Se.keys&&Se.keys.IE_PROTO||""))?"Symbol(src)_1."+Pe:"";var Ce=function(e){return!!Ie&&Ie in e},xe=Function.prototype.toString;var Te=function(e){if(null!=e){try{return xe.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Le=/^\[object .+?Constructor\]$/,Ue=Function.prototype,ze=Object.prototype,Ne=Ue.toString,Re=ze.hasOwnProperty,Me=RegExp("^"+Ne.call(Re).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var De=function(e){return!(!ke(e)||Ce(e))&&(Ae(e)?Me:Le).test(Te(e))};var Be=function(e,t){return null==e?void 0:e[t]};var qe=function(e,t){var r=Be(e,t);return De(r)?r:void 0},We=qe(me,"Map"),Fe=qe(Object,"create");var $e=function(){this.__data__=Fe?Fe(null):{},this.size=0};var Ve=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ge=Object.prototype.hasOwnProperty;var He=function(e){var t=this.__data__;if(Fe){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Ge.call(t,e)?t[e]:void 0},Je=Object.prototype.hasOwnProperty;var Ke=function(e){var t=this.__data__;return Fe?void 0!==t[e]:Je.call(t,e)};var Qe=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Fe&&void 0===t?"__lodash_hash_undefined__":t,this};function Xe(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Xe.prototype.clear=$e,Xe.prototype.delete=Ve,Xe.prototype.get=He,Xe.prototype.has=Ke,Xe.prototype.set=Qe;var Ye=Xe;var Ze=function(){this.size=0,this.__data__={hash:new Ye,map:new(We||ce),string:new Ye}};var et=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var tt=function(e,t){var r=e.__data__;return et(t)?r["string"==typeof t?"string":"hash"]:r.map};var rt=function(e){var t=tt(this,e).delete(e);return this.size-=t?1:0,t};var nt=function(e){return tt(this,e).get(e)};var ot=function(e){return tt(this,e).has(e)};var at=function(e,t){var r=tt(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function it(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}it.prototype.clear=Ze,it.prototype.delete=rt,it.prototype.get=nt,it.prototype.has=ot,it.prototype.set=at;var ct=it;var ut=function(e,t){var r=this.__data__;if(r instanceof ce){var n=r.__data__;if(!We||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new ct(n)}return r.set(e,t),this.size=r.size,this};function st(e){var t=this.__data__=new ce(e);this.size=t.size}st.prototype.clear=ue,st.prototype.delete=se,st.prototype.get=le,st.prototype.has=fe,st.prototype.set=ut;var lt=st;var ft=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var pt=function(e){return this.__data__.has(e)};function dt(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new ct;++t<r;)this.add(e[t])}dt.prototype.add=dt.prototype.push=ft,dt.prototype.has=pt;var mt=dt;var ht=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var vt=function(e,t){return e.has(t)};var yt=function(e,t,r,n,o,a){var i=1&r,c=e.length,u=t.length;if(c!=u&&!(i&&u>c))return!1;var s=a.get(e);if(s&&a.get(t))return s==t;var l=-1,f=!0,p=2&r?new mt:void 0;for(a.set(e,t),a.set(t,e);++l<c;){var d=e[l],m=t[l];if(n)var h=i?n(m,d,l,t,e,a):n(d,m,l,e,t,a);if(void 0!==h){if(h)continue;f=!1;break}if(p){if(!ht(t,(function(e,t){if(!vt(p,t)&&(d===e||o(d,e,r,n,a)))return p.push(t)}))){f=!1;break}}else if(d!==m&&!o(d,m,r,n,a)){f=!1;break}}return a.delete(e),a.delete(t),f},bt=me.Uint8Array;var gt=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var jt=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},_t=he?he.prototype:void 0,wt=_t?_t.valueOf:void 0;var Et=function(e,t,r,n,o,a,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new bt(e),new bt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Z(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var c=gt;case"[object Set]":var u=1&n;if(c||(c=jt),e.size!=t.size&&!u)return!1;var s=i.get(e);if(s)return s==t;n|=2,i.set(e,t);var l=yt(c(e),c(t),n,o,a,i);return i.delete(e),l;case"[object Symbol]":if(wt)return wt.call(e)==wt.call(t)}return!1};var Ot=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e},kt=Array.isArray;var Pt=function(e,t,r){var n=t(e);return kt(e)?n:Ot(n,r(e))};var At=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var i=e[r];t(i,r,e)&&(a[o++]=i)}return a};var St=function(){return[]},It=Object.prototype.propertyIsEnumerable,Ct=Object.getOwnPropertySymbols,xt=Ct?function(e){return null==e?[]:(e=Object(e),At(Ct(e),(function(t){return It.call(e,t)})))}:St;var Tt=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var Lt=function(e){return null!=e&&"object"==typeof e};var Ut=function(e){return Lt(e)&&"[object Arguments]"==Oe(e)},zt=Object.prototype,Nt=zt.hasOwnProperty,Rt=zt.propertyIsEnumerable,Mt=Ut(function(){return arguments}())?Ut:function(e){return Lt(e)&&Nt.call(e,"callee")&&!Rt.call(e,"callee")};var Dt=function(){return!1},Bt=L((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?me.Buffer:void 0,a=(o?o.isBuffer:void 0)||Dt;e.exports=a})),qt=/^(?:0|[1-9]\d*)$/;var Wt=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&qt.test(e))&&e>-1&&e%1==0&&e<t};var Ft=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},$t={};$t["[object Float32Array]"]=$t["[object Float64Array]"]=$t["[object Int8Array]"]=$t["[object Int16Array]"]=$t["[object Int32Array]"]=$t["[object Uint8Array]"]=$t["[object Uint8ClampedArray]"]=$t["[object Uint16Array]"]=$t["[object Uint32Array]"]=!0,$t["[object Arguments]"]=$t["[object Array]"]=$t["[object ArrayBuffer]"]=$t["[object Boolean]"]=$t["[object DataView]"]=$t["[object Date]"]=$t["[object Error]"]=$t["[object Function]"]=$t["[object Map]"]=$t["[object Number]"]=$t["[object Object]"]=$t["[object RegExp]"]=$t["[object Set]"]=$t["[object String]"]=$t["[object WeakMap]"]=!1;var Vt=function(e){return Lt(e)&&Ft(e.length)&&!!$t[Oe(e)]};var Gt=function(e){return function(t){return e(t)}},Ht=L((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r&&pe.process,a=function(){try{var e=n&&n.require&&n.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a})),Jt=Ht&&Ht.isTypedArray,Kt=Jt?Gt(Jt):Vt,Qt=Object.prototype.hasOwnProperty;var Xt=function(e,t){var r=kt(e),n=!r&&Mt(e),o=!r&&!n&&Bt(e),a=!r&&!n&&!o&&Kt(e),i=r||n||o||a,c=i?Tt(e.length,String):[],u=c.length;for(var s in e)!t&&!Qt.call(e,s)||i&&("length"==s||o&&("offset"==s||"parent"==s)||a&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||Wt(s,u))||c.push(s);return c},Yt=Object.prototype;var Zt=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Yt)};var er=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),tr=Object.prototype.hasOwnProperty;var rr=function(e){if(!Zt(e))return er(e);var t=[];for(var r in Object(e))tr.call(e,r)&&"constructor"!=r&&t.push(r);return t};var nr=function(e){return null!=e&&Ft(e.length)&&!Ae(e)};var or=function(e){return nr(e)?Xt(e):rr(e)};var ar=function(e){return Pt(e,or,xt)},ir=Object.prototype.hasOwnProperty;var cr=function(e,t,r,n,o,a){var i=1&r,c=ar(e),u=c.length;if(u!=ar(t).length&&!i)return!1;for(var s=u;s--;){var l=c[s];if(!(i?l in t:ir.call(t,l)))return!1}var f=a.get(e);if(f&&a.get(t))return f==t;var p=!0;a.set(e,t),a.set(t,e);for(var d=i;++s<u;){var m=e[l=c[s]],h=t[l];if(n)var v=i?n(h,m,l,t,e,a):n(m,h,l,e,t,a);if(!(void 0===v?m===h||o(m,h,r,n,a):v)){p=!1;break}d||(d="constructor"==l)}if(p&&!d){var y=e.constructor,b=t.constructor;y==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(p=!1)}return a.delete(e),a.delete(t),p},ur=qe(me,"DataView"),sr=qe(me,"Promise"),lr=qe(me,"Set"),fr=qe(me,"WeakMap"),pr=Te(ur),dr=Te(We),mr=Te(sr),hr=Te(lr),vr=Te(fr),yr=Oe;(ur&&"[object DataView]"!=yr(new ur(new ArrayBuffer(1)))||We&&"[object Map]"!=yr(new We)||sr&&"[object Promise]"!=yr(sr.resolve())||lr&&"[object Set]"!=yr(new lr)||fr&&"[object WeakMap]"!=yr(new fr))&&(yr=function(e){var t=Oe(e),r="[object Object]"==t?e.constructor:void 0,n=r?Te(r):"";if(n)switch(n){case pr:return"[object DataView]";case dr:return"[object Map]";case mr:return"[object Promise]";case hr:return"[object Set]";case vr:return"[object WeakMap]"}return t});var br=yr,gr=Object.prototype.hasOwnProperty;var jr=function(e,t,r,n,o,a){var i=kt(e),c=kt(t),u=i?"[object Array]":br(e),s=c?"[object Array]":br(t),l="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),f="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s),p=u==s;if(p&&Bt(e)){if(!Bt(t))return!1;i=!0,l=!1}if(p&&!l)return a||(a=new lt),i||Kt(e)?yt(e,t,r,n,o,a):Et(e,t,u,r,n,o,a);if(!(1&r)){var d=l&&gr.call(e,"__wrapped__"),m=f&&gr.call(t,"__wrapped__");if(d||m){var h=d?e.value():e,v=m?t.value():t;return a||(a=new lt),o(h,v,r,n,a)}}return!!p&&(a||(a=new lt),cr(e,t,r,n,o,a))};var _r=function e(t,r,n,o,a){return t===r||(null==t||null==r||!Lt(t)&&!Lt(r)?t!=t&&r!=r:jr(t,r,n,o,e,a))};var wr=function(e,t){return _r(e,t)},Er={},Or={"{}":void 0},kr=o.makeStyles((function(e){return{list:{width:"100%",maxWidth:"100%",backgroundColor:e.palette.background.paper}}})),Pr=function(e){return e?Array.isArray(e)?e:[e]:void 0},Ar=function(e,t){return Array.isArray(e["acl:agentClass"])?e["acl:agentClass"].includes(t):e["acl:agentClass"]===t},Sr=function(e,t,r,n){e[t]?e[t].permissions.push(n):e[t]=E(E({id:t,type:r},G[r]),{},{permissions:[n]})},Ir=function(e){var a=e.resourceId,i=kr(),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Er,r=JSON.stringify(e),o=n.useSafeSetState({permissions:Or[r]}),a=k(o,2),i=a[0],c=a[1],u=n.useGetPermissions(),s=t.useCallback((function(){return u(e).then((function(e){wr(e,i.permissions)||(Or[r]=e,c({permissions:e}))})).catch((function(e){c({error:e})}))}),[r,e,u]);return t.useEffect((function(){s()}),[r]),E(E({},i),{},{refetch:s})}(a),u=c.permissions,s=c.refetch,l=n.useAuthProvider(),f=t.useMemo((function(){var e={};if(u){var t,r=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=P(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}(u);try{var n=function(){var r=t.value;Ar(r,"foaf:Agent")&&Sr(e,"foaf:Agent","anon",r["acl:mode"]),Ar(r,"acl:AuthenticatedAgent")&&Sr(e,"acl:AuthenticatedAgent","anyUser",r["acl:mode"]),r["acl:agent"]&&Pr(r["acl:agent"]).forEach((function(t){return Sr(e,t,"user",r["acl:mode"])})),r["acl:agentGroup"]&&Pr(r["acl:agentGroup"]).forEach((function(t){return Sr(e,t,"group",r["acl:mode"])}))};for(r.s();!(t=r.n()).done;)n()}catch(e){r.e(e)}finally{r.f()}}return e}),[u]),p=t.useCallback((function(e,t,r){l.addPermission(a,e,t,r).then((function(e){e&&s()}))}),[a,l,s]);return r.createElement(o.List,{dense:!0,className:i.list},Object.entries(f).map((function(e){var t=k(e,2),n=t[0],o=t[1];return r.createElement(X,{key:n,agent:o,addPermission:p})})))},Cr=o.makeStyles((function(){return{title:{paddingBottom:8},actions:{padding:15},addForm:{paddingTop:0},listForm:{paddingTop:0,paddingBottom:0,paddingRight:0,maxHeight:200}}})),xr=function(e){var t=e.open,a=e.onClose,i=e.resourceId,c=Cr();return r.createElement(o.Dialog,{fullWidth:!0,open:t,onClose:a},r.createElement(o.DialogTitle,{className:c.title},"Permissions sur la ressource"),r.createElement(o.DialogContent,{className:c.addForm},r.createElement(o.TextField,{label:"Ajouter un utilisateur ou un groupe...",variant:"filled",margin:"dense",fullWidth:!0})),r.createElement(o.DialogContent,{className:c.listForm},r.createElement(Ir,{resourceId:i})),r.createElement(o.DialogActions,{className:c.actions},r.createElement(n.Button,{label:"ra.action.close",variant:"inlined",onClick:a})))},Tr=function(e){var o=e.record,a=k(t.useState(!1),2),i=a[0],c=a[1];return o?r.createElement(r.Fragment,null,r.createElement(n.Button,{label:"Permissions",onClick:function(){return c(!0)}},r.createElement(m,null)),r.createElement(xr,{resourceId:o.id||o["@id"],open:i,onClose:function(){return c(!1)}})):null},Lr=function(e){var t=e.basePath,o=e.className,a=e.data,i=e.hasList,c=e.hasEdit,u=e.hasControl,s=O(e,["basePath","className","data","hasList","hasEdit","hasControl"]);return r.createElement(n.TopToolbar,_({className:o},s),i&&r.createElement(n.ListButton,{basePath:t,record:a}),c&&r.createElement(n.EditButton,{basePath:t,record:a}),u&&r.createElement(Tr,{basePath:t,record:a}))},Ur=t.forwardRef((function(e,t){var o=e.onClick,a=e.webId;return r.createElement(n.MenuItemLink,{ref:t,to:"/Person/".concat(encodeURIComponent(a),"/show"),primaryText:"Voir mon profil",leftIcon:r.createElement(y,null),onClick:o})})),zr=t.forwardRef((function(e,t){var o=e.onClick,a=e.webId;return r.createElement(n.MenuItemLink,{ref:t,to:"/Person/".concat(encodeURIComponent(a),"/edit"),primaryText:"Editer mon profil",leftIcon:r.createElement(h,null),onClick:o})})),Nr=t.forwardRef((function(e,t){var o=e.onClick;return r.createElement(n.MenuItemLink,{ref:t,to:"/login",primaryText:"Se connecter",onClick:o})}));exports.EditActions=R,exports.EditWithPermissions=function(e){var t=n.usePermissionsOptimized(e.id).permissions;return r.createElement(n.Edit,_({actions:r.createElement(R,null)},e,{permissions:t}),r.cloneElement(e.children,{toolbar:r.createElement(D,{hasDelete:t&&t.some((function(e){return F.includes(e["acl:mode"])}))})}))},exports.LoginPage=J,exports.LogoutButton=K,exports.ResourceWithPermissions=function(e){var t=e.name,o=e.list,a=e.create,i=O(e,["name","list","create"]),c=n.usePermissionsOptimized(t).permissions;return r.createElement(n.Resource,_({},i,{name:t,list:c&&c.some((function(e){return B.includes(e["acl:mode"])}))?o:void 0,create:c&&c.some((function(e){return q.includes(e["acl:mode"])}))?a:void 0}))},exports.ShowActions=Lr,exports.ShowWithPermissions=function(e){var t=n.usePermissionsOptimized(e.id).permissions;return r.createElement(n.Show,_({actions:r.createElement(Lr,{hasControl:t&&t.some((function(e){return $.includes(e["acl:mode"])}))})},e,{permissions:t,hasEdit:t&&t.some((function(e){return W.includes(e["acl:mode"])}))}))},exports.UserMenu=function(e){var t=e.logout,o=O(e,["logout"]),a=n.useGetIdentity().identity;return r.createElement(n.UserMenu,o,a&&""!==a.id?[r.createElement(Ur,{webId:a.id,key:"view"}),r.createElement(zr,{webId:a.id,key:"edit"}),r.cloneElement(t,{key:"logout"})]:r.createElement(Nr,null))},exports.authProvider=function(e){var t,r,n=e.middlewareUri,o=e.httpClient,a=e.checkPermissions,i=e.resources;return{login:function(e){return window.location.href="".concat(n,"auth?redirectUrl=")+encodeURIComponent(window.location.href),Promise.resolve()},logout:function(){var e=new URL(window.location.href);return window.location.href="".concat(n,"auth/logout?redirectUrl=")+encodeURIComponent(e.origin+"/login?logout"),Promise.resolve("/")},checkAuth:function(){return localStorage.getItem("token"),Promise.resolve()},checkError:function(e){return Promise.resolve()},getPermissions:(r=g(regeneratorRuntime.mark((function e(t){var r,c,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return",!0);case 2:return r=i[t]?i[t].containerUri:t,c=N(n,r),e.next=6,o(c);case 6:return u=e.sent,s=u.json,e.abrupt("return",s["@graph"]);case 9:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)}),addPermission:(t=g(regeneratorRuntime.mark((function e(t,r,a,c){var u,s,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=i[t]?i[t].containerUri:t,s=N(n,u),l={"@id":s+"#"+c.replace("acl:",""),"@type":"acl:Authorization","acl:accessTo":u,"acl:mode":c},e.t0=a,e.next="user"===e.t0?6:"group"===e.t0?8:"anon"===e.t0||"anyUser"===e.t0?10:12;break;case 6:return l["acl:agent"]=r,e.abrupt("break",13);case 8:return l["acl:agentGroup"]=r,e.abrupt("break",13);case 10:return l["acl:agentClass"]=r,e.abrupt("break",13);case 12:throw new Error("Unknown agent type: "+a);case 13:return e.next=15,o(s,{method:"PATCH",body:JSON.stringify({"@context":{acl:"http://www.w3.org/ns/auth/acl#",foaf:"http://xmlns.com/foaf/0.1/"},"@graph":[l]})});case 15:return f=e.sent,e.abrupt("return",204===f.status);case 17:case"end":return e.stop()}}),e)}))),function(e,r,n,o){return t.apply(this,arguments)}),getIdentity:function(){var e=localStorage.getItem("token");if(e){var t=function(e,t){if("string"!=typeof e)throw new x("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(C(e.split(".")[r]))}catch(e){throw new x("Invalid token specified: "+e.message)}}(e);return{id:t.webId,fullName:t.name}}}}};
