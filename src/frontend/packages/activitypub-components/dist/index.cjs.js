"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("react-admin"),r=require("@tiptap/extension-placeholder"),n=require("@mui/material"),i=require("@mui/styles/makeStyles"),a=require("@mui/icons-material/Send"),o=require("@semapps/semantic-data-provider"),u=require("@semapps/auth-provider"),l=require("@tiptap/core"),c=require("@tiptap/extension-mention"),s=require("@tiptap/react"),d=require("@tiptap/starter-kit"),f=require("@tiptap/extension-underline"),m=require("@tiptap/extension-link"),v=require("@tiptap/extension-text-align"),p=require("@tiptap/extension-image"),b=require("@tiptap/extension-text-style"),h=require("@tiptap/extension-color"),g=require("@tiptap/extension-highlight"),y=require("@mui/material/styles"),E=require("ra-core"),S=require("ra-ui-materialui"),w=require("@mui/icons-material/ArrowDropDown"),O=require("@mui/icons-material/FormatBold"),x=require("@mui/icons-material/FormatItalic"),k=require("@mui/icons-material/FormatUnderlined"),T=require("@mui/icons-material/FormatStrikethrough"),L=require("@mui/icons-material/Code"),j=require("@mui/icons-material/FormatColorText"),C=require("@mui/icons-material/FontDownload"),F=require("@mui/material/colors"),A=require("@mui/icons-material/FormatAlignCenter"),I=require("@mui/icons-material/FormatAlignLeft"),R=require("@mui/icons-material/FormatAlignRight"),P=require("@mui/icons-material/FormatAlignJustify"),N=require("@mui/icons-material/FormatListBulleted"),B=require("@mui/icons-material/FormatListNumbered"),V=require("@mui/icons-material/InsertLink"),q=require("@mui/icons-material/Image"),_=require("@mui/icons-material/FormatQuote"),z=require("@mui/icons-material/FormatClear"),D=require("@semapps/field-components"),U=require("tippy.js");function M(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function H(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var G=H(e),W=M(e),J=M(r),K=M(i),Y=M(a),Q=M(c),$=M(d),X=M(f),Z=M(m),ee=M(v),te=M(p),re=M(b),ne=M(g),ie=M(w),ae=M(O),oe=M(x),ue=M(k),le=M(T),ce=M(L),se=M(j),de=M(C),fe=M(A),me=M(I),ve=M(R),pe=M(P),be=M(N),he=M(B),ge=M(V),ye=M(q),Ee=M(_),Se=M(z),we=M(U);function Oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(r),!0).forEach((function(t){je(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ke(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
ke=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof d?t:d,a=Object.create(i.prototype),o=new O(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return k()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var u=E(o,r);if(u){if(u===s)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===s)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}(e,r,o),a}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var s={};function d(){}function f(){}function m(){}var v={};u(v,i,(function(){return this}));var p=Object.getPrototypeOf,b=p&&p(p(x([])));b&&b!==t&&r.call(b,i)&&(v=b);var h=m.prototype=d.prototype=Object.create(v);function g(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){var n;this._invoke=function(i,a){function o(){return new t((function(n,o){!function n(i,a,o,u){var l=c(e[i],e,a);if("throw"!==l.type){var s=l.arg,d=s.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,u)}),(function(e){n("throw",e,o,u)})):t.resolve(d).then((function(e){s.value=e,o(s)}),(function(e){return n("throw",e,o,u)}))}u(l.arg)}(i,a,n,o)}))}return n=n?n.then(o,o):o()}}function E(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method))return s;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,s;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,s):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,s)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function x(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=m,u(h,"constructor",m),u(m,"constructor",f),f.displayName=u(m,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,u(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e},e.awrap=function(e){return{__await:e}},g(y.prototype),u(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new y(l(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},g(h),u(h,o,"Generator"),u(h,i,(function(){return this})),u(h,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=x,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,s):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),s},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),s}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;w(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:x(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},e}function Te(e,t,r,n,i,a,o){try{var u=e[a](o),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,i)}function Le(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){Te(a,n,i,o,u,"next",e)}function u(e){Te(a,n,i,o,u,"throw",e)}o(void 0)}))}}function je(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ce(){return(Ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Fe(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,a=[],o=!0,u=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){u=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(u)throw i}}return a}(e,t)||Re(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ie(e){return function(e){if(Array.isArray(e))return Pe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Re(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Re(e,t){if(e){if("string"==typeof e)return Pe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Pe(e,t):void 0}}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ne(e){var t,r,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(r=Ne(e[t]))&&(n&&(n+=" "),n+=r);else for(t in e)e[t]&&(n&&(n+=" "),n+=t);return n}function Be(){for(var e,t,r=0,n="";r<arguments.length;)(e=arguments[r++])&&(t=Ne(e))&&(n&&(n+=" "),n+=t);return n}var Ve,qe=e.createContext(void 0),_e=function(e){var t=e.children,r=e.value;return G.createElement(qe.Provider,{value:r},t)},ze=function(){var t=e.useState(!1),r=t[0],n=t[1],i=e.useContext(qe);return e.useEffect((function(){var e=function(){n(!0)};return null!=i&&(n(i.isEditable),i.on("create",e)),function(){null!=i&&i.off("create",e)}}),[i]),r?i:null},De=function(){return(De=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ue=function(t){var r=ze(),i=E.useTranslate(),a=e.useState([]),o=a[0],u=a[1],l=i("ra.tiptap.bold",{_:"Bold"}),c=i("ra.tiptap.italic",{_:"Italic"}),s=i("ra.tiptap.underline",{_:"Underline"}),d=i("ra.tiptap.strike",{_:"Strikethrough"}),f=i("ra.tiptap.code",{_:"Code"});e.useEffect((function(){var e=function(){u((function(){return Me.reduce((function(e,t){return r&&r.isActive(t)&&e.push(t),e}),[])}))};return r&&(r.on("update",e),r.on("selectionUpdate",e)),function(){r&&(r.off("update",e),r.off("selectionUpdate",e))}}),[r]);return G.createElement(n.ToggleButtonGroup,De({},t,{disabled:!(null==r?void 0:r.isEditable),onChange:function(e,t){Me.forEach((function(e){var n=r&&r.isActive(e)&&!t.includes(e),i=r&&!r.isActive(e)&&t.includes(e);(n||i)&&He[e](r)}))},value:o}),G.createElement(n.ToggleButton,{value:"bold","aria-label":l,title:l},G.createElement(ae.default,{fontSize:"inherit"})),G.createElement(n.ToggleButton,{value:"italic","aria-label":c,title:c},G.createElement(oe.default,{fontSize:"inherit"})),G.createElement(n.ToggleButton,{value:"underline","aria-label":s,title:s},G.createElement(ue.default,{fontSize:"inherit"})),G.createElement(n.ToggleButton,{value:"strike","aria-label":d,title:d},G.createElement(le.default,{fontSize:"inherit"})),G.createElement(n.ToggleButton,{value:"code","aria-label":f,title:f},G.createElement(ce.default,{fontSize:"inherit"})))},Me=["bold","italic","underline","strike","code"],He={bold:function(e){return e.chain().focus().toggleBold().run()},italic:function(e){return e.chain().focus().toggleItalic().run()},underline:function(e){return e.chain().focus().toggleUnderline().run()},strike:function(e){return e.chain().focus().toggleStrike().run()},code:function(e){return e.chain().focus().toggleCode().run()}},Ge=function(){return(Ge=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},We=function(t){var r=ze(),i=E.useTranslate(),a=i("ra.tiptap.list_bulleted",{_:"Bulleted list"}),o=i("ra.tiptap.list_numbered",{_:"Numbered list"}),u=e.useState(),l=u[0],c=u[1];return e.useEffect((function(){var e=function(){c((function(){return Je.reduce((function(e,t){return r&&r.isActive(t)?t:e}),void 0)}))};return r&&(r.on("update",e),r.on("selectionUpdate",e)),function(){r&&(r.off("update",e),r.off("selectionUpdate",e))}}),[r]),G.createElement(n.ToggleButtonGroup,Ge({},t,{disabled:!(null==r?void 0:r.isEditable),exclusive:!0,onChange:function(e,t){Je.forEach((function(e){var n=r&&r.isActive(e)&&t!==e,i=r&&!r.isActive(e)&&t===e;(n||i)&&Ke[e](r)}))},value:l}),G.createElement(n.ToggleButton,{value:"bulletList","aria-label":a,title:a},G.createElement(be.default,{fontSize:"inherit"})),G.createElement(n.ToggleButton,{value:"orderedList","aria-label":o,title:o},G.createElement(he.default,{fontSize:"inherit"})))},Je=["bulletList","orderedList"],Ke={bulletList:function(e){return e.chain().focus().toggleBulletList().run()},orderedList:function(e){return e.chain().focus().toggleOrderedList().run()}},Ye=function(){return(Ye=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Qe=function(t){var r=ze(),i=E.useTranslate(),a=e.useState("left"),o=a[0],u=a[1],l=i("ra.tiptap.align_left",{_:"Align left"}),c=i("ra.tiptap.align_right",{_:"Align right"}),s=i("ra.tiptap.align_center",{_:"Center"}),d=i("ra.tiptap.align_justify",{_:"Justify"});e.useEffect((function(){var e=function(){u((function(e){return $e.reduce((function(e,t){return r&&r.isActive({textAlign:t})?t:e}),e)}))};return r&&(r.on("update",e),r.on("selectionUpdate",e)),function(){r&&(r.off("update",e),r.off("selectionUpdate",e))}}),[r]);return G.createElement(n.ToggleButtonGroup,Ye({},t,{disabled:!(null==r?void 0:r.isEditable),exclusive:!0,onChange:function(e,t){Xe[t]&&Xe[t](r)},value:o}),G.createElement(n.ToggleButton,{value:"left","aria-label":l,title:l},G.createElement(me.default,{fontSize:"inherit"})),G.createElement(n.ToggleButton,{value:"center","aria-label":s,title:s},G.createElement(fe.default,{fontSize:"inherit"})),G.createElement(n.ToggleButton,{value:"right","aria-label":c,title:c},G.createElement(ve.default,{fontSize:"inherit"})),G.createElement(n.ToggleButton,{value:"justify","aria-label":d,title:d},G.createElement(pe.default,{fontSize:"inherit"})))},$e=["left","center","right","justify","code"],Xe={left:function(e){return e.chain().focus().setTextAlign("left").run()},center:function(e){return e.chain().focus().setTextAlign("center").run()},right:function(e){return e.chain().focus().setTextAlign("right").run()},justify:function(e){return e.chain().focus().setTextAlign("justify").run()}},Ze=function(){return(Ze=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},et=function(t){var r=ze(),i=E.useTranslate(),a=function(){var t=ze(),r=e.useState(t?t.state.doc.textBetween(t.state.selection.from,t.state.selection.to):null),n=r[0],i=r[1];return e.useEffect((function(){var e=function(){i(t?t.state.doc.textBetween(t.state.selection.from,t.state.selection.to):null)};return t&&t.on("selectionUpdate",e),function(){t&&t.off("selectionUpdate",e)}}),[t]),n}(),o=i("ra.tiptap.link",{_:"Add a link"});return G.createElement(n.ToggleButton,Ze({"aria-label":o,title:o},t,{disabled:!(null==r?void 0:r.isEditable)||!a,value:"link",onClick:function(){if(r.can().setLink({href:""})){var e=window.prompt("URL");r.chain().focus().extendMarkRange("link").setLink({href:e}).run()}},selected:r&&r.isActive("link")}),G.createElement(ge.default,{fontSize:"inherit"}))},tt=function(){return(tt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},rt=function(t){var r=ze(),i=E.useTranslate(),a=e.useState(!1),o=a[0],u=a[1],l=i("ra.tiptap.blockquote",{_:"Blockquote"});return e.useEffect((function(){var e=function(){u(r&&r.isActive("blockquote"))};return r&&(r.on("update",e),r.on("selectionUpdate",e)),function(){r&&(r.off("update",e),r.off("selectionUpdate",e))}}),[r]),G.createElement(n.ToggleButton,tt({"aria-label":l,title:l},t,{disabled:!(null==r?void 0:r.isEditable),onClick:function(){return r.chain().focus().toggleBlockquote().run()},selected:o,value:"quote"}),G.createElement(Ee.default,{fontSize:"inherit"}))},nt=function(){return(nt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},it=function(e){var t=ze(),r=E.useTranslate()("ra.tiptap.clear_format",{_:"Clear format"});return G.createElement(n.ToggleButton,nt({"aria-label":r,title:r},e,{disabled:!(null==t?void 0:t.isEditable),value:"clear",onClick:function(){return t.chain().focus().unsetAllMarks().run()}}),G.createElement(Se.default,{fontSize:"inherit"}))},at=function(t){var r,i=E.useTranslate(),a=ze(),o=e.useState(null),u=o[0],l=o[1],c=t.size,s=e.useState(ot[0]),d=s[0],f=s[1];return e.useEffect((function(){var e=function(){f((function(e){return ot.reduce((function(e,t){if(a){if("paragraph"===t.value&&a.isActive("paragraph"))return t;if(a.isActive("heading",{level:t.level}))return t}return e}),e)}))};return a&&(a.on("update",e),a.on("selectionUpdate",e)),function(){a&&(a.off("update",e),a.off("selectionUpdate",e))}}),[a]),G.createElement(ct,null,G.createElement(n.List,{component:"nav","aria-label":i("ra.tiptap.select_level",{_:"Select the level"}),dense:!0,disablePadding:!0,className:lt.list},G.createElement(n.ListItem,{button:!0,"aria-haspopup":"true","aria-controls":"level-menu","aria-label":i("ra.tiptap.current_level",{_:"Current level"}),disabled:!(null==a?void 0:a.isEditable),onClick:function(e){l(e.currentTarget)},className:Be((r={},r[lt.sizeSmall]="small"===c,r[lt.sizeLarge]="large"===c,r))},G.createElement(n.ListItemText,{primary:i(d.label,{_:d.defaultLabel})}),G.createElement(ie.default,null))),G.createElement(n.Menu,{anchorEl:u,open:Boolean(u),id:"level-menu",onClose:function(e){l(null)}},ot.map((function(e,t){return G.createElement(n.MenuItem,{key:e.label,selected:e===d,onClick:function(e){!function(e,t){l(null);var r=ot[t];"paragraph"===r.value?a.chain().focus().setParagraph().run():"heading"===r.value&&a.chain().focus().setHeading({level:r.level}).run()}(0,t)}},i(e.label,{_:e.defaultLabel}))}))))},ot=[{label:"ra.tiptap.paragraph",defaultLabel:"Normal",value:"paragraph"},{label:"ra.tiptap.heading1",defaultLabel:"Heading 1",value:"heading",level:1},{label:"ra.tiptap.heading2",defaultLabel:"Heading 2",value:"heading",level:2},{label:"ra.tiptap.heading3",defaultLabel:"Heading 3",value:"heading",level:3},{label:"ra.tiptap.heading4",defaultLabel:"Heading 4",value:"heading",level:4},{label:"ra.tiptap.heading5",defaultLabel:"Heading 5",value:"heading",level:5},{label:"ra.tiptap.heading6",defaultLabel:"Heading 6",value:"heading",level:6}],ut="RaRichTextInputLevelSelect",lt={list:"".concat(ut,"-list"),sizeSmall:"".concat(ut,"-sizeSmall"),sizeLarge:"".concat(ut,"-sizeLarge")},ct=y.styled("div")((function(e){var t,r=e.theme;return(t={})["&.".concat(lt.list)]={borderRadius:r.shape.borderRadius,border:"1px solid ".concat(y.alpha(r.palette.action.active,.12))},t["& .".concat(lt.sizeSmall)]={paddingTop:1,paddingBottom:1,"& .MuiTypography-root":{fontSize:r.typography.pxToRem(13)}},t["& .".concat(lt.sizeLarge)]={paddingTop:8,paddingBottom:8,"& .MuiTypography-root":{fontSize:r.typography.pxToRem(15)}},t})),st=function(){return(st=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},dt=function(e){var t=E.useTranslate(),r=ze(),i=t("ra.tiptap.image",{_:"Image"}),a=G.useCallback((function(){var e=window.prompt(t("ra.tiptap.image_dialog",{_:"Image URL"}));e&&r.chain().focus().setImage({src:e}).run()}),[r,t]);return r?G.createElement(n.ToggleButton,st({"aria-label":i,title:i},e,{disabled:!(null==r?void 0:r.isEditable),value:"image",onClick:a}),G.createElement(ye.default,{fontSize:"inherit"})):null},ft=function(){return(ft=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};!function(e){e.FONT="font",e.BACKGROUND="background"}(Ve||(Ve={}));var mt=function(e){var t=E.useTranslate(),r=ze(),i=G.useState(!1),a=i[0],o=i[1],u=G.useState(Ve.FONT),l=u[0],c=u[1],s=t("ra.tiptap.color",{_:"Color"}),d=t("ra.tiptap.highlight",{_:"Highlight"}),f=function(e){o(!0),c(e)};return r?G.createElement(n.Box,{sx:{position:"relative"}},G.createElement(pt,{onClick:function(){return o(!1)}},G.createElement(n.ToggleButtonGroup,null,G.createElement(n.ToggleButton,ft({"aria-label":s,title:s},e,{disabled:!(null==r?void 0:r.isEditable),value:"color",onClick:function(){return f(Ve.FONT)}}),G.createElement(se.default,{fontSize:"inherit"})),G.createElement(n.ToggleButton,ft({"aria-label":d,title:d},e,{disabled:!(null==r?void 0:r.isEditable),value:"highlight",onClick:function(){return f(Ve.BACKGROUND)}}),G.createElement(de.default,{fontSize:"inherit"}))),a&&G.createElement(vt,{editor:r,close:function(){return o(!1)},colorType:l}))):null},vt=function(e){var t,r,i=e.editor,a=e.close,o=e.colorType,u=S.useTheme()[0],l=[F.grey,F.red,F.orange,F.yellow,F.green,F.blue,F.purple];return G.createElement(n.Card,{sx:{position:"absolute",top:38,left:o===Ve.FONT?0:"50%",p:1,border:"1px solid ".concat(null===(r=null===(t=null==u?void 0:u.palette)||void 0===t?void 0:t.background)||void 0===r?void 0:r.default),display:"flex",flexDirection:"column",gap:1,zIndex:1}},[900,700,500,300,100].map((function(e,t){return G.createElement(n.Box,{key:"shade-".concat(e),sx:{display:"flex",flexDirection:"row",gap:1}},l.map((function(r,u){return G.createElement(n.Box,{key:"color-".concat(t*l.length+u+1),sx:{width:16,height:16,cursor:"pointer",backgroundColor:r[e]},onClick:function(){return function(e){o===Ve.FONT?i.chain().focus().setColor(e).run():i.chain().focus().toggleHighlight({color:e}).run(),a()}(r[e])}})})))})))},pt=function(e){var t=e.className,r=e.onClick,n=e.children,i=G.useRef(null);return bt(i,r),G.createElement("div",{className:t,ref:i},n)},bt=function(e,t){G.useEffect((function(){var r=function(r){e.current&&!e.current.contains(r.target)&&t()};return document.addEventListener("mousedown",r),function(){document.removeEventListener("mousedown",r)}}),[e,t])},ht=function(){return(ht=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},gt=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},yt=function(e){var t=e.size,r=void 0===t?"medium":t,n=e.children,i=void 0===n?G.createElement(G.Fragment,null,G.createElement(at,{size:r}),G.createElement(Ue,{size:r}),G.createElement(mt,{size:r}),G.createElement(Qe,{size:r}),G.createElement(We,{size:r}),G.createElement(et,{size:r}),G.createElement(dt,{size:r}),G.createElement(rt,{size:r}),G.createElement(it,{size:r})):n,a=gt(e,["size","children"]);return G.createElement(St,ht({className:Et.root},a),i)},Et={root:"".concat("RaRichTextInputToolbar","-root")},St=y.styled("div")((function(e){var t,r=e.theme;return(t={})["&.".concat(Et.root)]={display:"flex",flexWrap:"wrap",alignItems:"center","& > *":{marginRight:r.spacing(1),marginBottom:r.spacing(1)},"& > *:last-child":{marginRight:0}},t})),wt=function(){return(wt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ot=function(t){var r,n,i=t.className,a=t.defaultValue,o=void 0===a?"":a,u=t.disabled,l=void 0!==u&&u,c=t.editorOptions,d=void 0===c?kt:c,f=t.fullWidth,m=t.helperText,v=t.label,p=t.readOnly,b=void 0!==p&&p,h=t.source,g=t.toolbar,y=E.useResourceContext(t),w=E.useInput(wt(wt({},t),{source:h,defaultValue:o})),O=w.id,x=w.field,k=w.isRequired,T=w.fieldState,L=w.formState.isSubmitted,j=s.useEditor(wt(wt({},d),{editable:!l&&!b,content:x.value,editorProps:wt(wt({},null==d?void 0:d.editorProps),{attributes:wt(wt({},null===(r=null==d?void 0:d.editorProps)||void 0===r?void 0:r.attributes),{id:O})})})),C=T.error,F=T.invalid,A=T.isTouched;return e.useEffect((function(){if(j){var e=j.state.selection,t=e.from,r=e.to;j.commands.setContent(x.value,!1,{preserveWhitespace:!0}),j.commands.setTextSelection({from:t,to:r})}}),[j,x.value]),e.useEffect((function(){var e;j&&j.setOptions({editable:!l&&!b,editorProps:wt(wt({},null==d?void 0:d.editorProps),{attributes:wt(wt({},null===(e=null==d?void 0:d.editorProps)||void 0===e?void 0:e.attributes),{id:O})})})}),[l,j,b,O,null==d?void 0:d.editorProps,null===(n=null==d?void 0:d.editorProps)||void 0===n?void 0:n.attributes]),e.useEffect((function(){if(j){var e=function(){if(j.isEmpty)return x.onChange(""),void x.onBlur();var e=j.getHTML();x.onChange(e),x.onBlur()};return j.on("update",e),function(){j.off("update",e)}}}),[j,x]),G.createElement(S.Labeled,{isRequired:k,label:v,id:"".concat(O,"-label"),color:(null==T?void 0:T.invalid)?"error":void 0,source:h,resource:y,fullWidth:f},G.createElement(xt,{className:Be("ra-input","ra-input-".concat(h),i),editor:j,error:C,helperText:m,id:O,isTouched:A,isSubmitted:L,invalid:F,toolbar:g||G.createElement(yt,null)}))},xt=function(e){var t=e.className,r=e.editor,i=e.error;e.fullWidth;var a=e.helperText,o=e.id,u=e.isTouched,l=e.isSubmitted,c=e.invalid,d=e.toolbar;return G.createElement(Lt,{className:t},G.createElement(_e,{value:r},d,G.createElement(s.EditorContent,{"aria-labelledby":"".concat(o,"-label"),className:Tt.editorContent,editor:r})),G.createElement(n.FormHelperText,{className:(u||l)&&c?"ra-rich-text-input-error":"",error:(u||l)&&c},G.createElement(S.InputHelperText,{touched:u||l,error:null==i?void 0:i.message,helperText:a})))},kt={extensions:[$.default,X.default,Z.default,ee.default.configure({types:["heading","paragraph"]}),te.default.configure({inline:!0}),re.default,h.Color,ne.default.configure({multicolor:!0})]},Tt={editorContent:"".concat("RaRichTextInput","-editorContent")},Lt=y.styled("div",{name:"RaRichTextInput",overridesResolver:function(e,t){return t.root}})((function(e){var t,r=e.theme;return(t={display:"flex",flexDirection:"column",alignItems:"center"})["& .".concat(Tt.editorContent)]={width:"100%","& .ProseMirror":{backgroundColor:r.palette.background.default,borderColor:"light"===r.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)",borderRadius:r.shape.borderRadius,borderStyle:"solid",borderWidth:"1px",padding:r.spacing(1),'&[contenteditable="false"], &[contenteditable="false"]:hover, &[contenteditable="false"]:focus':{backgroundColor:r.palette.action.disabledBackground},"&:hover":{backgroundColor:r.palette.action.hover},"&:focus":{backgroundColor:r.palette.background.default},"& p":{margin:"0 0 1em 0","&:last-child":{marginBottom:0}}}},t}));function jt(){return(jt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Ct(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}var Ft=".".charCodeAt(0),At=/\\(\\)?/g,It=RegExp("[^.[\\]]+|\\[(?:([^\"'][^[]*)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))","g"),Rt={},Pt=/[.[\]]+/,Nt=function(e){if(null==e||!e.length)return[];if("string"!=typeof e)throw new Error("toPath() expects a string");var t,r;return null==Rt[e]&&(e.endsWith("[]")?Rt[e]=e.split(Pt).filter(Boolean):Rt[e]=(r=[],(t=e).charCodeAt(0)===Ft&&r.push(""),t.replace(It,(function(e,t,n,i){var a=e;n?a=i.replace(At,"$1"):t&&(a=t.trim()),r.push(a)})),r)),Rt[e]},Bt=function(e,t){for(var r=Nt(t),n=e,i=0;i<r.length;i++){var a=r[i];if(null==n||"object"!=typeof n||Array.isArray(n)&&isNaN(a))return;n=n[a]}return n};function Vt(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var qt=function(e,t,r,n){if(void 0===n&&(n=!1),null==e)throw new Error("Cannot call setIn() with "+String(e)+" state");if(null==t)throw new Error("Cannot call setIn() with "+String(t)+" key");return function e(t,r,n,i,a){if(r>=n.length)return i;var o=n[r];if(isNaN(o)){var u;if(null==t){var l,c=e(void 0,r+1,n,i,a);return void 0===c?void 0:((l={})[o]=c,l)}if(Array.isArray(t))throw new Error("Cannot set a non-numeric property on an array");var s=e(t[o],r+1,n,i,a);if(void 0===s){var d=Object.keys(t).length;if(void 0===t[o]&&0===d)return;return void 0!==t[o]&&d<=1?isNaN(n[r-1])||a?void 0:{}:(t[o],Ct(t,[o].map(Vt)))}return jt({},t,((u={})[o]=s,u))}var f=Number(o);if(null==t){var m=e(void 0,r+1,n,i,a);if(void 0===m)return;var v=[];return v[f]=m,v}if(!Array.isArray(t))throw new Error("Cannot set a numeric property on an object");var p=e(t[f],r+1,n,i,a),b=[].concat(t);if(a&&void 0===p){if(b.splice(f,1),0===b.length)return}else b[f]=p;return b}(e,0,Nt(t),r,n)},_t="FINAL_FORM/array-error";function zt(e,t){var r=e.errors,n=e.initialValues,i=e.lastSubmittedValues,a=e.submitErrors,o=e.submitFailed,u=e.submitSucceeded,l=e.submitting,c=e.values,s=t.active,d=t.blur,f=t.change,m=t.data,v=t.focus,p=t.modified,b=t.modifiedSinceLastSubmit,h=t.name,g=t.touched,y=t.validating,E=t.visited,S=Bt(c,h),w=Bt(r,h);w&&w[_t]&&(w=w[_t]);var O=a&&Bt(a,h),x=n&&Bt(n,h),k=t.isEqual(x,S),T=!w&&!O;return{active:s,blur:d,change:f,data:m,dirty:!k,dirtySinceLastSubmit:!(!i||t.isEqual(Bt(i,h),S)),error:w,focus:v,initial:x,invalid:!T,length:Array.isArray(S)?S.length:void 0,modified:p,modifiedSinceLastSubmit:b,name:h,pristine:k,submitError:O,submitFailed:o,submitSucceeded:u,submitting:l,touched:g,valid:T,value:S,visited:E,validating:y}}var Dt=["active","data","dirty","dirtySinceLastSubmit","error","initial","invalid","length","modified","modifiedSinceLastSubmit","pristine","submitError","submitFailed","submitSucceeded","submitting","touched","valid","value","visited","validating"],Ut=function(e,t){if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var i=Object.prototype.hasOwnProperty.bind(t),a=0;a<r.length;a++){var o=r[a];if(!i(o)||e[o]!==t[o])return!1}return!0};function Mt(e,t,r,n,i,a){var o=!1;return i.forEach((function(i){n[i]&&(e[i]=t[i],r&&(~a.indexOf(i)?Ut(t[i],r[i]):t[i]===r[i])||(o=!0))})),o}var Ht=["data"],Gt=function(e,t,r,n){var i={blur:e.blur,change:e.change,focus:e.focus,name:e.name};return Mt(i,e,t,r,Dt,Ht)||!t||n?i:void 0},Wt=["active","dirty","dirtyFields","dirtyFieldsSinceLastSubmit","dirtySinceLastSubmit","error","errors","hasSubmitErrors","hasValidationErrors","initialValues","invalid","modified","modifiedSinceLastSubmit","pristine","submitting","submitError","submitErrors","submitFailed","submitSucceeded","touched","valid","validating","values","visited"],Jt=["touched","visited"];function Kt(e,t,r,n){var i={};return Mt(i,e,t,r,Wt,Jt)||!t||n?i:void 0}var Yt=function(e){var t,r;return function(){for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return t&&i.length===t.length&&!i.some((function(e,r){return!Ut(t[r],e)}))||(t=i,r=e.apply(void 0,i)),r}},Qt=function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then},$t=function(e,t){return e===t},Xt=function e(t){return Object.keys(t).some((function(r){var n=t[r];return!n||"object"!=typeof n||n instanceof Error?void 0!==n:e(n)}))};function Zt(e,t,r,n,i,a){var o=i(r,n,t,a);return!!o&&(e(o),!0)}function er(e,t,r,n,i){var a=e.entries;Object.keys(a).forEach((function(e){var o=a[Number(e)];if(o){var u=o.subscription,l=o.subscriber,c=o.notified;Zt(l,u,t,r,n,i||!c)&&(o.notified=!0)}}))}function tr(e){if(!e)throw new Error("No config specified");var t=e.debug,r=e.destroyOnUnregister,n=e.keepDirtyOnReinitialize,i=e.initialValues,a=e.mutators,o=e.onSubmit,u=e.validate,l=e.validateOnBlur;if(!o)throw new Error("No onSubmit function specified");var c={subscribers:{index:0,entries:{}},fieldSubscribers:{},fields:{},formState:{asyncErrors:{},dirtySinceLastSubmit:!1,modifiedSinceLastSubmit:!1,errors:{},initialValues:i&&jt({},i),invalid:!1,pristine:!0,submitting:!1,submitFailed:!1,submitSucceeded:!1,resetWhileSubmitting:!1,valid:!0,validating:0,values:i?jt({},i):{}},lastFormState:void 0},s=0,d=!1,f=!1,m=!1,v=0,p={},b=function(e,t,r){var n=r(Bt(e.formState.values,t));e.formState.values=qt(e.formState.values,t,n)||{}},h=function(e,t,r){if(e.fields[t]){var n,i;e.fields=jt({},e.fields,((n={})[r]=jt({},e.fields[t],{name:r,blur:function(){return C.blur(r)},change:function(e){return C.change(r,e)},focus:function(){return C.focus(r)},lastFieldState:void 0}),n)),delete e.fields[t],e.fieldSubscribers=jt({},e.fieldSubscribers,((i={})[r]=e.fieldSubscribers[t],i)),delete e.fieldSubscribers[t];var a=Bt(e.formState.values,t);e.formState.values=qt(e.formState.values,t,void 0)||{},e.formState.values=qt(e.formState.values,r,a),delete e.lastFormState}},g=function(e){return function(){if(a){for(var t={formState:c.formState,fields:c.fields,fieldSubscribers:c.fieldSubscribers,lastFormState:c.lastFormState},r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];var o=a[e](n,t,{changeValue:b,getIn:Bt,renameField:h,resetFieldState:C.resetFieldState,setIn:qt,shallowEqual:Ut});return c.formState=t.formState,c.fields=t.fields,c.fieldSubscribers=t.fieldSubscribers,c.lastFormState=t.lastFormState,S(void 0,(function(){w(),L()})),o}}},y=a?Object.keys(a).reduce((function(e,t){return e[t]=g(t),e}),{}):{},E=function(e){return Object.keys(e.validators).reduce((function(t,r){var n=e.validators[Number(r)]();return n&&t.push(n),t}),[])},S=function(e,t){if(d)return f=!0,void t();var r=c.fields,n=c.formState,i=jt({},r),a=Object.keys(i);if(u||a.some((function(e){return E(i[e]).length}))){var o=!1;if(e){var l=i[e];if(l){var s=l.validateFields;s&&(o=!0,a=s.length?s.concat(e):[e])}}var m,b={},h={},g={},y=[].concat(function(e){var t=[];if(u){var r=u(jt({},c.formState.values));Qt(r)?t.push(r.then((function(t){return e(t,!0)}))):e(r,!1)}return t}((function(e,t){t?h=e||{}:b=e||{}})),a.reduce((function(e,t){return e.concat(function(e,t){var r,n=[],i=E(e);i.length&&(i.forEach((function(i){var a=i(Bt(c.formState.values,e.name),c.formState.values,0===i.length||3===i.length?zt(c.formState,c.fields[e.name]):void 0);if(a&&Qt(a)){e.validating=!0;var o=a.then((function(r){c.fields[e.name]&&(c.fields[e.name].validating=!1,t(r))}));n.push(o)}else r||(r=a)})),t(r));return n}(r[t],(function(e){g[t]=e})))}),[])),S=y.length>0,w=++v,O=Promise.all(y).then((m=w,function(e){return delete p[m],e}));S&&(p[w]=O);var x=function(e){var t=jt({},o?n.errors:{},b,e?h:n.asyncErrors),l=function(e){a.forEach((function(n){if(r[n]){var a=Bt(b,n),l=Bt(t,n),c=E(i[n]).length,s=g[n];e(n,c&&s||u&&a||(a||o?void 0:l))}}))};l((function(e,r){t=qt(t,e,r)||{}})),l((function(e,r){if(r&&r[_t]){var n=Bt(t,e),i=[].concat(n);i[_t]=r[_t],t=qt(t,e,i)}})),Ut(n.errors,t)||(n.errors=t),e&&(n.asyncErrors=h),n.error=b["FINAL_FORM/form-error"]};if(S&&(c.formState.validating++,t()),x(!1),t(),S){var k=function(){c.formState.validating--,t()};O.then((function(){v>w||x(!0)})).then(k,k)}}else t()},w=function(e){if(!s){var t=c.fields,r=c.fieldSubscribers,n=c.formState,i=jt({},t),a=function(e){var t=i[e],a=zt(n,t),o=t.lastFieldState;t.lastFieldState=a;var u=r[e];u&&er(u,a,o,Gt,void 0===o)};e?a(e):Object.keys(i).forEach(a)}},O=function(){Object.keys(c.fields).forEach((function(e){c.fields[e].touched=!0}))},x=function(){var e=c.fields,t=c.formState,r=c.lastFormState,n=jt({},e),i=Object.keys(n),a=!1,o=i.reduce((function(e,r){return!n[r].isEqual(Bt(t.values,r),Bt(t.initialValues||{},r))&&(a=!0,e[r]=!0),e}),{}),u=i.reduce((function(e,r){var i=t.lastSubmittedValues||{};return n[r].isEqual(Bt(t.values,r),Bt(i,r))||(e[r]=!0),e}),{});t.pristine=!a,t.dirtySinceLastSubmit=!(!t.lastSubmittedValues||!Object.values(u).some((function(e){return e}))),t.modifiedSinceLastSubmit=!(!t.lastSubmittedValues||!Object.keys(n).some((function(e){return n[e].modifiedSinceLastSubmit}))),t.valid=!(t.error||t.submitError||Xt(t.errors)||t.submitErrors&&Xt(t.submitErrors));var l=function(e){var t=e.active,r=e.dirtySinceLastSubmit,n=e.modifiedSinceLastSubmit,i=e.error,a=e.errors,o=e.initialValues,u=e.pristine,l=e.submitting,c=e.submitFailed,s=e.submitSucceeded,d=e.submitError,f=e.submitErrors,m=e.valid,v=e.validating,p=e.values;return{active:t,dirty:!u,dirtySinceLastSubmit:r,modifiedSinceLastSubmit:n,error:i,errors:a,hasSubmitErrors:!!(d||f&&Xt(f)),hasValidationErrors:!(!i&&!Xt(a)),invalid:!m,initialValues:o,pristine:u,submitting:l,submitFailed:c,submitSucceeded:s,submitError:d,submitErrors:f,valid:m,validating:v>0,values:p}}(t),s=i.reduce((function(e,t){return e.modified[t]=n[t].modified,e.touched[t]=n[t].touched,e.visited[t]=n[t].visited,e}),{modified:{},touched:{},visited:{}}),d=s.modified,f=s.touched,m=s.visited;return l.dirtyFields=r&&Ut(r.dirtyFields,o)?r.dirtyFields:o,l.dirtyFieldsSinceLastSubmit=r&&Ut(r.dirtyFieldsSinceLastSubmit,u)?r.dirtyFieldsSinceLastSubmit:u,l.modified=r&&Ut(r.modified,d)?r.modified:d,l.touched=r&&Ut(r.touched,f)?r.touched:f,l.visited=r&&Ut(r.visited,m)?r.visited:m,r&&Ut(r,l)?r:l},k=!1,T=!1,L=function e(){if(k)T=!0;else{if(k=!0,t&&t(x(),Object.keys(c.fields).reduce((function(e,t){return e[t]=c.fields[t],e}),{})),!(s||d&&m)){var r=c.lastFormState,n=x();n!==r&&(c.lastFormState=n,er(c.subscribers,n,r,Kt))}k=!1,T&&(T=!1,e())}},j=function(){return Object.keys(c.fields).forEach((function(e){return c.fields[e].modifiedSinceLastSubmit=!1}))};S(void 0,(function(){L()}));var C={batch:function(e){s++,e(),s--,w(),L()},blur:function(e){var t=c.fields,r=c.formState,n=t[e];n&&(delete r.active,t[e]=jt({},n,{active:!1,touched:!0}),l?S(e,(function(){w(),L()})):(w(),L()))},change:function(e,t){var r=c.fields,n=c.formState;if(Bt(n.values,e)!==t){b(c,e,(function(){return t}));var i=r[e];i&&(r[e]=jt({},i,{modified:!0,modifiedSinceLastSubmit:!!n.lastSubmittedValues})),l?(w(),L()):S(e,(function(){w(),L()}))}},get destroyOnUnregister(){return!!r},set destroyOnUnregister(e){r=e},focus:function(e){var t=c.fields[e];t&&!t.active&&(c.formState.active=e,t.active=!0,t.visited=!0,w(),L())},mutators:y,getFieldState:function(e){var t=c.fields[e];return t&&t.lastFieldState},getRegisteredFields:function(){return Object.keys(c.fields)},getState:function(){return x()},initialize:function(e){var t=c.fields,r=c.formState,i=jt({},t),a="function"==typeof e?e(r.values):e;n||(r.values=a);var o=n?Object.keys(i).reduce((function(e,t){return i[t].isEqual(Bt(r.values,t),Bt(r.initialValues||{},t))||(e[t]=Bt(r.values,t)),e}),{}):{};r.initialValues=a,r.values=a,Object.keys(o).forEach((function(e){r.values=qt(r.values,e,o[e])||{}})),S(void 0,(function(){w(),L()}))},isValidationPaused:function(){return d},pauseValidation:function(e){void 0===e&&(e=!0),d=!0,m=e},registerField:function(e,t,n,i){void 0===n&&(n={}),c.fieldSubscribers[e]||(c.fieldSubscribers[e]={index:0,entries:{}});var a=c.fieldSubscribers[e].index++;c.fieldSubscribers[e].entries[a]={subscriber:Yt(t),subscription:n,notified:!1};var o=c.fields[e]||{active:!1,afterSubmit:i&&i.afterSubmit,beforeSubmit:i&&i.beforeSubmit,data:i&&i.data||{},isEqual:i&&i.isEqual||$t,lastFieldState:void 0,modified:!1,modifiedSinceLastSubmit:!1,name:e,touched:!1,valid:!0,validateFields:i&&i.validateFields,validators:{},validating:!1,visited:!1};o.blur=o.blur||function(){return C.blur(e)},o.change=o.change||function(t){return C.change(e,t)},o.focus=o.focus||function(){return C.focus(e)},c.fields[e]=o;var u=!1,l=i&&i.silent,s=function(){l?w(e):(L(),w())};if(i){u=!(!i.getValidator||!i.getValidator()),i.getValidator&&(c.fields[e].validators[a]=i.getValidator);var d=void 0===Bt(c.formState.values,e);void 0===i.initialValue||!d&&Bt(c.formState.values,e)!==Bt(c.formState.initialValues,e)||(c.formState.initialValues=qt(c.formState.initialValues||{},e,i.initialValue),c.formState.values=qt(c.formState.values,e,i.initialValue),S(void 0,s)),void 0!==i.defaultValue&&void 0===i.initialValue&&void 0===Bt(c.formState.initialValues,e)&&d&&(c.formState.values=qt(c.formState.values,e,i.defaultValue))}return u?S(void 0,s):s(),function(){var t=!1;c.fields[e]&&(t=!(!c.fields[e].validators[a]||!c.fields[e].validators[a]()),delete c.fields[e].validators[a]);var n=!!c.fieldSubscribers[e];n&&delete c.fieldSubscribers[e].entries[a];var i=n&&!Object.keys(c.fieldSubscribers[e].entries).length;i&&(delete c.fieldSubscribers[e],delete c.fields[e],t&&(c.formState.errors=qt(c.formState.errors,e,void 0)||{}),r&&(c.formState.values=qt(c.formState.values,e,void 0,!0)||{})),l||(t?S(void 0,(function(){L(),w()})):i&&L())}},reset:function(e){void 0===e&&(e=c.formState.initialValues),c.formState.submitting&&(c.formState.resetWhileSubmitting=!0),c.formState.submitFailed=!1,c.formState.submitSucceeded=!1,delete c.formState.submitError,delete c.formState.submitErrors,delete c.formState.lastSubmittedValues,C.initialize(e||{})},resetFieldState:function(e){c.fields[e]=jt({},c.fields[e],{active:!1,lastFieldState:void 0,modified:!1,touched:!1,valid:!0,validating:!1,visited:!1}),S(void 0,(function(){w(),L()}))},restart:function(e){void 0===e&&(e=c.formState.initialValues),C.batch((function(){for(var t in c.fields)C.resetFieldState(t),c.fields[t]=jt({},c.fields[t],{active:!1,lastFieldState:void 0,modified:!1,modifiedSinceLastSubmit:!1,touched:!1,valid:!0,validating:!1,visited:!1});C.reset(e)}))},resumeValidation:function(){d=!1,m=!1,f&&S(void 0,(function(){w(),L()})),f=!1},setConfig:function(e,i){switch(e){case"debug":t=i;break;case"destroyOnUnregister":r=i;break;case"initialValues":C.initialize(i);break;case"keepDirtyOnReinitialize":n=i;break;case"mutators":a=i,i?(Object.keys(y).forEach((function(e){e in i||delete y[e]})),Object.keys(i).forEach((function(e){y[e]=g(e)}))):Object.keys(y).forEach((function(e){delete y[e]}));break;case"onSubmit":o=i;break;case"validate":u=i,S(void 0,(function(){w(),L()}));break;case"validateOnBlur":l=i;break;default:throw new Error("Unrecognised option "+e)}},submit:function(){var e=c.formState;if(!e.submitting){if(delete e.submitErrors,delete e.submitError,e.lastSubmittedValues=jt({},e.values),c.formState.error||Xt(c.formState.errors))return O(),j(),c.formState.submitFailed=!0,L(),void w();var t=Object.keys(p);if(t.length)Promise.all(t.map((function(e){return p[Number(e)]}))).then(C.submit,console.error);else if(!Object.keys(c.fields).some((function(e){return c.fields[e].beforeSubmit&&!1===c.fields[e].beforeSubmit()}))){var r,n=!1,i=function(t){e.submitting=!1;var i=e.resetWhileSubmitting;return i&&(e.resetWhileSubmitting=!1),t&&Xt(t)?(e.submitFailed=!0,e.submitSucceeded=!1,e.submitErrors=t,e.submitError=t["FINAL_FORM/form-error"],O()):(i||(e.submitFailed=!1,e.submitSucceeded=!0),Object.keys(c.fields).forEach((function(e){return c.fields[e].afterSubmit&&c.fields[e].afterSubmit()}))),L(),w(),n=!0,r&&r(t),t};e.submitting=!0,e.submitFailed=!1,e.submitSucceeded=!1,e.lastSubmittedValues=jt({},e.values),j();var a=o(e.values,C,i);if(!n){if(a&&Qt(a))return L(),w(),a.then(i,(function(e){throw i(),e}));if(o.length>=3)return L(),w(),new Promise((function(e){r=e}));i(a)}}}},subscribe:function(e,t){if(!e)throw new Error("No callback given.");if(!t)throw new Error("No subscription provided. What values do you want to listen to?");var r=Yt(e),n=c.subscribers,i=n.index++;n.entries[i]={subscriber:r,subscription:t,notified:!1};var a=x();return Zt(r,t,a,a,Kt,!0),function(){delete n.entries[i]}}};return C}var rr=["render","children","component"];function nr(e,t,r){void 0===r&&(r=function(e,t){return e===t});var n=W.default.useRef(e);W.default.useEffect((function(){r(e,n.current)||(t(),n.current=e)}))}var ir=function(e,t){if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var i=Object.prototype.hasOwnProperty.bind(t),a=0;a<r.length;a++){var o=r[a];if(!i(o)||e[o]!==t[o])return!1}return!0},ar=G.createContext();var or=function(e,t){return function(e,t,r){r.forEach((function(r){Object.defineProperty(e,r,{get:function(){return t[r]},enumerable:!0})}))}(e,t,["active","dirty","dirtyFields","dirtySinceLastSubmit","dirtyFieldsSinceLastSubmit","error","errors","hasSubmitErrors","hasValidationErrors","initialValues","invalid","modified","modifiedSinceLastSubmit","pristine","submitError","submitErrors","submitFailed","submitSucceeded","submitting","touched","valid","validating","values","visited"])},ur=["debug","decorators","destroyOnUnregister","form","initialValues","initialValuesEqual","keepDirtyOnReinitialize","mutators","onSubmit","subscription","validate","validateOnBlur"],lr={"final-form":"4.20.8","react-final-form":"6.5.8"},cr=Wt.reduce((function(e,t){return e[t]=!0,e}),{});function sr(e){var t,r,n=e.debug,i=e.decorators,a=void 0===i?[]:i,o=e.destroyOnUnregister,u=e.form,l=e.initialValues,c=e.initialValuesEqual,s=e.keepDirtyOnReinitialize,d=e.mutators,f=e.onSubmit,m=e.subscription,v=void 0===m?cr:m,p=e.validate,b=e.validateOnBlur,h=Ct(e,ur),g={debug:n,destroyOnUnregister:o,initialValues:l,keepDirtyOnReinitialize:s,mutators:d,onSubmit:f,validate:p,validateOnBlur:b},y=(t=function(){var e=u||tr(g);return e.pauseValidation(),e},(r=W.default.useRef()).current||(r.current=t()),r.current),E=G.useState((function(){var e={};return y.subscribe((function(t){e=t}),v)(),e})),S=E[0],w=E[1],O=function(e){var t=W.default.useRef(e);return W.default.useEffect((function(){t.current=e})),t}(S);G.useEffect((function(){y.isValidationPaused()&&y.resumeValidation();var e=[y.subscribe((function(e){ir(e,O.current)||w(e)}),v)].concat(a?a.map((function(e){return e(y)})):[]);return function(){y.pauseValidation(),e.reverse().forEach((function(e){return e()}))}}),a),nr(n,(function(){y.setConfig("debug",n)})),nr(o,(function(){y.destroyOnUnregister=!!o})),nr(s,(function(){y.setConfig("keepDirtyOnReinitialize",s)})),nr(l,(function(){y.setConfig("initialValues",l)}),c||ir),nr(d,(function(){y.setConfig("mutators",d)})),nr(f,(function(){y.setConfig("onSubmit",f)})),nr(p,(function(){y.setConfig("validate",p)})),nr(b,(function(){y.setConfig("validateOnBlur",b)}));var x={form:jt({},y,{reset:function(e){var t;(t=e)&&"function"==typeof t.stopPropagation?y.reset():y.reset(e)}}),handleSubmit:function(e){return e&&("function"==typeof e.preventDefault&&e.preventDefault(),"function"==typeof e.stopPropagation&&e.stopPropagation()),y.submit()}};return or(x,S),G.createElement(ar.Provider,{value:y},function(e,t,r){var n=e.render,i=e.children,a=e.component,o=Ct(e,rr);if(a)return G.createElement(a,Object.assign(t,o,{children:i,render:n}));if(n)return n(void 0===i?Object.assign(t,o):Object.assign(t,o,{children:i}));if("function"!=typeof i)throw new Error("Must specify either a render prop, a render function as children, or a component prop to "+r);return i(Object.assign(t,o))}(jt({},h,{__versions:lr}),x,"ReactFinalForm"))}Dt.reduce((function(e,t){return e[t]=!0,e}),{});var dr={ARTICLE:"Article",AUDIO:"Audio",DOCUMENT:"Document",EVENT:"Event",IMAGE:"Image",NOTE:"Note",PAGE:"Page",PLACE:"Place",PROFILE:"Profile",RELATIONSHIP:"Relationship",TOMBSTONE:"Tombstone",VIDEO:"Video"},fr="https://www.w3.org/ns/activitystreams#Public",mr=function(){var r=t.useGetIdentity().identity,n=e.useMemo((function(){var e;if(null!=r&&r.webIdData)return null==r||null===(e=r.webIdData)||void 0===e?void 0:e.outbox}),[r]),i=e.useMemo((function(){var e,t;if(null!=r&&r.webIdData)return(null==r||null===(e=r.webIdData)||void 0===e||null===(t=e.endpoints)||void 0===t?void 0:t["void:sparqlEndpoint"])||(null==r?void 0:r.id)+"/sparql"}),[r]);return{post:e.useCallback(function(){var e=Le(ke().mark((function e(r){var i,a,o;return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=localStorage.getItem("token"),e.next=3,t.fetchUtils.fetchJson(n,{method:"POST",body:JSON.stringify(xe({"@context":"https://www.w3.org/ns/activitystreams"},r)),headers:new Headers({"Content-Type":"application/ld+json",Authorization:"Bearer ".concat(i)})});case 3:return a=e.sent,o=a.headers,e.abrupt("return",o.get("Location"));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n]),fetch:e.useCallback(Le(ke().mark((function e(){var r,a,u,l,c;return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i&&n){e.next=2;break}return e.abrupt("return");case 2:return r=localStorage.getItem("token"),a=o.buildBlankNodesQuery(["as:object"]),u="\n      PREFIX as: <https://www.w3.org/ns/activitystreams#>\n      CONSTRUCT {\n        ?s1 ?p1 ?o1 .\n        ".concat(a.construct,"\n      }\n      WHERE {\n        <").concat(n,"> as:items ?s1 .\n        ?s1 ?p1 ?o1 .\n        ").concat(a.where,"\n      }\n    "),e.next=7,t.fetchUtils.fetchJson(i,{method:"POST",body:u,headers:new Headers({Accept:"application/ld+json",Authorization:r?"Bearer ".concat(r):void 0})});case 7:if(l=e.sent,!(c=l.json)["@graph"]){e.next=13;break}return e.abrupt("return",c["@graph"]);case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}}),e)}))),[i,n]),url:n,owner:null==r?void 0:r.id}},vr=Q.default.extend({renderHTML:function(e){var t=e.node,r=e.HTMLAttributes;return["span",l.mergeAttributes(this.options.HTMLAttributes,r),"@".concat(t.attrs.id.label)]},addAttributes:function(){return{label:{default:null,parseHTML:function(e){return{label:e.getAttribute("data-mention-label")}},renderHTML:function(e){return e.id.label?{"data-mention-label":e.id.label}:{}}},id:{default:null,parseHTML:function(e){return{id:e.getAttribute("data-mention-id")}},renderHTML:function(e){return e.id.id?{"data-mention-id":e.id.id}:{}}}}}}),pr=K.default((function(e){return{form:{marginTop:-12},container:{paddingLeft:80,position:"relative"},avatar:{position:"absolute",top:16,left:0,bottom:0,width:64,height:64},editorContent:{"& > div":{backgroundColor:"rgba(0, 0, 0, 0.09)",padding:"2px 12px",borderWidth:"0px !important",borderRadius:0,borderBottom:"1px solid #FFF",minHeight:60,outline:"unset !important"},"& > div > p":{marginTop:12,marginBottom:12,fontFamily:e.typography.body1.fontFamily,marginBlockStart:"0.5em",marginBlockEnd:"0.5em"},"& > div > p.is-editor-empty:first-child::before":{color:"grey",content:"attr(data-placeholder)",float:"left",height:0,pointerEvents:"none"},marginBottom:-19},button:{marginBottom:15}}})),br=function(r){var i=r.context,a=r.placeholder,l=r.helperText,c=r.mentions,s=r.userResource,d=r.addItem,f=r.removeItem,m=t.useRecordContext(),v=t.useGetIdentity().identity,p=o.useDataModel(s),b=pr(),h=t.useNotify(),g=mr(),y=Ae(e.useState(!1),2),E=y[0],S=y[1],w=Ae(e.useState(!1),2),O=w[0],x=w[1],k=e.useCallback(function(){var e=Le(ke().mark((function e(t,r){var n,a,o,u,l,c;return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.reset,a=(new DOMParser).parseFromString(t.comment,"text/html"),o=Array.from(a.body.getElementsByClassName("mention")),u=[],o.forEach((function(e){var t=e.attributes["data-mention-id"].value,r=e.attributes["data-mention-label"].value,n=a.createElement("a");n.setAttribute("href",new URL(window.location.href).origin+"/"+s+"/"+encodeURIComponent(t)+"/show"),n.textContent="@"+r,e.parentNode.replaceChild(n,e),u.push(t)})),"undefined"!==a.body.innerHTML){e.next=9;break}h("Votre commentaire est vide",{type:"error"}),e.next=24;break;case 9:return l=Date.now(),c={type:dr.NOTE,attributedTo:g.owner,content:a.body.innerHTML,inReplyTo:m[i],published:(new Date).toISOString()},e.prev=11,d(xe({id:l},c)),n(),S(!1),e.next=17,g.post(xe(xe({},c),{},{to:[].concat(u,[fr])}));case 17:h("Commentaire posté avec succès",{type:"success"}),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(11),f(l),h(e.t0.message,{type:"error"});case 24:case"end":return e.stop()}}),e,null,[[11,20]])})));return function(t,r){return e.apply(this,arguments)}}(),[g,h,S,d,f]),T=e.useCallback((function(){v.id||x(!0)}),[v,x]);return c&&!c.items||!v?null:W.default.createElement(W.default.Fragment,null,W.default.createElement(sr,{onSubmit:k,subscription:{submitting:!0,pristine:!0},render:function(e){var t,r,i,o,u=e.handleSubmit,s=e.submitting;if(e.pristine){var d=document.getElementById("comment");d&&""!==d.textContent&&(d.innerHTML="")}return W.default.createElement("form",{onSubmit:u,className:b.form},W.default.createElement(n.Box,{className:b.container,onClick:T},W.default.createElement(n.Avatar,{src:(null==v||null===(t=v.webIdData)||void 0===t?void 0:t[null==p||null===(r=p.fieldsMapping)||void 0===r?void 0:r.image])||(null==v||null===(i=v.profileData)||void 0===i?void 0:i[null==p||null===(o=p.fieldsMapping)||void 0===o?void 0:o.image]),className:b.avatar}),W.default.createElement(Ot,{source:"comment",label:"",toolbar:null,fullWidth:!0,classes:{editorContent:b.editorContent},editorOptions:xe(xe({},kt),{},{onFocus:function(){S(!0)},extensions:[].concat(Ie(kt.extensions),[a?J.default.configure({placeholder:a}):null,c?vr.configure({HTMLAttributes:{class:"mention"},suggestion:c}):null]),editable:!!v.id}),helperText:l}),E&&W.default.createElement(n.Button,{type:"submit",size:"small",variant:"contained",color:"primary",endIcon:W.default.createElement(Y.default,null),disabled:s,className:b.button},"Envoyer")))}}),W.default.createElement(u.AuthDialog,{open:O,onClose:function(){return x(!1)},message:"Pour poster un commentaire, vous devez être connecté."}))},hr=K.default((function(){return{container:{paddingLeft:80,marginTop:8,minHeight:80,position:"relative"},avatar:{position:"absolute",top:0,left:0,bottom:0,width:64,height:64},text:{paddingTop:2,paddingBottom:8},label:{fontWeight:"bold"},content:{"& p":{marginBlockStart:"0.5em",marginBlockEnd:"0.5em"}},loading:{zIndex:1e3,backgroundColor:"white",opacity:.5,position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",minHeight:200,marginTop:5}}})),gr=function(e){var r=e.comments,i=e.userResource,a=e.loading,u=hr(),l=o.useDataModel(i);return W.default.createElement(n.Box,{position:"relative"},r&&r.sort((function(e,t){return new Date(t.published)-new Date(e.published)})).map((function(e){var r,a;return W.default.createElement(n.Box,{className:u.container},W.default.createElement(n.Box,{className:u.avatar},W.default.createElement(D.ReferenceField,{record:e,reference:i,source:"attributedTo",linkType:"show"},W.default.createElement(D.AvatarWithLabelField,{image:null==l||null===(r=l.fieldsMapping)||void 0===r?void 0:r.image}))),W.default.createElement(n.Box,{className:u.text},W.default.createElement(n.Typography,{variant:"body2"},W.default.createElement(D.ReferenceField,{record:e,reference:i,source:"attributedTo",linkType:"show"},W.default.createElement(t.TextField,{variant:"body2",source:null==l||null===(a=l.fieldsMapping)||void 0===a?void 0:a.title,className:u.label}))," • ",W.default.createElement(t.DateField,{record:e,variant:"body2",source:"published",showTime:!0})),W.default.createElement(t.RichTextField,{record:e,variant:"body1",source:"content",className:u.content})))})),a&&W.default.createElement(n.Box,{minHeight:200},W.default.createElement(n.Box,{alignItems:"center",className:u.loading},W.default.createElement(n.CircularProgress,{size:60,thickness:6}))))},yr=function(r){var n=t.useGetIdentity().identity,i=Ae(e.useState([]),2),a=i[0],o=i[1],u=Ae(e.useState(!1),2),l=u[0],c=u[1],s=Ae(e.useState(!1),2),d=s[0],f=s[1],m=Ae(e.useState(!1),2),v=m[0],p=m[1],b=e.useMemo((function(){if(r){if(r.startsWith("http"))return r;var e;if(null!=n&&n.webIdData)return null==n||null===(e=n.webIdData)||void 0===e?void 0:e[r]}}),[n,r]),h=e.useCallback(Le(ke().mark((function e(){var r,n;return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=2;break}return e.abrupt("return");case 2:c(!0),r=localStorage.getItem("token"),n=new Headers({Accept:"application/ld+json",Authorization:r?"Bearer ".concat(r):void 0}),t.fetchUtils.fetchJson(b,{headers:n}).then((function(e){var t=e.json;t&&t.items?o(t.items):t&&t.orderedItems?o(t.orderedItems):o([]),p(!1),f(!0),c(!1)})).catch((function(){p(!0),f(!0),c(!1)}));case 6:case"end":return e.stop()}}),e)}))),[o,f,c,p,b]);e.useEffect((function(){l||d||v||h()}),[h,l,d,v]);var g=e.useCallback((function(e){o((function(t){return[].concat(Ie(t),[e])}))}),[o]),y=e.useCallback((function(e){o((function(t){return t.filter((function(t){return"string"==typeof t?t!==e:t.id!==e}))}))}),[o]);return{items:a,loading:l,loaded:d,error:v,refetch:h,addItem:g,removeItem:y,url:b}},Er=function(e){e.source;var r=e.context,n=e.helperText,i=e.placeholder,a=e.userResource,o=e.mentions,u=t.useRecordContext(),l=yr(u.replies),c=l.items,s=l.loading,d=l.addItem,f=l.removeItem;if(!a)throw new Error("No userResource defined for CommentsField");return W.default.createElement(W.default.Fragment,null,W.default.createElement(br,{context:r,helperText:n,userResource:a,placeholder:i,mentions:o,addItem:d,removeItem:f}),W.default.createElement(gr,{comments:c,loading:s,userResource:a}))};Er.defaultProps={label:"Commentaires",placeholder:"Commencez à taper votre commentaire...",source:"id",context:"id"};var Sr=["collectionUrl","resource","children"],wr=function(e){var r=e.collectionUrl,n=e.resource,i=e.children,a=Fe(e,Sr);if(1!==W.default.Children.count(i))throw new Error("<CollectionList> only accepts a single child");var o=t.useGetOne(n,r,{enabled:!!r}),u=o.data;return o.isLoading?W.default.createElement("div",{style:{marginTop:8}},W.default.createElement(t.LinearProgress,null)):u?W.default.createElement(D.ReferenceArrayField,Ce({reference:n,record:u,source:"items"},a),i):null},Or=["source","record","reference","children"],xr=K.default((function(e){return{items:{background:"#fff",borderRadius:"0.5rem",boxShadow:"0 0 0 1px rgba(0, 0, 0, 0.05), 0px 10px 20px rgba(0, 0, 0, 0.1)",color:"rgba(0, 0, 0, 0.8)",fontSize:"0.9rem",overflow:"hidden",padding:"0.2rem",position:"relative"},item:{background:"transparent",border:"1px solid transparent",borderRadius:"0.4rem",display:"block",margin:0,padding:"0.2rem 0.4rem",textAlign:"left",width:"100%","&.selected":{borderColor:"#000"}}}})),kr=e.forwardRef((function(t,r){var n=Ae(e.useState(0),2),i=n[0],a=n[1],o=xr(),u=function(e){var r=t.items[e];r&&t.command({id:r})};return e.useEffect((function(){return a(0)}),[t.items]),e.useImperativeHandle(r,(function(){return{onKeyDown:function(e){var r=e.event;return"ArrowUp"===r.key?(a((i+t.items.length-1)%t.items.length),!0):"ArrowDown"===r.key?(a((i+1)%t.items.length),!0):"Enter"===r.key&&(u(i),!0)}}})),W.default.createElement("div",{className:o.items},t.items.length?t.items.map((function(e,t){return W.default.createElement("button",{className:o.item+(t===i?" selected":""),key:t,onClick:function(){return u(t)}},e.label)})):W.default.createElement("div",{className:o.item},"Aucun résultat"))})),Tr=function(){var e,t;return{onStart:function(r){e=new s.ReactRenderer(kr,{props:r,editor:r.editor}),t=we.default("body",{getReferenceClientRect:r.clientRect,appendTo:function(){return document.body},content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"})},onUpdate:function(r){e.updateProps(r),t[0].setProps({getReferenceClientRect:r.clientRect})},onKeyDown:function(r){var n;return"Escape"===r.event.key?(t[0].hide(),!0):null===(n=e.ref)||void 0===n?void 0:n.onKeyDown(r)},onExit:function(){t[0].destroy(),e.destroy()}}};exports.ACTIVITY_TYPES={ACCEPT:"Accept",ADD:"Add",ANNOUNCE:"Announce",ARRIVE:"Arrive",BLOCK:"Block",CREATE:"Create",DELETE:"Delete",DISLIKE:"Dislike",FLAG:"Flag",FOLLOW:"Follow",IGNORE:"Ignore",INVITE:"Invite",JOIN:"Join",LEAVE:"Leave",LIKE:"Like",LISTEN:"Listen",MOVE:"Move",OFFER:"Offer",QUESTION:"Question",REJECT:"Reject",READ:"Read",REMOVE:"Remove",TENTATIVE_REJECT:"TentativeReject",TENTATIVE_ACCEPT:"TentativeAccept",TRAVAL:"Travel",UNDO:"Undo",UPDATE:"Update",VIEW:"View"},exports.ACTOR_TYPES={APPLICATION:"Application",GROUP:"Group",ORGANIZATION:"Organization",PERSON:"Person",SERVICE:"Service"},exports.CollectionList=wr,exports.CommentsField=Er,exports.OBJECT_TYPES=dr,exports.PUBLIC_URI=fr,exports.ReferenceCollectionField=function(e){var t=e.source,r=e.record,n=e.reference,i=e.children,a=Fe(e,Or);if(1!==W.default.Children.count(i))throw new Error("<ReferenceCollectionField> only accepts a single child");return r&&r[t]?W.default.createElement(wr,Ce({resource:n,collectionUrl:r[t]},a),i):null},exports.useCollection=yr,exports.useInbox=function(){var r=t.useGetIdentity().identity,n=e.useMemo((function(){var e;if(null!=r&&r.webIdData)return null==r||null===(e=r.webIdData)||void 0===e?void 0:e.inbox}),[r]),i=e.useMemo((function(){var e,t;if(null!=r&&r.webIdData)return(null==r||null===(e=r.webIdData)||void 0===e||null===(t=e.endpoints)||void 0===t?void 0:t["void:sparqlEndpoint"])||(null==r?void 0:r.id)+"/sparql"}),[r]);return{fetch:e.useCallback(function(){var e=Le(ke().mark((function e(r){var a,u,l,c,s,d,f;return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.filters,console.log("inboxUrl",n,i),i&&n){e.next=4;break}return e.abrupt("return");case 4:return u=localStorage.getItem("token"),l=o.buildBlankNodesQuery(["as:object"]),c="",a&&Object.keys(a).forEach((function(e){if(a[e]){var t=a[e].startsWith("http")?"<".concat(a[e],">"):a[e];c+="?s1 ".concat(e," ").concat(t," .")}})),s="\n        PREFIX as: <https://www.w3.org/ns/activitystreams#>\n        CONSTRUCT {\n          ?s1 ?p1 ?o1 .\n          ".concat(l.construct,"\n        }\n        WHERE {\n          <").concat(n,"> as:items ?s1 .\n          ?s1 ?p1 ?o1 .\n          FILTER( (isIRI(?s1)) ) .\n          ").concat(c,"\n          ").concat(l.where,"\n        }\n      "),e.next=11,t.fetchUtils.fetchJson(i,{method:"POST",body:s,headers:new Headers({Accept:"application/ld+json",Authorization:u?"Bearer ".concat(u):void 0})});case 11:if(d=e.sent,!(f=d.json)["@graph"]){e.next=17;break}return e.abrupt("return",f["@graph"]);case 17:return e.abrupt("return",null);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[i,n]),url:n,owner:null==r?void 0:r.id}},exports.useMentions=function(r){var n,i,a=o.useDataModel(r),u=t.useGetList({resource:r,payload:{filter:{_predicates:[null==a||null===(n=a.fieldsMapping)||void 0===n?void 0:n.title],blankNodes:[]}}},{enabled:!(null==a||null===(i=a.fieldsMapping)||void 0===i||!i.title)}).data,l=e.useMemo((function(){if(u)return u.map((function(e){var t;return{id:e.id,label:e[null==a||null===(t=a.fieldsMapping)||void 0===t?void 0:t.title]}}))}),[u]);return{items:e.useMemo((function(){if(l)return function(e){var t=e.query;return l.filter((function(e){return e.label.toLowerCase().startsWith(t.toLowerCase())})).slice(0,5)}}),[l]),render:Tr}},exports.useOutbox=mr,exports.useWebfinger=function(){return{fetch:e.useCallback(function(){var e=Le(ke().mark((function e(r){var n,i,a,o,u,l,c,s,d;return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.split("@"),(i=Ae(n,3))[0],a=i[1],!(o=i[2])){e.next=18;break}return u=o.includes(":")?"http":"https",l="".concat(u,"://").concat(o,"/.well-known/webfinger?resource=acct:").concat(a,"@").concat(o),e.prev=4,e.next=7,t.fetchUtils.fetchJson(l);case 7:return c=e.sent,s=c.json,d=s.links.find((function(e){return"application/activity+json"===e.type})),e.abrupt("return",d?d.href:null);case 13:return e.prev=13,e.t0=e.catch(4),e.abrupt("return",null);case 16:e.next=19;break;case 18:return e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(t){return e.apply(this,arguments)}}(),[])}};
//# sourceMappingURL=index.cjs.js.map
