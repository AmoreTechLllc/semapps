{"version":3,"file":"index.cjs.js","sources":["../src/fields/ReferenceArrayField.js","../src/fields/ReferenceField.js","../src/dataHandling/FilterHandler.js","../src/inputs/ReferenceArrayInput.js","../src/inputs/ReificationArrayInput.js","../src/dataProvider/utils/getServerKeyFromType.js","../src/dataProvider/utils/getServerKeyFromUri.js","../src/dataProvider/utils/fetchResource.js","../src/dataProvider/methods/getOne.js","../node_modules/url-join/lib/url-join.js","../src/dataProvider/utils/uploadAllFiles.js","../src/dataProvider/utils/findContainersWithTypes.js","../src/dataProvider/methods/create.js","../src/dataProvider/methods/delete.js","../src/dataProvider/methods/deleteMany.js","../src/dataProvider/methods/getCreateContainer.js","../src/dataProvider/utils/fetchContainers.js","../src/dataProvider/utils/getEmbedFrame.js","../node_modules/@rdfjs/data-model/lib/BlankNode.js","../node_modules/@rdfjs/data-model/lib/DefaultGraph.js","../node_modules/@rdfjs/data-model/lib/fromTerm.js","../node_modules/@rdfjs/data-model/lib/NamedNode.js","../node_modules/@rdfjs/data-model/lib/Literal.js","../node_modules/@rdfjs/data-model/lib/Quad.js","../node_modules/@rdfjs/data-model/lib/Variable.js","../node_modules/@rdfjs/data-model/lib/DataFactory.js","../src/dataProvider/utils/buildDereferenceQuery.js","../src/dataProvider/utils/buildSparqlQuery.js","../src/dataProvider/utils/fetchSparqlEndpoints.js","../src/dataProvider/methods/getList.js","../src/dataProvider/methods/getMany.js","../src/dataProvider/methods/getManyReference.js","../src/dataProvider/methods/update.js","../node_modules/jwt-decode/build/jwt-decode.esm.js","../src/dataProvider/utils/fetchUserConfig.js","../src/dataProvider/utils/fetchVoidEndpoints.js","../src/inputs/DateTimeInput.js","../src/dataHandling/GroupedReferenceHandler.js","../src/fields/ImageField.js","../src/inputs/ReferenceInput.js","../src/dataProvider/dataProvider.js","../src/httpClient.js","../src/hooks/useCreateContainer.js"],"sourcesContent":["import React from 'react';\nimport { ReferenceArrayField as RaReferenceArrayField } from 'react-admin';\n\nconst ReferenceArrayField = ({ record, source, ...otherProps }) => {\n  if (record?.[source]) {\n    if (!Array.isArray(record[source])) {\n      record[source] = [record[source]];\n    }\n    record[source] = record[source].map(i => i['@id'] || i.id || i);\n  }\n  return <RaReferenceArrayField record={record} source={source} {...otherProps} />;\n};\n\nReferenceArrayField.defaultProps = {\n  addLabel: true\n};\n\nexport default ReferenceArrayField;\n","import React from 'react';\nimport { ReferenceField as RaReferenceField } from 'react-admin';\n\nconst ReferenceField = ({ record, source, ...otherProps }) => {\n  if (record[source]) {\n    if (typeof record[source] === 'object') {\n      record[source] = record[source]['@id'] || record[source].id;\n    }\n  }\n  return <RaReferenceField record={record} source={source} {...otherProps} />;\n};\n\nReferenceField.defaultProps = {\n  addLabel: true\n};\n\nexport default ReferenceField;\n","import React, { useState, useEffect } from 'react';\n\n/**\n * @example\n * <Show>\n *   <FilterHandler\n *     source=\"property\" // ex pair:organizationOfMembership\n *     filter={{\n *       'propertyToFilter':'value'\n *     }} // ex {{'pair:membershipRole':'http://localhost:3000/membership-roles/role-1'}}\n *     >\n *     <SingleFieldList>\n *    </SingleFieldList>\n *   </FilterHandler>\n * </Show>\n */\n\nconst FilterHandler = ({ children, record, filter, source, ...otherProps }) => {\n  const [filtered, setFiltered] = useState();\n  useEffect(() => {\n    if (record && source && Array.isArray(record?.[source])) {\n      const filteredData = record?.[source].filter(r => {\n        let eq = true;\n        for (const key in filter) {\n          const value = r[key];\n          if (Array.isArray(value)) {\n            if (!value.includes(filter[key])) {\n              eq = false;\n            }\n          } else {\n            if (value !== filter[key]) {\n              eq = false;\n            }\n          }\n        }\n        return eq;\n      });\n      let newRecord = {\n        ...record\n      };\n      //undefined setted if no data to obtain no render in RightLabel or equivalent\n      newRecord[source] = filteredData.length > 0 ? filteredData : undefined;\n      setFiltered(newRecord);\n    }\n  }, [record, source, filter]);\n\n  return (\n    <>\n      {React.Children.map(children, (child, i) => {\n        return React.cloneElement(child, {\n          ...otherProps,\n          record: filtered,\n          addLabel: true,\n          source\n        });\n      })}\n    </>\n  );\n};\nexport default FilterHandler;\n","import React from 'react';\nimport { ReferenceArrayInput as RaReferenceArrayInput, useResourceContext } from 'react-admin';\n\nconst ReferenceArrayInput = props => {\n  const resource = useResourceContext({});\n  return (\n    <RaReferenceArrayInput\n      {...props}\n      resource={resource}\n      format={value => {\n        // If there is no value, return immediately\n        if (!value) return value;\n        // if the linked field value is not an array, turns it into an array.\n        // Necessary as JSON-LD are sometimes arrays, sometimes not (when there is one value)\n        // and the ReferenceArrayInput component only accept arrays\n        if (!Array.isArray(value)) value = [value];\n        // If a format prop was defined, apply it to the array\n        if (props.format) value = props.format(value);\n        // If the values are objects with @id field, turn it to a simple string\n        return value.map(v => (typeof v === 'object' ? v.id || v['@id'] : v));\n      }}\n    />\n  );\n};\n\nexport default ReferenceArrayInput;\n","import React, { useEffect, useState } from 'react';\nimport { ArrayInput, SimpleFormIterator, TextInput } from 'react-admin';\nimport { makeStyles } from '@material-ui/core/styles';\n\nconst useReferenceInputStyles = makeStyles({\n  form: {\n    display: 'flex'\n  },\n  input: {\n    paddingRight: '20px'\n  }\n});\n\nconst useHideInputStyles = makeStyles({\n  root: {\n    display: 'none'\n  }\n});\n\nconst ReificationArrayInput = props => {\n  const { reificationClass, children, ...otherProps } = props;\n  const flexFormClasses = useReferenceInputStyles();\n  const hideInputStyles = useHideInputStyles();\n\n  return (\n    <ArrayInput {...otherProps}>\n      <SimpleFormIterator classes={{ form: flexFormClasses.form }}>\n        {React.Children.map(props.children, (child, i) => {\n          return React.cloneElement(child, {\n            className: flexFormClasses.input\n          });\n        })}\n        <TextInput className={hideInputStyles.root} source=\"type\" initialValue={reificationClass} />\n      </SimpleFormIterator>\n    </ArrayInput>\n  );\n};\n\nexport default ReificationArrayInput;\n","const getServerKeyFromType = (type, dataServers) => {\n  return Object.keys(dataServers).find(key => {\n    return dataServers[key][type];\n  });\n};\n\nexport default getServerKeyFromType;\n","// Return the first server matching with the baseUrl\nconst getServerKeyFromUri = (uri, dataServers) => {\n  return Object.keys(dataServers).find(key => {\n    return uri.startsWith(dataServers[key].baseUrl);\n  });\n};\n\nexport default getServerKeyFromUri;\n","import getServerKeyFromType from './getServerKeyFromType';\nimport getServerKeyFromUri from './getServerKeyFromUri';\nimport jsonld from 'jsonld';\n\nconst fetchResource = async (resourceUri, config) => {\n  const { dataServers, httpClient, jsonContext } = config;\n\n  const authServerKey = getServerKeyFromType('authServer', dataServers);\n  const serverKey = getServerKeyFromUri(resourceUri, dataServers);\n\n  // Fetch through proxy server if it is available\n  let { json: data } =\n    serverKey !== authServerKey && dataServers[authServerKey]?.proxyUrl && dataServers[serverKey]?.noProxy !== true\n      ? await httpClient(dataServers[authServerKey].proxyUrl, {\n          method: 'POST',\n          headers: new Headers({ 'Content-Type': 'application/x-www-form-urlencoded' }),\n          body: new URLSearchParams({ id: resourceUri })\n        })\n      : await httpClient(resourceUri, {\n          noToken: serverKey !== authServerKey\n        });\n\n  data.id = data.id || data['@id'];\n\n  // We compact only if the context is different between the frontend and the middleware\n  // TODO deep compare if the context is an object\n  if (data['@context'] !== jsonContext) {\n    data = await jsonld.compact(data, jsonContext);\n  }\n\n  return data;\n};\n\nexport default fetchResource;\n","import fetchResource from '../utils/fetchResource';\n\nconst getOneMethod = config => async (resourceId, params) => {\n  const { resources } = config;\n  const dataModel = resources[resourceId];\n\n  if (!dataModel) throw new Error(`Resource ${resourceId} is not mapped in resources file`);\n\n  const data = await fetchResource(params.id, config);\n\n  // Transform single value into array if forceArray is set\n  if (dataModel.list?.forceArray) {\n    for (const forceArrayItem of dataModel.list?.forceArray) {\n      if (data[forceArrayItem] && !Array.isArray(data[forceArrayItem])) {\n        data[forceArrayItem] = [data[forceArrayItem]];\n      }\n    }\n  }\n\n  if (dataModel.list?.dereference) {\n    for (const dereferenceItem of dataModel.list?.dereference) {\n      if (\n        data[dereferenceItem] &&\n        typeof data[dereferenceItem] === 'string' &&\n        data[dereferenceItem].startsWith('http')\n      ) {\n        try {\n          const dataToEmbed = await fetchResource(data[dereferenceItem], config);\n          delete dataToEmbed['@context'];\n          data[dereferenceItem] = dataToEmbed;\n        } catch (e) {\n          // Ignore errors (this may happen if user does not have rights to see the resource)\n        }\n      }\n    }\n  }\n\n  return { data: data };\n};\n\nexport default getOneMethod;\n","(function (name, context, definition) {\n  if (typeof module !== 'undefined' && module.exports) module.exports = definition();\n  else if (typeof define === 'function' && define.amd) define(definition);\n  else context[name] = definition();\n})('urljoin', this, function () {\n\n  function normalize (strArray) {\n    var resultArray = [];\n    if (strArray.length === 0) { return ''; }\n\n    if (typeof strArray[0] !== 'string') {\n      throw new TypeError('Url must be a string. Received ' + strArray[0]);\n    }\n\n    // If the first part is a plain protocol, we combine it with the next part.\n    if (strArray[0].match(/^[^/:]+:\\/*$/) && strArray.length > 1) {\n      var first = strArray.shift();\n      strArray[0] = first + strArray[0];\n    }\n\n    // There must be two or three slashes in the file protocol, two slashes in anything else.\n    if (strArray[0].match(/^file:\\/\\/\\//)) {\n      strArray[0] = strArray[0].replace(/^([^/:]+):\\/*/, '$1:///');\n    } else {\n      strArray[0] = strArray[0].replace(/^([^/:]+):\\/*/, '$1://');\n    }\n\n    for (var i = 0; i < strArray.length; i++) {\n      var component = strArray[i];\n\n      if (typeof component !== 'string') {\n        throw new TypeError('Url must be a string. Received ' + component);\n      }\n\n      if (component === '') { continue; }\n\n      if (i > 0) {\n        // Removing the starting slashes for each component but the first.\n        component = component.replace(/^[\\/]+/, '');\n      }\n      if (i < strArray.length - 1) {\n        // Removing the ending slashes for each component but the last.\n        component = component.replace(/[\\/]+$/, '');\n      } else {\n        // For the last component we will combine multiple slashes to a single one.\n        component = component.replace(/[\\/]+$/, '/');\n      }\n\n      resultArray.push(component);\n\n    }\n\n    var str = resultArray.join('/');\n    // Each input component is now separated by a single slash except the possible first plain protocol part.\n\n    // remove trailing slash before parameters or hash\n    str = str.replace(/\\/(\\?|&|#[^!])/g, '$1');\n\n    // replace ? in parameters with &\n    var parts = str.split('?');\n    str = parts.shift() + (parts.length > 0 ? '?': '') + parts.join('&');\n\n    return str;\n  }\n\n  return function () {\n    var input;\n\n    if (typeof arguments[0] === 'object') {\n      input = arguments[0];\n    } else {\n      input = [].slice.call(arguments);\n    }\n\n    return normalize(input);\n  };\n\n});\n","import createSlug from 'speakingurl';\nimport urlJoin from 'url-join';\n\nexport const getSlugWithExtension = fileName => {\n  let fileExtension = '';\n  let splitFileName = fileName.split('.');\n  if (splitFileName.length > 1) {\n    fileExtension = splitFileName.pop();\n    fileName = splitFileName.join('.');\n  }\n  return createSlug(fileName, { lang: 'fr' }) + '.' + fileExtension;\n};\n\nexport const isFile = o => o && o.rawFile && o.rawFile instanceof File;\n\nconst getUploadsContainerUri = config => {\n  const serverKey = Object.keys(config.dataServers).find(key => config.dataServers[key].uploadsContainer);\n  if (serverKey) {\n    return urlJoin(config.dataServers[serverKey].baseUrl, config.dataServers[serverKey].uploadsContainer);\n  }\n};\n\nconst uploadFile = async (rawFile, config) => {\n  const uploadsContainerUri = getUploadsContainerUri(config);\n  if (!uploadsContainerUri) throw new Error(\"You must define an uploadsContainer in one of the server's configuration\");\n\n  const response = await config.httpClient(uploadsContainerUri, {\n    method: 'POST',\n    body: rawFile,\n    headers: new Headers({\n      // We must sluggify the file name, because we can't use non-ASCII characters in the header\n      // However we keep the extension apart (if it exists) so that it is not replaced with a -\n      // TODO let the middleware guess the extension based on the content type\n      Slug: getSlugWithExtension(rawFile.name),\n      'Content-Type': rawFile.type\n    })\n  });\n\n  if (response.status === 201) {\n    return response.headers.get('Location');\n  }\n};\n\n/*\n * Look for raw files in the record data.\n * If there are any, upload them and replace the file by its URL.\n */\nconst uploadAllFiles = async (record, config) => {\n  for (let property in record) {\n    if (record.hasOwnProperty(property)) {\n      if (Array.isArray(record[property])) {\n        for (let i = 0; i < record[property].length; i++) {\n          if (isFile(record[property][i])) {\n            record[property][i] = await uploadFile(record[property][i].rawFile, config);\n          }\n        }\n      } else {\n        if (isFile(record[property])) {\n          record[property] = await uploadFile(record[property].rawFile, config);\n        }\n      }\n    }\n  }\n  return record;\n};\n\nexport default uploadAllFiles;\n","import urlJoin from 'url-join';\n\nconst findContainersWithTypes = (types, servers, dataServers) => {\n  let containers = {};\n  let existingContainers = [];\n  Object.keys(dataServers).forEach(key1 => {\n    Object.keys(dataServers[key1].containers).forEach(key2 => {\n      if (!servers || (Array.isArray(servers) ? servers.includes(key2) : servers === key2)) {\n        Object.keys(dataServers[key1].containers[key2]).forEach(type => {\n          if (types.includes(type)) {\n            dataServers[key1].containers[key2][type].map(path => {\n              const containerUri = urlJoin(dataServers[key2].baseUrl, path);\n\n              // Avoid returning the same container several times\n              if (!existingContainers.includes(containerUri)) {\n                existingContainers.push(containerUri);\n\n                if (!containers[key1]) containers[key1] = [];\n                containers[key1].push(containerUri);\n              }\n            });\n          }\n        });\n      }\n    });\n  });\n  return containers;\n};\n\nexport default findContainersWithTypes;\n","import getOne from './getOne';\nimport uploadAllFiles from '../utils/uploadAllFiles';\nimport findContainersWithTypes from '../utils/findContainersWithTypes';\nimport getServerKeyFromUri from '../utils/getServerKeyFromUri';\n\nconst createMethod = config => async (resourceId, params) => {\n  const { dataServers, resources, httpClient, jsonContext } = config;\n  const dataModel = resources[resourceId];\n\n  if (!dataModel) Error(`Resource ${resourceId} is not mapped in resources file`);\n\n  const headers = new Headers();\n\n  if (dataModel.fieldsMapping?.title) {\n    headers.set('Slug', params.data[dataModel.fieldsMapping?.title]);\n  }\n\n  let containerUri, serverKey;\n  if (dataModel.create?.container) {\n    containerUri = dataModel.create?.container;\n    serverKey = getServerKeyFromUri(containerUri, dataServers);\n  } else {\n    serverKey =\n      dataModel.create?.server || Object.keys(config.dataServers).find(key => config.dataServers[key].default === true);\n    if (!serverKey) throw new Error('You must define a server for the creation, or a container, or a default server');\n\n    const containers = findContainersWithTypes(dataModel.types, [serverKey], dataServers);\n    // Extract the containerUri from the results (and ensure there is only one)\n    const serverKeys = Object.keys(containers);\n\n    if (!serverKeys || serverKeys.length === 0)\n      throw new Error(`No container with types ${JSON.stringify(dataModel.types)} found on server ${serverKey}`);\n    if (serverKeys.length > 1 || containers[serverKeys[0]].length > 1)\n      throw new Error(\n        `More than one container detected with types ${JSON.stringify(dataModel.types)} on server ${serverKey}`\n      );\n    containerUri = containers[serverKeys[0]][0];\n  }\n\n  // Upload files, if there are any\n  params.data = await uploadAllFiles(params.data, config);\n\n  const { headers: responseHeaders } = await httpClient(containerUri, {\n    method: 'POST',\n    headers,\n    body: JSON.stringify({\n      '@context': jsonContext,\n      '@type': dataModel.types,\n      ...params.data\n    }),\n    noToken: dataServers[serverKey].authServer !== true\n  });\n\n  // Retrieve newly-created resource\n  const resourceUri = responseHeaders.get('Location');\n  return await getOne(config)(resourceId, { id: resourceUri });\n};\n\nexport default createMethod;\n","import getServerKeyFromUri from '../utils/getServerKeyFromUri';\n\nconst deleteMethod = config => async (resourceId, params) => {\n  const { dataServers, httpClient } = config;\n  const serverKey = getServerKeyFromUri(params.id, dataServers);\n\n  await httpClient(params.id, {\n    method: 'DELETE',\n    noToken: !serverKey || dataServers[serverKey].authServer !== true\n  });\n\n  return { data: { id: params.id } };\n};\n\nexport default deleteMethod;\n","const deleteManyMethod = config => async (resourceId, params) => {\n  const { httpClient } = config;\n  let ids = [];\n\n  for (let id of params.ids) {\n    try {\n      await httpClient(id, {\n        method: 'DELETE'\n      });\n      ids.push(id);\n    } catch (e) {\n      // Do nothing if we fail to delete a resource\n    }\n  }\n\n  return { data: ids };\n};\n\nexport default deleteManyMethod;\n","import urlJoin from 'url-join';\nimport getServerKeyFromType from '../utils/getServerKeyFromType';\n\nconst findCreateContainerWithTypes = (types, createServerKey, dataServers) => {\n  let containers = [];\n  Object.keys(dataServers[createServerKey].containers[createServerKey]).forEach(type => {\n    if (types.includes(type)) {\n      dataServers[createServerKey].containers[createServerKey][type].map(path => {\n        const containerUri = urlJoin(dataServers[createServerKey].baseUrl, path);\n        if (!containers.includes(containerUri)) {\n          containers.push(containerUri);\n        }\n      });\n    }\n  });\n\n  if (containers.length === 0) {\n    throw new Error(\n      `No container found matching with types ${JSON.stringify(\n        types\n      )}. You can set explicitely the create.container property of the resource.`\n    );\n  } else if (containers.length > 1) {\n    throw new Error(\n      `More than one container found matching with types ${JSON.stringify(\n        types\n      )}. You must set the create.server or create.container property for the resource.`\n    );\n  }\n\n  return containers[0];\n};\n\nconst getCreateContainer = config => resourceId => {\n  let { dataServers, resources } = config;\n  const dataModel = resources[resourceId];\n\n  if (!dataModel) throw new Error(`Resource ${resourceId} is not mapped in resources file`);\n\n  if (dataModel.create?.container) {\n    return dataModel.create?.container;\n  } else if (dataModel.create?.server) {\n    return findCreateContainerWithTypes(dataModel.types, dataModel.create?.server, dataServers);\n  } else {\n    const defaultServerKey = getServerKeyFromType('default', dataServers);\n    return findCreateContainerWithTypes(dataModel.types, defaultServerKey, dataServers);\n  }\n};\n\nexport default getCreateContainer;\n","import jsonld from 'jsonld';\n\nexport const isType = (type, resource) => {\n  const resourceType = resource.type || resource['@type'];\n  return Array.isArray(resourceType) ? resourceType.includes(type) : resourceType === type;\n};\n\nconst fetchContainers = async (containers, resourceId, params, config) => {\n  const { dataServers, httpClient, jsonContext } = config;\n\n  // Transform in an containerUri:serverKey object\n  const containersServers = Object.keys(containers).reduce(\n    (acc, serverKey) => ({\n      ...acc,\n      ...Object.fromEntries(containers[serverKey].map(containerUri => [containerUri, serverKey]))\n    }),\n    {}\n  );\n\n  const fetchPromises = Object.keys(containersServers).map(containerUri =>\n    httpClient(containerUri, {\n      noToken: !containersServers[containerUri] || dataServers[containersServers[containerUri]].authServer !== true\n    })\n      .then(({ json }) => {\n        // If container's context is different, compact it to have an uniform result\n        // TODO deep compare if the context is an object\n        if (json['@context'] !== jsonContext) {\n          return jsonld.compact(json, jsonContext);\n        } else {\n          return json;\n        }\n      })\n      .then(json => {\n        if (isType('ldp:Container', json)) {\n          return json['ldp:contains'];\n        } else {\n          throw new Error(containerUri + ' is not a LDP container');\n        }\n      })\n  );\n\n  // Fetch simultaneously all containers\n  let results = await Promise.all(fetchPromises);\n\n  if (results.length === 0) {\n    return { data: [], total: 0 };\n  } else {\n    // Merge all results in one array\n    results = [].concat.apply(...results);\n\n    let returnData = results.map(item => {\n      item.id = item.id || item['@id'];\n      return item;\n    });\n\n    // Apply filter to results\n    if (params.filter) {\n      // For SPARQL queries, we use \"a\" to filter types, but in containers it must be \"type\"\n      if (params.filter.a) {\n        params.filter.type = params.filter.a;\n        delete params.filter.a;\n      }\n\n      // Remove search params from filter\n      if (params.filter.q) {\n        delete params.filter.q;\n      }\n      if (Object.keys(params.filter).length > 0) {\n        returnData = returnData.filter(resource =>\n          Object.entries(params.filter).some(([k, v]) =>\n            Array.isArray(resource[k]) ? resource[k].includes(v) : resource[k] === v\n          )\n        );\n      }\n    }\n\n    if (params.sort) {\n      returnData = returnData.sort((a, b) => {\n        if (a[params.sort.field] && b[params.sort.field]) {\n          if (params.sort.order === 'ASC') {\n            return a[params.sort.field].localeCompare(b[params.sort.field]);\n          } else {\n            return b[params.sort.field].localeCompare(a[params.sort.field]);\n          }\n        } else {\n          return true;\n        }\n      });\n    }\n    if (params.pagination) {\n      returnData = returnData.slice(\n        (params.pagination.page - 1) * params.pagination.perPage,\n        params.pagination.page * params.pagination.perPage\n      );\n    }\n\n    return { data: returnData, total: results.length };\n  }\n};\n\nexport default fetchContainers;\n","const getEmbedFrame = paths => {\n  let embedFrame = {},\n    predicates;\n  if (paths) {\n    for (let path of paths) {\n      if (path.includes('/')) {\n        predicates = path.split('/').reverse();\n      } else {\n        predicates = [path];\n      }\n      embedFrame = {\n        ...embedFrame,\n        ...predicates.reduce(\n          (accumulator, predicate) => ({\n            [predicate]: {\n              '@embed': '@last',\n              ...accumulator\n            }\n          }),\n          {}\n        )\n      };\n    }\n    return embedFrame;\n  }\n};\n\nexport default getEmbedFrame;\n","class BlankNode {\n  constructor (id) {\n    this.value = id || ('b' + (++BlankNode.nextId))\n  }\n\n  equals (other) {\n    return !!other && other.termType === this.termType && other.value === this.value\n  }\n}\n\nBlankNode.prototype.termType = 'BlankNode'\n\nBlankNode.nextId = 0\n\nmodule.exports = BlankNode\n","class DefaultGraph {\n  equals (other) {\n    return !!other && other.termType === this.termType\n  }\n}\n\nDefaultGraph.prototype.termType = 'DefaultGraph'\nDefaultGraph.prototype.value = ''\n\nmodule.exports = DefaultGraph\n","function fromTerm (original) {\n  if (!original) {\n    return null\n  }\n\n  if (original.termType === 'BlankNode') {\n    return this.blankNode(original.value)\n  }\n\n  if (original.termType === 'DefaultGraph') {\n    return this.defaultGraph()\n  }\n\n  if (original.termType === 'Literal') {\n    return this.literal(original.value, original.language || this.namedNode(original.datatype.value))\n  }\n\n  if (original.termType === 'NamedNode') {\n    return this.namedNode(original.value)\n  }\n\n  if (original.termType === 'Quad') {\n    const subject = this.fromTerm(original.subject)\n    const predicate = this.fromTerm(original.predicate)\n    const object = this.fromTerm(original.object)\n    const graph = this.fromTerm(original.graph)\n\n    return this.quad(subject, predicate, object, graph)\n  }\n\n  if (original.termType === 'Variable') {\n    return this.variable(original.value)\n  }\n\n  throw new Error(`unknown termType ${original.termType}`)\n}\n\nmodule.exports = fromTerm\n","class NamedNode {\n  constructor (iri) {\n    this.value = iri\n  }\n\n  equals (other) {\n    return !!other && other.termType === this.termType && other.value === this.value\n  }\n}\n\nNamedNode.prototype.termType = 'NamedNode'\n\nmodule.exports = NamedNode\n","const NamedNode = require('./NamedNode.js')\n\nclass Literal {\n  constructor (value, language, datatype) {\n    this.value = value\n    this.datatype = Literal.stringDatatype\n    this.language = ''\n\n    if (language) {\n      this.language = language\n      this.datatype = Literal.langStringDatatype\n    } else if (datatype) {\n      this.datatype = datatype\n    }\n  }\n\n  equals (other) {\n    return !!other && other.termType === this.termType && other.value === this.value &&\n      other.language === this.language && other.datatype.equals(this.datatype)\n  }\n}\n\nLiteral.prototype.termType = 'Literal'\n\nLiteral.langStringDatatype = new NamedNode('http://www.w3.org/1999/02/22-rdf-syntax-ns#langString')\nLiteral.stringDatatype = new NamedNode('http://www.w3.org/2001/XMLSchema#string')\n\nmodule.exports = Literal\n","const DefaultGraph = require('./DefaultGraph.js')\n\nclass Quad {\n  constructor (subject, predicate, object, graph) {\n    this.subject = subject\n    this.predicate = predicate\n    this.object = object\n\n    if (graph) {\n      this.graph = graph\n    } else {\n      this.graph = new DefaultGraph()\n    }\n  }\n\n  equals (other) {\n    // `|| !other.termType` is for backwards-compatibility with old factories without RDF* support.\n    return !!other && (other.termType === 'Quad' || !other.termType) &&\n      other.subject.equals(this.subject) && other.predicate.equals(this.predicate) &&\n      other.object.equals(this.object) && other.graph.equals(this.graph)\n  }\n}\n\nQuad.prototype.termType = 'Quad'\nQuad.prototype.value = ''\n\nmodule.exports = Quad\n","class Variable {\n  constructor (name) {\n    this.value = name\n  }\n\n  equals (other) {\n    return !!other && other.termType === this.termType && other.value === this.value\n  }\n}\n\nVariable.prototype.termType = 'Variable'\n\nmodule.exports = Variable\n","const BlankNode = require('./BlankNode.js')\nconst DefaultGraph = require('./DefaultGraph.js')\nconst fromTermRaw = require('./fromTerm.js')\nconst Literal = require('./Literal.js')\nconst NamedNode = require('./NamedNode.js')\nconst Quad = require('./Quad.js')\nconst Variable = require('./Variable.js')\n\nfunction namedNode (value) {\n  return new NamedNode(value)\n}\n\nfunction blankNode (value) {\n  return new BlankNode(value)\n}\n\nfunction literal (value, languageOrDatatype) {\n  if (typeof languageOrDatatype === 'string') {\n    if (languageOrDatatype.indexOf(':') === -1) {\n      return new Literal(value, languageOrDatatype)\n    }\n\n    return new Literal(value, null, DataFactory.namedNode(languageOrDatatype))\n  }\n\n  return new Literal(value, null, languageOrDatatype)\n}\n\nfunction variable (value) {\n  return new Variable(value)\n}\n\nfunction defaultGraph () {\n  return DataFactory.defaultGraphInstance\n}\n\nfunction triple (subject, predicate, object) {\n  return DataFactory.quad(subject, predicate, object)\n}\n\nfunction quad (subject, predicate, object, graph) {\n  return new Quad(subject, predicate, object, graph || DataFactory.defaultGraphInstance)\n}\n\nfunction fromTerm (original) {\n  return fromTermRaw.call(DataFactory, original)\n}\n\nfunction fromQuad (original) {\n  return fromTermRaw.call(DataFactory, original)\n}\n\nconst DataFactory = {\n  namedNode,\n  blankNode,\n  literal,\n  variable,\n  defaultGraph,\n  triple,\n  quad,\n  fromTerm,\n  fromQuad,\n  defaultGraphInstance: new DefaultGraph()\n}\n\nmodule.exports = DataFactory\n","import crypto from 'crypto';\nimport DataFactory from '@rdfjs/data-model';\nconst { namedNode, quad, variable } = DataFactory;\n\n// Transform ['ont:predicate1/ont:predicate2'] to ['ont:predicate1', 'ont:predicate1/ont:predicate2']\nconst extractNodes = predicates => {\n  let nodes = [];\n  if (predicates) {\n    for (let predicate of predicates) {\n      if (predicate.includes('/')) {\n        const nodeNames = predicate.split('/');\n        for (let i = 1; i <= nodeNames.length; i++) {\n          nodes.push(nodeNames.slice(0, i).join('/'));\n        }\n      } else {\n        nodes.push(predicate);\n      }\n    }\n  }\n  return nodes;\n};\n\nconst generateSparqlVarName = node =>\n  crypto\n    .createHash('md5')\n    .update(node)\n    .digest('hex');\n\nconst getParentNode = node => node.includes('/') && node.split('/')[0];\n\nconst getPredicate = node => (node.includes('/') ? node.split('/')[1] : node);\n\nconst buildOptionalQuery = (queries, parentNode = false) =>\n  queries\n    .filter(q => q.parentNode === parentNode)\n    .map(\n      q => `\n      OPTIONAL { \n        ${q.query}\n        ${q.filter}\n        ${buildOptionalQuery(queries, q.node)}\n      }\n    `\n    )\n    .join('\\n');\n\nconst buildDereferenceQueryStandard = predicates => {\n  let queries = [];\n  const nodes = extractNodes(predicates);\n\n  if (nodes) {\n    for (let node of nodes) {\n      const parentNode = getParentNode(node);\n      const predicate = getPredicate(node);\n      const varName = generateSparqlVarName(node);\n      const parentVarName = parentNode ? generateSparqlVarName(parentNode) : '1';\n\n      queries.push({\n        node,\n        parentNode,\n        query: `?s${parentVarName} ${predicate} ?s${varName} .\\n?s${varName} ?p${varName} ?o${varName} .`,\n        filter: '' // `FILTER(isBLANK(?s${varName})) .`\n      });\n    }\n\n    return {\n      construct: queries.map(q => q.query).join('\\n'),\n      where: buildOptionalQuery(queries)\n    };\n  } else {\n    return {\n      construct: '',\n      where: ''\n    };\n  }\n};\n\nconst buildOptionalQueryForSparqljs = (queries, parentNode = false) =>\n  queries\n    .filter(q => q.parentNode === parentNode)\n    .map(q => ({\n      type: 'optional',\n      patterns: [\n        {\n          type: 'bgp',\n          triples: q.query\n        },\n        buildOptionalQueryForSparqljs(queries, q.node)\n      ]\n    }));\n\nconst buildDereferenceQueryForSparqlJs = (predicates, ontologies) => {\n  let queries = [];\n  const nodes = extractNodes(predicates);\n\n  if (nodes && ontologies && ontologies.length > 0) {\n    for (let node of nodes) {\n      const parentNode = getParentNode(node);\n      const predicate = getPredicate(node);\n      const varName = generateSparqlVarName(node);\n      const parentVarName = parentNode ? generateSparqlVarName(parentNode) : '1';\n      const filterPrefix = predicate.split(':')[0];\n      const filterValue = predicate.split(':')[1];\n      const filterOntology = ontologies.find(ontology => ontology.prefix === filterPrefix);\n      const queryForSparqljs = [\n        quad(variable('s' + parentVarName), namedNode(filterOntology.url + filterValue), variable('s' + varName)),\n        quad(variable('s' + varName), variable('p' + varName), variable('o' + varName))\n      ];\n\n      queries.push({\n        node,\n        parentNode,\n        query: queryForSparqljs,\n        filter: '' // `FILTER(isBLANK(?s${varName})) .`\n      });\n    }\n    return {\n      construct: queries.length > 0 ? queries.map(q => q.query).reduce((pre, cur) => pre.concat(cur)) : null,\n      where: buildOptionalQueryForSparqljs(queries)\n    };\n  } else {\n    return {\n      construct: '',\n      where: ''\n    };\n  }\n};\n\nconst buildDereferenceQuery = (predicates, sparqlJs = false, ontologies = null) => {\n  if (sparqlJs) {\n    return buildDereferenceQueryForSparqlJs(predicates, ontologies);\n  } else {\n    return buildDereferenceQueryStandard(predicates);\n  }\n};\n\nexport default buildDereferenceQuery;\n","import buildDereferenceQuery from './buildDereferenceQuery';\nimport DataFactory from '@rdfjs/data-model';\nconst { literal, namedNode, quad, variable } = DataFactory;\n\n// Regenerate a SPARQL query from a JSON object\nlet SparqlGenerator = require('sparqljs').Generator;\nlet generator = new SparqlGenerator({\n  /* prefixes, baseIRI, factory, sparqlStar */\n});\n\nconst buildSparqlQuery = ({ containers, params: { filter }, dereference, ontologies }) => {\n  // sparqljs init :\n  let sparqljsParams = {\n    queryType: 'CONSTRUCT',\n    template: [quad(variable('s1'), variable('p1'), variable('o1'))],\n    where: [\n      {\n        type: 'bgp',\n        triples: [quad(variable('s1'), variable('p1'), variable('o1'))]\n      },\n      {\n        type: 'filter',\n        expression: {\n          type: 'operation',\n          operator: 'isiri',\n          args: [variable('s1')]\n        }\n      },\n      {\n        type: 'filter',\n        expression: {\n          type: 'operation',\n          operator: 'in',\n          args: [variable('containerUri'), [namedNode(containers[0])]]\n        }\n      },\n      {\n        type: 'bgp',\n        triples: [quad(variable('containerUri'), namedNode('http://www.w3.org/ns/ldp#contains'), variable('s1'))]\n      }\n    ],\n    type: 'query',\n    prefixes: {}\n  };\n\n  // sparqljs prefixes :\n  ontologies.map(ontology => {\n    sparqljsParams.prefixes = {\n      ...sparqljsParams.prefixes,\n      [ontology.prefix]: ontology.url\n    };\n  });\n\n  // sparqljs dereference :\n  const dereferenceQueryForSparqlJs = buildDereferenceQuery(dereference, true, ontologies);\n  if (dereferenceQueryForSparqlJs && dereferenceQueryForSparqlJs.construct) {\n    sparqljsParams.where = sparqljsParams.where.concat(dereferenceQueryForSparqlJs.where);\n    sparqljsParams.template = sparqljsParams.template.concat(dereferenceQueryForSparqlJs.construct);\n  }\n\n  // sparqljs filters :\n  if (filter && Object.keys(filter).length > 0) {\n    const isSPARQLFilter = filter.sparqlWhere && Object.keys(filter.sparqlWhere).length > 0;\n    const isQFilter = filter.q && filter.q.length > 0;\n\n    // sparqljs filter \"sparqlWhere\" :\n    if (isSPARQLFilter) {\n      /* \n      Example of sparqlWhere usage : \n      - url :\n      http://localhost:5000/Organization?filter=%7B%22q%22%3A%20%22orga%22%2C%22sparqlWhere%22%3A%20%7B%0A%22type%22%3A%20%22bgp%22%2C%0A%22triples%22%3A%20%5B%7B%0A%22subject%22%3A%20%7B%0A%22termType%22%3A%20%22Variable%22%2C%0A%22value%22%3A%20%22s1%22%0A%7D%2C%0A%22predicate%22%3A%20%7B%0A%22termType%22%3A%20%22NameNode%22%2C%0A%22value%22%3A%20%22http%3A%2F%2Fvirtual-assembly.org%2Fontologies%2Fpair%23label%22%0A%7D%2C%0A%22object%22%3A%20%7B%0A%22termType%22%3A%20%22Literal%22%2C%0A%22value%22%3A%20%22orga2%22%0A%7D%0A%7D%5D%0A%7D%7D\n      - json :\n      {\n        \"q\": \"orga\",\n        \"sparqlWhere\": {\n          \"type\": \"bgp\",\n          \"triples\": [{\n              \"subject\": {\"termType\": \"Variable\",\"value\": \"s1\"},\n              \"predicate\": {\"termType\": \"NameNode\",\"value\": \"http://virtual-assembly.org/ontologies/pair#label\"},\n              \"object\": {\"termType\": \"Literal\",\"value\": \"orga2\"}\n          }]\n        }\n      }\n      */\n      sparqljsParams.where.push(filter.sparqlWhere);\n    }\n\n    // sparqljs filter \"q\" :\n    if (isQFilter) {\n      sparqljsParams.where.push({\n        type: 'group',\n        patterns: [\n          {\n            queryType: 'SELECT',\n            variables: [variable('s1')],\n            where: [\n              {\n                type: 'bgp',\n                triples: [quad(variable('s1'), variable('p1'), variable('o1'))]\n              },\n              {\n                type: 'filter',\n                expression: {\n                  type: 'operation',\n                  operator: 'regex',\n                  args: [\n                    {\n                      type: 'operation',\n                      operator: 'lcase',\n                      args: [\n                        {\n                          type: 'operation',\n                          operator: 'str',\n                          args: [variable('o1')]\n                        }\n                      ]\n                    },\n                    literal(filter.q.toLowerCase(), '', namedNode('http://www.w3.org/2001/XMLSchema#string'))\n                  ]\n                }\n              },\n              {\n                type: 'filter',\n                expression: {\n                  type: 'operation',\n                  operator: 'notexists',\n                  args: [\n                    {\n                      type: 'bgp',\n                      triples: [\n                        quad(\n                          variable('s1'),\n                          namedNode('http://www.w3.org/1999/02/22-rdf-syntax-ns#type'),\n                          variable('o1')\n                        )\n                      ]\n                    }\n                  ]\n                }\n              }\n            ],\n            type: 'query'\n          }\n        ]\n      });\n    }\n    \n    // sparqljs \"a\" and other filters :\n    Object.keys(filter).forEach((filterKey) => {\n      if (filterKey !== 'sparqlWhere' && filterKey !== 'q') {\n\n        // SPARQL keyword a = filter based on the class of a resource (example => 'a': 'pair:OrganizationType')\n        // Other filters are based on a value (example => 'petr:hasAudience': 'http://localhost:3000/audiences/tout-public')\n        const filterItem = (filterKey === 'a')\n          ? filter[filterKey]\n          : filterKey\n        const filterPrefix = filterItem.split(':')[0];\n        const filterValue = filterItem.split(':')[1];\n        const filterOntology = ontologies.find(ontology => ontology.prefix === filterPrefix);\n        const filterPredicateValue = (filterKey === 'a')\n          ? 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type'\n          : filterOntology.url + filterValue;\n        const filterObjectValue = (filterKey === 'a')\n          ? filterOntology.url + filterValue\n          : filter[filterKey];\n\n        sparqljsParams.where.push({\n          type: 'bgp',\n          triples: [quad(variable('s1'), namedNode(filterPredicateValue), namedNode(filterObjectValue))]\n        });\n      }\n    });\n  }\n\n  const sparqljsQuery = generator.stringify(sparqljsParams);\n\n  if (filter.q) {\n    delete filter.q;\n  }\n\n  return sparqljsQuery;\n};\n\nexport default buildSparqlQuery;\n","import getEmbedFrame from './getEmbedFrame';\nimport buildSparqlQuery from './buildSparqlQuery';\nimport jsonld from 'jsonld';\n\nconst fetchSparqlEndpoints = async (containers, resourceId, params, config) => {\n  const { dataServers, resources, httpClient, jsonContext, ontologies } = config;\n  const dataModel = resources[resourceId];\n\n  const frame = {\n    '@context': jsonContext,\n    '@type': dataModel.types,\n    // Embed only what we explicitly asked to dereference\n    // Otherwise we may have same-type resources embedded in other resources\n    '@embed': '@never',\n    ...getEmbedFrame(dataModel.list?.dereference)\n  };\n\n  const sparqlQueryPromises = Object.keys(containers).map(\n    serverKey =>\n      new Promise((resolve, reject) => {\n        const sparqlQuery = buildSparqlQuery({\n          containers: containers[serverKey],\n          params: { ...params, filter: { ...dataModel.list?.filter, ...params.filter } },\n          dereference: dataModel.list?.dereference,\n          ontologies\n        });\n\n        httpClient(dataServers[serverKey].sparqlEndpoint, {\n          method: 'POST',\n          body: sparqlQuery,\n          noToken: dataServers[serverKey].authServer !== true\n        })\n          .then(({ json }) => {\n            // omitGraph option force results to be in a @graph, even if we have a single result\n            return jsonld.frame(json, frame, { omitGraph: false });\n          })\n          .then(compactJson => {\n            resolve(compactJson['@graph'] || []);\n          })\n          .catch(e => reject(e));\n      })\n  );\n\n  // Run simultaneous SPARQL queries\n  let results = await Promise.all(sparqlQueryPromises);\n\n  if (results.length === 0) {\n    return { data: [], total: 0 };\n  } else {\n    // Merge all results in one array\n    results = [].concat.apply(...results);\n\n    // Add id in addition to @id, as this is what React-Admin expects\n    let returnData = results.map(item => {\n      item.id = item.id || item['@id'];\n      return item;\n    });\n\n    // TODO sort and paginate the results in the SPARQL query to improve performances\n    if (params.sort) {\n      returnData = returnData.sort((a, b) => {\n        if (a[params.sort.field] && b[params.sort.field]) {\n          if (params.sort.order === 'ASC') {\n            return a[params.sort.field].localeCompare(b[params.sort.field]);\n          } else {\n            return b[params.sort.field].localeCompare(a[params.sort.field]);\n          }\n        } else {\n          return true;\n        }\n      });\n    }\n    if (params.pagination) {\n      returnData = returnData.slice(\n        (params.pagination.page - 1) * params.pagination.perPage,\n        params.pagination.page * params.pagination.perPage\n      );\n    }\n\n    return { data: returnData, total: results.length };\n  }\n};\n\nexport default fetchSparqlEndpoints;\n","import findContainersWithTypes from '../utils/findContainersWithTypes';\nimport fetchContainers from '../utils/fetchContainers';\nimport fetchSparqlEndpoints from '../utils/fetchSparqlEndpoints';\n\nconst getListMethod = config => async (resourceId, params = {}) => {\n  let { dataServers, resources } = config;\n  const dataModel = resources[resourceId];\n\n  if (!dataModel) throw new Error(`Resource ${resourceId} is not mapped in resources file`);\n\n  let containers;\n  if (dataModel.list?.containers && dataModel.list?.containers.length > 0) {\n    // If containers are set explicitly, use them\n    containers = dataModel.list?.containers;\n  } else {\n    containers = findContainersWithTypes(dataModel.types, dataModel.list?.servers, dataServers);\n  }\n\n  if (dataModel.list?.fetchContainer) {\n    return fetchContainers(containers, resourceId, params, config);\n  } else {\n    return fetchSparqlEndpoints(containers, resourceId, params, config);\n  }\n};\n\nexport default getListMethod;\n","import getOne from './getOne';\n\nconst getManyMethod = config => async (resourceId, params) => {\n  const { returnFailedResources } = config;\n\n  let returnData = [];\n\n  for (let id of params.ids) {\n    id = typeof id === 'object' ? id['@id'] : id;\n\n    try {\n      const { data } = await getOne(config)(resourceId, { id });\n      returnData.push(data);\n    } catch (e) {\n      // Catch if one resource fails to load\n      // Otherwise no references will be show if only one is missing\n      // See https://github.com/marmelab/react-admin/issues/5190\n      if (returnFailedResources) {\n        // Return only the ID of the resource\n        returnData.push({ id });\n      } else {\n        // Do nothing. The resource will not appear in the results.\n      }\n    }\n  }\n\n  return { data: returnData };\n};\n\nexport default getManyMethod;\n","import getList from './getList';\n\nconst getManyReferenceMethod = config => async (resourceId, params) => {\n  params.filter = { ...params.filter, [params.target]: params.id };\n  delete params.target;\n  return await getList(config)(resourceId, params);\n};\n\nexport default getManyReferenceMethod;\n","import uploadAllFiles from '../utils/uploadAllFiles';\nimport getServerKeyFromUri from '../utils/getServerKeyFromUri';\n\nconst updateMethod = config => async (resourceId, params) => {\n  const { dataServers, httpClient, jsonContext } = config;\n  const serverKey = getServerKeyFromUri(params.id, dataServers);\n\n  // Upload files, if there are any\n  params.data = await uploadAllFiles(params.data, config);\n\n  await httpClient(params.id, {\n    method: 'PUT',\n    body: JSON.stringify({\n      '@context': jsonContext,\n      ...params.data\n    }),\n    noToken: !serverKey || dataServers[serverKey].authServer !== true\n  });\n\n  return { data: params.data };\n};\n\nexport default updateMethod;\n","function e(e){this.message=e}e.prototype=new Error,e.prototype.name=\"InvalidCharacterError\";var r=\"undefined\"!=typeof window&&window.atob&&window.atob.bind(window)||function(r){var t=String(r).replace(/=+$/,\"\");if(t.length%4==1)throw new e(\"'atob' failed: The string to be decoded is not correctly encoded.\");for(var n,o,a=0,i=0,c=\"\";o=t.charAt(i++);~o&&(n=a%4?64*n+o:o,a++%4)?c+=String.fromCharCode(255&n>>(-2*a&6)):0)o=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\".indexOf(o);return c};function t(e){var t=e.replace(/-/g,\"+\").replace(/_/g,\"/\");switch(t.length%4){case 0:break;case 2:t+=\"==\";break;case 3:t+=\"=\";break;default:throw\"Illegal base64url string!\"}try{return function(e){return decodeURIComponent(r(e).replace(/(.)/g,(function(e,r){var t=r.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t=\"0\"+t),\"%\"+t})))}(t)}catch(e){return r(t)}}function n(e){this.message=e}function o(e,r){if(\"string\"!=typeof e)throw new n(\"Invalid token specified\");var o=!0===(r=r||{}).header?0:1;try{return JSON.parse(t(e.split(\".\")[o]))}catch(e){throw new n(\"Invalid token specified: \"+e.message)}}n.prototype=new Error,n.prototype.name=\"InvalidTokenError\";export default o;export{n as InvalidTokenError};\n//# sourceMappingURL=jwt-decode.esm.js.map\n","import jwtDecode from 'jwt-decode';\nimport getServerKeyFromType from './getServerKeyFromType';\nimport urlJoin from 'url-join';\n\nconst fetchUserConfig = async config => {\n  const { dataServers, httpClient } = config;\n  const token = localStorage.getItem('token');\n  const podKey = getServerKeyFromType('pod', dataServers);\n  const authServerKey = getServerKeyFromType('authServer', dataServers);\n\n  // If the user is logged in\n  if (token) {\n    const { webId } = jwtDecode(token);\n    let userData;\n\n    try {\n      const { json } = await httpClient(webId);\n      userData = json;\n    } catch (e) {\n      console.error(e);\n      // If the webId cannot be fetched, assume an invalid token and disconnect the user\n      localStorage.removeItem('token');\n      window.location.reload();\n      return;\n    }\n\n    // If we have a POD server\n    if (podKey) {\n      // Fill the config provided to the data provider\n      // We must modify the config object directly\n      config.dataServers[podKey].name = 'My Pod';\n      config.dataServers[podKey].baseUrl = urlJoin(webId, 'data'); // TODO find POD URI from user profile\n      config.dataServers[podKey].sparqlEndpoint =\n        userData.endpoints?.['void:sparqlEndpoint'] || urlJoin(webId, 'sparql');\n    }\n\n    if (authServerKey) {\n      // Fill the config provided to the data provider\n      // We must modify the config object directly\n      config.dataServers[authServerKey].proxyUrl = userData.endpoints?.proxyUrl;\n    }\n  } else {\n    if (podKey) {\n      // If the user is not logged in, ignore the POD server\n      delete config.dataServers[podKey];\n    }\n  }\n};\n\nexport default fetchUserConfig;\n","const fetchVoidEndpoints = async config => {\n  const fetchPromises = Object.values(config.dataServers)\n    .filter(server => server.pod !== true)\n    .map(server =>\n      config\n        .httpClient(new URL('/.well-known/void', server.baseUrl))\n        .then(result => ({ data: result.json }))\n        .catch(e => {\n          if (e.status === 404) {\n            return { error: e };\n          } else {\n            throw e;\n          }\n        })\n    );\n\n  try {\n    const results = await Promise.all(fetchPromises);\n    for (let result of results) {\n      // Ignore unfetchable endpoints\n      if (result.data) {\n        // TODO modify config.dataServers based on the VOID configs returned\n      }\n    }\n  } catch (e) {\n    // Do not throw error if no endpoint found\n  }\n};\n\nexport default fetchVoidEndpoints;\n","import React from 'react';\nimport { DateTimeInput as RaDateTimeInput } from 'react-admin';\n\n/**\n * @deprecated Use the component from the @semapps/date-components instead\n */\nconst DateTimeInput = props => (\n  <RaDateTimeInput {...props} format={value => value && value.replace(' ', 'T').replace('Z', '')} />\n);\n\nexport default DateTimeInput;\n","import React from 'react';\nimport { useQueryWithStore } from 'react-admin';\nimport { default as FilterHandler } from './FilterHandler';\n\n/*\n * @example Label used in examples\n *  const Label = ({label, ...otherProps})=>{\n *     return <h2>{label}</h2>\n *  }\n *\n * @example show header for each group with group property thanks to groupHeader\n * <GroupedReferenceHandler\n *   source=\"property\" // predicat of main record to show / ex pair:organizationOfMembership\n *   groupReference=\"RAresource\" // React-Admin resource reference. this is the \"group by\" ressource. / ex MembershipRole\n *   groupHeader={({group,...otherProps}) => <Label {...otherProps} label={group['pair:label']}></Label> }\n *   filterProperty=\"property of source filtered by groupReference\"\n *   addLabel={false}\n * >\n *   <ArrayField source=\"property\"> // same props as GroupedArrayField source\n *    <GridList>\n *    </GridList>\n *   </ArrayField>\n * </GroupedReferenceHandler>\n *\n * @example call chhildren with label thanks to groupLabel\n * <GroupedReferenceHandler\n *   source=\"property\" // predicat of main record to show / ex pair:organizationOfMembership\n *   groupReference=\"RAresource\" // React-Admin resource reference. this is the \"group by\" ressource. / ex MembershipRole\n *   groupLabel=\"property of RAresource display\" // property of React-Admin resource to display. children call whith props \"label\" filled by groupLabel property of groupReference\n *   filterProperty=\"property of source filtered by groupReference\"\n *   addLabel={false}\n * >\n *   <Label>\n *   <ArrayField source=\"property\"> // same props as GroupedArrayField source\n *    <GridList>\n *    </GridList>\n *   </ArrayField>\n * </GroupedReferenceHandler>\n *\n * @example conditional show of group if no data in source. Conditionale groupHeader is not possible because GroupedArrayField define group before filter ; need use chhildren.\n * const ConditionalSourceDefinedHandler = ({record,source,children,...otherProps})=>{\n *   if (record?.[source] && (!Array.isArray(record[source])||record[source].length>0)){\n *     return  React.Children.map(children, (child, i) => {\n *         return React.cloneElement(child, {...otherProps,record,source});\n *       })\n *   }else{\n *     return <></>\n *   }\n * }\n *\n * <GroupedReferenceHandler\n *   source=\"property\" // predicat of main record to show / ex pair:organizationOfMembership\n *   groupReference=\"RAresource\" // React-Admin resource reference. this is the \"group by\" ressource. / ex MembershipRole\n *   groupLabel=\"property of RAresource display\" // property of React-Admin resource to display. children call whith props \"label\" filled by groupLabel property of groupReference\n *   filterProperty=\"property of source filtered by groupReference\"\n *   addLabel={false}\n * >\n *  <ConditionalSourceDefinedHandler>\n *   <Label>\n *   <ArrayField source=\"property\"> // same props as GroupedArrayField source\n *    <GridList>\n *    </GridList>\n *   </ArrayField>\n *  </ConditionalSourceDefinedHandler>\n * </GroupedReferenceHandler>\n *\n *\n */\nconst GroupedReferenceHandler = ({\n  children,\n  groupReference,\n  groupLabel,\n  groupHeader,\n  filterProperty,\n  ...otherProps\n}) => {\n  const { data } = useQueryWithStore({\n    type: 'getList',\n    resource: groupReference,\n    payload: {}\n  });\n\n  return (\n    <>\n      {data?.map((data, index) => {\n        let filter = {};\n        filter[filterProperty] = data.id;\n        return (\n          <>\n            {groupHeader && groupHeader({ ...otherProps, group: data })}\n            <FilterHandler {...otherProps} filter={filter} label={data[groupLabel]}>\n              {children}\n            </FilterHandler>\n          </>\n        );\n      })}\n    </>\n  );\n};\n\nexport default GroupedReferenceHandler;\n","import React from 'react';\nimport { ImageField as RaImageField } from 'react-admin';\n\nconst ImageField = ({ record, source, ...otherProps }) => {\n  // For the display, we need to have the URI in a src property\n  if (typeof record === 'string') record = { [source]: record };\n  return <RaImageField record={record} source={source} {...otherProps} />;\n};\n\nexport default ImageField;\n","import React from 'react';\nimport { ReferenceInput as RaReferenceInput, useResourceContext } from 'react-admin';\n\nconst ReferenceInput = props => {\n  const resource = useResourceContext({});\n  return (\n    <RaReferenceInput\n      {...props}\n      resource={resource}\n      format={value => {\n        // If there is no value, return immediately\n        if (!value) return value;\n        // If a format prop was defined, apply it\n        if (props.format) value = props.format(value);\n        // If the value is an object with an @id field, return the uri\n        return typeof value === 'object' ? value.id || value['@id'] : value;\n      }}\n    />\n  );\n};\n\nexport default ReferenceInput;\n","import createMethod from './methods/create';\nimport deleteMethod from './methods/delete';\nimport deleteManyMethod from './methods/deleteMany';\nimport getCreateContainerMethod from './methods/getCreateContainer';\nimport getListMethod from './methods/getList';\nimport getManyMethod from './methods/getMany';\nimport getManyReferenceMethod from './methods/getManyReference';\nimport getOneMethod from './methods/getOne';\nimport updateMethod from './methods/update';\nimport fetchUserConfig from './utils/fetchUserConfig';\nimport fetchVoidEndpoints from './utils/fetchVoidEndpoints';\nimport getServerKeyFromType from './utils/getServerKeyFromType';\n\nconst dataProvider = config => {\n  // TODO verify all data provider config + data models\n  if (!getServerKeyFromType('default', config.dataServers))\n    throw new Error('You must define a default server in your dataServers config');\n\n  if (!config.jsonContext) config.jsonContext = Object.fromEntries(config.ontologies.map(o => [o.prefix, o.url]));\n  if (!config.returnFailedResources) config.returnFailedResources = false;\n\n  const fetchUserConfigPromise = fetchUserConfig(config);\n  const fetchVoidEndpointsPromise = fetchVoidEndpoints(config);\n\n  const waitForVoidEndpoints = method => async (...arg) => {\n    await fetchUserConfigPromise;\n    await fetchVoidEndpointsPromise; // Return immediately if promise is fulfilled\n    return await method(...arg);\n  };\n\n  return {\n    getList: waitForVoidEndpoints(getListMethod(config)),\n    getOne: waitForVoidEndpoints(getOneMethod(config)),\n    getMany: waitForVoidEndpoints(getManyMethod(config)),\n    getManyReference: waitForVoidEndpoints(getManyReferenceMethod(config)),\n    create: waitForVoidEndpoints(createMethod(config)),\n    update: waitForVoidEndpoints(updateMethod(config)),\n    updateMany: () => {\n      throw new Error('updateMany is not implemented yet');\n    },\n    delete: waitForVoidEndpoints(deleteMethod(config)),\n    deleteMany: waitForVoidEndpoints(deleteManyMethod(config)),\n    getCreateContainer: waitForVoidEndpoints(getCreateContainerMethod(config))\n  };\n};\n\nexport default dataProvider;\n","import { fetchUtils } from 'react-admin';\n\nconst httpClient = (url, options = {}) => {\n  if (!options.headers) options.headers = new Headers();\n\n  switch (options.method) {\n    case 'POST':\n    case 'PATCH':\n    case 'PUT':\n      if (!options.headers.has('Accept')) options.headers.set('Accept', 'application/ld+json');\n      if (!options.headers.has('Content-Type')) options.headers.set('Content-Type', 'application/ld+json');\n      break;\n\n    case 'DELETE':\n      break;\n\n    case 'GET':\n    default:\n      if (!options.headers.has('Accept')) options.headers.set('Accept', 'application/ld+json');\n      break;\n  }\n\n  if (!options.noToken) {\n    const token = localStorage.getItem('token');\n    if (token) options.headers.set('Authorization', `Bearer ${token}`);\n  }\n\n  return fetchUtils.fetchJson(url, options);\n};\n\nexport default httpClient;\n","import { useContext, useState, useEffect } from 'react';\nimport { DataProviderContext } from 'react-admin';\n\nconst useCreateContainer = resourceId => {\n  // Get the raw data provider, since useDataProvider returns a wrapper\n  const dataProvider = useContext(DataProviderContext);\n  const [createContainer, setCreateContainer] = useState();\n\n  useEffect(() => {\n    if (resourceId) {\n      dataProvider.getCreateContainer(resourceId).then(containerUri => setCreateContainer(containerUri));\n    }\n  }, [resourceId]);\n\n  return createContainer;\n};\n\nexport default useCreateContainer;\n"],"names":["ReferenceArrayField","record","source","otherProps","Array","isArray","map","i","id","React","RaReferenceArrayField","defaultProps","addLabel","ReferenceField","_typeof","RaReferenceField","FilterHandler","children","filter","useState","filtered","setFiltered","useEffect","filteredData","r","eq","key","value","includes","newRecord","length","undefined","Children","child","cloneElement","ReferenceArrayInput","props","resource","useResourceContext","RaReferenceArrayInput","format","v","useReferenceInputStyles","makeStyles","form","display","input","paddingRight","useHideInputStyles","root","getServerKeyFromType","type","dataServers","Object","keys","find","getServerKeyFromUri","uri","startsWith","baseUrl","fetchResource","resourceUri","config","httpClient","jsonContext","authServerKey","serverKey","_dataServers$authServ","proxyUrl","noProxy","method","headers","Headers","body","URLSearchParams","noToken","data","json","jsonld","compact","getOneMethod","resourceId","params","resources","dataModel","Error","list","_dataModel$list","forceArray","_dataModel$list2","forceArrayItem","_dataModel$list3","dereference","_dataModel$list4","dereferenceItem","dataToEmbed","context","definition","this","normalize","strArray","resultArray","TypeError","match","first","shift","replace","component","push","str","join","parts","split","arguments","slice","call","module","exports","isFile","o","rawFile","File","getUploadsContainerUri","uploadsContainer","urlJoin","uploadFile","uploadsContainerUri","Slug","fileName","name","fileExtension","splitFileName","pop","createSlug","lang","response","status","get","uploadAllFiles","property","hasOwnProperty","findContainersWithTypes","types","servers","containers","existingContainers","forEach","key1","key2","path","containerUri","createMethod","fieldsMapping","_dataModel$fieldsMapp","title","set","_dataModel$fieldsMapp2","create","_dataModel$create","container","_dataModel$create2","server","serverKeys","JSON","stringify","authServer","responseHeaders","getOne","deleteMethod","deleteManyMethod","ids","findCreateContainerWithTypes","createServerKey","getCreateContainer","_dataModel$create3","_dataModel$create4","defaultServerKey","fetchContainers","containersServers","reduce","acc","fromEntries","fetchPromises","then","resourceType","Promise","all","results","total","concat","apply","returnData","item","a","q","entries","some","k","sort","b","field","order","localeCompare","pagination","page","perPage","getEmbedFrame","paths","predicates","embedFrame","reverse","accumulator","predicate","BlankNode","[object Object]","nextId","other","termType","prototype","DefaultGraph","original","blankNode","defaultGraph","literal","language","namedNode","datatype","subject","fromTerm","object","graph","quad","variable","NamedNode","iri","Literal","stringDatatype","langStringDatatype","equals","Quad","Variable","DataFactory","languageOrDatatype","indexOf","defaultGraphInstance","triple","fromTermRaw","fromQuad","extractNodes","nodes","nodeNames","generateSparqlVarName","node","crypto","createHash","update","digest","getParentNode","getPredicate","buildOptionalQuery","queries","parentNode","query","buildDereferenceQueryStandard","varName","parentVarName","construct","where","buildOptionalQueryForSparqljs","patterns","triples","buildDereferenceQueryForSparqlJs","ontologies","filterPrefix","filterValue","filterOntology","ontology","prefix","queryForSparqljs","url","pre","cur","buildDereferenceQuery","sparqlJs","generator","SparqlGenerator","require","Generator","buildSparqlQuery","sparqljsParams","queryType","template","expression","operator","args","prefixes","dereferenceQueryForSparqlJs","isSPARQLFilter","sparqlWhere","isQFilter","variables","toLowerCase","filterKey","filterItem","filterPredicateValue","filterObjectValue","sparqljsQuery","fetchSparqlEndpoints","frame","sparqlQueryPromises","resolve","reject","sparqlQuery","sparqlEndpoint","omitGraph","compactJson","e","getListMethod","_dataModel$list5","fetchContainer","getManyMethod","returnFailedResources","getManyReferenceMethod","target","getList","updateMethod","message","window","atob","bind","t","String","n","c","charAt","fromCharCode","decodeURIComponent","charCodeAt","toString","toUpperCase","header","parse","fetchUserConfig","token","localStorage","getItem","podKey","jwtDecode","webId","userData","console","error","removeItem","location","reload","endpoints","_userData$endpoints2","fetchVoidEndpoints","values","pod","URL","result","RaDateTimeInput","groupReference","groupLabel","groupHeader","filterProperty","useQueryWithStore","payload","index","group","label","RaImageField","RaReferenceInput","reificationClass","flexFormClasses","hideInputStyles","ArrayInput","SimpleFormIterator","classes","className","TextInput","initialValue","fetchUserConfigPromise","fetchVoidEndpointsPromise","waitForVoidEndpoints","getMany","getManyReference","updateMany","deleteMany","getCreateContainerMethod","options","has","fetchUtils","fetchJson","dataProvider","useContext","DataProviderContext","createContainer","setCreateContainer"],"mappings":"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"}