import e,{useState as t,useMemo as r,useEffect as n}from"react";import{useResourceDefinition as o,ShowButton as a,EditButton as s,useLocale as l,useTranslate as i,useInput as u,FieldTitle as c,InputHelperText as f,useListContext as p}from"react-admin";import{Typography as b,makeStyles as m,TextField as g,Grid as h,useMediaQuery as d,Box as y,Drawer as v,IconButton as O}from"@material-ui/core";import E from"@material-ui/lab/Autocomplete";import x from"@material-ui/icons/LocationOn";import{useHistory as j,useLocation as w}from"react-router";import P from"@material-ui/core/CircularProgress";import{useMapEvents as S,Marker as A,Popup as C,Polyline as T,MapContainer as z,TileLayer as k}from"react-leaflet";import I from"react-leaflet-markercluster";import M from"@material-ui/icons/Close";var N=function(t){var r=t.record,n=t.basePath,l=o({});return e.createElement(e.Fragment,null,r.label&&e.createElement(b,{variant:"h5"},r.label),r.description&&e.createElement(b,null,r.description.length>150?r.description.substring(0,150)+"...":r.description),l.hasShow&&e.createElement(a,{basePath:n,record:r}),l.hasEdit&&e.createElement(s,{basePath:n,record:r}))},L=function(e,t){var r=e.find((function(e){return e.id.startsWith(t+".")}));if(r)return r.text};function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach((function(t){B(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function B(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function R(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,o,a=[],s=!0,l=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);s=!0);}catch(e){l=!0,o=e}finally{try{s||null==r.return||r.return()}finally{if(l)throw o}}return a}(e,t)||q(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(e){return function(e){if(Array.isArray(e))return Z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||q(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(e,t){if(e){if("string"==typeof e)return Z(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Z(e,t):void 0}}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var _="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var V=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){
// @license MIT
!function(t,r){e.exports?e.exports=r():this.Diacritics=r()}(0,(function(){for(var e={map:{}},t=[{base:" ",letters:" "},{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"Th",letters:"Þ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"ff",letters:"ﬀ"},{base:"fi",letters:"ﬁ"},{base:"fl",letters:"ﬂ"},{base:"ffi",letters:"ﬃ"},{base:"ffl",letters:"ﬄ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nñnⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥлԉ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"߀oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oe",letters:"Œœ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"ss",letters:"ß"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"th",letters:"þ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],r=0,n=t.length;r<n;r++)for(var o=t[r].letters.split(""),a=0,s=o.length;a<s;a++)e.map[o[a]]=t[r].base;return e.clean=function(t){if(!t||!t.length||t.length<1)return"";for(var r,n="",o=t.split(""),a=0,s=o.length;a<s;a++)n+=(r=o[a])in e.map?e.map[r]:r;return n},e}))})).clean,H=/[.*+?^${}()|[\]\\]/g,J=/[a-z0-9_]/i,Y=/\s+/;var G=function(e,t,r){var n,o;return o={insideWords:!1,findAllOccurrences:!1,requireMatchAll:!1},n=(n=r)||{},Object.keys(n).forEach((function(e){o[e]=!!n[e]})),r=o,e=V(e),(t=V(t)).trim().split(Y).filter((function(e){return e.length>0})).reduce((function(t,n){var o,a,s=n.length,l=!r.insideWords&&J.test(n[0])?"\\b":"",i=new RegExp(l+n.replace(H,"\\$&"),"i");if(o=i.exec(e),r.requireMatchAll&&null===o)return e="",[];for(;o&&(a=o.index,t.push([a,a+s]),e=e.slice(0,a)+new Array(s+1).join(" ")+e.slice(a+s),r.findAllOccurrences);)o=i.exec(e);return t}),[]).sort((function(e,t){return e[0]-t[0]}))},K=/^\s+|\s+$/g,Q=/^[-+]0x[0-9a-f]+$/i,X=/^0b[01]+$/i,ee=/^0o[0-7]+$/i,te=parseInt,re="object"==typeof _&&_&&_.Object===Object&&_,ne="object"==typeof self&&self&&self.Object===Object&&self,oe=re||ne||Function("return this")(),ae=Object.prototype.toString,se=Math.max,le=Math.min,ie=function(){return oe.Date.now()};function ue(e,t,r){var n,o,a,s,l,i,u=0,c=!1,f=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function b(t){var r=n,a=o;return n=o=void 0,u=t,s=e.apply(a,r)}function m(e){return u=e,l=setTimeout(h,t),c?b(e):s}function g(e){var r=e-i;return void 0===i||r>=t||r<0||f&&e-u>=a}function h(){var e=ie();if(g(e))return d(e);l=setTimeout(h,function(e){var r=t-(e-i);return f?le(r,a-(e-u)):r}(e))}function d(e){return l=void 0,p&&n?b(e):(n=o=void 0,s)}function y(){var e=ie(),r=g(e);if(n=arguments,o=this,i=e,r){if(void 0===l)return m(i);if(f)return l=setTimeout(h,t),b(i)}return void 0===l&&(l=setTimeout(h,t)),s}return t=fe(t)||0,ce(r)&&(c=!!r.leading,a=(f="maxWait"in r)?se(fe(r.maxWait)||0,t):a,p="trailing"in r?!!r.trailing:p),y.cancel=function(){void 0!==l&&clearTimeout(l),u=0,n=i=o=l=void 0},y.flush=function(){return void 0===l?s:d(ie())},y}function ce(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function fe(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==ae.call(e)}(e))return NaN;if(ce(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ce(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(K,"");var r=X.test(e);return r||ee.test(e)?te(e.slice(2),r?2:8):Q.test(e)?NaN:+e}var pe=function(e,t,r){var n=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return ce(r)&&(n="leading"in r?!!r.leading:n,o="trailing"in r?!!r.trailing:o),ue(e,t,{leading:n,maxWait:t,trailing:o})},be=["mapboxConfig","record","resource","source","label","basePath","parse","optionText","helperText"],me=m((function(e){return{icon:{color:e.palette.text.secondary,marginRight:e.spacing(2)}}})),ge=function(e,t){return e.place_name?e.place_name:"string"==typeof t?e[t]:"function"==typeof t?t(e):void 0},he=function(o){var a=o.mapboxConfig;o.record;var s=o.resource,p=o.source,m=o.label;o.basePath;var d=o.parse,y=o.optionText,v=o.helperText,O=R(o,be);if(!a)throw new Error("@semapps/geo-components : No mapbox configuration");if(!a.access_token)throw new Error("@semapps/geo-components : No access token in mapbox configuration");var j=me(),w=l(),P=i(),S=U(t(""),2),A=S[0],C=S[1],T=U(t([]),2),z=T[0],k=T[1],I=u(W({resource:s,source:p},O)),M=I.input,N=M.value,L=M.onChange,D=M.onBlur,B=M.onFocus,q=I.isRequired,Z=I.meta,_=Z.error,V=Z.submitError,H=Z.touched,J=r((function(){return pe((function(e,t){var r=new URL("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e,".json"));a.language||(a.language=w),Object.entries(a).forEach((function(e){var t=U(e,2),n=t[0],o=t[1];Array.isArray(o)?o=o.join(","):"boolean"==typeof o&&(o=o?"true":"false"),r.searchParams.set(n,o)})),fetch(r.toString()).then((function(e){return e.json()})).then((function(e){return t(e)}))}),200)}),[a,w]);return n((function(){A&&A!==ge(N,y)&&J(A,(function(e){return k(e.features)}))}),[N,A,J]),e.createElement(E,{autoComplete:!0,value:N||null,options:N?[N].concat($(z)):z,filterSelectedOptions:!0,filterOptions:function(e){return e},getOptionLabel:function(e){return ge(e,y)},getOptionSelected:function(e,t){return ge(e,y)===ge(t,y)},onChange:function(e,t){t&&d&&(t=d(t)),L(t),k([])},onInputChange:function(e,t){return C(t)},noOptionsText:P("ra.navigation.no_results"),renderInput:function(t){return t.inputProps.autoComplete="new-password",e.createElement(g,F({},t,{inputProps:W(W({},t.inputProps),{},{onBlur:function(e){D(e),t.inputProps.onBlur&&t.inputProps.onBlur(e)},onFocus:function(e){B(e),t.inputProps.onFocus&&t.inputProps.onFocus(e)}}),label:""!==m&&!1!==m&&e.createElement(c,{label:m,source:p,resource:s,isRequired:q}),error:!(!H||!_&&!V),helperText:e.createElement(f,{touched:H,error:_||V,helperText:v})},O))},renderOption:function(t){var r=G(t.text,A),n=function(e,t){var r=[];return 0===t.length?r.push({text:e,highlight:!1}):t[0][0]>0&&r.push({text:e.slice(0,t[0][0]),highlight:!1}),t.forEach((function(n,o){var a=n[0],s=n[1];r.push({text:e.slice(a,s),highlight:!0}),o===t.length-1?s<e.length&&r.push({text:e.slice(s,e.length),highlight:!1}):s<t[o+1][0]&&r.push({text:e.slice(s,t[o+1][0]),highlight:!1})})),r}(t.text,r);return e.createElement(h,{container:!0,alignItems:"center"},e.createElement(h,{item:!0},e.createElement(x,{className:j.icon})),e.createElement(h,{item:!0,xs:!0},"string"==typeof n?n:n.map((function(t,r){return e.createElement("span",{key:r,style:{fontWeight:t.highlight?700:400}},t.text)})),e.createElement(b,{variant:"body2",color:"textSecondary"},t.place_name)))}})};he.defaultProps={variant:"filled",margin:"dense"};var de=function(){var e=j(),t=new URLSearchParams(e.location.search);return S({moveend:function(r){t.set("lat",r.target.getCenter().lat),t.set("lng",r.target.getCenter().lng),e.replace({pathname:e.location.pathname,search:"?"+t.toString()})},zoomend:function(r){t.set("zoom",r.target.getZoom()),e.replace({pathname:e.location.pathname,search:"?"+t.toString()})}}),null},ye=["latitude","longitude","label","description","popupContent","height","center","zoom","groupClusters","boundToMarkers","connectMarkers"],ve=m((function(){return{loading:{zIndex:1e3,position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center"},closeButton:{position:"absolute",zIndex:1400,top:0,right:0}}})),Oe=function(r){var n,o=r.latitude,a=r.longitude,s=r.label,l=r.description,i=r.popupContent,u=r.height,c=r.center,f=r.zoom,b=r.groupClusters,m=r.boundToMarkers,g=r.connectMarkers,h=R(r,ye),E=p(),x=E.ids,j=E.data,S=E.basePath,N=E.loading,L=d((function(e){return e.breakpoints.down("xs")}),{noSsr:!0}),D=U(t(null),2),B=D[0],$=D[1],q=U(t(null),2),Z=q[0],_=q[1],V=ve(),H=new URLSearchParams(w().search);c=H.has("lat")&&H.has("lng")?[H.get("lat"),H.get("lng")]:c,f=H.has("zoom")?H.get("zoom"):f;var J=x.map((function(e){return W(W({},j[e]),{},{latitude:o&&o(j[e]),longitude:a&&a(j[e]),label:s&&s(j[e]),description:l&&l(j[e])})})).filter((function(e){return e.latitude&&e.longitude})),Y=m&&J.length>0?J.map((function(e){return[e.latitude,e.longitude]})):void 0;if(m&&!Y)return null;var G=J.map((function(t,r){var o=e.createElement(e.Fragment,{key:r},e.createElement(A,{position:[t.latitude,t.longitude],eventHandlers:L?{click:function(){Z.setView([t.latitude,t.longitude]),$(t)}}:void 0},!L&&e.createElement(C,null,e.createElement(i,{record:t,basePath:S}))),g&&n&&e.createElement(T,{positions:[[n.latitude,n.longitude],[t.latitude,t.longitude]]}));return n=t,o}));return e.createElement(z,F({style:{height:u},center:m?void 0:c,zoom:m?void 0:f,bounds:Y,whenCreated:_},h),e.createElement(k,{attribution:'© <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),N&&e.createElement(y,{alignItems:"center",className:V.loading},e.createElement(P,{size:60,thickness:6})),b?e.createElement(I,{showCoverageOnHover:!1},G):G,e.createElement(de,null),e.createElement(v,{anchor:"bottom",open:!!B,onClose:function(){return $(null)}},e.createElement(y,{p:1,position:"relative"},e.createElement(O,{onClick:function(){return $(null)},className:V.closeButton},e.createElement(M,null)),B&&e.createElement(i,{record:B,basePath:S}))))};Oe.defaultProps={height:700,center:[47,2.213749],zoom:6,groupClusters:!0,connectMarkers:!1,scrollWheelZoom:!1,popupContent:N};var Ee=["record","latitude","longitude","address","height","addLabel","typographyProps"],xe=m((function(e){return{address:{marginTop:e.spacing(2),marginBottom:e.spacing(1)}}})),je=function(t){var r=t.record,n=t.latitude,o=t.longitude,a=t.address,s=t.height;t.addLabel;var l=t.typographyProps,i=R(t,Ee);xe();var u=[n(r),o(r)];return u[0]&&u[1]?e.createElement(y,null,a&&e.createElement(y,{mt:1,mb:1},e.createElement(b,l,a(r))),e.createElement(z,F({style:{height:s},center:u},i),e.createElement(k,{attribution:'© <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.createElement(A,{position:u}))):null};je.defaultProps={height:400,zoom:11,addLabel:!0};export{N as DefaultPopupContent,he as LocationInput,je as MapField,Oe as MapList,de as QueryStringUpdater,L as extractContext};
//# sourceMappingURL=index.es.js.map
