import e,{useEffect as t,createElement as r,cloneElement as n,Children as a}from"react";import{getResources as o,Notification as l,TopToolbar as i,ListButton as c,Create as s,ShowButton as m,Edit as u,CreateButton as d,ExportButton as p,RefreshButton as h,List as f,Pagination as E,SimpleList as b,useListContext as g,linkToRecord as v,ImageField as y,EditButton as P,Show as x}from"react-admin";import{Grid as w,Button as L,TextField as k,Select as N,MenuItem as C,makeStyles as S,Box as B,Container as I,Hidden as O,useMediaQuery as T,ThemeProvider as R,createMuiTheme as F,Tabs as U,Tab as W,Typography as j,CircularProgress as V}from"@material-ui/core";import{useHistory as M,useLocation as H,Link as z}from"react-router-dom";import{Form as A,Field as G}from"react-final-form";import{useSelector as _,shallowEqual as D}from"react-redux";import{useHistory as q,useLocation as J}from"react-router";import{createMuiTheme as K,ThemeProvider as Q}from"@material-ui/core/styles";import X from"react-markdown";function Y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Z(){return(Z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function $(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var ee=function(t){var r=t.input,n=$(t,["input"]);return e.createElement(k,Z({},r,n))},te=function(t){var r=t.input,n=$(t,["input"]),a=_(o,D);return e.createElement(N,Z({},r,n),a.filter((function(e){return e.hasList})).map((function(t){return e.createElement(C,{value:t.name,key:t.name},t.options.label)})))},re=function(){var t=M(),r=H().pathname.match(/^\/([^/]+)/),n=r?r[1]:"Organization";return e.createElement(A,{onSubmit:function(e){var r=e.filter,n=e.type;r?t.push("/".concat(n,"?filter=").concat(encodeURIComponent('{"q": "'.concat(r,'"}')))):t.push("/".concat(n))},initialValues:{type:n},render:function(t){var r=t.handleSubmit;return e.createElement("form",{onSubmit:r},e.createElement(w,{container:!0,spacing:2},e.createElement(w,{item:!0,xs:5},e.createElement(G,{name:"filter",component:ee,placeholder:"Rechercher...",fullWidth:!0})),e.createElement(w,{item:!0,xs:5},e.createElement(G,{name:"type",component:te,fullWidth:!0})),e.createElement(w,{item:!0,xs:2},e.createElement(L,{variant:"outlined",type:"submit",fullWidth:!0},"Hop"))))}})},ne=S((function(e){return{header:{position:"relative",height:65},logo:Y({position:"absolute",top:-15,height:110,width:110},e.breakpoints.down("xs"),{position:"relative",top:0,width:65,height:65})}})),ae=function(t){var r=t.userMenu,n=t.logout,a=ne();return e.createElement(B,{bgcolor:"primary.main"},e.createElement(I,{maxWidth:"lg",className:a.header},e.createElement(w,{container:!0},e.createElement(w,{item:!0,xs:12,sm:r?3:6},e.createElement(z,{to:"/"},e.createElement("img",{src:process.env.PUBLIC_URL+"/logo192.png",alt:"SemApps",className:a.logo}))),e.createElement(O,{xsDown:!0},e.createElement(w,{item:!0,sm:6},e.createElement(B,{pt:2},e.createElement(re,null)))),r&&e.createElement(w,{item:!0,sm:3,align:"right"},e.createElement(B,{pt:2},e.cloneElement(r,{logout:n}))))))},oe=function(){var e=H().pathname;return t((function(){window.scrollTo(0,0)}),[e]),null},le=function(t){var r=t.appBar,n=t.logout,a=t.theme,o=t.children,i=T(a.breakpoints.down("xs"));return e.createElement(R,{theme:a},e.createElement(oe,null),e.cloneElement(r,{logout:n}),e.createElement(I,{maxWidth:"lg",disableGutters:i},e.createElement(B,{mb:{xs:0,sm:5}},o)),e.createElement(l,null))};le.defaultProps={appBar:e.createElement(ae,null)};var ie=F(),ce=F({palette:{primary:{main:"#28ccfb"},secondary:{main:"#bcef5b"},grey:{main:"#e0e0e0"}},typography:{details:{fontSize:8}},overrides:{RaChipField:{chip:{marginLeft:0,marginTop:0,marginRight:8,marginBottom:8}},RaShow:{card:Y({padding:25},ie.breakpoints.down("xs"),{padding:15})},RaList:{content:Y({padding:25},ie.breakpoints.down("xs"),{padding:15})},RaListToolbar:{toolbar:Y({},ie.breakpoints.down("xs"),{height:0,minHeight:0})},RaSingleFieldList:{root:{marginTop:0,marginBottom:0}},MuiTab:{labelIcon:{paddingTop:0}}}}),se=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=$(t,["basePath","className","data","hasList"]);return e.createElement(i,Z({className:n},l),o&&e.createElement(c,{basePath:r,record:a}))},me=function(t){return e.createElement(s,Z({actions:e.createElement(se,null),redirect:"show"},t))},ue=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=t.hasShow,s=$(t,["basePath","className","data","hasList","hasShow"]);return e.createElement(i,Z({className:n},s),o&&e.createElement(c,{basePath:r,record:a}),l&&e.createElement(m,{basePath:r,record:a}))},de=function(t){return e.createElement(u,Z({actions:e.createElement(ue,null)},t))},pe=S((function(e){return{tab:{minWidth:55}}})),he=function(){var t=q(),r=pe(),n=J().pathname.match(/^\/([^/]+)/),a=n?n[1]:null,l=_(o,D),i=T((function(e){return e.breakpoints.down("xs")}));return e.createElement(U,{value:a,onChange:function(e,r){return t.push("/"+r)},indicatorColor:"primary",textColor:"primary",scrollButtons:"auto"},l.filter((function(e){return e.hasList})).map((function(t){return e.createElement(W,{key:t.name,icon:e.createElement(t.icon),label:i?void 0:t.options.label,value:t.name,className:r.tab})})))},fe=function(t){var r=t.bulkActions,n=t.basePath,a=t.currentSort,l=t.displayedFilters,c=t.exporter,s=t.filters,m=t.filterValues,u=t.onUnselectItems,f=t.resource,E=t.selectedIds,b=t.showFilter,g=t.total,v=T((function(e){return e.breakpoints.down("xs")})),y=_(o,D).filter((function(e){return e.name==f}))[0];return e.createElement(i,null,r&&e.cloneElement(r,{basePath:n,filterValues:m,resource:f,selectedIds:E,onUnselectItems:u}),s&&e.cloneElement(s,{resource:f,showFilter:b,displayedFilters:l,filterValues:m,context:"button"}),y.hasCreate&&e.createElement(d,{basePath:n}),!v&&e.createElement(p,{disabled:0===g,resource:f,sort:a,filter:m,exporter:c}),!v&&e.createElement(h,null))},Ee=function(t){return e.createElement(E,Z({rowsPerPageOptions:[25,50,100]},t))},be=function(t){var r=t.children,n=$(t,["children"]);return e.createElement(f,Z({actions:e.createElement(fe,null),sort:{field:"pair:label",order:"DESC"},pagination:e.createElement(Ee,null),perPage:50},n),e.createElement(e.Fragment,null,e.createElement(he,null),r))},ge=K({overrides:{MuiListItem:{root:{padding:15,paddingBottom:15,paddingTop:15,marginBottom:10,borderStyle:"solid",borderColor:"#e0e0e0",borderWidth:1}}}}),ve=function(t){return e.createElement(Q,{theme:ge},e.createElement(b,t))},ye=S((function(){return{rightLabel:{color:"grey",textAlign:"right",borderBottom:"1px dashed #c0c0c0",paddingBottom:10,marginBottom:10}}})),Pe=function(t){var r=t.label,n=t.children,a=t.record,o=t.resource,l=t.source,i=t.basePath,c=ye();return a[l]?e.createElement(B,{mb:4},e.createElement(B,{className:c.rightLabel},r),e.createElement(B,{m:0},e.cloneElement(n,{record:a,resource:o,basePath:i}))):null},xe=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=t.showLabel,i=$(t,["basePath","children","record","resource","showLabel"]);return e.createElement(w,Z({item:!0},i),e.Children.map(n,(function(t){return t&&e.isValidElement(t)?e.createElement("div",{key:t.props.source},t.props.addLabel&&l?e.createElement(Pe,{record:a,resource:o,basePath:r,label:t.props.label,source:t.props.source,disabled:!1},t):"string"==typeof t.type?t:e.cloneElement(t,{record:a,resource:o,basePath:r})):null})))},we=S((function(){return{root:{flexGrow:1}}})),Le=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=we();return e.createElement("div",{className:l.root},e.createElement(w,{container:!0,spacing:5},e.Children.map(n,(function(t){return t&&e.isValidElement(t)?e.cloneElement(t,{resource:o,record:a,basePath:r}):null}))))},ke=function(e){return e.stopPropagation()},Ne=function(){},Ce=function(e){var t=e.children,o=e.xs,l=e.linkType,i=g(),c=i.ids,s=i.data,m=i.basePath;return r(w,{container:!0,spacing:3},c.map((function(e){return r(w,{item:!0,xs:o,key:e},r(z,{to:v(m,e,l),onClick:ke},n(a.only(t),{record:s[e],basePath:m,onClick:Ne})))})))};Ce.defaultProps={xs:6,linkType:"edit"};var Se=S((function(){return{line:{borderBottom:"1px solid #e0e0e0",marginTop:-6,marginBottom:7}}})),Be=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=Se();return e.createElement(B,null,e.Children.map(n,(function(t){return t&&a[t.props.source]&&e.isValidElement(t)?e.createElement("div",{key:t.props.source},t.props.addLabel?e.createElement(w,{container:!0,spacing:3,className:l.line},e.createElement(w,{item:!0,xs:3},e.createElement(j,{color:"textSecondary",align:"right",variant:"body2"},t.props.label)),e.createElement(w,{item:!0,xs:9},e.createElement(j,{variant:"body2"},e.cloneElement(t,{record:a,resource:o,basePath:r})))):"string"==typeof t.type?t:e.cloneElement(t,{record:a,resource:o,basePath:r})):null})))},Ie=S((function(){return{loader:{width:"100%",backgroundColor:"#e0e0e0",paddingTop:100,paddingBottom:100},image:{width:"100%",maxHeight:"none"}}})),Oe=function(t){var r=t.record,n=t.source,a=t.defaultImage,o=$(t,["record","source","defaultImage"]),l=Ie();if(r[n]){if(r[n].rawFile instanceof File)return e.createElement(B,{align:"center",className:l.loader},e.createElement(V,null))}else r[n]=a;return e.createElement(y,Z({record:r,source:n,classes:{image:l.image}},o))},Te=S((function(){return{root:{flexGrow:1}}})),Re=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=t.title,i=t.image,c=t.defaultImage,s=Te();return e.createElement("div",{className:s.root},e.createElement(B,null,e.createElement(j,{variant:"h3",color:"primary",paragraph:!0},e.cloneElement(l,{record:a}))),e.createElement(w,{container:!0,spacing:5},e.createElement(w,{item:!0,xs:12,sm:5},e.createElement(Oe,{record:a,source:i,defaultImage:c,title:l})),e.createElement(w,{item:!0,xs:12,sm:7},e.createElement(Be,{record:a,resource:o,basePath:r},n))))};Re.defaultProps={defaultImage:process.env.PUBLIC_URL+"/logo192.png"};var Fe=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=t.hasEdit,s=$(t,["basePath","className","data","hasList","hasEdit"]);return e.createElement(i,Z({className:n},s),o&&e.createElement(c,{basePath:r,record:a}),l&&e.createElement(P,{basePath:r,record:a}))},Ue=function(t){return e.createElement(x,Z({actions:e.createElement(Fe,null)},t))},We=S((function(){return{parent:{position:"relative"},child:{position:"absolute",bottom:0,left:0,right:0,paddingTop:2,paddingBottom:2,paddingLeft:6,paddingRight:6},caption:{color:"black",fontSize:13}}})),je=function(t){var r=t.record,n=We(),a=r?r["pair:firstName"]+" "+r["pair:lastName"]:"";return e.createElement(B,{className:n.parent},e.createElement("img",{src:process.env.PUBLIC_URL+"/unknown-user.png",style:{width:"100%"},alt:a}),e.createElement(B,{bgcolor:"secondary.main",className:n.child,borderRadius:7},e.createElement(j,{align:"center",className:n.caption,noWrap:!0},a)))},Ve=function(t){var r=t.source,n=t.record;return n&&n[r]?e.createElement(X,{source:n[r]}):null};export{ae as AppBar,xe as Column,Le as ColumnShowLayout,me as Create,se as CreateActions,de as Edit,ue as EditActions,Ce as GridList,Re as Hero,le as Layout,be as List,Ve as MarkdownField,he as ResourceTabs,Ue as Show,Fe as ShowActions,ve as SimpleList,je as UserIcon,ce as theme};
