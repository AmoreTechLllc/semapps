import e,{useEffect as t,createElement as r,cloneElement as n,Children as a,useState as o}from"react";import{getResources as l,Notification as i,TopToolbar as c,ListButton as s,Create as u,ShowButton as m,Edit as d,CreateButton as p,ExportButton as f,RefreshButton as h,List as b,Pagination as E,SimpleList as g,useListContext as v,Link as y,linkToRecord as P,useTranslate as w,getFieldLabelTranslationArgs as x,ImageField as k,EditButton as L,Show as N,sanitizeListRestProps as S,useCreate as C,useNotify as I,ReferenceInput as T,Button as B,FormWithRedirect as O,TextInput as R,required as j,SaveButton as A}from"react-admin";import{Grid as W,Button as F,TextField as U,Select as V,MenuItem as M,makeStyles as H,Box as z,Container as G,Hidden as _,useMediaQuery as D,ThemeProvider as q,createMuiTheme as $,Tabs as J,Tab as K,Card as Q,CardActionArea as X,CardMedia as Y,CardContent as Z,Typography as ee,CircularProgress as te,LinearProgress as re,Dialog as ne,DialogTitle as ae,DialogContent as oe,DialogActions as le}from"@material-ui/core";import{useHistory as ie,useLocation as ce,Link as se}from"react-router-dom";import{Form as ue,Field as me,useForm as de}from"react-final-form";import{useSelector as pe,shallowEqual as fe}from"react-redux";import{useHistory as he,useLocation as be}from"react-router";import{createMuiTheme as Ee,ThemeProvider as ge,makeStyles as ve}from"@material-ui/core/styles";import ye from"react-masonry-css";import Pe from"react-markdown";import we from"classnames";import xe from"@material-ui/icons/Add";import ke from"@material-ui/icons/Cancel";function Le(e,t,r,n,a,o,l){try{var i=e[o](l),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,a)}function Ne(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Se(){return(Se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Ce(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function Ie(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(n=(l=i.next()).done)&&(r.push(l.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw o}}return r}(e,t)||Be(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Te(e){return function(e){if(Array.isArray(e))return Oe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Be(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Be(e,t){if(e){if("string"==typeof e)return Oe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Oe(e,t):void 0}}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Re=function(t){var r=t.input,n=Ce(t,["input"]);return e.createElement(U,Se({},r,n))},je=function(t){var r=t.input,n=Ce(t,["input"]),a=pe(l,fe);return e.createElement(V,Se({},r,n),a.filter((function(e){return e.hasList})).map((function(t){return e.createElement(M,{value:t.name,key:t.name},t.options.label)})))},Ae=function(){var t=ie(),r=ce().pathname.match(/^\/([^/]+)/),n=r?r[1]:"Organization";return e.createElement(ue,{onSubmit:function(e){var r=e.filter,n=e.type;r?t.push("/".concat(n,"?filter=").concat(encodeURIComponent('{"q": "'.concat(r,'"}')))):t.push("/".concat(n))},initialValues:{type:n},render:function(t){var r=t.handleSubmit;return e.createElement("form",{onSubmit:r},e.createElement(W,{container:!0,spacing:2},e.createElement(W,{item:!0,xs:5},e.createElement(me,{name:"filter",component:Re,placeholder:"Rechercher...",fullWidth:!0})),e.createElement(W,{item:!0,xs:5},e.createElement(me,{name:"type",component:je,fullWidth:!0})),e.createElement(W,{item:!0,xs:2},e.createElement(F,{variant:"outlined",type:"submit",fullWidth:!0},"Hop"))))}})},We=H((function(e){return{header:{position:"relative",height:65},logo:Ne({position:"absolute",top:-15,height:110,width:110},e.breakpoints.down("xs"),{position:"relative",top:0,width:65,height:65})}})),Fe=function(t){var r=t.userMenu,n=t.logout,a=We();return e.createElement(z,{bgcolor:"primary.main"},e.createElement(G,{maxWidth:"lg",className:a.header},e.createElement(W,{container:!0},e.createElement(W,{item:!0,xs:12,sm:r?3:6},e.createElement(se,{to:"/"},e.createElement("img",{src:process.env.PUBLIC_URL+"/logo192.png",alt:"SemApps",className:a.logo}))),e.createElement(_,{xsDown:!0},e.createElement(W,{item:!0,sm:6},e.createElement(z,{pt:2},e.createElement(Ae,null)))),r&&e.createElement(W,{item:!0,sm:3,align:"right"},e.createElement(z,{pt:2},e.cloneElement(r,{logout:n}))))))},Ue=function(){var e=ce().pathname;return t((function(){window.scrollTo(0,0)}),[e]),null},Ve=function(t){var r=t.appBar,n=t.logout,a=t.theme,o=t.children,l=D(a.breakpoints.down("xs"));return e.createElement(q,{theme:a},e.createElement(Ue,null),e.cloneElement(r,{logout:n}),e.createElement(G,{maxWidth:"lg",disableGutters:l},e.createElement(z,{mb:{xs:0,sm:5}},o)),e.createElement(i,null))};Ve.defaultProps={appBar:e.createElement(Fe,null)};var Me=$(),He=$({palette:{primary:{main:"#28ccfb"},secondary:{main:"#bcef5b"},grey:{main:"#e0e0e0"}},typography:{details:{fontSize:8}},overrides:{RaChipField:{chip:{marginLeft:0,marginTop:0,marginRight:8,marginBottom:8}},RaShow:{card:Ne({padding:25},Me.breakpoints.down("xs"),{padding:15})},RaList:{content:Ne({padding:25},Me.breakpoints.down("xs"),{padding:15})},RaListToolbar:{toolbar:Ne({},Me.breakpoints.down("xs"),{height:0,minHeight:0})},RaSingleFieldList:{root:{marginTop:0,marginBottom:0}},MuiTab:{labelIcon:{paddingTop:0}}}}),ze=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=Ce(t,["basePath","className","data","hasList"]);return e.createElement(c,Se({className:n},l),o&&e.createElement(s,{basePath:r,record:a}))},Ge=function(t){return e.createElement(u,Se({actions:e.createElement(ze,null),redirect:"show"},t))},_e=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=t.hasShow,i=Ce(t,["basePath","className","data","hasList","hasShow"]);return e.createElement(c,Se({className:n},i),o&&e.createElement(s,{basePath:r,record:a}),l&&e.createElement(m,{basePath:r,record:a}))},De=function(t){return e.createElement(d,Se({actions:e.createElement(_e,null)},t))},qe=H((function(e){return{tab:{minWidth:55}}})),$e=function(){var t=he(),r=qe(),n=be().pathname.match(/^\/([^/]+)/),a=n?n[1]:null,o=pe(l,fe),i=D((function(e){return e.breakpoints.down("xs")}));return e.createElement(J,{value:a,onChange:function(e,r){return t.push("/"+r)},indicatorColor:"primary",textColor:"primary",scrollButtons:"auto"},o.filter((function(e){return e.hasList})).map((function(t){return e.createElement(K,{key:t.name,icon:e.createElement(t.icon),label:i?void 0:t.options.label,value:t.name,className:r.tab})})))},Je=function(t){var r=t.bulkActions,n=t.basePath,a=t.currentSort,o=t.displayedFilters,i=t.exporter,s=t.filters,u=t.filterValues,m=t.onUnselectItems,d=t.resource,b=t.selectedIds,E=t.showFilter,g=t.total,v=D((function(e){return e.breakpoints.down("xs")})),y=pe(l,fe).filter((function(e){return e.name==d}))[0];return e.createElement(c,null,r&&e.cloneElement(r,{basePath:n,filterValues:u,resource:d,selectedIds:b,onUnselectItems:m}),s&&e.cloneElement(s,{resource:d,showFilter:E,displayedFilters:o,filterValues:u,context:"button"}),y.hasCreate&&e.createElement(p,{basePath:n}),!v&&e.createElement(f,{disabled:0===g,resource:d,sort:a,filter:u,exporter:i}),!v&&e.createElement(h,null))},Ke=function(t){return e.createElement(E,Se({rowsPerPageOptions:[25,50,100]},t))},Qe=function(t){var r=t.children,n=Ce(t,["children"]);return e.createElement(b,Se({actions:e.createElement(Je,null),sort:{field:"pair:label",order:"DESC"},pagination:e.createElement(Ke,null),perPage:50},n),e.createElement(e.Fragment,null,e.createElement($e,null),r))},Xe=Ee({overrides:{MuiListItem:{root:{padding:15,paddingBottom:15,paddingTop:15,marginBottom:10,borderStyle:"solid",borderColor:"#e0e0e0",borderWidth:1}}}}),Ye=function(t){return e.createElement(ge,{theme:Xe},e.createElement(g,t))},Ze=H((function(){return{grid:{display:"flex",marginLeft:-20,width:"auto"},column:{paddingLeft:20,backgroundClip:"padding-box"},card:{marginBottom:20},media:{height:0,paddingTop:"56.25%"}}})),et=function(t){var r=t.image,n=t.content,a=t.breakpointCols,o=t.linkType,l=Ze(),i=v(),c=i.ids,s=i.data,u=i.basePath;return e.createElement(ye,{breakpointCols:a,className:l.grid,columnClassName:l.column},c.map((function(t){var a="function"==typeof r?r(s[t]):r;return e.createElement(Q,{key:t,className:l.card},e.createElement(y,{to:P(u,t)+"/"+o},e.createElement(X,null,a&&e.createElement(Y,{className:l.media,image:a}),n&&e.createElement(Z,null,n(s[t])))))})))};et.defaultProps={breakpointCols:{default:3,900:2,450:1},linkType:"edit"};var tt=H((function(){return{rightLabel:{color:"grey",textAlign:"right",borderBottom:"1px dashed #c0c0c0",paddingBottom:10,marginBottom:10}}})),rt=function(t){var r=t.label,n=t.children,a=t.record,o=t.resource,l=t.source,i=t.basePath,c=tt(),s=w();return a[l]?e.createElement(z,{mb:4},e.createElement(z,{className:c.rightLabel},s.apply(void 0,Te(x({label:r,resource:o,source:l})))),e.createElement(z,{m:0},e.cloneElement(n,{record:a,resource:o,basePath:i}))):null},nt=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=t.showLabel,i=Ce(t,["basePath","children","record","resource","showLabel"]);return e.createElement(W,Se({item:!0},i),e.Children.map(n,(function(t){return t&&e.isValidElement(t)?e.createElement("div",{key:t.props.source},t.props.addLabel&&l?e.createElement(rt,{record:a,resource:o,basePath:r,label:t.props.label,source:t.props.source,disabled:!1},t):"string"==typeof t.type?t:e.cloneElement(t,{record:a,resource:o,basePath:r})):null})))},at=H((function(){return{root:{flexGrow:1}}})),ot=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=at();return e.createElement("div",{className:l.root},e.createElement(W,{container:!0,spacing:5},e.Children.map(n,(function(t){return t&&e.isValidElement(t)?e.cloneElement(t,{resource:o,record:a,basePath:r}):null}))))},lt=function(e){return e.stopPropagation()},it=function(){},ct=function(e){var t=e.children,o=e.xs,l=e.linkType,i=v(),c=i.ids,s=i.data,u=i.basePath;return r(W,{container:!0,spacing:3},c.map((function(e){return r(W,{item:!0,xs:o,key:e},r(se,{to:P(u,e,l),onClick:lt},n(a.only(t),{record:s[e],basePath:u,onClick:it})))})))};ct.defaultProps={xs:6,linkType:"edit"};var st=H((function(){return{line:{borderBottom:"1px solid #e0e0e0",marginTop:-6,marginBottom:7}}})),ut=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=st(),i=w();return e.createElement(z,null,e.Children.map(n,(function(t){return t&&a[t.props.source]&&e.isValidElement(t)?e.createElement("div",{key:t.props.source},t.props.addLabel?e.createElement(W,{container:!0,spacing:3,className:l.line},e.createElement(W,{item:!0,xs:3},e.createElement(ee,{color:"textSecondary",align:"right",variant:"body2"},i.apply(void 0,Te(x({label:t.props.label,resource:o,source:t.props.source}))))),e.createElement(W,{item:!0,xs:9},e.createElement(ee,{variant:"body2"},e.cloneElement(t,{record:a,resource:o,basePath:r})))):"string"==typeof t.type?t:e.cloneElement(t,{record:a,resource:o,basePath:r})):null})))},mt=H((function(){return{loader:{width:"100%",backgroundColor:"#e0e0e0",paddingTop:100,paddingBottom:100},image:{width:"100%",maxHeight:"none"}}})),dt=function(t){var r=t.record,n=t.source,a=t.defaultImage,o=Ce(t,["record","source","defaultImage"]),l=mt();if(r[n]){if(r[n].rawFile instanceof File)return e.createElement(z,{align:"center",className:l.loader},e.createElement(te,null))}else r[n]=a;return e.createElement(k,Se({record:r,source:n,classes:{image:l.image}},o))},pt=H((function(){return{root:{flexGrow:1}}})),ft=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=t.title,i=t.image,c=t.defaultImage,s=pt();return e.createElement("div",{className:s.root},e.createElement(z,null,e.createElement(ee,{variant:"h3",color:"primary",paragraph:!0},e.cloneElement(l,{record:a}))),e.createElement(W,{container:!0,spacing:5},e.createElement(W,{item:!0,xs:12,sm:5},e.createElement(dt,{record:a,source:i,defaultImage:c,title:l})),e.createElement(W,{item:!0,xs:12,sm:7},e.createElement(ut,{record:a,resource:o,basePath:r},n))))};ft.defaultProps={defaultImage:process.env.PUBLIC_URL+"/logo192.png"};var ht=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=t.hasEdit,i=Ce(t,["basePath","className","data","hasList","hasEdit"]);return e.createElement(c,Se({className:n},i),o&&e.createElement(s,{basePath:r,record:a}),l&&e.createElement(L,{basePath:r,record:a}))},bt=function(t){return e.createElement(N,Se({actions:e.createElement(ht,null)},t))},Et=H((function(){return{parent:{position:"relative"},image:{width:"100%",borderRadius:"50%"},child:{position:"absolute",bottom:0,left:0,right:0,paddingTop:2,paddingBottom:2,paddingLeft:6,paddingRight:6},caption:{color:"black",fontSize:13}}})),gt=function(t){var r=t.record,n=Et(),a=r?r["pair:firstName"]+" "+r["pair:lastName"]:"";return e.createElement(z,{className:n.parent},e.createElement("img",{src:r&&r.image||process.env.PUBLIC_URL+"/unknown-user.png",className:n.image,alt:a}),e.createElement(z,{bgcolor:"secondary.main",className:n.child,borderRadius:7},e.createElement(ee,{align:"center",className:n.caption,noWrap:!0},a)))},vt=function(t){var r=t.source,n=t.record;return n&&n[r]?e.createElement(Pe,{source:n[r]}):null},yt=ve((function(e){return{root:{display:"flex",flexWrap:"wrap"},link:{}}})),Pt=function(e){return e.stopPropagation()},wt=function(){},xt=function(e){e.classes;var t=e.className,o=e.children,l=e.linkType,i=void 0===l?"edit":l,c=e.separator,s=void 0===c?",":c,u=Ce(e,["classes","className","children","linkType","separator"]),m=v(e),d=m.ids,p=m.data,f=m.loaded,h=m.resource,b=m.basePath,E=yt(e);return!1===f?r(re,null):r("div",Se({className:we(E.root,t)},S(u)),d.map((function(e,t){var l=!!i&&P(b,e,i);return l?r("span",{key:e},r(y,{classes:E.link,to:l,onClick:Pt},n(a.only(o),{record:p[e],resource:h,basePath:b,onClick:wt})),t<d.length-1&&s+" "):n(a.only(o),{key:e,record:p[e],resource:h,basePath:b})})))},kt=H({root:{display:"flex",alignItems:"center"}}),Lt=function(t){var r=t.label,n=t.reference,a=t.source,l=t.children,i=kt(),c=Ie(o(!1),2),s=c[0],u=c[1],m=Ie(C(n),2),d=m[0],p=m[1].loading,f=w(),h=I(),b=de(),E=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d({payload:{data:t}},{onSuccess:function(e){var t=e.data;u(!1),b.change(a,t["@id"])},onFailure:function(e){var t=e.error;h(t.message,"error")}});case 1:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function l(e){Le(o,n,a,l,i,"next",e)}function i(e){Le(o,n,a,l,i,"throw",e)}l(void 0)}))});return function(e){return t.apply(this,arguments)}}();return e.createElement("div",{className:i.root},e.createElement(T,{label:r,reference:n,source:a},l),e.createElement(B,{onClick:function(){return u(!0)},label:"ra.action.create"},e.createElement(xe,null)),e.createElement(ne,{fullWidth:!0,open:s,onClose:function(){return u(!1)}},e.createElement(ae,null,f("ra.action.create")),e.createElement(O,{resource:n,save:E,render:function(t){var r=t.handleSubmitWithRedirect,n=t.pristine,a=t.saving;return e.createElement(e.Fragment,null,e.createElement(oe,null,e.createElement(R,{label:"Titre",source:"pair:label",validate:j(),fullWidth:!0})),e.createElement(le,null,e.createElement(B,{label:"ra.action.cancel",onClick:function(){return u(!1)},disabled:p},e.createElement(ke,null)),e.createElement(A,{handleSubmitWithRedirect:r,pristine:n,saving:a,disabled:p})))}})))};export{Fe as AppBar,nt as Column,ot as ColumnShowLayout,Ge as Create,ze as CreateActions,De as Edit,_e as EditActions,ct as GridList,ft as Hero,Ve as Layout,Qe as List,vt as MarkdownField,et as MasonryList,Lt as ReferenceQuickCreateInput,$e as ResourceTabs,xt as SeparatedListField,bt as Show,ht as ShowActions,Ye as SimpleList,gt as UserIcon,He as theme};
