import e,{useEffect as t,createElement as r,cloneElement as n,Children as a}from"react";import{getResources as o,Notification as l,TopToolbar as i,ListButton as c,Create as s,ShowButton as m,Edit as u,CreateButton as d,ExportButton as p,RefreshButton as h,List as f,Pagination as E,SimpleList as b,useListContext as g,linkToRecord as v,ImageField as y,EditButton as P,Show as x,sanitizeListRestProps as w,Link as k}from"react-admin";import{Grid as L,Button as N,TextField as C,Select as S,MenuItem as B,makeStyles as I,Box as T,Container as O,Hidden as R,useMediaQuery as F,ThemeProvider as U,createMuiTheme as W,Tabs as j,Tab as V,Typography as M,CircularProgress as H,LinearProgress as z}from"@material-ui/core";import{useHistory as A,useLocation as G,Link as _}from"react-router-dom";import{Form as D,Field as q}from"react-final-form";import{useSelector as J,shallowEqual as K}from"react-redux";import{useHistory as Q,useLocation as X}from"react-router";import{createMuiTheme as Y,ThemeProvider as Z,makeStyles as $}from"@material-ui/core/styles";import ee from"react-markdown";import te from"classnames";function re(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ne(){return(ne=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function ae(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var oe=function(t){var r=t.input,n=ae(t,["input"]);return e.createElement(C,ne({},r,n))},le=function(t){var r=t.input,n=ae(t,["input"]),a=J(o,K);return e.createElement(S,ne({},r,n),a.filter((function(e){return e.hasList})).map((function(t){return e.createElement(B,{value:t.name,key:t.name},t.options.label)})))},ie=function(){var t=A(),r=G().pathname.match(/^\/([^/]+)/),n=r?r[1]:"Organization";return e.createElement(D,{onSubmit:function(e){var r=e.filter,n=e.type;r?t.push("/".concat(n,"?filter=").concat(encodeURIComponent('{"q": "'.concat(r,'"}')))):t.push("/".concat(n))},initialValues:{type:n},render:function(t){var r=t.handleSubmit;return e.createElement("form",{onSubmit:r},e.createElement(L,{container:!0,spacing:2},e.createElement(L,{item:!0,xs:5},e.createElement(q,{name:"filter",component:oe,placeholder:"Rechercher...",fullWidth:!0})),e.createElement(L,{item:!0,xs:5},e.createElement(q,{name:"type",component:le,fullWidth:!0})),e.createElement(L,{item:!0,xs:2},e.createElement(N,{variant:"outlined",type:"submit",fullWidth:!0},"Hop"))))}})},ce=I((function(e){return{header:{position:"relative",height:65},logo:re({position:"absolute",top:-15,height:110,width:110},e.breakpoints.down("xs"),{position:"relative",top:0,width:65,height:65})}})),se=function(t){var r=t.userMenu,n=t.logout,a=ce();return e.createElement(T,{bgcolor:"primary.main"},e.createElement(O,{maxWidth:"lg",className:a.header},e.createElement(L,{container:!0},e.createElement(L,{item:!0,xs:12,sm:r?3:6},e.createElement(_,{to:"/"},e.createElement("img",{src:process.env.PUBLIC_URL+"/logo192.png",alt:"SemApps",className:a.logo}))),e.createElement(R,{xsDown:!0},e.createElement(L,{item:!0,sm:6},e.createElement(T,{pt:2},e.createElement(ie,null)))),r&&e.createElement(L,{item:!0,sm:3,align:"right"},e.createElement(T,{pt:2},e.cloneElement(r,{logout:n}))))))},me=function(){var e=G().pathname;return t((function(){window.scrollTo(0,0)}),[e]),null},ue=function(t){var r=t.appBar,n=t.logout,a=t.theme,o=t.children,i=F(a.breakpoints.down("xs"));return e.createElement(U,{theme:a},e.createElement(me,null),e.cloneElement(r,{logout:n}),e.createElement(O,{maxWidth:"lg",disableGutters:i},e.createElement(T,{mb:{xs:0,sm:5}},o)),e.createElement(l,null))};ue.defaultProps={appBar:e.createElement(se,null)};var de=W(),pe=W({palette:{primary:{main:"#28ccfb"},secondary:{main:"#bcef5b"},grey:{main:"#e0e0e0"}},typography:{details:{fontSize:8}},overrides:{RaChipField:{chip:{marginLeft:0,marginTop:0,marginRight:8,marginBottom:8}},RaShow:{card:re({padding:25},de.breakpoints.down("xs"),{padding:15})},RaList:{content:re({padding:25},de.breakpoints.down("xs"),{padding:15})},RaListToolbar:{toolbar:re({},de.breakpoints.down("xs"),{height:0,minHeight:0})},RaSingleFieldList:{root:{marginTop:0,marginBottom:0}},MuiTab:{labelIcon:{paddingTop:0}}}}),he=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=ae(t,["basePath","className","data","hasList"]);return e.createElement(i,ne({className:n},l),o&&e.createElement(c,{basePath:r,record:a}))},fe=function(t){return e.createElement(s,ne({actions:e.createElement(he,null),redirect:"show"},t))},Ee=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=t.hasShow,s=ae(t,["basePath","className","data","hasList","hasShow"]);return e.createElement(i,ne({className:n},s),o&&e.createElement(c,{basePath:r,record:a}),l&&e.createElement(m,{basePath:r,record:a}))},be=function(t){return e.createElement(u,ne({actions:e.createElement(Ee,null)},t))},ge=I((function(e){return{tab:{minWidth:55}}})),ve=function(){var t=Q(),r=ge(),n=X().pathname.match(/^\/([^/]+)/),a=n?n[1]:null,l=J(o,K),i=F((function(e){return e.breakpoints.down("xs")}));return e.createElement(j,{value:a,onChange:function(e,r){return t.push("/"+r)},indicatorColor:"primary",textColor:"primary",scrollButtons:"auto"},l.filter((function(e){return e.hasList})).map((function(t){return e.createElement(V,{key:t.name,icon:e.createElement(t.icon),label:i?void 0:t.options.label,value:t.name,className:r.tab})})))},ye=function(t){var r=t.bulkActions,n=t.basePath,a=t.currentSort,l=t.displayedFilters,c=t.exporter,s=t.filters,m=t.filterValues,u=t.onUnselectItems,f=t.resource,E=t.selectedIds,b=t.showFilter,g=t.total,v=F((function(e){return e.breakpoints.down("xs")})),y=J(o,K).filter((function(e){return e.name==f}))[0];return e.createElement(i,null,r&&e.cloneElement(r,{basePath:n,filterValues:m,resource:f,selectedIds:E,onUnselectItems:u}),s&&e.cloneElement(s,{resource:f,showFilter:b,displayedFilters:l,filterValues:m,context:"button"}),y.hasCreate&&e.createElement(d,{basePath:n}),!v&&e.createElement(p,{disabled:0===g,resource:f,sort:a,filter:m,exporter:c}),!v&&e.createElement(h,null))},Pe=function(t){return e.createElement(E,ne({rowsPerPageOptions:[25,50,100]},t))},xe=function(t){var r=t.children,n=ae(t,["children"]);return e.createElement(f,ne({actions:e.createElement(ye,null),sort:{field:"pair:label",order:"DESC"},pagination:e.createElement(Pe,null),perPage:50},n),e.createElement(e.Fragment,null,e.createElement(ve,null),r))},we=Y({overrides:{MuiListItem:{root:{padding:15,paddingBottom:15,paddingTop:15,marginBottom:10,borderStyle:"solid",borderColor:"#e0e0e0",borderWidth:1}}}}),ke=function(t){return e.createElement(Z,{theme:we},e.createElement(b,t))},Le=I((function(){return{rightLabel:{color:"grey",textAlign:"right",borderBottom:"1px dashed #c0c0c0",paddingBottom:10,marginBottom:10}}})),Ne=function(t){var r=t.label,n=t.children,a=t.record,o=t.resource,l=t.source,i=t.basePath,c=Le();return a[l]?e.createElement(T,{mb:4},e.createElement(T,{className:c.rightLabel},r),e.createElement(T,{m:0},e.cloneElement(n,{record:a,resource:o,basePath:i}))):null},Ce=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=t.showLabel,i=ae(t,["basePath","children","record","resource","showLabel"]);return e.createElement(L,ne({item:!0},i),e.Children.map(n,(function(t){return t&&e.isValidElement(t)?e.createElement("div",{key:t.props.source},t.props.addLabel&&l?e.createElement(Ne,{record:a,resource:o,basePath:r,label:t.props.label,source:t.props.source,disabled:!1},t):"string"==typeof t.type?t:e.cloneElement(t,{record:a,resource:o,basePath:r})):null})))},Se=I((function(){return{root:{flexGrow:1}}})),Be=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=Se();return e.createElement("div",{className:l.root},e.createElement(L,{container:!0,spacing:5},e.Children.map(n,(function(t){return t&&e.isValidElement(t)?e.cloneElement(t,{resource:o,record:a,basePath:r}):null}))))},Ie=function(e){return e.stopPropagation()},Te=function(){},Oe=function(e){var t=e.children,o=e.xs,l=e.linkType,i=g(),c=i.ids,s=i.data,m=i.basePath;return r(L,{container:!0,spacing:3},c.map((function(e){return r(L,{item:!0,xs:o,key:e},r(_,{to:v(m,e,l),onClick:Ie},n(a.only(t),{record:s[e],basePath:m,onClick:Te})))})))};Oe.defaultProps={xs:6,linkType:"edit"};var Re=I((function(){return{line:{borderBottom:"1px solid #e0e0e0",marginTop:-6,marginBottom:7}}})),Fe=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=Re();return e.createElement(T,null,e.Children.map(n,(function(t){return t&&a[t.props.source]&&e.isValidElement(t)?e.createElement("div",{key:t.props.source},t.props.addLabel?e.createElement(L,{container:!0,spacing:3,className:l.line},e.createElement(L,{item:!0,xs:3},e.createElement(M,{color:"textSecondary",align:"right",variant:"body2"},t.props.label)),e.createElement(L,{item:!0,xs:9},e.createElement(M,{variant:"body2"},e.cloneElement(t,{record:a,resource:o,basePath:r})))):"string"==typeof t.type?t:e.cloneElement(t,{record:a,resource:o,basePath:r})):null})))},Ue=I((function(){return{loader:{width:"100%",backgroundColor:"#e0e0e0",paddingTop:100,paddingBottom:100},image:{width:"100%",maxHeight:"none"}}})),We=function(t){var r=t.record,n=t.source,a=t.defaultImage,o=ae(t,["record","source","defaultImage"]),l=Ue();if(r[n]){if(r[n].rawFile instanceof File)return e.createElement(T,{align:"center",className:l.loader},e.createElement(H,null))}else r[n]=a;return e.createElement(y,ne({record:r,source:n,classes:{image:l.image}},o))},je=I((function(){return{root:{flexGrow:1}}})),Ve=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=t.title,i=t.image,c=t.defaultImage,s=je();return e.createElement("div",{className:s.root},e.createElement(T,null,e.createElement(M,{variant:"h3",color:"primary",paragraph:!0},e.cloneElement(l,{record:a}))),e.createElement(L,{container:!0,spacing:5},e.createElement(L,{item:!0,xs:12,sm:5},e.createElement(We,{record:a,source:i,defaultImage:c,title:l})),e.createElement(L,{item:!0,xs:12,sm:7},e.createElement(Fe,{record:a,resource:o,basePath:r},n))))};Ve.defaultProps={defaultImage:process.env.PUBLIC_URL+"/logo192.png"};var Me=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=t.hasEdit,s=ae(t,["basePath","className","data","hasList","hasEdit"]);return e.createElement(i,ne({className:n},s),o&&e.createElement(c,{basePath:r,record:a}),l&&e.createElement(P,{basePath:r,record:a}))},He=function(t){return e.createElement(x,ne({actions:e.createElement(Me,null)},t))},ze=I((function(){return{parent:{position:"relative"},child:{position:"absolute",bottom:0,left:0,right:0,paddingTop:2,paddingBottom:2,paddingLeft:6,paddingRight:6},caption:{color:"black",fontSize:13}}})),Ae=function(t){var r=t.record,n=ze(),a=r?r["pair:firstName"]+" "+r["pair:lastName"]:"";return e.createElement(T,{className:n.parent},e.createElement("img",{src:process.env.PUBLIC_URL+"/unknown-user.png",style:{width:"100%"},alt:a}),e.createElement(T,{bgcolor:"secondary.main",className:n.child,borderRadius:7},e.createElement(M,{align:"center",className:n.caption,noWrap:!0},a)))},Ge=function(t){var r=t.source,n=t.record;return n&&n[r]?e.createElement(ee,{source:n[r]}):null},_e=$((function(e){return{root:{display:"flex",flexWrap:"wrap"},link:{}}})),De=function(e){return e.stopPropagation()},qe=function(){},Je=function(e){e.classes;var t=e.className,o=e.children,l=e.linkType,i=void 0===l?"edit":l,c=e.separator,s=void 0===c?",":c,m=ae(e,["classes","className","children","linkType","separator"]),u=g(e),d=u.ids,p=u.data,h=u.loaded,f=u.resource,E=u.basePath,b=_e(e);return!1===h?r(z,null):r("div",ne({className:te(b.root,t)},w(m)),d.map((function(e,t){var l=!!i&&v(E,e,i);return l?r("span",{key:e},r(k,{classes:b.link,to:l,onClick:De},n(a.only(o),{record:p[e],resource:f,basePath:E,onClick:qe})),t<d.length-1&&s+" "):n(a.only(o),{key:e,record:p[e],resource:f,basePath:E})})))};export{se as AppBar,Ce as Column,Be as ColumnShowLayout,fe as Create,he as CreateActions,be as Edit,Ee as EditActions,Oe as GridList,Ve as Hero,ue as Layout,xe as List,Ge as MarkdownField,ve as ResourceTabs,Je as SeparatedListField,He as Show,Me as ShowActions,ke as SimpleList,Ae as UserIcon,pe as theme};
