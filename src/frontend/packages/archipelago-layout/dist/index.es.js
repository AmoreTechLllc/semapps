import e,{useEffect as t,createElement as r,cloneElement as n,Children as a,useState as o}from"react";import{getResources as l,Notification as i,TopToolbar as c,ListButton as s,Create as u,ShowButton as m,Edit as d,CreateButton as p,ExportButton as f,RefreshButton as h,List as b,Pagination as E,SimpleList as g,useTranslate as v,getFieldLabelTranslationArgs as y,useListContext as P,linkToRecord as w,ImageField as x,EditButton as k,Show as S,sanitizeListRestProps as L,Link as N,useCreate as C,useNotify as I,ReferenceInput as T,Button as B,FormWithRedirect as O,TextInput as R,required as j,SaveButton as A}from"react-admin";import{Grid as W,Button as F,TextField as U,Select as V,MenuItem as M,makeStyles as H,Box as z,Container as G,Hidden as _,useMediaQuery as D,ThemeProvider as q,createMuiTheme as $,Tabs as J,Tab as K,Typography as Q,CircularProgress as X,LinearProgress as Y,Dialog as Z,DialogTitle as ee,DialogContent as te,DialogActions as re}from"@material-ui/core";import{useHistory as ne,useLocation as ae,Link as oe}from"react-router-dom";import{Form as le,Field as ie,useForm as ce}from"react-final-form";import{useSelector as se,shallowEqual as ue}from"react-redux";import{useHistory as me,useLocation as de}from"react-router";import{createMuiTheme as pe,ThemeProvider as fe,makeStyles as he}from"@material-ui/core/styles";import be from"react-markdown";import Ee from"classnames";import ge from"@material-ui/icons/Add";import ve from"@material-ui/icons/Cancel";function ye(e,t,r,n,a,o,l){try{var i=e[o](l),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,a)}function Pe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function we(){return(we=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function xe(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function ke(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(n=(l=i.next()).done)&&(r.push(l.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw o}}return r}(e,t)||Le(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Se(e){return function(e){if(Array.isArray(e))return Ne(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Le(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Le(e,t){if(e){if("string"==typeof e)return Ne(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ne(e,t):void 0}}function Ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ce=function(t){var r=t.input,n=xe(t,["input"]);return e.createElement(U,we({},r,n))},Ie=function(t){var r=t.input,n=xe(t,["input"]),a=se(l,ue);return e.createElement(V,we({},r,n),a.filter((function(e){return e.hasList})).map((function(t){return e.createElement(M,{value:t.name,key:t.name},t.options.label)})))},Te=function(){var t=ne(),r=ae().pathname.match(/^\/([^/]+)/),n=r?r[1]:"Organization";return e.createElement(le,{onSubmit:function(e){var r=e.filter,n=e.type;r?t.push("/".concat(n,"?filter=").concat(encodeURIComponent('{"q": "'.concat(r,'"}')))):t.push("/".concat(n))},initialValues:{type:n},render:function(t){var r=t.handleSubmit;return e.createElement("form",{onSubmit:r},e.createElement(W,{container:!0,spacing:2},e.createElement(W,{item:!0,xs:5},e.createElement(ie,{name:"filter",component:Ce,placeholder:"Rechercher...",fullWidth:!0})),e.createElement(W,{item:!0,xs:5},e.createElement(ie,{name:"type",component:Ie,fullWidth:!0})),e.createElement(W,{item:!0,xs:2},e.createElement(F,{variant:"outlined",type:"submit",fullWidth:!0},"Hop"))))}})},Be=H((function(e){return{header:{position:"relative",height:65},logo:Pe({position:"absolute",top:-15,height:110,width:110},e.breakpoints.down("xs"),{position:"relative",top:0,width:65,height:65})}})),Oe=function(t){var r=t.userMenu,n=t.logout,a=Be();return e.createElement(z,{bgcolor:"primary.main"},e.createElement(G,{maxWidth:"lg",className:a.header},e.createElement(W,{container:!0},e.createElement(W,{item:!0,xs:12,sm:r?3:6},e.createElement(oe,{to:"/"},e.createElement("img",{src:process.env.PUBLIC_URL+"/logo192.png",alt:"SemApps",className:a.logo}))),e.createElement(_,{xsDown:!0},e.createElement(W,{item:!0,sm:6},e.createElement(z,{pt:2},e.createElement(Te,null)))),r&&e.createElement(W,{item:!0,sm:3,align:"right"},e.createElement(z,{pt:2},e.cloneElement(r,{logout:n}))))))},Re=function(){var e=ae().pathname;return t((function(){window.scrollTo(0,0)}),[e]),null},je=function(t){var r=t.appBar,n=t.logout,a=t.theme,o=t.children,l=D(a.breakpoints.down("xs"));return e.createElement(q,{theme:a},e.createElement(Re,null),e.cloneElement(r,{logout:n}),e.createElement(G,{maxWidth:"lg",disableGutters:l},e.createElement(z,{mb:{xs:0,sm:5}},o)),e.createElement(i,null))};je.defaultProps={appBar:e.createElement(Oe,null)};var Ae=$(),We=$({palette:{primary:{main:"#28ccfb"},secondary:{main:"#bcef5b"},grey:{main:"#e0e0e0"}},typography:{details:{fontSize:8}},overrides:{RaChipField:{chip:{marginLeft:0,marginTop:0,marginRight:8,marginBottom:8}},RaShow:{card:Pe({padding:25},Ae.breakpoints.down("xs"),{padding:15})},RaList:{content:Pe({padding:25},Ae.breakpoints.down("xs"),{padding:15})},RaListToolbar:{toolbar:Pe({},Ae.breakpoints.down("xs"),{height:0,minHeight:0})},RaSingleFieldList:{root:{marginTop:0,marginBottom:0}},MuiTab:{labelIcon:{paddingTop:0}}}}),Fe=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=xe(t,["basePath","className","data","hasList"]);return e.createElement(c,we({className:n},l),o&&e.createElement(s,{basePath:r,record:a}))},Ue=function(t){return e.createElement(u,we({actions:e.createElement(Fe,null),redirect:"show"},t))},Ve=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=t.hasShow,i=xe(t,["basePath","className","data","hasList","hasShow"]);return e.createElement(c,we({className:n},i),o&&e.createElement(s,{basePath:r,record:a}),l&&e.createElement(m,{basePath:r,record:a}))},Me=function(t){return e.createElement(d,we({actions:e.createElement(Ve,null)},t))},He=H((function(e){return{tab:{minWidth:55}}})),ze=function(){var t=me(),r=He(),n=de().pathname.match(/^\/([^/]+)/),a=n?n[1]:null,o=se(l,ue),i=D((function(e){return e.breakpoints.down("xs")}));return e.createElement(J,{value:a,onChange:function(e,r){return t.push("/"+r)},indicatorColor:"primary",textColor:"primary",scrollButtons:"auto"},o.filter((function(e){return e.hasList})).map((function(t){return e.createElement(K,{key:t.name,icon:e.createElement(t.icon),label:i?void 0:t.options.label,value:t.name,className:r.tab})})))},Ge=function(t){var r=t.bulkActions,n=t.basePath,a=t.currentSort,o=t.displayedFilters,i=t.exporter,s=t.filters,u=t.filterValues,m=t.onUnselectItems,d=t.resource,b=t.selectedIds,E=t.showFilter,g=t.total,v=D((function(e){return e.breakpoints.down("xs")})),y=se(l,ue).filter((function(e){return e.name==d}))[0];return e.createElement(c,null,r&&e.cloneElement(r,{basePath:n,filterValues:u,resource:d,selectedIds:b,onUnselectItems:m}),s&&e.cloneElement(s,{resource:d,showFilter:E,displayedFilters:o,filterValues:u,context:"button"}),y.hasCreate&&e.createElement(p,{basePath:n}),!v&&e.createElement(f,{disabled:0===g,resource:d,sort:a,filter:u,exporter:i}),!v&&e.createElement(h,null))},_e=function(t){return e.createElement(E,we({rowsPerPageOptions:[25,50,100]},t))},De=function(t){var r=t.children,n=xe(t,["children"]);return e.createElement(b,we({actions:e.createElement(Ge,null),sort:{field:"pair:label",order:"DESC"},pagination:e.createElement(_e,null),perPage:50},n),e.createElement(e.Fragment,null,e.createElement(ze,null),r))},qe=pe({overrides:{MuiListItem:{root:{padding:15,paddingBottom:15,paddingTop:15,marginBottom:10,borderStyle:"solid",borderColor:"#e0e0e0",borderWidth:1}}}}),$e=function(t){return e.createElement(fe,{theme:qe},e.createElement(g,t))},Je=H((function(){return{rightLabel:{color:"grey",textAlign:"right",borderBottom:"1px dashed #c0c0c0",paddingBottom:10,marginBottom:10}}})),Ke=function(t){var r=t.label,n=t.children,a=t.record,o=t.resource,l=t.source,i=t.basePath,c=Je(),s=v();return a[l]?e.createElement(z,{mb:4},e.createElement(z,{className:c.rightLabel},s.apply(void 0,Se(y({label:r,resource:o,source:l})))),e.createElement(z,{m:0},e.cloneElement(n,{record:a,resource:o,basePath:i}))):null},Qe=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=t.showLabel,i=xe(t,["basePath","children","record","resource","showLabel"]);return e.createElement(W,we({item:!0},i),e.Children.map(n,(function(t){return t&&e.isValidElement(t)?e.createElement("div",{key:t.props.source},t.props.addLabel&&l?e.createElement(Ke,{record:a,resource:o,basePath:r,label:t.props.label,source:t.props.source,disabled:!1},t):"string"==typeof t.type?t:e.cloneElement(t,{record:a,resource:o,basePath:r})):null})))},Xe=H((function(){return{root:{flexGrow:1}}})),Ye=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=Xe();return e.createElement("div",{className:l.root},e.createElement(W,{container:!0,spacing:5},e.Children.map(n,(function(t){return t&&e.isValidElement(t)?e.cloneElement(t,{resource:o,record:a,basePath:r}):null}))))},Ze=function(e){return e.stopPropagation()},et=function(){},tt=function(e){var t=e.children,o=e.xs,l=e.linkType,i=P(),c=i.ids,s=i.data,u=i.basePath;return r(W,{container:!0,spacing:3},c.map((function(e){return r(W,{item:!0,xs:o,key:e},r(oe,{to:w(u,e,l),onClick:Ze},n(a.only(t),{record:s[e],basePath:u,onClick:et})))})))};tt.defaultProps={xs:6,linkType:"edit"};var rt=H((function(){return{line:{borderBottom:"1px solid #e0e0e0",marginTop:-6,marginBottom:7}}})),nt=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=rt(),i=v();return e.createElement(z,null,e.Children.map(n,(function(t){return t&&a[t.props.source]&&e.isValidElement(t)?e.createElement("div",{key:t.props.source},t.props.addLabel?e.createElement(W,{container:!0,spacing:3,className:l.line},e.createElement(W,{item:!0,xs:3},e.createElement(Q,{color:"textSecondary",align:"right",variant:"body2"},i.apply(void 0,Se(y({label:t.props.label,resource:o,source:t.props.source}))))),e.createElement(W,{item:!0,xs:9},e.createElement(Q,{variant:"body2"},e.cloneElement(t,{record:a,resource:o,basePath:r})))):"string"==typeof t.type?t:e.cloneElement(t,{record:a,resource:o,basePath:r})):null})))},at=H((function(){return{loader:{width:"100%",backgroundColor:"#e0e0e0",paddingTop:100,paddingBottom:100},image:{width:"100%",maxHeight:"none"}}})),ot=function(t){var r=t.record,n=t.source,a=t.defaultImage,o=xe(t,["record","source","defaultImage"]),l=at();if(r[n]){if(r[n].rawFile instanceof File)return e.createElement(z,{align:"center",className:l.loader},e.createElement(X,null))}else r[n]=a;return e.createElement(x,we({record:r,source:n,classes:{image:l.image}},o))},lt=H((function(){return{root:{flexGrow:1}}})),it=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=t.title,i=t.image,c=t.defaultImage,s=lt();return e.createElement("div",{className:s.root},e.createElement(z,null,e.createElement(Q,{variant:"h3",color:"primary",paragraph:!0},e.cloneElement(l,{record:a}))),e.createElement(W,{container:!0,spacing:5},e.createElement(W,{item:!0,xs:12,sm:5},e.createElement(ot,{record:a,source:i,defaultImage:c,title:l})),e.createElement(W,{item:!0,xs:12,sm:7},e.createElement(nt,{record:a,resource:o,basePath:r},n))))};it.defaultProps={defaultImage:process.env.PUBLIC_URL+"/logo192.png"};var ct=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=t.hasEdit,i=xe(t,["basePath","className","data","hasList","hasEdit"]);return e.createElement(c,we({className:n},i),o&&e.createElement(s,{basePath:r,record:a}),l&&e.createElement(k,{basePath:r,record:a}))},st=function(t){return e.createElement(S,we({actions:e.createElement(ct,null)},t))},ut=H((function(){return{parent:{position:"relative"},image:{width:"100%",borderRadius:"50%"},child:{position:"absolute",bottom:0,left:0,right:0,paddingTop:2,paddingBottom:2,paddingLeft:6,paddingRight:6},caption:{color:"black",fontSize:13}}})),mt=function(t){var r=t.record,n=ut(),a=r?r["pair:firstName"]+" "+r["pair:lastName"]:"";return e.createElement(z,{className:n.parent},e.createElement("img",{src:r&&r.image||process.env.PUBLIC_URL+"/unknown-user.png",className:n.image,alt:a}),e.createElement(z,{bgcolor:"secondary.main",className:n.child,borderRadius:7},e.createElement(Q,{align:"center",className:n.caption,noWrap:!0},a)))},dt=function(t){var r=t.source,n=t.record;return n&&n[r]?e.createElement(be,{source:n[r]}):null},pt=he((function(e){return{root:{display:"flex",flexWrap:"wrap"},link:{}}})),ft=function(e){return e.stopPropagation()},ht=function(){},bt=function(e){e.classes;var t=e.className,o=e.children,l=e.linkType,i=void 0===l?"edit":l,c=e.separator,s=void 0===c?",":c,u=xe(e,["classes","className","children","linkType","separator"]),m=P(e),d=m.ids,p=m.data,f=m.loaded,h=m.resource,b=m.basePath,E=pt(e);return!1===f?r(Y,null):r("div",we({className:Ee(E.root,t)},L(u)),d.map((function(e,t){var l=!!i&&w(b,e,i);return l?r("span",{key:e},r(N,{classes:E.link,to:l,onClick:ft},n(a.only(o),{record:p[e],resource:h,basePath:b,onClick:ht})),t<d.length-1&&s+" "):n(a.only(o),{key:e,record:p[e],resource:h,basePath:b})})))},Et=H({root:{display:"flex",alignItems:"center"}}),gt=function(t){var r=t.label,n=t.reference,a=t.source,l=t.children,i=Et(),c=ke(o(!1),2),s=c[0],u=c[1],m=ke(C(n),2),d=m[0],p=m[1].loading,f=v(),h=I(),b=ce(),E=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d({payload:{data:t}},{onSuccess:function(e){var t=e.data;u(!1),b.change(a,t["@id"])},onFailure:function(e){var t=e.error;h(t.message,"error")}});case 1:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function l(e){ye(o,n,a,l,i,"next",e)}function i(e){ye(o,n,a,l,i,"throw",e)}l(void 0)}))});return function(e){return t.apply(this,arguments)}}();return e.createElement("div",{className:i.root},e.createElement(T,{label:r,reference:n,source:a},l),e.createElement(B,{onClick:function(){return u(!0)},label:"ra.action.create"},e.createElement(ge,null)),e.createElement(Z,{fullWidth:!0,open:s,onClose:function(){return u(!1)}},e.createElement(ee,null,f("ra.action.create")),e.createElement(O,{resource:n,save:E,render:function(t){var r=t.handleSubmitWithRedirect,n=t.pristine,a=t.saving;return e.createElement(e.Fragment,null,e.createElement(te,null,e.createElement(R,{label:"Titre",source:"pair:label",validate:j(),fullWidth:!0})),e.createElement(re,null,e.createElement(B,{label:"ra.action.cancel",onClick:function(){return u(!1)},disabled:p},e.createElement(ve,null)),e.createElement(A,{handleSubmitWithRedirect:r,pristine:n,saving:a,disabled:p})))}})))};export{Oe as AppBar,Qe as Column,Ye as ColumnShowLayout,Ue as Create,Fe as CreateActions,Me as Edit,Ve as EditActions,tt as GridList,it as Hero,je as Layout,De as List,dt as MarkdownField,gt as ReferenceQuickCreateInput,ze as ResourceTabs,bt as SeparatedListField,st as Show,ct as ShowActions,$e as SimpleList,mt as UserIcon,We as theme};
