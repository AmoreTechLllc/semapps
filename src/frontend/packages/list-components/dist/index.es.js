import*as e from"react";import t,{useState as r}from"react";import{useListContext as n,useResourceContext as a,sanitizeListRestProps as l,RecordContextProvider as o,ChipField as i,Link as c,linkToRecord as s,useGetList as u,getResources as m,FilterList as p,FilterListItem as d,Button as f,useResourceDefinition as h,TopToolbar as b,CreateButton as y,ExportButton as v,List as g}from"react-admin";import{makeStyles as E,LinearProgress as k,Grid as P,Card as w,CardActionArea as x,CardMedia as C,CardContent as O,CardActions as L,useMediaQuery as N}from"@material-ui/core";import I from"@material-ui/icons/AddCircle";import S from"@material-ui/icons/Launch";import{useGetExternalLink as j}from"@semapps/semantic-data-provider";import F from"react-masonry-css";import{useSelector as T,shallowEqual as V}from"react-redux";import{useLocation as A}from"react-router";function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function R(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,l=[],o=!0,i=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(l.push(n.value),!t||l.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==r.return||r.return()}finally{if(i)throw a}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return B(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var D=["classes","className","children","linkType","component","primaryText","appendLink","externalLinks"],_=E((function(e){return{root:{display:"flex",flexWrap:"wrap"},link:{textDecoration:"none",maxWidth:"100%"},chipField:{maxWidth:"100%"},addIcon:{cursor:"pointer",fontSize:35,position:"relative",top:-2,left:-2},launchIcon:{width:16,paddingRight:6,marginLeft:-10}}})),z=function(e){return e.stopPropagation()},M=function(){},$=function(e){e.classes,e.className,e.children;var r=e.linkType,u=void 0===r?"edit":r,m=e.component,p=void 0===m?"div":m,d=e.primaryText,f=e.appendLink,h=e.externalLinks,b=void 0!==h&&h,y=R(e,D),v=n(e),g=v.ids,E=v.data,P=v.loaded,w=v.basePath,x=a(e),C=j(b),O=_(e),L=p;return!1===P?t.createElement(k,null):t.createElement(L,U({className:O.root},l(y)),g.map((function(e){if(!E[e])return null;var r=C(E[e]);return r?t.createElement(o,{value:E[e],key:e},t.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:O.link,onClick:z},t.createElement(i,{record:E[e],resource:x,basePath:w,source:d,className:O.chipField,color:"secondary",deleteIcon:t.createElement(S,{className:O.launchIcon}),onClick:M,onDelete:M}))):u?t.createElement(o,{value:E[e],key:e},t.createElement(c,{className:O.link,to:s(w,e,u),onClick:z},t.createElement(i,{record:E[e],resource:x,basePath:w,source:d,className:O.chipField,color:"secondary",onClick:M}))):t.createElement(o,{value:E[e],key:e},t.createElement(i,{record:E[e],resource:x,basePath:w,source:d,className:O.chipField,color:"secondary",onClick:M}))})),f&&t.createElement(I,{color:"primary",className:O.addIcon,onClick:f}))},q=function(e){return e.stopPropagation()},G=function(){},H=function(t){var r=t.children,a=t.linkType,l=t.externalLinks,i=t.spacing,u=t.xs,m=t.sm,p=t.md,d=t.lg,f=t.xl,h=n(),b=h.ids,y=h.data,v=h.basePath,g=j(l);return e.createElement(P,{container:!0,spacing:i},b.map((function(t){if(!y[t])return null;var n,l=g(y[t]);return n=l?e.createElement("a",{href:l,target:"_blank",rel:"noopener noreferrer",onClick:q},e.cloneElement(e.Children.only(r),{record:y[t],basePath:r.props.basePath||v,externalLink:!0,onClick:G})):a?e.createElement(c,{to:s(v,t,a),onClick:q},e.cloneElement(e.Children.only(r),{record:y[t],basePath:r.props.basePath||v,onClick:G})):e.cloneElement(e.Children.only(r),{record:y[t],basePath:r.props.basePath||v}),e.createElement(P,{item:!0,key:t,xs:u,sm:m,md:p,lg:d,xl:f},e.createElement(o,{value:y[t],key:t},n))})))};H.defaultProps={xs:6,spacing:3,linkType:"edit",externalLinks:!1};var J=E((function(){return{grid:{display:"flex",marginLeft:-20,marginBottom:-20,width:"auto"},column:{paddingLeft:20,backgroundClip:"padding-box"},card:{marginBottom:20},media:{height:0,paddingTop:"56.25%"}}})),K=function(e){var r=e.image,a=e.content,l=e.actions,o=e.breakpointCols,i=e.linkType,u=J(),m=n(),p=m.ids,d=m.data,f=m.basePath;return t.createElement(F,{breakpointCols:o,className:u.grid,columnClassName:u.column},p.map((function(e){if(!d[e])return null;var n="function"==typeof r?r(d[e]):r;return t.createElement(w,{key:e,className:u.card},t.createElement(c,{to:s(f,e)+"/"+i},t.createElement(x,null,n&&t.createElement(C,{className:u.media,image:n}),a&&t.createElement(O,null,a(d[e])))),l&&t.createElement(L,null,l.map((function(r){return t.createElement(r,{record:d[e],basePath:f})}))))})))};K.defaultProps={breakpointCols:{default:3,1050:2,700:1},linkType:"edit"};var Q=function(e){var r=e.source,n=e.id,l=a(),o=u(l).data;return t.createElement(t.Fragment,null,"Â ",t.createElement("span",{className:"filter-count"},"("+Object.values(o).filter((function(e){return e[r]===n})).length+")"))},X=function(e){var r=e.reference,n=e.source,a=e.inverseSource,l=e.limit,o=e.sort,i=e.filter,c=e.label,s=e.icon,f=e.showCounters,h=u(r,{page:1,perPage:l},o,i),b=h.data,y=h.ids,v=T(m,V).filter((function(e){return(null==e?void 0:e.name)===r}))[0];return t.createElement(p,{label:c||v.options.label,icon:s||t.createElement(v.icon)},y.filter((function(e){return!a||b[e][a]})).map((function(e){return t.createElement(d,{key:e,label:t.createElement("span",{className:"filter-label"},b[e]["pair:label"],f&&t.createElement(Q,{source:n,id:e})),value:(r={},a=n,l=e,a in r?Object.defineProperty(r,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[a]=l,r)});var r,a,l})))};X.defaultProps={limit:25,showCounters:!0};var Y=t.createContext({views:null,currentView:null,setView:function(){return null}}),Z=function(){var e=new URLSearchParams(A().search),r=t.useContext(Y),n=r.views,a=r.currentView,l=r.setView;return n?Object.entries(n).filter((function(e){return W(e,1)[0]!==a})).map((function(r){var n=W(r,2),a=n[0],o=n[1];return e.set("view",a),e.set("page",1),e.set("perPage",o.perPage),o.sort&&(e.set("sort",o.sort.field),e.set("order",o.sort.order)),t.createElement(c,{key:a,to:"?"+e.toString()},t.createElement(f,{onClick:function(){return l(a)},label:o.label},t.createElement(o.icon)))})):null},ee=["bulkActions","basePath","currentSort","displayedFilters","exporter","filters","filterValues","onUnselectItems","resource","selectedIds","showFilter","total"],te=function(e){var r=e.bulkActions,n=e.basePath,a=e.currentSort,l=e.displayedFilters,o=e.exporter,i=e.filters,c=e.filterValues,s=e.onUnselectItems,u=e.resource,m=e.selectedIds,p=e.showFilter,d=e.total,f=R(e,ee),g=N((function(e){return e.breakpoints.down("xs")})),E=h(f);return t.createElement(b,null,t.createElement(Z,null),i&&t.cloneElement(i,{resource:u,showFilter:p,displayedFilters:l,filterValues:c,context:"button"}),E.hasCreate&&t.createElement(y,{basePath:n}),!g&&!1!==o&&t.createElement(v,{disabled:0===d,resource:u,sort:a,filter:c,exporter:o}),r&&t.cloneElement(r,{basePath:n,filterValues:c,resource:u,selectedIds:m,onUnselectItems:s}))},re=["children","actions","views","ListComponent"],ne=function(e){e.children;var n=e.actions,a=e.views,l=e.ListComponent,o=R(e,re),i=new URLSearchParams(A().search),c=i.has("view")?i.get("view"):Object.keys(a)[0],s=W(r(c),2),u=s[0],m=s[1];return t.createElement(Y.Provider,{value:{views:a,currentView:u,setView:m}},t.createElement(l,U({actions:n,pagination:a[u].pagination,perPage:a[c].perPage,sort:a[c].sort},o),a[u].list))};ne.defaultProps={actions:t.createElement(te,null),ListComponent:g};export{$ as ChipList,H as GridList,te as ListActionsWithViews,Y as ListViewContext,K as MasonryList,ne as MultiViewsList,X as ReferenceFilter,Z as ViewsButtons};
//# sourceMappingURL=index.es.js.map
