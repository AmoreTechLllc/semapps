import*as e from"react";import t,{useState as r}from"react";import{useListContext as n,useResourceContext as a,sanitizeListRestProps as o,RecordContextProvider as l,ChipField as i,Link as c,linkToRecord as s,useResourceDefinition as u,TopToolbar as m,Button as p,CreateButton as f,ExportButton as d,List as b,useGetList as h,getResources as y,FilterList as g,FilterListItem as v}from"react-admin";import{makeStyles as E,LinearProgress as k,Grid as P,Card as w,CardActionArea as O,CardMedia as x,CardContent as C,CardActions as j,useMediaQuery as L}from"@material-ui/core";import N from"@material-ui/icons/AddCircle";import S from"@material-ui/icons/Launch";import{useGetExternalLink as I}from"@semapps/semantic-data-provider";import F from"react-masonry-css";import{useLocation as V}from"react-router";import{useSelector as T,shallowEqual as A}from"react-redux";function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach((function(t){R(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function R(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function W(){return(W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function B(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return z(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return z(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var M=["classes","className","children","linkType","component","primaryText","appendLink","externalLinks"],$=E((function(e){return{root:{display:"flex",flexWrap:"wrap"},link:{textDecoration:"none",maxWidth:"100%"},chipField:{maxWidth:"100%"},addIcon:{cursor:"pointer",fontSize:35,position:"relative",top:-2,left:-2},launchIcon:{width:16,paddingRight:6,marginLeft:-10}}})),q=function(e){return e.stopPropagation()},G=function(){},H=function(e){e.classes,e.className,e.children;var r=e.linkType,u=void 0===r?"edit":r,m=e.component,p=void 0===m?"div":m,f=e.primaryText,d=e.appendLink,b=e.externalLinks,h=void 0!==b&&b,y=B(e,M),g=n(e),v=g.ids,E=g.data,P=g.loaded,w=g.basePath,O=a(e),x=I(h),C=$(e),j=p;return!1===P?t.createElement(k,null):t.createElement(j,W({className:C.root},o(y)),v.map((function(e){if(!E[e])return null;var r=x(E[e]);return r?t.createElement(l,{value:E[e],key:e},t.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:C.link,onClick:q},t.createElement(i,{record:E[e],resource:O,basePath:w,source:f,className:C.chipField,color:"secondary",deleteIcon:t.createElement(S,{className:C.launchIcon}),onClick:G,onDelete:G}))):u?t.createElement(l,{value:E[e],key:e},t.createElement(c,{className:C.link,to:s(w,e,u),onClick:q},t.createElement(i,{record:E[e],resource:O,basePath:w,source:f,className:C.chipField,color:"secondary",onClick:G}))):t.createElement(l,{value:E[e],key:e},t.createElement(i,{record:E[e],resource:O,basePath:w,source:f,className:C.chipField,color:"secondary",onClick:G}))})),d&&t.createElement(N,{color:"primary",className:C.addIcon,onClick:d}))},J=function(e){return e.stopPropagation()},K=function(){},Q=function(t){var r=t.children,a=t.linkType,o=t.externalLinks,i=t.spacing,u=t.xs,m=t.sm,p=t.md,f=t.lg,d=t.xl,b=n(),h=b.ids,y=b.data,g=b.basePath,v=I(o);return e.createElement(P,{container:!0,spacing:i},h.map((function(t){if(!y[t])return null;var n,o=v(y[t]);return n=o?e.createElement("a",{href:o,target:"_blank",rel:"noopener noreferrer",onClick:J},e.cloneElement(e.Children.only(r),{record:y[t],basePath:r.props.basePath||g,externalLink:!0,onClick:K})):a?e.createElement(c,{to:s(g,t,a),onClick:J},e.cloneElement(e.Children.only(r),{record:y[t],basePath:r.props.basePath||g,onClick:K})):e.cloneElement(e.Children.only(r),{record:y[t],basePath:r.props.basePath||g}),e.createElement(P,{item:!0,key:t,xs:u,sm:m,md:p,lg:f,xl:d},e.createElement(l,{value:y[t],key:t},n))})))};Q.defaultProps={xs:6,spacing:3,linkType:"edit",externalLinks:!1};var X=E((function(){return{grid:{display:"flex",marginLeft:-20,marginBottom:-20,width:"auto"},column:{paddingLeft:20,backgroundClip:"padding-box"},card:{marginBottom:20},media:{height:0,paddingTop:"56.25%"}}})),Y=function(e){var r=e.image,a=e.content,o=e.actions,l=e.breakpointCols,i=e.linkType,u=X(),m=n(),p=m.ids,f=m.data,d=m.basePath;return t.createElement(F,{breakpointCols:l,className:u.grid,columnClassName:u.column},p.map((function(e){if(!f[e])return null;var n="function"==typeof r?r(f[e]):r;return t.createElement(w,{key:e,className:u.card},t.createElement(c,{to:s(d,e)+"/"+i},t.createElement(O,null,n&&t.createElement(x,{className:u.media,image:n}),a&&t.createElement(C,null,a(f[e])))),o&&t.createElement(j,null,o.map((function(r){return t.createElement(r,{record:f[e],basePath:d})}))))})))};Y.defaultProps={breakpointCols:{default:3,1050:2,700:1},linkType:"edit"};var Z=["bulkActions","basePath","currentSort","displayedFilters","exporter","filters","filterValues","onUnselectItems","resource","selectedIds","showFilter","total","views","currentView","setView"],ee=function(e){var r=e.bulkActions,n=e.basePath,a=e.currentSort,o=e.displayedFilters,l=e.exporter,i=e.filters,s=e.filterValues,b=e.onUnselectItems,h=e.resource,y=e.selectedIds,g=e.showFilter,v=e.total,E=e.views,k=e.currentView,P=e.setView,w=B(e,Z),O=L((function(e){return e.breakpoints.down("xs")})),x=u(w),C=new URLSearchParams(V().search);return t.createElement(m,{currentView:k},E&&Object.entries(E).filter((function(e){return _(e,1)[0]!==k})).map((function(e){var r=_(e,2),n=r[0],a=r[1];return C.set("view",n),C.set("page",1),C.set("perPage",a.perPage),a.sort&&(C.set("sort",a.sort.field),C.set("order",a.sort.order)),t.createElement(c,{key:n,to:"?"+C.toString()},t.createElement(p,{onClick:function(){return P(n)},label:a.label},t.createElement(a.icon)))})),i&&t.cloneElement(i,{resource:h,showFilter:g,displayedFilters:o,filterValues:s,context:"button"}),x.hasCreate&&t.createElement(f,{basePath:n}),!O&&!1!==l&&t.createElement(d,{disabled:0===v,resource:h,sort:a,filter:s,exporter:l}),r&&t.cloneElement(r,{basePath:n,filterValues:s,resource:h,selectedIds:y,onUnselectItems:b}))},te=["children","actions","views","ListComponent"],re=function(e){e.children;var n=e.actions,a=e.views,o=e.ListComponent,l=B(e,te),i=new URLSearchParams(V().search),c=i.has("view")?i.get("view"):Object.keys(a)[0],s=_(r(c),2),u=s[0],m=s[1];return t.createElement(o,W({actions:t.cloneElement(n,U({views:a,currentView:u,setView:m},l)),pagination:a[u].pagination,perPage:a[c].perPage,sort:a[c].sort},l),a[u].list)};re.defaultProps={actions:t.createElement(ee,null),ListComponent:b};var ne=function(e){var r=e.source,n=e.id,o=a(),l=h(o).data;return t.createElement(t.Fragment,null,"Â ",t.createElement("span",{className:"filter-count"},"("+Object.values(l).filter((function(e){return e[r]===n})).length+")"))},ae=function(e){var r=e.reference,n=e.source,a=e.inverseSource,o=e.limit,l=e.sort,i=e.filter,c=e.label,s=e.icon,u=e.showCounters,m=h(r,{page:1,perPage:o},l,i),p=m.data,f=m.ids,d=T(y,A).filter((function(e){return(null==e?void 0:e.name)===r}))[0];return t.createElement(g,{label:c||d.options.label,icon:s||t.createElement(d.icon)},f.filter((function(e){return!a||p[e][a]})).map((function(e){return t.createElement(v,{key:e,label:t.createElement("span",{className:"filter-label"},p[e]["pair:label"],u&&t.createElement(ne,{source:n,id:e})),value:R({},n,e)})})))};ae.defaultProps={limit:25,showCounters:!0};export{H as ChipList,Q as GridList,Y as MasonryList,re as MultiViewsList,ae as ReferenceFilter};
//# sourceMappingURL=index.es.js.map
