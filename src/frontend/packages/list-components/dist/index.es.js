import*as e from"react";import r,{useEffect as t,useState as n}from"react";import{useListContext as a,useResourceContext as l,sanitizeListRestProps as o,RecordContextProvider as i,ChipField as c,Link as s,linkToRecord as u,useGetList as m,useResourceDefinition as d,FilterList as f,FilterListItem as p,Button as h,TopToolbar as b,CreateButton as v,ExportButton as y,List as g}from"react-admin";import{LinearProgress as E,Grid as k,Card as w,CardActionArea as P,CardMedia as x,CardContent as C,CardActions as L,useMediaQuery as O}from"@mui/material";import j from"@mui/styles/makeStyles";import N from"@mui/icons-material/AddCircle";import S from"@mui/icons-material/Launch";import{useGetExternalLink as I,useDataModel as F,useContainers as V}from"@semapps/semantic-data-provider";import T from"react-masonry-css";import{useLocation as A}from"react-router";function U(){return(U=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function _(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)t=l[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}function R(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==t)return;var n,a,l=[],o=!0,i=!1;try{for(t=t.call(e);!(o=(n=t.next()).done)&&(l.push(n.value),!r||l.length!==r);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==t.return||t.return()}finally{if(i)throw a}}return l}(e,r)||function(e,r){if(!e)return;if("string"==typeof e)return W(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return W(e,r)}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var B=["classes","className","children","linkType","component","primaryText","appendLink","externalLinks"],D=j((function(e){return{root:{display:"flex",flexWrap:"wrap"},link:{textDecoration:"none",maxWidth:"100%"},chipField:{maxWidth:"100%"},addIcon:{cursor:"pointer",fontSize:35,position:"relative",top:-2,left:-2},launchIcon:{width:16,paddingRight:6,marginLeft:-10}}})),z=function(e){return e.stopPropagation()},G=function(){},M=function(e){e.classes,e.className,e.children;var t=e.linkType,n=void 0===t?"edit":t,m=e.component,d=void 0===m?"div":m,f=e.primaryText,p=e.appendLink,h=e.externalLinks,b=void 0!==h&&h,v=_(e,B),y=a(e),g=y.ids,k=y.data,w=y.loaded,P=y.basePath,x=l(e),C=I(b),L=D(e),O=d;return!1===w?r.createElement(E,null):r.createElement(O,U({className:L.root},o(v)),g.map((function(e){if(!k[e]||k[e]._error)return null;var t=C(k[e]);return t?r.createElement(i,{value:k[e],key:e},r.createElement("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:L.link,onClick:z},r.createElement(c,{record:k[e],resource:x,basePath:P,source:f,className:L.chipField,color:"secondary",deleteIcon:r.createElement(S,{className:L.launchIcon}),onClick:G,onDelete:G}))):n?r.createElement(i,{value:k[e],key:e},r.createElement(s,{className:L.link,to:u(P,e,n),onClick:z},r.createElement(c,{record:k[e],resource:x,basePath:P,source:f,className:L.chipField,color:"secondary",onClick:G}))):r.createElement(i,{value:k[e],key:e},r.createElement(c,{record:k[e],resource:x,basePath:P,source:f,className:L.chipField,color:"secondary",onClick:G}))})),p&&r.createElement(N,{color:"primary",className:L.addIcon,onClick:p}))},$=function(e){return e.stopPropagation()},q=function(){},H=function(r){var t=r.children,n=r.linkType,l=r.externalLinks,o=r.spacing,c=r.xs,m=r.sm,d=r.md,f=r.lg,p=r.xl,h=a(),b=h.ids,v=h.data,y=h.basePath,g=I(l);return e.createElement(k,{container:!0,spacing:o},b.map((function(r){if(!v[r]||v[r]._error)return null;var a,l=g(v[r]);return a=l?e.createElement("a",{href:l,target:"_blank",rel:"noopener noreferrer",onClick:$},e.cloneElement(e.Children.only(t),{record:v[r],basePath:t.props.basePath||y,externalLink:!0,onClick:q})):n?e.createElement(s,{to:u(y,r,n),onClick:$},e.cloneElement(e.Children.only(t),{record:v[r],basePath:t.props.basePath||y,onClick:q})):e.cloneElement(e.Children.only(t),{record:v[r],basePath:t.props.basePath||y}),e.createElement(k,{item:!0,key:r,xs:c,sm:m,md:d,lg:f,xl:p},e.createElement(i,{value:v[r],key:r},a))})))};H.defaultProps={xs:6,spacing:3,linkType:"edit",externalLinks:!1};var J=j((function(){return{grid:{display:"flex",marginLeft:-20,marginBottom:-20,width:"auto"},column:{paddingLeft:20,backgroundClip:"padding-box"},card:{marginBottom:20},media:{height:0,paddingTop:"56.25%"}}})),K=function(e){var t=e.image,n=e.content,l=e.actions,o=e.breakpointCols,i=e.linkType,c=J(),m=a(),d=m.ids,f=m.data,p=m.basePath;return r.createElement(T,{breakpointCols:o,className:c.grid,columnClassName:c.column},d.map((function(e){if(!f[e]||f[e]._error)return null;var a="function"==typeof t?t(f[e]):t;return r.createElement(w,{key:e,className:c.card},r.createElement(s,{to:u(p,e)+"/"+i},r.createElement(P,null,a&&r.createElement(x,{className:c.media,image:a}),n&&r.createElement(C,null,n(f[e])))),l&&r.createElement(L,null,l.map((function(t){return r.createElement(t,{record:f[e],basePath:p})}))))})))};K.defaultProps={breakpointCols:{default:3,1050:2,700:1},linkType:"edit"};var Q=function(e){var t=e.source,n=e.id,a=l(),o=m(a),i=o.data,c=o.isLoading;return r.createElement(r.Fragment,null,"Â ",!c&&r.createElement("span",{className:"filter-count"},"("+Object.values(i).filter((function(e){return[].concat(e[t]).includes(n)})).length+")"))},X=function(e){var n,o=e.reference,i=e.source,c=e.inverseSource,s=e.limit,u=e.sort,h=e.filter,b=e.label,v=e.icon,y=e.showCounters,g=m(o,{page:1,perPage:s},u,h),E=g.data;g.isLoading;var k=d({resource:o}),w=l();F(w);var P=V(w),x=a();x.displayedFilters,x.filterValues;var C=x.setFilters;x.hideFilter,t((function(){var e=new URLSearchParams(window.location.search);Object.fromEntries(e.entries()).filter||C({})}),[]);return r.createElement(f,{label:b||(null==k||null===(n=k.options)||void 0===n?void 0:n.label)||"",icon:v||null!=k&&k.icon?r.createElement(k.icon):void 0},E&&E.filter((function(e){return function(e){if(!c)return!0;if(!P||!e)return!1;var r=!1;return Object.values(P).forEach((function(t){t.forEach((function(t){[].concat(e[c]).forEach((function(e){e.startsWith(t)&&(r=!0)}))}))})),r}(e)})).map((function(e){return r.createElement(p,{key:e.id,label:r.createElement("span",{className:"filter-label"},e["pair:label"],y&&r.createElement(Q,{source:i,id:e.id})),value:(t={},n=i,a=e.id,n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t)});var t,n,a})))};X.defaultProps={limit:25,showCounters:!0};var Y=r.createContext({views:null,currentView:null,setView:function(){return null}}),Z=function(){var e=new URLSearchParams(A().search),t=r.useContext(Y),n=t.views,a=t.currentView,l=t.setView;return n?Object.entries(n).filter((function(e){return R(e,1)[0]!==a})).map((function(t){var n=R(t,2),a=n[0],o=n[1];return e.set("view",a),e.set("page",1),e.set("perPage",o.perPage),o.sort&&(e.set("sort",o.sort.field),e.set("order",o.sort.order)),r.createElement(s,{key:a,to:"?"+e.toString()},r.createElement(h,{onClick:function(){return l(a)},label:o.label},r.createElement(o.icon)))})):null},ee=["bulkActions","basePath","currentSort","displayedFilters","exporter","filters","filterValues","onUnselectItems","resource","selectedIds","showFilter","total"],re=function(e){var t=e.bulkActions,n=e.basePath,a=e.currentSort,l=e.displayedFilters,o=e.exporter,i=e.filters,c=e.filterValues,s=e.onUnselectItems,u=e.resource,m=e.selectedIds,f=e.showFilter,p=e.total,h=_(e,ee),g=O((function(e){return e.breakpoints.down("sm")})),E=d(h);return r.createElement(b,null,r.createElement(Z,null),i&&r.cloneElement(i,{resource:u,showFilter:f,displayedFilters:l,filterValues:c,context:"button"}),E.hasCreate&&r.createElement(v,{basePath:n}),!g&&!1!==o&&r.createElement(y,{disabled:0===p,resource:u,sort:a,filter:c,exporter:o}),t&&r.cloneElement(t,{basePath:n,filterValues:c,resource:u,selectedIds:m,onUnselectItems:s}))},te=["children","actions","views","ListComponent"],ne=function(e){e.children;var t=e.actions,a=e.views,l=e.ListComponent,o=_(e,te),i=new URLSearchParams(A().search),c=i.has("view")?i.get("view"):Object.keys(a)[0],s=R(n(c),2),u=s[0],m=s[1];return r.createElement(Y.Provider,{value:{views:a,currentView:u,setView:m}},r.createElement(l,U({actions:t,pagination:a[u].pagination,perPage:a[c].perPage,sort:a[c].sort},o),a[u].list))};ne.defaultProps={actions:r.createElement(re,null),ListComponent:g};export{M as ChipList,H as GridList,re as ListActionsWithViews,Y as ListViewContext,K as MasonryList,ne as MultiViewsList,X as ReferenceFilter,Z as ViewsButtons};
//# sourceMappingURL=index.es.js.map
