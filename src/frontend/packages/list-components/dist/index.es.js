import*as e from"react";import t,{useEffect as r,useState as n}from"react";import{useTheme as a,useListContext as l,useResourceContext as o,sanitizeListRestProps as i,RecordContextProvider as c,ChipField as s,Link as u,linkToRecord as m,useGetList as d,useResourceDefinition as f,FilterList as p,FilterListItem as h,Button as b,TopToolbar as v,CreateButton as y,ExportButton as g,List as E}from"react-admin";import{LinearProgress as k,Grid as w,Card as P,CardActionArea as x,CardMedia as C,CardContent as L,CardActions as O,useMediaQuery as j}from"@mui/material";import N from"@mui/styles/makeStyles";import I from"@mui/icons-material/AddCircle";import F from"@mui/icons-material/Launch";import{useGetExternalLink as S,useDataModel as V,useContainers as T}from"@semapps/semantic-data-provider";import A from"react-masonry-css";import{useLocation as U}from"react-router";function _(){return(_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function R(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,l=[],o=!0,i=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(l.push(n.value),!t||l.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==r.return||r.return()}finally{if(i)throw a}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return B(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var D=["classes","className","children","linkType","component","primaryText","appendLink","externalLinks"],z=N((function(){return W(a(),1)[0],{root:{display:"flex",flexWrap:"wrap"},link:{textDecoration:"none",maxWidth:"100%"},chipField:{maxWidth:"100%"},addIcon:{cursor:"pointer",fontSize:35,position:"relative",top:-2,left:-2},launchIcon:{width:16,paddingRight:6,marginLeft:-10}}})),M=function(e){return e.stopPropagation()},$=function(){},q=function(e){e.classes,e.className,e.children;var r=e.linkType,n=void 0===r?"edit":r,a=e.component,d=void 0===a?"div":a,f=e.primaryText,p=e.appendLink,h=e.externalLinks,b=void 0!==h&&h,v=R(e,D),y=l(e),g=y.ids,E=y.data,w=y.isLoading,P=y.basePath,x=o(e),C=S(b),L=z(e),O=d;return!0===w?t.createElement(k,null):t.createElement(O,_({className:L.root},i(v)),g.map((function(e){if(!E[e]||E[e]._error)return null;var r=C(E[e]);return r?t.createElement(c,{value:E[e],key:e},t.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:L.link,onClick:M},t.createElement(s,{record:E[e],resource:x,basePath:P,source:f,className:L.chipField,color:"secondary",deleteIcon:t.createElement(F,{className:L.launchIcon}),onClick:$,onDelete:$}))):n?t.createElement(c,{value:E[e],key:e},t.createElement(u,{className:L.link,to:m(P,e,n),onClick:M},t.createElement(s,{record:E[e],resource:x,basePath:P,source:f,className:L.chipField,color:"secondary",onClick:$}))):t.createElement(c,{value:E[e],key:e},t.createElement(s,{record:E[e],resource:x,basePath:P,source:f,className:L.chipField,color:"secondary",onClick:$}))})),p&&t.createElement(I,{color:"primary",className:L.addIcon,onClick:p}))},G=function(e){return e.stopPropagation()},H=function(){},J=function(t){var r=t.children,n=t.linkType,a=t.externalLinks,o=t.spacing,i=t.xs,s=t.sm,d=t.md,f=t.lg,p=t.xl,h=l(),b=h.data,v=h.basePath,y=S(a);return e.createElement(w,{container:!0,spacing:o},b.map((function(t){if(!t||t._error)return null;var a,l=y(t);return a=l?e.createElement("a",{href:l,target:"_blank",rel:"noopener noreferrer",onClick:G},e.cloneElement(e.Children.only(r),{basePath:r.props.basePath||v,externalLink:!0,onClick:H})):n?e.createElement(u,{to:m(v,t.id,n),onClick:G},e.cloneElement(e.Children.only(r),{basePath:r.props.basePath||v,onClick:H})):e.cloneElement(e.Children.only(r),{basePath:r.props.basePath||v}),e.createElement(w,{item:!0,key:t.id,xs:i,sm:s,md:d,lg:f,xl:p},e.createElement(c,{value:t},a))})))};J.defaultProps={xs:6,spacing:3,linkType:"edit",externalLinks:!1};var K=N((function(){return{grid:{display:"flex",marginLeft:-20,marginBottom:-20,width:"auto"},column:{paddingLeft:20,backgroundClip:"padding-box"},card:{marginBottom:20},media:{height:0,paddingTop:"56.25%"}}})),Q=function(e){var r=e.image,n=e.content,a=e.actions,o=e.breakpointCols,i=e.linkType,c=K(),s=l(),d=s.ids,f=s.data,p=s.basePath;return t.createElement(A,{breakpointCols:o,className:c.grid,columnClassName:c.column},d.map((function(e){if(!f[e]||f[e]._error)return null;var l="function"==typeof r?r(f[e]):r;return t.createElement(P,{key:e,className:c.card},t.createElement(u,{to:m(p,e)+"/"+i},t.createElement(x,null,l&&t.createElement(C,{className:c.media,image:l}),n&&t.createElement(L,null,n(f[e])))),a&&t.createElement(O,null,a.map((function(r){return t.createElement(r,{record:f[e],basePath:p})}))))})))};Q.defaultProps={breakpointCols:{default:3,1050:2,700:1},linkType:"edit"};var X=function(e){var r=e.source,n=e.id,a=o(),l=d(a),i=l.data,c=l.isLoading;return t.createElement(t.Fragment,null,"Â ",!c&&t.createElement("span",{className:"filter-count"},"("+Object.values(i).filter((function(e){return[].concat(e[r]).includes(n)})).length+")"))},Y=function(e){var n,a=e.reference,i=e.source,c=e.inverseSource,s=e.limit,u=e.sort,m=e.filter,b=e.label,v=e.icon,y=e.showCounters,g=d(a,{page:1,perPage:s},u,m),E=g.data,k=g.isLoading,w=f({resource:a}),P=o();V(P);var x=T(P),C=l();C.displayedFilters,C.filterValues;var L=C.setFilters;C.hideFilter,r((function(){var e=new URLSearchParams(window.location.search);Object.fromEntries(e.entries()).filter||k||L({})}),[]);return t.createElement(p,{label:b||(null==w||null===(n=w.options)||void 0===n?void 0:n.label)||"",icon:v||null!=w&&w.icon?t.createElement(w.icon):void 0},E&&E.filter((function(e){return function(e){if(!c)return!0;if(!x||!e)return!1;var t=!1;return Object.values(x).forEach((function(r){r.forEach((function(r){[].concat(e[c]).forEach((function(e){null!=e&&e.startsWith(r)&&(t=!0)}))}))})),t}(e)})).map((function(e){return t.createElement(h,{key:e.id,label:t.createElement("span",{className:"filter-label"},e["pair:label"],y&&t.createElement(X,{source:i,id:e.id})),value:(r={},n=i,a=e.id,n in r?Object.defineProperty(r,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[n]=a,r)});var r,n,a})))};Y.defaultProps={limit:25,showCounters:!0};var Z=t.createContext({views:null,currentView:null,setView:function(){return null}}),ee=function(){var e=new URLSearchParams(U().search),r=t.useContext(Z),n=r.views,a=r.currentView,l=r.setView;return n?Object.entries(n).filter((function(e){return W(e,1)[0]!==a})).map((function(r){var n=W(r,2),a=n[0],o=n[1];return e.set("view",a),e.set("page",1),e.set("perPage",o.perPage),o.sort&&(e.set("sort",o.sort.field),e.set("order",o.sort.order)),t.createElement(u,{key:a,to:"?"+e.toString()},t.createElement(b,{onClick:function(){return l(a)},label:o.label},t.createElement(o.icon)))})):null},te=["bulkActions","basePath","sort","displayedFilters","exporter","filters","filterValues","onUnselectItems","resource","selectedIds","showFilter","total"],re=function(e){var r=e.bulkActions,n=e.basePath,l=e.sort,o=e.displayedFilters,i=e.exporter,c=e.filters,s=e.filterValues,u=e.onUnselectItems,m=e.resource,d=e.selectedIds,p=e.showFilter,h=e.total,b=R(e,te),E=W(a(),1)[0],k=j((function(){return E.breakpoints.down("sm")})),w=f(b);return t.createElement(v,null,t.createElement(ee,null),c&&t.cloneElement(c,{resource:m,showFilter:p,displayedFilters:o,filterValues:s,context:"button"}),w.hasCreate&&t.createElement(y,{basePath:n}),!k&&!1!==i&&t.createElement(g,{disabled:0===h,resource:m,sort:l,filter:s,exporter:i}),r&&t.cloneElement(r,{basePath:n,filterValues:s,resource:m,selectedIds:d,onUnselectItems:u}))},ne=["children","actions","views","ListComponent"],ae=function(e){e.children;var r=e.actions,a=e.views,l=e.ListComponent,o=R(e,ne),i=new URLSearchParams(U().search),c=i.has("view")?i.get("view"):Object.keys(a)[0],s=W(n(c),2),u=s[0],m=s[1];return t.createElement(Z.Provider,{value:{views:a,currentView:u,setView:m}},t.createElement(l,_({actions:r,pagination:a[u].pagination,perPage:a[c].perPage,sort:a[c].sort},o),a[u].list))};ae.defaultProps={actions:t.createElement(re,null),ListComponent:E};export{q as ChipList,J as GridList,re as ListActionsWithViews,Z as ListViewContext,Q as MasonryList,ae as MultiViewsList,Y as ReferenceFilter,ee as ViewsButtons};
//# sourceMappingURL=index.es.js.map
