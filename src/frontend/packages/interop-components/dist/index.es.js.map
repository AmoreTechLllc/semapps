{"version":3,"file":"index.es.js","sources":["../src/hooks/useFork.js","../src/hooks/useSync.js","../src/forms/ImportForm.js","../src/forms/CreateOrImportForm.js"],"sourcesContent":["import { useCallback } from 'react';\nimport { useDataProvider, useRedirect, useNotify } from 'react-admin';\n\nconst useFork = resourceId => {\n  const dataProvider = useDataProvider();\n  const redirect = useRedirect();\n  const notify = useNotify();\n\n  return useCallback(\n    async (remoteRecordUri, stripProperties = []) => {\n      const { data: remoteData } = await dataProvider.getOne(resourceId, { id: remoteRecordUri });\n\n      let strippedData = { ...remoteData };\n      strippedData['http://www.w3.org/ns/prov#wasDerivedFrom'] = strippedData.id;\n      delete strippedData.id;\n      delete strippedData['@context'];\n      stripProperties.forEach(prop => {\n        delete strippedData[prop];\n      });\n\n      const { data: localData } = await dataProvider.create(resourceId, { data: strippedData });\n\n      redirect('/' + resourceId + '/' + encodeURIComponent(localData.id) + '/show');\n      notify('La ressource a bien été copiée', { type: 'success' });\n    },\n    [resourceId, dataProvider, redirect, notify]\n  );\n};\n\nexport default useFork;\n","import { useCallback } from 'react';\nimport { useNotify } from 'react-admin';\nimport { useCreateContainer } from '@semapps/semantic-data-provider';\n\nconst useSync = resourceId => {\n  const notify = useNotify();\n  const createContainerUri = useCreateContainer(resourceId);\n\n  return useCallback(\n    async remoteRecordUri => {\n      notify(\"Cette méthode n'est pas disponible pour le moment\", { type: 'error' });\n    },\n    [notify, createContainerUri]\n  );\n};\n\nexport default useSync;\n","import React, { useCallback } from 'react';\nimport { FormInput, TextInput, RadioButtonGroupInput } from 'react-admin';\nimport { Form } from 'react-final-form';\nimport createDecorator from 'final-form-calculate';\nimport { Box, Toolbar, makeStyles, Button } from '@material-ui/core';\nimport SaveAltIcon from '@material-ui/icons/SaveAlt';\nimport { ReferenceInput, useContainers } from '@semapps/semantic-data-provider';\nimport { MultiServerAutocompleteInput } from '@semapps/input-components';\nimport useFork from '../hooks/useFork';\nimport useSync from '../hooks/useSync';\n\nconst useStyles = makeStyles(theme => ({\n  toolbar: {\n    backgroundColor: theme.palette.type === 'light' ? theme.palette.grey[100] : theme.palette.grey[900],\n    marginTop: theme.spacing(2)\n  },\n  field: {\n    marginBottom: 23,\n    minWidth: theme.spacing(20)\n  }\n}));\n\nconst decorator = createDecorator(\n  {\n    field: 'remoteUri',\n    updates: value => {\n      if (value) {\n        return { plainUri: value };\n      }\n      return {};\n    }\n  },\n  {\n    field: 'plainUri',\n    updates: (value, name, allValues) => {\n      if (value !== allValues.remoteUri) {\n        return { remoteUri: null };\n      }\n      return {};\n    }\n  }\n);\n\nconst ImportForm = ({ basePath, record, resource, stripProperties }) => {\n  const classes = useStyles();\n  const containers = useContainers(resource, '@remote');\n  const fork = useFork(resource);\n  const sync = useSync(resource);\n\n  const onSubmit = useCallback(\n    async ({ plainUri, method }) => {\n      if (method === 'fork') {\n        await fork(plainUri, stripProperties);\n      } else {\n        await sync(plainUri);\n      }\n    },\n    [fork, sync, stripProperties]\n  );\n\n  return (\n    <Form\n      onSubmit={onSubmit}\n      decorators={[decorator]}\n      initialValues={{ method: 'fork' }}\n      render={({ handleSubmit, dirtyFields }) => (\n        <form onSubmit={handleSubmit}>\n          <Box m=\"1em\">\n            {containers && Object.keys(containers).length > 0 && (\n              <FormInput\n                input={\n                  <ReferenceInput\n                    source=\"remoteUri\"\n                    label=\"Rechercher...\"\n                    reference={resource}\n                    filter={{ _servers: '@remote' }}\n                    fullWidth\n                  >\n                    <MultiServerAutocompleteInput\n                      optionText=\"pair:label\"\n                      shouldRenderSuggestions={value => value.length > 1}\n                      resettable\n                    />\n                  </ReferenceInput>\n                }\n                basePath={basePath}\n                record={record}\n                resource={resource}\n                variant=\"filled\"\n                margin=\"dense\"\n              />\n            )}\n            <FormInput\n              input={<TextInput source=\"plainUri\" label=\"URL de la ressource distante\" fullWidth />}\n              basePath={basePath}\n              record={record}\n              resource={resource}\n              variant=\"filled\"\n              margin=\"dense\"\n            />\n            <FormInput\n              input={\n                <RadioButtonGroupInput\n                  source=\"method\"\n                  label=\"Méthode d'importation\"\n                  choices={[\n                    { id: 'fork', name: 'Créer une nouvelle version de la ressource (fork)' },\n                    { id: 'sync', name: 'Garder la ressource locale synchronisée avec la ressource distante' }\n                  ]}\n                />\n              }\n              basePath={basePath}\n              record={record}\n              resource={resource}\n              variant=\"filled\"\n              margin=\"dense\"\n            />\n          </Box>\n          <Toolbar className={classes.toolbar}>\n            <Button\n              type=\"submit\"\n              startIcon={<SaveAltIcon />}\n              variant=\"contained\"\n              color=\"primary\"\n              disabled={!dirtyFields.remoteUri}\n            >\n              Importer\n            </Button>\n          </Toolbar>\n        </form>\n      )}\n    />\n  );\n};\n\nexport default ImportForm;\n","import React, { useState } from 'react';\nimport { SimpleForm } from 'react-admin';\nimport { Box, Tab, Tabs, Divider, makeStyles, useMediaQuery } from '@material-ui/core';\nimport ImportForm from './ImportForm';\n\nconst useStyles = makeStyles(theme => ({\n  tab: {\n    maxWidth: 'unset',\n    padding: '6px 24px'\n  }\n}));\n\nconst CreateOrImportForm = ({ stripProperties, ...rest }) => {\n  const [tab, setTab] = useState(0);\n  const xs = useMediaQuery(theme => theme.breakpoints.down('xs'), { noSsr: true });\n  const classes = useStyles();\n  return (\n    <>\n      <Box pb={2} fullWidth>\n        <Tabs value={tab} onChange={(_, v) => setTab(v)} indicatorColor=\"primary\">\n          <Tab className={classes.tab} label=\"Créer\" />\n          <Tab className={classes.tab} label={xs ? 'Importer' : 'Importer une ressource distante'} />\n        </Tabs>\n        <Divider />\n      </Box>\n      {tab === 0 && <SimpleForm {...rest} />}\n      {tab === 1 && <ImportForm stripProperties={stripProperties || []} {...rest} />}\n    </>\n  );\n};\n\nexport default CreateOrImportForm;\n"],"names":["useFork","resourceId","dataProvider","useDataProvider","redirect","useRedirect","notify","useNotify","useCallback","remoteRecordUri","stripProperties","getOne","id","remoteData","data","strippedData","forEach","prop","create","localData","encodeURIComponent","type","useSync","createContainerUri","useCreateContainer","useStyles","makeStyles","theme","toolbar","backgroundColor","palette","grey","marginTop","spacing","field","marginBottom","minWidth","decorator","createDecorator","updates","value","plainUri","name","allValues","remoteUri","ImportForm","basePath","record","resource","classes","containers","useContainers","fork","sync","onSubmit","method","React","Form","decorators","initialValues","render","handleSubmit","dirtyFields","Box","m","Object","keys","length","FormInput","input","ReferenceInput","source","label","reference","filter","_servers","fullWidth","MultiServerAutocompleteInput","optionText","shouldRenderSuggestions","resettable","variant","margin","TextInput","RadioButtonGroupInput","choices","Toolbar","className","Button","startIcon","SaveAltIcon","color","disabled","tab","maxWidth","padding","CreateOrImportForm","rest","useState","setTab","xs","useMediaQuery","breakpoints","down","noSsr","pb","Tabs","onChange","_","v","indicatorColor","Tab","Divider","SimpleForm"],"mappings":"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"}