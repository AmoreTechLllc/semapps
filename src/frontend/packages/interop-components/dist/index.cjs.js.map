{"version":3,"file":"index.cjs.js","sources":["../src/hooks/useFork.js","../src/hooks/useSync.js","../src/forms/ImportForm.js","../src/forms/CreateOrImportForm.js"],"sourcesContent":["import { useCallback } from 'react';\nimport { useDataProvider, useRedirect, useNotify } from \"react-admin\";\n\nconst useFork = resourceId => {\n  const dataProvider = useDataProvider();\n  const redirect = useRedirect();\n  const notify = useNotify();\n\n  return useCallback(async (remoteRecordUri, stripProperties = []) => {\n    const { data: remoteData } = await dataProvider.getOne(resourceId, { id: remoteRecordUri });\n\n    let strippedData = { ...remoteData };\n    strippedData['http://www.w3.org/ns/prov#wasDerivedFrom'] = strippedData.id;\n    delete strippedData.id;\n    delete strippedData['@context'];\n    stripProperties.forEach(prop => {\n      delete strippedData[prop];\n    });\n\n    const { data: localData } = await dataProvider.create(resourceId, { data: strippedData })\n\n    redirect('/' + resourceId + '/' + encodeURIComponent(localData.id) + '/show');\n    notify('La ressource a bien été copiée', { type: 'success' });\n  }, [resourceId, dataProvider, redirect, notify]);\n};\n\nexport default useFork;\n","import { useCallback } from 'react';\nimport { useNotify } from \"react-admin\";\nimport { useCreateContainer } from \"@semapps/semantic-data-provider\";\n\nconst useSync = resourceId => {\n  const notify = useNotify();\n  const createContainerUri = useCreateContainer(resourceId);\n\n  return useCallback(async (remoteRecordUri) => {\n    notify(\"Cette méthode n'est pas disponible pour le moment\", { type: 'error' });\n  }, [notify, createContainerUri]);\n};\n\nexport default useSync;\n","import React, { useCallback } from 'react';\nimport { FormInput, TextInput, RadioButtonGroupInput } from \"react-admin\";\nimport { Form } from 'react-final-form';\nimport createDecorator from 'final-form-calculate'\nimport { Box, Toolbar, makeStyles, Button } from '@material-ui/core';\nimport SaveAltIcon from '@material-ui/icons/SaveAlt';\nimport { ReferenceInput, useContainers } from '@semapps/semantic-data-provider';\nimport { MultiServerAutocompleteInput } from '@semapps/input-components';\nimport useFork from \"../hooks/useFork\";\nimport useSync from \"../hooks/useSync\";\n\nconst useStyles = makeStyles(theme => ({\n  toolbar: {\n    backgroundColor: theme.palette.type === 'light' ? theme.palette.grey[100] : theme.palette.grey[900],\n    marginTop: theme.spacing(2),\n  },\n  field: {\n    marginBottom: 23,\n    minWidth: theme.spacing(20),\n  }\n}));\n\nconst decorator = createDecorator(\n  {\n    field: 'remoteUri',\n    updates: value => {\n      if( value ) {\n        return { plainUri: value };\n      }\n      return {};\n    }\n  },\n  {\n    field: 'plainUri',\n    updates: (value, name, allValues) => {\n      if( value !== allValues.remoteUri ) {\n        return { remoteUri: null };\n      }\n      return {};\n    }\n  }\n);\n\nconst ImportForm = ({ basePath, record, resource, stripProperties }) => {\n  const classes = useStyles();\n  const containers = useContainers(resource, '@remote');\n  const fork = useFork(resource);\n  const sync = useSync(resource);\n\n  const onSubmit = useCallback(async ({ plainUri, method }) => {\n    if( method === 'fork' ) {\n      await fork(plainUri, stripProperties);\n    } else {\n      await sync(plainUri);\n    }\n  }, [fork, sync, stripProperties]);\n\n  return (\n    <Form\n      onSubmit={onSubmit}\n      decorators={[decorator]}\n      initialValues={{ method: 'fork' }}\n      render={({ handleSubmit, dirtyFields }) => (\n        <form onSubmit={handleSubmit}>\n          <Box m=\"1em\">\n            {containers && Object.keys(containers).length > 0 &&\n              <FormInput\n                input={\n                  <ReferenceInput source=\"remoteUri\" label=\"Rechercher...\" reference={resource} filter={{ _servers: '@remote' }} fullWidth>\n                    <MultiServerAutocompleteInput optionText=\"pair:label\" shouldRenderSuggestions={value => value.length > 1} resettable />\n                  </ReferenceInput>\n                }\n                basePath={basePath}\n                record={record}\n                resource={resource}\n                variant=\"filled\"\n                margin=\"dense\"\n              />\n            }\n            <FormInput\n              input={\n                <TextInput source=\"plainUri\" label=\"URL de la ressource distante\" fullWidth />\n              }\n              basePath={basePath}\n              record={record}\n              resource={resource}\n              variant=\"filled\"\n              margin=\"dense\"\n            />\n            <FormInput\n              input={\n                <RadioButtonGroupInput source=\"method\" label=\"Méthode d'importation\" choices={[\n                  { id: 'fork', name: 'Créer une nouvelle version de la ressource (fork)' },\n                  { id: 'sync', name: 'Garder la ressource locale synchronisée avec la ressource distante' },\n                ]} />\n              }\n              basePath={basePath}\n              record={record}\n              resource={resource}\n              variant=\"filled\"\n              margin=\"dense\"\n            />\n          </Box>\n          <Toolbar className={classes.toolbar}>\n            <Button type=\"submit\" startIcon={<SaveAltIcon />} variant=\"contained\" color=\"primary\" disabled={!dirtyFields.remoteUri}>Importer</Button>\n          </Toolbar>\n        </form>\n      )}\n    />\n  );\n};\n\nexport default ImportForm;","import React, { useState } from 'react';\nimport { SimpleForm } from 'react-admin';\nimport { Box, Tab, Tabs, Divider, makeStyles, useMediaQuery } from '@material-ui/core';\nimport ImportForm from './ImportForm';\n\nconst useStyles = makeStyles(theme => ({\n  tab: {\n    maxWidth: 'unset',\n    padding: '6px 24px'\n  }\n}));\n\nconst CreateOrImportForm = ({ stripProperties, ...rest }) => {\n  const [tab, setTab] = useState(0);\n  const xs = useMediaQuery(theme => theme.breakpoints.down('xs'), { noSsr: true });\n  const classes = useStyles();\n  return (\n    <>\n      <Box pb={2} fullWidth>\n        <Tabs value={tab} onChange={(_, v) => setTab(v)} indicatorColor=\"primary\">\n          <Tab className={classes.tab} label=\"Créer\" />\n          <Tab className={classes.tab} label={xs ? 'Importer' : 'Importer une ressource distante'} />\n        </Tabs>\n        <Divider />\n      </Box>\n      {tab === 0 && <SimpleForm {...rest} />}\n      {tab === 1 && <ImportForm stripProperties={stripProperties || []} {...rest} />}\n    </>\n  );\n};\n\nexport default CreateOrImportForm;\n"],"names":["useFork","resourceId","dataProvider","useDataProvider","redirect","useRedirect","notify","useNotify","useCallback","remoteRecordUri","stripProperties","getOne","id","remoteData","data","strippedData","forEach","prop","create","localData","encodeURIComponent","type","useSync","createContainerUri","useCreateContainer","useStyles","makeStyles","theme","toolbar","backgroundColor","palette","grey","marginTop","spacing","field","marginBottom","minWidth","decorator","createDecorator","updates","value","plainUri","name","allValues","remoteUri","ImportForm","basePath","record","resource","classes","containers","useContainers","fork","sync","onSubmit","method","React","Form","decorators","initialValues","render","handleSubmit","dirtyFields","Box","m","Object","keys","length","FormInput","input","ReferenceInput","source","label","reference","filter","_servers","fullWidth","MultiServerAutocompleteInput","optionText","shouldRenderSuggestions","resettable","variant","margin","TextInput","RadioButtonGroupInput","choices","Toolbar","className","Button","startIcon","SaveAltIcon","color","disabled","tab","maxWidth","padding","rest","useState","setTab","xs","useMediaQuery","breakpoints","down","noSsr","pb","Tabs","onChange","_","v","indicatorColor","Tab","Divider","SimpleForm"],"mappings":"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"}